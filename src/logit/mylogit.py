#!/usr/bin/env python3
# Generated by Futhark 0.20.2
import sys
import numpy as np
import ctypes as ct
# Stub code for OpenCL setup.

import pyopencl as cl
import numpy as np
import sys

if cl.version.VERSION < (2015,2):
    raise Exception('Futhark requires at least PyOpenCL version 2015.2.  Installed version is %s.' %
                    cl.version.VERSION_TEXT)

def parse_preferred_device(s):
    pref_num = 0
    if len(s) > 1 and s[0] == '#':
        i = 1
        while i < len(s):
            if not s[i].isdigit():
                break
            else:
                pref_num = pref_num * 10 + int(s[i])
            i += 1
        while i < len(s) and s[i].isspace():
            i += 1
        return (s[i:], pref_num)
    else:
        return (s, 0)

def get_prefered_context(interactive=False, platform_pref=None, device_pref=None):
    if device_pref != None:
        (device_pref, device_num) = parse_preferred_device(device_pref)
    else:
        device_num = 0

    if interactive:
        return cl.create_some_context(interactive=True)

    def blacklisted(p, d):
        return platform_pref == None and device_pref == None and \
            p.name == "Apple" and d.name.find("Intel(R) Core(TM)") >= 0
    def platform_ok(p):
        return not platform_pref or p.name.find(platform_pref) >= 0
    def device_ok(d):
        return not device_pref or d.name.find(device_pref) >= 0

    device_matches = 0

    for p in cl.get_platforms():
        if not platform_ok(p):
            continue
        for d in p.get_devices():
            if blacklisted(p,d) or not device_ok(d):
                continue
            if device_matches == device_num:
                return cl.Context(devices=[d])
            else:
                device_matches += 1
    raise Exception('No OpenCL platform and device matching constraints found.')

def size_assignment(s):
    name, value = s.split('=')
    return (name, int(value))

def check_types(self, required_types):
    if 'f64' in required_types:
        if self.device.get_info(cl.device_info.PREFERRED_VECTOR_WIDTH_DOUBLE) == 0:
            raise Exception('Program uses double-precision floats, but this is not supported on chosen device: %s' % self.device.name)

def apply_size_heuristics(self, size_heuristics, sizes):
    for (platform_name, device_type, size, valuef) in size_heuristics:
        if sizes[size] == None \
           and self.platform.name.find(platform_name) >= 0 \
           and (self.device.type & device_type) == device_type:
               sizes[size] = valuef(self.device)
    return sizes

def initialise_opencl_object(self,
                             program_src='',
                             command_queue=None,
                             interactive=False,
                             platform_pref=None,
                             device_pref=None,
                             default_group_size=None,
                             default_num_groups=None,
                             default_tile_size=None,
                             default_reg_tile_size=None,
                             default_threshold=None,
                             size_heuristics=[],
                             required_types=[],
                             all_sizes={},
                             user_sizes={}):
    if command_queue is None:
        self.ctx = get_prefered_context(interactive, platform_pref, device_pref)
        self.queue = cl.CommandQueue(self.ctx)
    else:
        self.ctx = command_queue.context
        self.queue = command_queue
    self.device = self.queue.device
    self.platform = self.device.platform
    self.pool = cl.tools.MemoryPool(cl.tools.ImmediateAllocator(self.queue))
    device_type = self.device.type

    check_types(self, required_types)

    max_group_size = int(self.device.max_work_group_size)
    max_tile_size = int(np.sqrt(self.device.max_work_group_size))

    self.max_group_size = max_group_size
    self.max_tile_size = max_tile_size
    self.max_threshold = 0
    self.max_num_groups = 0

    self.max_local_memory = int(self.device.local_mem_size)

    # Futhark reserves 4 bytes of local memory for its own purposes.
    self.max_local_memory -= 4

    # See comment in rts/c/opencl.h.
    if self.platform.name.find('NVIDIA CUDA') >= 0:
        self.max_local_memory -= 12
    elif self.platform.name.find('AMD') >= 0:
        self.max_local_memory -= 16

    self.free_list = {}

    self.global_failure = self.pool.allocate(np.int32().itemsize)
    cl.enqueue_fill_buffer(self.queue, self.global_failure, np.int32(-1), 0, np.int32().itemsize)
    self.global_failure_args = self.pool.allocate(np.int64().itemsize *
                                                  (self.global_failure_args_max+1))
    self.failure_is_an_option = np.int32(0)

    if 'default_group_size' in sizes:
        default_group_size = sizes['default_group_size']
        del sizes['default_group_size']

    if 'default_num_groups' in sizes:
        default_num_groups = sizes['default_num_groups']
        del sizes['default_num_groups']

    if 'default_tile_size' in sizes:
        default_tile_size = sizes['default_tile_size']
        del sizes['default_tile_size']

    if 'default_reg_tile_size' in sizes:
        default_reg_tile_size = sizes['default_reg_tile_size']
        del sizes['default_reg_tile_size']

    if 'default_threshold' in sizes:
        default_threshold = sizes['default_threshold']
        del sizes['default_threshold']

    default_group_size_set = default_group_size != None
    default_tile_size_set = default_tile_size != None
    default_sizes = apply_size_heuristics(self, size_heuristics,
                                          {'group_size': default_group_size,
                                           'tile_size': default_tile_size,
                                           'reg_tile_size': default_reg_tile_size,
                                           'num_groups': default_num_groups,
                                           'lockstep_width': None,
                                           'threshold': default_threshold})
    default_group_size = default_sizes['group_size']
    default_num_groups = default_sizes['num_groups']
    default_threshold = default_sizes['threshold']
    default_tile_size = default_sizes['tile_size']
    default_reg_tile_size = default_sizes['reg_tile_size']
    lockstep_width = default_sizes['lockstep_width']

    if default_group_size > max_group_size:
        if default_group_size_set:
            sys.stderr.write('Note: Device limits group size to {} (down from {})\n'.
                             format(max_tile_size, default_group_size))
        default_group_size = max_group_size

    if default_tile_size > max_tile_size:
        if default_tile_size_set:
            sys.stderr.write('Note: Device limits tile size to {} (down from {})\n'.
                             format(max_tile_size, default_tile_size))
        default_tile_size = max_tile_size

    for (k,v) in user_sizes.items():
        if k in all_sizes:
            all_sizes[k]['value'] = v
        else:
            raise Exception('Unknown size: {}\nKnown sizes: {}'.format(k, ' '.join(all_sizes.keys())))

    self.sizes = {}
    for (k,v) in all_sizes.items():
        if v['class'] == 'group_size':
            max_value = max_group_size
            default_value = default_group_size
        elif v['class'] == 'num_groups':
            max_value = max_group_size # Intentional!
            default_value = default_num_groups
        elif v['class'] == 'tile_size':
            max_value = max_tile_size
            default_value = default_tile_size
        elif v['class'] == 'reg_tile_size':
            max_value = None
            default_value = default_reg_tile_size
        elif v['class'].startswith('threshold'):
            max_value = None
            default_value = default_threshold
        else:
            # Bespoke sizes have no limit or default.
            max_value = None
        if v['value'] == None:
            self.sizes[k] = default_value
        elif max_value != None and v['value'] > max_value:
            sys.stderr.write('Note: Device limits {} to {} (down from {}\n'.
                             format(k, max_value, v['value']))
            self.sizes[k] = max_value
        else:
            self.sizes[k] = v['value']

    # XXX: we perform only a subset of z-encoding here.  Really, the
    # compiler should provide us with the variables to which
    # parameters are mapped.
    if (len(program_src) >= 0):
        build_options = []

        build_options += ["-DLOCKSTEP_WIDTH={}".format(lockstep_width)]

        build_options += ["-D{}={}".format(s.replace('z', 'zz').replace('.', 'zi').replace('#', 'zh'),v) for (s,v) in self.sizes.items()]

        if (self.platform.name == 'Oclgrind'):
            build_options += ['-DEMULATE_F16']

        return cl.Program(self.ctx, program_src).build(build_options)

def opencl_alloc(self, min_size, tag):
    min_size = 1 if min_size == 0 else min_size
    assert min_size > 0
    return self.pool.allocate(min_size)

def opencl_free_all(self):
    self.pool.free_held()

def sync(self):
    failure = np.empty(1, dtype=np.int32)
    cl.enqueue_copy(self.queue, failure, self.global_failure, is_blocking=True)
    self.failure_is_an_option = np.int32(0)
    if failure[0] >= 0:
        # Reset failure information.
        cl.enqueue_fill_buffer(self.queue, self.global_failure, np.int32(-1), 0, np.int32().itemsize)

        # Read failure args.
        failure_args = np.empty(self.global_failure_args_max+1, dtype=np.int64)
        cl.enqueue_copy(self.queue, failure_args, self.global_failure_args, is_blocking=True)

        raise Exception(self.failure_msgs[failure[0]].format(*failure_args))
import pyopencl.array
import time
import argparse
sizes = {}
synchronous = False
preferred_platform = None
preferred_device = None
default_threshold = None
default_group_size = None
default_num_groups = None
default_tile_size = None
default_reg_tile_size = None
fut_opencl_src = """
// Clang-based OpenCL implementations need this for 'static' to work.
#ifdef cl_clang_storage_class_specifiers
#pragma OPENCL EXTENSION cl_clang_storage_class_specifiers : enable
#endif
#pragma OPENCL EXTENSION cl_khr_byte_addressable_store : enable

#pragma OPENCL EXTENSION cl_khr_fp64 : enable
#define FUTHARK_F64_ENABLED

// Some OpenCL programs dislike empty progams, or programs with no kernels.
// Declare a dummy kernel to ensure they remain our friends.
__kernel void dummy_kernel(__global unsigned char *dummy, int n)
{
    const int thread_gid = get_global_id(0);
    if (thread_gid >= n) return;
}

#pragma OPENCL EXTENSION cl_khr_int64_base_atomics : enable
#pragma OPENCL EXTENSION cl_khr_int64_extended_atomics : enable

typedef char int8_t;
typedef short int16_t;
typedef int int32_t;
typedef long int64_t;

typedef uchar uint8_t;
typedef ushort uint16_t;
typedef uint uint32_t;
typedef ulong uint64_t;

// NVIDIAs OpenCL does not create device-wide memory fences (see #734), so we
// use inline assembly if we detect we are on an NVIDIA GPU.
#ifdef cl_nv_pragma_unroll
static inline void mem_fence_global() {
  asm("membar.gl;");
}
#else
static inline void mem_fence_global() {
  mem_fence(CLK_LOCAL_MEM_FENCE | CLK_GLOBAL_MEM_FENCE);
}
#endif
static inline void mem_fence_local() {
  mem_fence(CLK_LOCAL_MEM_FENCE);
}
// Start of half.h.

// Conversion functions are from http://half.sourceforge.net/, but
// translated to C.
//
// Copyright (c) 2012-2021 Christian Rau
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

#ifndef __OPENCL_VERSION__
#define __constant
#endif

__constant static const uint16_t base_table[512] = {
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0002, 0x0004, 0x0008, 0x0010, 0x0020, 0x0040, 0x0080, 0x0100,
  0x0200, 0x0400, 0x0800, 0x0C00, 0x1000, 0x1400, 0x1800, 0x1C00, 0x2000, 0x2400, 0x2800, 0x2C00, 0x3000, 0x3400, 0x3800, 0x3C00,
  0x4000, 0x4400, 0x4800, 0x4C00, 0x5000, 0x5400, 0x5800, 0x5C00, 0x6000, 0x6400, 0x6800, 0x6C00, 0x7000, 0x7400, 0x7800, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8001, 0x8002, 0x8004, 0x8008, 0x8010, 0x8020, 0x8040, 0x8080, 0x8100,
  0x8200, 0x8400, 0x8800, 0x8C00, 0x9000, 0x9400, 0x9800, 0x9C00, 0xA000, 0xA400, 0xA800, 0xAC00, 0xB000, 0xB400, 0xB800, 0xBC00,
  0xC000, 0xC400, 0xC800, 0xCC00, 0xD000, 0xD400, 0xD800, 0xDC00, 0xE000, 0xE400, 0xE800, 0xEC00, 0xF000, 0xF400, 0xF800, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00 };

__constant static const unsigned char shift_table[512] = {
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13 };

__constant static const uint32_t mantissa_table[2048] = {
  0x00000000, 0x33800000, 0x34000000, 0x34400000, 0x34800000, 0x34A00000, 0x34C00000, 0x34E00000, 0x35000000, 0x35100000, 0x35200000, 0x35300000, 0x35400000, 0x35500000, 0x35600000, 0x35700000,
  0x35800000, 0x35880000, 0x35900000, 0x35980000, 0x35A00000, 0x35A80000, 0x35B00000, 0x35B80000, 0x35C00000, 0x35C80000, 0x35D00000, 0x35D80000, 0x35E00000, 0x35E80000, 0x35F00000, 0x35F80000,
  0x36000000, 0x36040000, 0x36080000, 0x360C0000, 0x36100000, 0x36140000, 0x36180000, 0x361C0000, 0x36200000, 0x36240000, 0x36280000, 0x362C0000, 0x36300000, 0x36340000, 0x36380000, 0x363C0000,
  0x36400000, 0x36440000, 0x36480000, 0x364C0000, 0x36500000, 0x36540000, 0x36580000, 0x365C0000, 0x36600000, 0x36640000, 0x36680000, 0x366C0000, 0x36700000, 0x36740000, 0x36780000, 0x367C0000,
  0x36800000, 0x36820000, 0x36840000, 0x36860000, 0x36880000, 0x368A0000, 0x368C0000, 0x368E0000, 0x36900000, 0x36920000, 0x36940000, 0x36960000, 0x36980000, 0x369A0000, 0x369C0000, 0x369E0000,
  0x36A00000, 0x36A20000, 0x36A40000, 0x36A60000, 0x36A80000, 0x36AA0000, 0x36AC0000, 0x36AE0000, 0x36B00000, 0x36B20000, 0x36B40000, 0x36B60000, 0x36B80000, 0x36BA0000, 0x36BC0000, 0x36BE0000,
  0x36C00000, 0x36C20000, 0x36C40000, 0x36C60000, 0x36C80000, 0x36CA0000, 0x36CC0000, 0x36CE0000, 0x36D00000, 0x36D20000, 0x36D40000, 0x36D60000, 0x36D80000, 0x36DA0000, 0x36DC0000, 0x36DE0000,
  0x36E00000, 0x36E20000, 0x36E40000, 0x36E60000, 0x36E80000, 0x36EA0000, 0x36EC0000, 0x36EE0000, 0x36F00000, 0x36F20000, 0x36F40000, 0x36F60000, 0x36F80000, 0x36FA0000, 0x36FC0000, 0x36FE0000,
  0x37000000, 0x37010000, 0x37020000, 0x37030000, 0x37040000, 0x37050000, 0x37060000, 0x37070000, 0x37080000, 0x37090000, 0x370A0000, 0x370B0000, 0x370C0000, 0x370D0000, 0x370E0000, 0x370F0000,
  0x37100000, 0x37110000, 0x37120000, 0x37130000, 0x37140000, 0x37150000, 0x37160000, 0x37170000, 0x37180000, 0x37190000, 0x371A0000, 0x371B0000, 0x371C0000, 0x371D0000, 0x371E0000, 0x371F0000,
  0x37200000, 0x37210000, 0x37220000, 0x37230000, 0x37240000, 0x37250000, 0x37260000, 0x37270000, 0x37280000, 0x37290000, 0x372A0000, 0x372B0000, 0x372C0000, 0x372D0000, 0x372E0000, 0x372F0000,
  0x37300000, 0x37310000, 0x37320000, 0x37330000, 0x37340000, 0x37350000, 0x37360000, 0x37370000, 0x37380000, 0x37390000, 0x373A0000, 0x373B0000, 0x373C0000, 0x373D0000, 0x373E0000, 0x373F0000,
  0x37400000, 0x37410000, 0x37420000, 0x37430000, 0x37440000, 0x37450000, 0x37460000, 0x37470000, 0x37480000, 0x37490000, 0x374A0000, 0x374B0000, 0x374C0000, 0x374D0000, 0x374E0000, 0x374F0000,
  0x37500000, 0x37510000, 0x37520000, 0x37530000, 0x37540000, 0x37550000, 0x37560000, 0x37570000, 0x37580000, 0x37590000, 0x375A0000, 0x375B0000, 0x375C0000, 0x375D0000, 0x375E0000, 0x375F0000,
  0x37600000, 0x37610000, 0x37620000, 0x37630000, 0x37640000, 0x37650000, 0x37660000, 0x37670000, 0x37680000, 0x37690000, 0x376A0000, 0x376B0000, 0x376C0000, 0x376D0000, 0x376E0000, 0x376F0000,
  0x37700000, 0x37710000, 0x37720000, 0x37730000, 0x37740000, 0x37750000, 0x37760000, 0x37770000, 0x37780000, 0x37790000, 0x377A0000, 0x377B0000, 0x377C0000, 0x377D0000, 0x377E0000, 0x377F0000,
  0x37800000, 0x37808000, 0x37810000, 0x37818000, 0x37820000, 0x37828000, 0x37830000, 0x37838000, 0x37840000, 0x37848000, 0x37850000, 0x37858000, 0x37860000, 0x37868000, 0x37870000, 0x37878000,
  0x37880000, 0x37888000, 0x37890000, 0x37898000, 0x378A0000, 0x378A8000, 0x378B0000, 0x378B8000, 0x378C0000, 0x378C8000, 0x378D0000, 0x378D8000, 0x378E0000, 0x378E8000, 0x378F0000, 0x378F8000,
  0x37900000, 0x37908000, 0x37910000, 0x37918000, 0x37920000, 0x37928000, 0x37930000, 0x37938000, 0x37940000, 0x37948000, 0x37950000, 0x37958000, 0x37960000, 0x37968000, 0x37970000, 0x37978000,
  0x37980000, 0x37988000, 0x37990000, 0x37998000, 0x379A0000, 0x379A8000, 0x379B0000, 0x379B8000, 0x379C0000, 0x379C8000, 0x379D0000, 0x379D8000, 0x379E0000, 0x379E8000, 0x379F0000, 0x379F8000,
  0x37A00000, 0x37A08000, 0x37A10000, 0x37A18000, 0x37A20000, 0x37A28000, 0x37A30000, 0x37A38000, 0x37A40000, 0x37A48000, 0x37A50000, 0x37A58000, 0x37A60000, 0x37A68000, 0x37A70000, 0x37A78000,
  0x37A80000, 0x37A88000, 0x37A90000, 0x37A98000, 0x37AA0000, 0x37AA8000, 0x37AB0000, 0x37AB8000, 0x37AC0000, 0x37AC8000, 0x37AD0000, 0x37AD8000, 0x37AE0000, 0x37AE8000, 0x37AF0000, 0x37AF8000,
  0x37B00000, 0x37B08000, 0x37B10000, 0x37B18000, 0x37B20000, 0x37B28000, 0x37B30000, 0x37B38000, 0x37B40000, 0x37B48000, 0x37B50000, 0x37B58000, 0x37B60000, 0x37B68000, 0x37B70000, 0x37B78000,
  0x37B80000, 0x37B88000, 0x37B90000, 0x37B98000, 0x37BA0000, 0x37BA8000, 0x37BB0000, 0x37BB8000, 0x37BC0000, 0x37BC8000, 0x37BD0000, 0x37BD8000, 0x37BE0000, 0x37BE8000, 0x37BF0000, 0x37BF8000,
  0x37C00000, 0x37C08000, 0x37C10000, 0x37C18000, 0x37C20000, 0x37C28000, 0x37C30000, 0x37C38000, 0x37C40000, 0x37C48000, 0x37C50000, 0x37C58000, 0x37C60000, 0x37C68000, 0x37C70000, 0x37C78000,
  0x37C80000, 0x37C88000, 0x37C90000, 0x37C98000, 0x37CA0000, 0x37CA8000, 0x37CB0000, 0x37CB8000, 0x37CC0000, 0x37CC8000, 0x37CD0000, 0x37CD8000, 0x37CE0000, 0x37CE8000, 0x37CF0000, 0x37CF8000,
  0x37D00000, 0x37D08000, 0x37D10000, 0x37D18000, 0x37D20000, 0x37D28000, 0x37D30000, 0x37D38000, 0x37D40000, 0x37D48000, 0x37D50000, 0x37D58000, 0x37D60000, 0x37D68000, 0x37D70000, 0x37D78000,
  0x37D80000, 0x37D88000, 0x37D90000, 0x37D98000, 0x37DA0000, 0x37DA8000, 0x37DB0000, 0x37DB8000, 0x37DC0000, 0x37DC8000, 0x37DD0000, 0x37DD8000, 0x37DE0000, 0x37DE8000, 0x37DF0000, 0x37DF8000,
  0x37E00000, 0x37E08000, 0x37E10000, 0x37E18000, 0x37E20000, 0x37E28000, 0x37E30000, 0x37E38000, 0x37E40000, 0x37E48000, 0x37E50000, 0x37E58000, 0x37E60000, 0x37E68000, 0x37E70000, 0x37E78000,
  0x37E80000, 0x37E88000, 0x37E90000, 0x37E98000, 0x37EA0000, 0x37EA8000, 0x37EB0000, 0x37EB8000, 0x37EC0000, 0x37EC8000, 0x37ED0000, 0x37ED8000, 0x37EE0000, 0x37EE8000, 0x37EF0000, 0x37EF8000,
  0x37F00000, 0x37F08000, 0x37F10000, 0x37F18000, 0x37F20000, 0x37F28000, 0x37F30000, 0x37F38000, 0x37F40000, 0x37F48000, 0x37F50000, 0x37F58000, 0x37F60000, 0x37F68000, 0x37F70000, 0x37F78000,
  0x37F80000, 0x37F88000, 0x37F90000, 0x37F98000, 0x37FA0000, 0x37FA8000, 0x37FB0000, 0x37FB8000, 0x37FC0000, 0x37FC8000, 0x37FD0000, 0x37FD8000, 0x37FE0000, 0x37FE8000, 0x37FF0000, 0x37FF8000,
  0x38000000, 0x38004000, 0x38008000, 0x3800C000, 0x38010000, 0x38014000, 0x38018000, 0x3801C000, 0x38020000, 0x38024000, 0x38028000, 0x3802C000, 0x38030000, 0x38034000, 0x38038000, 0x3803C000,
  0x38040000, 0x38044000, 0x38048000, 0x3804C000, 0x38050000, 0x38054000, 0x38058000, 0x3805C000, 0x38060000, 0x38064000, 0x38068000, 0x3806C000, 0x38070000, 0x38074000, 0x38078000, 0x3807C000,
  0x38080000, 0x38084000, 0x38088000, 0x3808C000, 0x38090000, 0x38094000, 0x38098000, 0x3809C000, 0x380A0000, 0x380A4000, 0x380A8000, 0x380AC000, 0x380B0000, 0x380B4000, 0x380B8000, 0x380BC000,
  0x380C0000, 0x380C4000, 0x380C8000, 0x380CC000, 0x380D0000, 0x380D4000, 0x380D8000, 0x380DC000, 0x380E0000, 0x380E4000, 0x380E8000, 0x380EC000, 0x380F0000, 0x380F4000, 0x380F8000, 0x380FC000,
  0x38100000, 0x38104000, 0x38108000, 0x3810C000, 0x38110000, 0x38114000, 0x38118000, 0x3811C000, 0x38120000, 0x38124000, 0x38128000, 0x3812C000, 0x38130000, 0x38134000, 0x38138000, 0x3813C000,
  0x38140000, 0x38144000, 0x38148000, 0x3814C000, 0x38150000, 0x38154000, 0x38158000, 0x3815C000, 0x38160000, 0x38164000, 0x38168000, 0x3816C000, 0x38170000, 0x38174000, 0x38178000, 0x3817C000,
  0x38180000, 0x38184000, 0x38188000, 0x3818C000, 0x38190000, 0x38194000, 0x38198000, 0x3819C000, 0x381A0000, 0x381A4000, 0x381A8000, 0x381AC000, 0x381B0000, 0x381B4000, 0x381B8000, 0x381BC000,
  0x381C0000, 0x381C4000, 0x381C8000, 0x381CC000, 0x381D0000, 0x381D4000, 0x381D8000, 0x381DC000, 0x381E0000, 0x381E4000, 0x381E8000, 0x381EC000, 0x381F0000, 0x381F4000, 0x381F8000, 0x381FC000,
  0x38200000, 0x38204000, 0x38208000, 0x3820C000, 0x38210000, 0x38214000, 0x38218000, 0x3821C000, 0x38220000, 0x38224000, 0x38228000, 0x3822C000, 0x38230000, 0x38234000, 0x38238000, 0x3823C000,
  0x38240000, 0x38244000, 0x38248000, 0x3824C000, 0x38250000, 0x38254000, 0x38258000, 0x3825C000, 0x38260000, 0x38264000, 0x38268000, 0x3826C000, 0x38270000, 0x38274000, 0x38278000, 0x3827C000,
  0x38280000, 0x38284000, 0x38288000, 0x3828C000, 0x38290000, 0x38294000, 0x38298000, 0x3829C000, 0x382A0000, 0x382A4000, 0x382A8000, 0x382AC000, 0x382B0000, 0x382B4000, 0x382B8000, 0x382BC000,
  0x382C0000, 0x382C4000, 0x382C8000, 0x382CC000, 0x382D0000, 0x382D4000, 0x382D8000, 0x382DC000, 0x382E0000, 0x382E4000, 0x382E8000, 0x382EC000, 0x382F0000, 0x382F4000, 0x382F8000, 0x382FC000,
  0x38300000, 0x38304000, 0x38308000, 0x3830C000, 0x38310000, 0x38314000, 0x38318000, 0x3831C000, 0x38320000, 0x38324000, 0x38328000, 0x3832C000, 0x38330000, 0x38334000, 0x38338000, 0x3833C000,
  0x38340000, 0x38344000, 0x38348000, 0x3834C000, 0x38350000, 0x38354000, 0x38358000, 0x3835C000, 0x38360000, 0x38364000, 0x38368000, 0x3836C000, 0x38370000, 0x38374000, 0x38378000, 0x3837C000,
  0x38380000, 0x38384000, 0x38388000, 0x3838C000, 0x38390000, 0x38394000, 0x38398000, 0x3839C000, 0x383A0000, 0x383A4000, 0x383A8000, 0x383AC000, 0x383B0000, 0x383B4000, 0x383B8000, 0x383BC000,
  0x383C0000, 0x383C4000, 0x383C8000, 0x383CC000, 0x383D0000, 0x383D4000, 0x383D8000, 0x383DC000, 0x383E0000, 0x383E4000, 0x383E8000, 0x383EC000, 0x383F0000, 0x383F4000, 0x383F8000, 0x383FC000,
  0x38400000, 0x38404000, 0x38408000, 0x3840C000, 0x38410000, 0x38414000, 0x38418000, 0x3841C000, 0x38420000, 0x38424000, 0x38428000, 0x3842C000, 0x38430000, 0x38434000, 0x38438000, 0x3843C000,
  0x38440000, 0x38444000, 0x38448000, 0x3844C000, 0x38450000, 0x38454000, 0x38458000, 0x3845C000, 0x38460000, 0x38464000, 0x38468000, 0x3846C000, 0x38470000, 0x38474000, 0x38478000, 0x3847C000,
  0x38480000, 0x38484000, 0x38488000, 0x3848C000, 0x38490000, 0x38494000, 0x38498000, 0x3849C000, 0x384A0000, 0x384A4000, 0x384A8000, 0x384AC000, 0x384B0000, 0x384B4000, 0x384B8000, 0x384BC000,
  0x384C0000, 0x384C4000, 0x384C8000, 0x384CC000, 0x384D0000, 0x384D4000, 0x384D8000, 0x384DC000, 0x384E0000, 0x384E4000, 0x384E8000, 0x384EC000, 0x384F0000, 0x384F4000, 0x384F8000, 0x384FC000,
  0x38500000, 0x38504000, 0x38508000, 0x3850C000, 0x38510000, 0x38514000, 0x38518000, 0x3851C000, 0x38520000, 0x38524000, 0x38528000, 0x3852C000, 0x38530000, 0x38534000, 0x38538000, 0x3853C000,
  0x38540000, 0x38544000, 0x38548000, 0x3854C000, 0x38550000, 0x38554000, 0x38558000, 0x3855C000, 0x38560000, 0x38564000, 0x38568000, 0x3856C000, 0x38570000, 0x38574000, 0x38578000, 0x3857C000,
  0x38580000, 0x38584000, 0x38588000, 0x3858C000, 0x38590000, 0x38594000, 0x38598000, 0x3859C000, 0x385A0000, 0x385A4000, 0x385A8000, 0x385AC000, 0x385B0000, 0x385B4000, 0x385B8000, 0x385BC000,
  0x385C0000, 0x385C4000, 0x385C8000, 0x385CC000, 0x385D0000, 0x385D4000, 0x385D8000, 0x385DC000, 0x385E0000, 0x385E4000, 0x385E8000, 0x385EC000, 0x385F0000, 0x385F4000, 0x385F8000, 0x385FC000,
  0x38600000, 0x38604000, 0x38608000, 0x3860C000, 0x38610000, 0x38614000, 0x38618000, 0x3861C000, 0x38620000, 0x38624000, 0x38628000, 0x3862C000, 0x38630000, 0x38634000, 0x38638000, 0x3863C000,
  0x38640000, 0x38644000, 0x38648000, 0x3864C000, 0x38650000, 0x38654000, 0x38658000, 0x3865C000, 0x38660000, 0x38664000, 0x38668000, 0x3866C000, 0x38670000, 0x38674000, 0x38678000, 0x3867C000,
  0x38680000, 0x38684000, 0x38688000, 0x3868C000, 0x38690000, 0x38694000, 0x38698000, 0x3869C000, 0x386A0000, 0x386A4000, 0x386A8000, 0x386AC000, 0x386B0000, 0x386B4000, 0x386B8000, 0x386BC000,
  0x386C0000, 0x386C4000, 0x386C8000, 0x386CC000, 0x386D0000, 0x386D4000, 0x386D8000, 0x386DC000, 0x386E0000, 0x386E4000, 0x386E8000, 0x386EC000, 0x386F0000, 0x386F4000, 0x386F8000, 0x386FC000,
  0x38700000, 0x38704000, 0x38708000, 0x3870C000, 0x38710000, 0x38714000, 0x38718000, 0x3871C000, 0x38720000, 0x38724000, 0x38728000, 0x3872C000, 0x38730000, 0x38734000, 0x38738000, 0x3873C000,
  0x38740000, 0x38744000, 0x38748000, 0x3874C000, 0x38750000, 0x38754000, 0x38758000, 0x3875C000, 0x38760000, 0x38764000, 0x38768000, 0x3876C000, 0x38770000, 0x38774000, 0x38778000, 0x3877C000,
  0x38780000, 0x38784000, 0x38788000, 0x3878C000, 0x38790000, 0x38794000, 0x38798000, 0x3879C000, 0x387A0000, 0x387A4000, 0x387A8000, 0x387AC000, 0x387B0000, 0x387B4000, 0x387B8000, 0x387BC000,
  0x387C0000, 0x387C4000, 0x387C8000, 0x387CC000, 0x387D0000, 0x387D4000, 0x387D8000, 0x387DC000, 0x387E0000, 0x387E4000, 0x387E8000, 0x387EC000, 0x387F0000, 0x387F4000, 0x387F8000, 0x387FC000,
  0x38000000, 0x38002000, 0x38004000, 0x38006000, 0x38008000, 0x3800A000, 0x3800C000, 0x3800E000, 0x38010000, 0x38012000, 0x38014000, 0x38016000, 0x38018000, 0x3801A000, 0x3801C000, 0x3801E000,
  0x38020000, 0x38022000, 0x38024000, 0x38026000, 0x38028000, 0x3802A000, 0x3802C000, 0x3802E000, 0x38030000, 0x38032000, 0x38034000, 0x38036000, 0x38038000, 0x3803A000, 0x3803C000, 0x3803E000,
  0x38040000, 0x38042000, 0x38044000, 0x38046000, 0x38048000, 0x3804A000, 0x3804C000, 0x3804E000, 0x38050000, 0x38052000, 0x38054000, 0x38056000, 0x38058000, 0x3805A000, 0x3805C000, 0x3805E000,
  0x38060000, 0x38062000, 0x38064000, 0x38066000, 0x38068000, 0x3806A000, 0x3806C000, 0x3806E000, 0x38070000, 0x38072000, 0x38074000, 0x38076000, 0x38078000, 0x3807A000, 0x3807C000, 0x3807E000,
  0x38080000, 0x38082000, 0x38084000, 0x38086000, 0x38088000, 0x3808A000, 0x3808C000, 0x3808E000, 0x38090000, 0x38092000, 0x38094000, 0x38096000, 0x38098000, 0x3809A000, 0x3809C000, 0x3809E000,
  0x380A0000, 0x380A2000, 0x380A4000, 0x380A6000, 0x380A8000, 0x380AA000, 0x380AC000, 0x380AE000, 0x380B0000, 0x380B2000, 0x380B4000, 0x380B6000, 0x380B8000, 0x380BA000, 0x380BC000, 0x380BE000,
  0x380C0000, 0x380C2000, 0x380C4000, 0x380C6000, 0x380C8000, 0x380CA000, 0x380CC000, 0x380CE000, 0x380D0000, 0x380D2000, 0x380D4000, 0x380D6000, 0x380D8000, 0x380DA000, 0x380DC000, 0x380DE000,
  0x380E0000, 0x380E2000, 0x380E4000, 0x380E6000, 0x380E8000, 0x380EA000, 0x380EC000, 0x380EE000, 0x380F0000, 0x380F2000, 0x380F4000, 0x380F6000, 0x380F8000, 0x380FA000, 0x380FC000, 0x380FE000,
  0x38100000, 0x38102000, 0x38104000, 0x38106000, 0x38108000, 0x3810A000, 0x3810C000, 0x3810E000, 0x38110000, 0x38112000, 0x38114000, 0x38116000, 0x38118000, 0x3811A000, 0x3811C000, 0x3811E000,
  0x38120000, 0x38122000, 0x38124000, 0x38126000, 0x38128000, 0x3812A000, 0x3812C000, 0x3812E000, 0x38130000, 0x38132000, 0x38134000, 0x38136000, 0x38138000, 0x3813A000, 0x3813C000, 0x3813E000,
  0x38140000, 0x38142000, 0x38144000, 0x38146000, 0x38148000, 0x3814A000, 0x3814C000, 0x3814E000, 0x38150000, 0x38152000, 0x38154000, 0x38156000, 0x38158000, 0x3815A000, 0x3815C000, 0x3815E000,
  0x38160000, 0x38162000, 0x38164000, 0x38166000, 0x38168000, 0x3816A000, 0x3816C000, 0x3816E000, 0x38170000, 0x38172000, 0x38174000, 0x38176000, 0x38178000, 0x3817A000, 0x3817C000, 0x3817E000,
  0x38180000, 0x38182000, 0x38184000, 0x38186000, 0x38188000, 0x3818A000, 0x3818C000, 0x3818E000, 0x38190000, 0x38192000, 0x38194000, 0x38196000, 0x38198000, 0x3819A000, 0x3819C000, 0x3819E000,
  0x381A0000, 0x381A2000, 0x381A4000, 0x381A6000, 0x381A8000, 0x381AA000, 0x381AC000, 0x381AE000, 0x381B0000, 0x381B2000, 0x381B4000, 0x381B6000, 0x381B8000, 0x381BA000, 0x381BC000, 0x381BE000,
  0x381C0000, 0x381C2000, 0x381C4000, 0x381C6000, 0x381C8000, 0x381CA000, 0x381CC000, 0x381CE000, 0x381D0000, 0x381D2000, 0x381D4000, 0x381D6000, 0x381D8000, 0x381DA000, 0x381DC000, 0x381DE000,
  0x381E0000, 0x381E2000, 0x381E4000, 0x381E6000, 0x381E8000, 0x381EA000, 0x381EC000, 0x381EE000, 0x381F0000, 0x381F2000, 0x381F4000, 0x381F6000, 0x381F8000, 0x381FA000, 0x381FC000, 0x381FE000,
  0x38200000, 0x38202000, 0x38204000, 0x38206000, 0x38208000, 0x3820A000, 0x3820C000, 0x3820E000, 0x38210000, 0x38212000, 0x38214000, 0x38216000, 0x38218000, 0x3821A000, 0x3821C000, 0x3821E000,
  0x38220000, 0x38222000, 0x38224000, 0x38226000, 0x38228000, 0x3822A000, 0x3822C000, 0x3822E000, 0x38230000, 0x38232000, 0x38234000, 0x38236000, 0x38238000, 0x3823A000, 0x3823C000, 0x3823E000,
  0x38240000, 0x38242000, 0x38244000, 0x38246000, 0x38248000, 0x3824A000, 0x3824C000, 0x3824E000, 0x38250000, 0x38252000, 0x38254000, 0x38256000, 0x38258000, 0x3825A000, 0x3825C000, 0x3825E000,
  0x38260000, 0x38262000, 0x38264000, 0x38266000, 0x38268000, 0x3826A000, 0x3826C000, 0x3826E000, 0x38270000, 0x38272000, 0x38274000, 0x38276000, 0x38278000, 0x3827A000, 0x3827C000, 0x3827E000,
  0x38280000, 0x38282000, 0x38284000, 0x38286000, 0x38288000, 0x3828A000, 0x3828C000, 0x3828E000, 0x38290000, 0x38292000, 0x38294000, 0x38296000, 0x38298000, 0x3829A000, 0x3829C000, 0x3829E000,
  0x382A0000, 0x382A2000, 0x382A4000, 0x382A6000, 0x382A8000, 0x382AA000, 0x382AC000, 0x382AE000, 0x382B0000, 0x382B2000, 0x382B4000, 0x382B6000, 0x382B8000, 0x382BA000, 0x382BC000, 0x382BE000,
  0x382C0000, 0x382C2000, 0x382C4000, 0x382C6000, 0x382C8000, 0x382CA000, 0x382CC000, 0x382CE000, 0x382D0000, 0x382D2000, 0x382D4000, 0x382D6000, 0x382D8000, 0x382DA000, 0x382DC000, 0x382DE000,
  0x382E0000, 0x382E2000, 0x382E4000, 0x382E6000, 0x382E8000, 0x382EA000, 0x382EC000, 0x382EE000, 0x382F0000, 0x382F2000, 0x382F4000, 0x382F6000, 0x382F8000, 0x382FA000, 0x382FC000, 0x382FE000,
  0x38300000, 0x38302000, 0x38304000, 0x38306000, 0x38308000, 0x3830A000, 0x3830C000, 0x3830E000, 0x38310000, 0x38312000, 0x38314000, 0x38316000, 0x38318000, 0x3831A000, 0x3831C000, 0x3831E000,
  0x38320000, 0x38322000, 0x38324000, 0x38326000, 0x38328000, 0x3832A000, 0x3832C000, 0x3832E000, 0x38330000, 0x38332000, 0x38334000, 0x38336000, 0x38338000, 0x3833A000, 0x3833C000, 0x3833E000,
  0x38340000, 0x38342000, 0x38344000, 0x38346000, 0x38348000, 0x3834A000, 0x3834C000, 0x3834E000, 0x38350000, 0x38352000, 0x38354000, 0x38356000, 0x38358000, 0x3835A000, 0x3835C000, 0x3835E000,
  0x38360000, 0x38362000, 0x38364000, 0x38366000, 0x38368000, 0x3836A000, 0x3836C000, 0x3836E000, 0x38370000, 0x38372000, 0x38374000, 0x38376000, 0x38378000, 0x3837A000, 0x3837C000, 0x3837E000,
  0x38380000, 0x38382000, 0x38384000, 0x38386000, 0x38388000, 0x3838A000, 0x3838C000, 0x3838E000, 0x38390000, 0x38392000, 0x38394000, 0x38396000, 0x38398000, 0x3839A000, 0x3839C000, 0x3839E000,
  0x383A0000, 0x383A2000, 0x383A4000, 0x383A6000, 0x383A8000, 0x383AA000, 0x383AC000, 0x383AE000, 0x383B0000, 0x383B2000, 0x383B4000, 0x383B6000, 0x383B8000, 0x383BA000, 0x383BC000, 0x383BE000,
  0x383C0000, 0x383C2000, 0x383C4000, 0x383C6000, 0x383C8000, 0x383CA000, 0x383CC000, 0x383CE000, 0x383D0000, 0x383D2000, 0x383D4000, 0x383D6000, 0x383D8000, 0x383DA000, 0x383DC000, 0x383DE000,
  0x383E0000, 0x383E2000, 0x383E4000, 0x383E6000, 0x383E8000, 0x383EA000, 0x383EC000, 0x383EE000, 0x383F0000, 0x383F2000, 0x383F4000, 0x383F6000, 0x383F8000, 0x383FA000, 0x383FC000, 0x383FE000,
  0x38400000, 0x38402000, 0x38404000, 0x38406000, 0x38408000, 0x3840A000, 0x3840C000, 0x3840E000, 0x38410000, 0x38412000, 0x38414000, 0x38416000, 0x38418000, 0x3841A000, 0x3841C000, 0x3841E000,
  0x38420000, 0x38422000, 0x38424000, 0x38426000, 0x38428000, 0x3842A000, 0x3842C000, 0x3842E000, 0x38430000, 0x38432000, 0x38434000, 0x38436000, 0x38438000, 0x3843A000, 0x3843C000, 0x3843E000,
  0x38440000, 0x38442000, 0x38444000, 0x38446000, 0x38448000, 0x3844A000, 0x3844C000, 0x3844E000, 0x38450000, 0x38452000, 0x38454000, 0x38456000, 0x38458000, 0x3845A000, 0x3845C000, 0x3845E000,
  0x38460000, 0x38462000, 0x38464000, 0x38466000, 0x38468000, 0x3846A000, 0x3846C000, 0x3846E000, 0x38470000, 0x38472000, 0x38474000, 0x38476000, 0x38478000, 0x3847A000, 0x3847C000, 0x3847E000,
  0x38480000, 0x38482000, 0x38484000, 0x38486000, 0x38488000, 0x3848A000, 0x3848C000, 0x3848E000, 0x38490000, 0x38492000, 0x38494000, 0x38496000, 0x38498000, 0x3849A000, 0x3849C000, 0x3849E000,
  0x384A0000, 0x384A2000, 0x384A4000, 0x384A6000, 0x384A8000, 0x384AA000, 0x384AC000, 0x384AE000, 0x384B0000, 0x384B2000, 0x384B4000, 0x384B6000, 0x384B8000, 0x384BA000, 0x384BC000, 0x384BE000,
  0x384C0000, 0x384C2000, 0x384C4000, 0x384C6000, 0x384C8000, 0x384CA000, 0x384CC000, 0x384CE000, 0x384D0000, 0x384D2000, 0x384D4000, 0x384D6000, 0x384D8000, 0x384DA000, 0x384DC000, 0x384DE000,
  0x384E0000, 0x384E2000, 0x384E4000, 0x384E6000, 0x384E8000, 0x384EA000, 0x384EC000, 0x384EE000, 0x384F0000, 0x384F2000, 0x384F4000, 0x384F6000, 0x384F8000, 0x384FA000, 0x384FC000, 0x384FE000,
  0x38500000, 0x38502000, 0x38504000, 0x38506000, 0x38508000, 0x3850A000, 0x3850C000, 0x3850E000, 0x38510000, 0x38512000, 0x38514000, 0x38516000, 0x38518000, 0x3851A000, 0x3851C000, 0x3851E000,
  0x38520000, 0x38522000, 0x38524000, 0x38526000, 0x38528000, 0x3852A000, 0x3852C000, 0x3852E000, 0x38530000, 0x38532000, 0x38534000, 0x38536000, 0x38538000, 0x3853A000, 0x3853C000, 0x3853E000,
  0x38540000, 0x38542000, 0x38544000, 0x38546000, 0x38548000, 0x3854A000, 0x3854C000, 0x3854E000, 0x38550000, 0x38552000, 0x38554000, 0x38556000, 0x38558000, 0x3855A000, 0x3855C000, 0x3855E000,
  0x38560000, 0x38562000, 0x38564000, 0x38566000, 0x38568000, 0x3856A000, 0x3856C000, 0x3856E000, 0x38570000, 0x38572000, 0x38574000, 0x38576000, 0x38578000, 0x3857A000, 0x3857C000, 0x3857E000,
  0x38580000, 0x38582000, 0x38584000, 0x38586000, 0x38588000, 0x3858A000, 0x3858C000, 0x3858E000, 0x38590000, 0x38592000, 0x38594000, 0x38596000, 0x38598000, 0x3859A000, 0x3859C000, 0x3859E000,
  0x385A0000, 0x385A2000, 0x385A4000, 0x385A6000, 0x385A8000, 0x385AA000, 0x385AC000, 0x385AE000, 0x385B0000, 0x385B2000, 0x385B4000, 0x385B6000, 0x385B8000, 0x385BA000, 0x385BC000, 0x385BE000,
  0x385C0000, 0x385C2000, 0x385C4000, 0x385C6000, 0x385C8000, 0x385CA000, 0x385CC000, 0x385CE000, 0x385D0000, 0x385D2000, 0x385D4000, 0x385D6000, 0x385D8000, 0x385DA000, 0x385DC000, 0x385DE000,
  0x385E0000, 0x385E2000, 0x385E4000, 0x385E6000, 0x385E8000, 0x385EA000, 0x385EC000, 0x385EE000, 0x385F0000, 0x385F2000, 0x385F4000, 0x385F6000, 0x385F8000, 0x385FA000, 0x385FC000, 0x385FE000,
  0x38600000, 0x38602000, 0x38604000, 0x38606000, 0x38608000, 0x3860A000, 0x3860C000, 0x3860E000, 0x38610000, 0x38612000, 0x38614000, 0x38616000, 0x38618000, 0x3861A000, 0x3861C000, 0x3861E000,
  0x38620000, 0x38622000, 0x38624000, 0x38626000, 0x38628000, 0x3862A000, 0x3862C000, 0x3862E000, 0x38630000, 0x38632000, 0x38634000, 0x38636000, 0x38638000, 0x3863A000, 0x3863C000, 0x3863E000,
  0x38640000, 0x38642000, 0x38644000, 0x38646000, 0x38648000, 0x3864A000, 0x3864C000, 0x3864E000, 0x38650000, 0x38652000, 0x38654000, 0x38656000, 0x38658000, 0x3865A000, 0x3865C000, 0x3865E000,
  0x38660000, 0x38662000, 0x38664000, 0x38666000, 0x38668000, 0x3866A000, 0x3866C000, 0x3866E000, 0x38670000, 0x38672000, 0x38674000, 0x38676000, 0x38678000, 0x3867A000, 0x3867C000, 0x3867E000,
  0x38680000, 0x38682000, 0x38684000, 0x38686000, 0x38688000, 0x3868A000, 0x3868C000, 0x3868E000, 0x38690000, 0x38692000, 0x38694000, 0x38696000, 0x38698000, 0x3869A000, 0x3869C000, 0x3869E000,
  0x386A0000, 0x386A2000, 0x386A4000, 0x386A6000, 0x386A8000, 0x386AA000, 0x386AC000, 0x386AE000, 0x386B0000, 0x386B2000, 0x386B4000, 0x386B6000, 0x386B8000, 0x386BA000, 0x386BC000, 0x386BE000,
  0x386C0000, 0x386C2000, 0x386C4000, 0x386C6000, 0x386C8000, 0x386CA000, 0x386CC000, 0x386CE000, 0x386D0000, 0x386D2000, 0x386D4000, 0x386D6000, 0x386D8000, 0x386DA000, 0x386DC000, 0x386DE000,
  0x386E0000, 0x386E2000, 0x386E4000, 0x386E6000, 0x386E8000, 0x386EA000, 0x386EC000, 0x386EE000, 0x386F0000, 0x386F2000, 0x386F4000, 0x386F6000, 0x386F8000, 0x386FA000, 0x386FC000, 0x386FE000,
  0x38700000, 0x38702000, 0x38704000, 0x38706000, 0x38708000, 0x3870A000, 0x3870C000, 0x3870E000, 0x38710000, 0x38712000, 0x38714000, 0x38716000, 0x38718000, 0x3871A000, 0x3871C000, 0x3871E000,
  0x38720000, 0x38722000, 0x38724000, 0x38726000, 0x38728000, 0x3872A000, 0x3872C000, 0x3872E000, 0x38730000, 0x38732000, 0x38734000, 0x38736000, 0x38738000, 0x3873A000, 0x3873C000, 0x3873E000,
  0x38740000, 0x38742000, 0x38744000, 0x38746000, 0x38748000, 0x3874A000, 0x3874C000, 0x3874E000, 0x38750000, 0x38752000, 0x38754000, 0x38756000, 0x38758000, 0x3875A000, 0x3875C000, 0x3875E000,
  0x38760000, 0x38762000, 0x38764000, 0x38766000, 0x38768000, 0x3876A000, 0x3876C000, 0x3876E000, 0x38770000, 0x38772000, 0x38774000, 0x38776000, 0x38778000, 0x3877A000, 0x3877C000, 0x3877E000,
  0x38780000, 0x38782000, 0x38784000, 0x38786000, 0x38788000, 0x3878A000, 0x3878C000, 0x3878E000, 0x38790000, 0x38792000, 0x38794000, 0x38796000, 0x38798000, 0x3879A000, 0x3879C000, 0x3879E000,
  0x387A0000, 0x387A2000, 0x387A4000, 0x387A6000, 0x387A8000, 0x387AA000, 0x387AC000, 0x387AE000, 0x387B0000, 0x387B2000, 0x387B4000, 0x387B6000, 0x387B8000, 0x387BA000, 0x387BC000, 0x387BE000,
  0x387C0000, 0x387C2000, 0x387C4000, 0x387C6000, 0x387C8000, 0x387CA000, 0x387CC000, 0x387CE000, 0x387D0000, 0x387D2000, 0x387D4000, 0x387D6000, 0x387D8000, 0x387DA000, 0x387DC000, 0x387DE000,
  0x387E0000, 0x387E2000, 0x387E4000, 0x387E6000, 0x387E8000, 0x387EA000, 0x387EC000, 0x387EE000, 0x387F0000, 0x387F2000, 0x387F4000, 0x387F6000, 0x387F8000, 0x387FA000, 0x387FC000, 0x387FE000 };
__constant static const uint32_t exponent_table[64] = {
  0x00000000, 0x00800000, 0x01000000, 0x01800000, 0x02000000, 0x02800000, 0x03000000, 0x03800000, 0x04000000, 0x04800000, 0x05000000, 0x05800000, 0x06000000, 0x06800000, 0x07000000, 0x07800000,
  0x08000000, 0x08800000, 0x09000000, 0x09800000, 0x0A000000, 0x0A800000, 0x0B000000, 0x0B800000, 0x0C000000, 0x0C800000, 0x0D000000, 0x0D800000, 0x0E000000, 0x0E800000, 0x0F000000, 0x47800000,
  0x80000000, 0x80800000, 0x81000000, 0x81800000, 0x82000000, 0x82800000, 0x83000000, 0x83800000, 0x84000000, 0x84800000, 0x85000000, 0x85800000, 0x86000000, 0x86800000, 0x87000000, 0x87800000,
  0x88000000, 0x88800000, 0x89000000, 0x89800000, 0x8A000000, 0x8A800000, 0x8B000000, 0x8B800000, 0x8C000000, 0x8C800000, 0x8D000000, 0x8D800000, 0x8E000000, 0x8E800000, 0x8F000000, 0xC7800000 };
__constant static const unsigned short offset_table[64] = {
  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024,
  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024 };

static uint16_t float2halfbits(float value) {
  union { float x; uint32_t y; } u;
  u.x = value;
  uint32_t bits = u.y;

  uint16_t hbits = base_table[bits>>23] + (uint16_t)((bits&0x7FFFFF)>>shift_table[bits>>23]);;

  return hbits;
}

static float halfbits2float(uint16_t value) {
  uint32_t bits = mantissa_table[offset_table[value>>10]+(value&0x3FF)] + exponent_table[value>>10];

  union { uint32_t x; float y; } u;
  u.x = bits;
  return u.y;
}

// End of half.h.
// Start of scalar.h.

// Implementation of the primitive scalar operations.  Very
// repetitive.  This code is inserted directly into both CUDA and
// OpenCL programs, as well as the CPU code, so it has some #ifdefs to
// work everywhere.  Some operations are defined as macros because
// this allows us to use them as constant expressions in things like
// array sizes and static initialisers.

// Some of the #ifdefs are because OpenCL uses type-generic functions
// for some operations (e.g. sqrt), while C and CUDA sensibly use
// distinct functions for different precisions (e.g. sqrtf() and
// sqrt()).  This is quite annoying.  Due to C's unfortunate casting
// rules, it is also really easy to accidentally implement
// floating-point functions in the wrong precision, so be careful.

// Double-precision definitions are only included if the preprocessor
// macro FUTHARK_F64_ENABLED is set.

static inline uint8_t add8(uint8_t x, uint8_t y) {
  return x + y;
}

static inline uint16_t add16(uint16_t x, uint16_t y) {
  return x + y;
}

static inline uint32_t add32(uint32_t x, uint32_t y) {
  return x + y;
}

static inline uint64_t add64(uint64_t x, uint64_t y) {
  return x + y;
}

static inline uint8_t sub8(uint8_t x, uint8_t y) {
  return x - y;
}

static inline uint16_t sub16(uint16_t x, uint16_t y) {
  return x - y;
}

static inline uint32_t sub32(uint32_t x, uint32_t y) {
  return x - y;
}

static inline uint64_t sub64(uint64_t x, uint64_t y) {
  return x - y;
}

static inline uint8_t mul8(uint8_t x, uint8_t y) {
  return x * y;
}

static inline uint16_t mul16(uint16_t x, uint16_t y) {
  return x * y;
}

static inline uint32_t mul32(uint32_t x, uint32_t y) {
  return x * y;
}

static inline uint64_t mul64(uint64_t x, uint64_t y) {
  return x * y;
}

static inline uint8_t udiv8(uint8_t x, uint8_t y) {
  return x / y;
}

static inline uint16_t udiv16(uint16_t x, uint16_t y) {
  return x / y;
}

static inline uint32_t udiv32(uint32_t x, uint32_t y) {
  return x / y;
}

static inline uint64_t udiv64(uint64_t x, uint64_t y) {
  return x / y;
}

static inline uint8_t udiv_up8(uint8_t x, uint8_t y) {
  return (x + y - 1) / y;
}

static inline uint16_t udiv_up16(uint16_t x, uint16_t y) {
  return (x + y - 1) / y;
}

static inline uint32_t udiv_up32(uint32_t x, uint32_t y) {
  return (x + y - 1) / y;
}

static inline uint64_t udiv_up64(uint64_t x, uint64_t y) {
  return (x + y - 1) / y;
}

static inline uint8_t umod8(uint8_t x, uint8_t y) {
  return x % y;
}

static inline uint16_t umod16(uint16_t x, uint16_t y) {
  return x % y;
}

static inline uint32_t umod32(uint32_t x, uint32_t y) {
  return x % y;
}

static inline uint64_t umod64(uint64_t x, uint64_t y) {
  return x % y;
}

static inline uint8_t udiv_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : x / y;
}

static inline uint16_t udiv_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : x / y;
}

static inline uint32_t udiv_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : x / y;
}

static inline uint64_t udiv_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : x / y;
}

static inline uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

static inline uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

static inline uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

static inline uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

static inline uint8_t umod_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : x % y;
}

static inline uint16_t umod_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : x % y;
}

static inline uint32_t umod_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : x % y;
}

static inline uint64_t umod_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : x % y;
}

static inline int8_t sdiv8(int8_t x, int8_t y) {
  int8_t q = x / y;
  int8_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

static inline int16_t sdiv16(int16_t x, int16_t y) {
  int16_t q = x / y;
  int16_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

static inline int32_t sdiv32(int32_t x, int32_t y) {
  int32_t q = x / y;
  int32_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

static inline int64_t sdiv64(int64_t x, int64_t y) {
  int64_t q = x / y;
  int64_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

static inline int8_t sdiv_up8(int8_t x, int8_t y) {
  return sdiv8(x + y - 1, y);
}

static inline int16_t sdiv_up16(int16_t x, int16_t y) {
  return sdiv16(x + y - 1, y);
}

static inline int32_t sdiv_up32(int32_t x, int32_t y) {
  return sdiv32(x + y - 1, y);
}

static inline int64_t sdiv_up64(int64_t x, int64_t y) {
  return sdiv64(x + y - 1, y);
}

static inline int8_t smod8(int8_t x, int8_t y) {
  int8_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

static inline int16_t smod16(int16_t x, int16_t y) {
  int16_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

static inline int32_t smod32(int32_t x, int32_t y) {
  int32_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

static inline int64_t smod64(int64_t x, int64_t y) {
  int64_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

static inline int8_t sdiv_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : sdiv8(x, y);
}

static inline int16_t sdiv_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : sdiv16(x, y);
}

static inline int32_t sdiv_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : sdiv32(x, y);
}

static inline int64_t sdiv_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : sdiv64(x, y);
}

static inline int8_t sdiv_up_safe8(int8_t x, int8_t y) {
  return sdiv_safe8(x + y - 1, y);
}

static inline int16_t sdiv_up_safe16(int16_t x, int16_t y) {
  return sdiv_safe16(x + y - 1, y);
}

static inline int32_t sdiv_up_safe32(int32_t x, int32_t y) {
  return sdiv_safe32(x + y - 1, y);
}

static inline int64_t sdiv_up_safe64(int64_t x, int64_t y) {
  return sdiv_safe64(x + y - 1, y);
}

static inline int8_t smod_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : smod8(x, y);
}

static inline int16_t smod_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : smod16(x, y);
}

static inline int32_t smod_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : smod32(x, y);
}

static inline int64_t smod_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : smod64(x, y);
}

static inline int8_t squot8(int8_t x, int8_t y) {
  return x / y;
}

static inline int16_t squot16(int16_t x, int16_t y) {
  return x / y;
}

static inline int32_t squot32(int32_t x, int32_t y) {
  return x / y;
}

static inline int64_t squot64(int64_t x, int64_t y) {
  return x / y;
}

static inline int8_t srem8(int8_t x, int8_t y) {
  return x % y;
}

static inline int16_t srem16(int16_t x, int16_t y) {
  return x % y;
}

static inline int32_t srem32(int32_t x, int32_t y) {
  return x % y;
}

static inline int64_t srem64(int64_t x, int64_t y) {
  return x % y;
}

static inline int8_t squot_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : x / y;
}

static inline int16_t squot_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : x / y;
}

static inline int32_t squot_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : x / y;
}

static inline int64_t squot_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : x / y;
}

static inline int8_t srem_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : x % y;
}

static inline int16_t srem_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : x % y;
}

static inline int32_t srem_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : x % y;
}

static inline int64_t srem_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : x % y;
}

static inline int8_t smin8(int8_t x, int8_t y) {
  return x < y ? x : y;
}

static inline int16_t smin16(int16_t x, int16_t y) {
  return x < y ? x : y;
}

static inline int32_t smin32(int32_t x, int32_t y) {
  return x < y ? x : y;
}

static inline int64_t smin64(int64_t x, int64_t y) {
  return x < y ? x : y;
}

static inline uint8_t umin8(uint8_t x, uint8_t y) {
  return x < y ? x : y;
}

static inline uint16_t umin16(uint16_t x, uint16_t y) {
  return x < y ? x : y;
}

static inline uint32_t umin32(uint32_t x, uint32_t y) {
  return x < y ? x : y;
}

static inline uint64_t umin64(uint64_t x, uint64_t y) {
  return x < y ? x : y;
}

static inline int8_t smax8(int8_t x, int8_t y) {
  return x < y ? y : x;
}

static inline int16_t smax16(int16_t x, int16_t y) {
  return x < y ? y : x;
}

static inline int32_t smax32(int32_t x, int32_t y) {
  return x < y ? y : x;
}

static inline int64_t smax64(int64_t x, int64_t y) {
  return x < y ? y : x;
}

static inline uint8_t umax8(uint8_t x, uint8_t y) {
  return x < y ? y : x;
}

static inline uint16_t umax16(uint16_t x, uint16_t y) {
  return x < y ? y : x;
}

static inline uint32_t umax32(uint32_t x, uint32_t y) {
  return x < y ? y : x;
}

static inline uint64_t umax64(uint64_t x, uint64_t y) {
  return x < y ? y : x;
}

static inline uint8_t shl8(uint8_t x, uint8_t y) {
  return (uint8_t)(x << y);
}

static inline uint16_t shl16(uint16_t x, uint16_t y) {
  return (uint16_t)(x << y);
}

static inline uint32_t shl32(uint32_t x, uint32_t y) {
  return x << y;
}

static inline uint64_t shl64(uint64_t x, uint64_t y) {
  return x << y;
}

static inline uint8_t lshr8(uint8_t x, uint8_t y) {
  return x >> y;
}

static inline uint16_t lshr16(uint16_t x, uint16_t y) {
  return x >> y;
}

static inline uint32_t lshr32(uint32_t x, uint32_t y) {
  return x >> y;
}

static inline uint64_t lshr64(uint64_t x, uint64_t y) {
  return x >> y;
}

static inline int8_t ashr8(int8_t x, int8_t y) {
  return x >> y;
}

static inline int16_t ashr16(int16_t x, int16_t y) {
  return x >> y;
}

static inline int32_t ashr32(int32_t x, int32_t y) {
  return x >> y;
}

static inline int64_t ashr64(int64_t x, int64_t y) {
  return x >> y;
}

static inline uint8_t and8(uint8_t x, uint8_t y) {
  return x & y;
}

static inline uint16_t and16(uint16_t x, uint16_t y) {
  return x & y;
}

static inline uint32_t and32(uint32_t x, uint32_t y) {
  return x & y;
}

static inline uint64_t and64(uint64_t x, uint64_t y) {
  return x & y;
}

static inline uint8_t or8(uint8_t x, uint8_t y) {
  return x | y;
}

static inline uint16_t or16(uint16_t x, uint16_t y) {
  return x | y;
}

static inline uint32_t or32(uint32_t x, uint32_t y) {
  return x | y;
}

static inline uint64_t or64(uint64_t x, uint64_t y) {
  return x | y;
}

static inline uint8_t xor8(uint8_t x, uint8_t y) {
  return x ^ y;
}

static inline uint16_t xor16(uint16_t x, uint16_t y) {
  return x ^ y;
}

static inline uint32_t xor32(uint32_t x, uint32_t y) {
  return x ^ y;
}

static inline uint64_t xor64(uint64_t x, uint64_t y) {
  return x ^ y;
}

static inline bool ult8(uint8_t x, uint8_t y) {
  return x < y;
}

static inline bool ult16(uint16_t x, uint16_t y) {
  return x < y;
}

static inline bool ult32(uint32_t x, uint32_t y) {
  return x < y;
}

static inline bool ult64(uint64_t x, uint64_t y) {
  return x < y;
}

static inline bool ule8(uint8_t x, uint8_t y) {
  return x <= y;
}

static inline bool ule16(uint16_t x, uint16_t y) {
  return x <= y;
}

static inline bool ule32(uint32_t x, uint32_t y) {
  return x <= y;
}

static inline bool ule64(uint64_t x, uint64_t y) {
  return x <= y;
}

static inline bool slt8(int8_t x, int8_t y) {
  return x < y;
}

static inline bool slt16(int16_t x, int16_t y) {
  return x < y;
}

static inline bool slt32(int32_t x, int32_t y) {
  return x < y;
}

static inline bool slt64(int64_t x, int64_t y) {
  return x < y;
}

static inline bool sle8(int8_t x, int8_t y) {
  return x <= y;
}

static inline bool sle16(int16_t x, int16_t y) {
  return x <= y;
}

static inline bool sle32(int32_t x, int32_t y) {
  return x <= y;
}

static inline bool sle64(int64_t x, int64_t y) {
  return x <= y;
}

static inline uint8_t pow8(uint8_t x, uint8_t y) {
  uint8_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

static inline uint16_t pow16(uint16_t x, uint16_t y) {
  uint16_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

static inline uint32_t pow32(uint32_t x, uint32_t y) {
  uint32_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

static inline uint64_t pow64(uint64_t x, uint64_t y) {
  uint64_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

static inline bool itob_i8_bool(int8_t x) {
  return x;
}

static inline bool itob_i16_bool(int16_t x) {
  return x;
}

static inline bool itob_i32_bool(int32_t x) {
  return x;
}

static inline bool itob_i64_bool(int64_t x) {
  return x;
}

static inline int8_t btoi_bool_i8(bool x) {
  return x;
}

static inline int16_t btoi_bool_i16(bool x) {
  return x;
}

static inline int32_t btoi_bool_i32(bool x) {
  return x;
}

static inline int64_t btoi_bool_i64(bool x) {
  return x;
}

#define sext_i8_i8(x) ((int8_t) (int8_t) (x))
#define sext_i8_i16(x) ((int16_t) (int8_t) (x))
#define sext_i8_i32(x) ((int32_t) (int8_t) (x))
#define sext_i8_i64(x) ((int64_t) (int8_t) (x))
#define sext_i16_i8(x) ((int8_t) (int16_t) (x))
#define sext_i16_i16(x) ((int16_t) (int16_t) (x))
#define sext_i16_i32(x) ((int32_t) (int16_t) (x))
#define sext_i16_i64(x) ((int64_t) (int16_t) (x))
#define sext_i32_i8(x) ((int8_t) (int32_t) (x))
#define sext_i32_i16(x) ((int16_t) (int32_t) (x))
#define sext_i32_i32(x) ((int32_t) (int32_t) (x))
#define sext_i32_i64(x) ((int64_t) (int32_t) (x))
#define sext_i64_i8(x) ((int8_t) (int64_t) (x))
#define sext_i64_i16(x) ((int16_t) (int64_t) (x))
#define sext_i64_i32(x) ((int32_t) (int64_t) (x))
#define sext_i64_i64(x) ((int64_t) (int64_t) (x))
#define zext_i8_i8(x) ((int8_t) (uint8_t) (x))
#define zext_i8_i16(x) ((int16_t) (uint8_t) (x))
#define zext_i8_i32(x) ((int32_t) (uint8_t) (x))
#define zext_i8_i64(x) ((int64_t) (uint8_t) (x))
#define zext_i16_i8(x) ((int8_t) (uint16_t) (x))
#define zext_i16_i16(x) ((int16_t) (uint16_t) (x))
#define zext_i16_i32(x) ((int32_t) (uint16_t) (x))
#define zext_i16_i64(x) ((int64_t) (uint16_t) (x))
#define zext_i32_i8(x) ((int8_t) (uint32_t) (x))
#define zext_i32_i16(x) ((int16_t) (uint32_t) (x))
#define zext_i32_i32(x) ((int32_t) (uint32_t) (x))
#define zext_i32_i64(x) ((int64_t) (uint32_t) (x))
#define zext_i64_i8(x) ((int8_t) (uint64_t) (x))
#define zext_i64_i16(x) ((int16_t) (uint64_t) (x))
#define zext_i64_i32(x) ((int32_t) (uint64_t) (x))
#define zext_i64_i64(x) ((int64_t) (uint64_t) (x))

static int8_t abs8(int8_t x) {
  return (int8_t)abs(x);
}

static int16_t abs16(int16_t x) {
  return (int16_t)abs(x);
}

static int32_t abs32(int32_t x) {
  return abs(x);
}

static int64_t abs64(int64_t x) {
#if defined(__OPENCL_VERSION__)
  return abs(x);
#else
  return llabs(x);
#endif
}

#if defined(__OPENCL_VERSION__)
static int32_t futrts_popc8(int8_t x) {
  return popcount(x);
}

static int32_t futrts_popc16(int16_t x) {
  return popcount(x);
}

static int32_t futrts_popc32(int32_t x) {
  return popcount(x);
}

static int32_t futrts_popc64(int64_t x) {
  return popcount(x);
}
#elif defined(__CUDA_ARCH__)

static int32_t futrts_popc8(int8_t x) {
  return __popc(zext_i8_i32(x));
}

static int32_t futrts_popc16(int16_t x) {
  return __popc(zext_i16_i32(x));
}

static int32_t futrts_popc32(int32_t x) {
  return __popc(x);
}

static int32_t futrts_popc64(int64_t x) {
  return __popcll(x);
}

#else // Not OpenCL or CUDA, but plain C.

static int32_t futrts_popc8(uint8_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

static int32_t futrts_popc16(uint16_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

static int32_t futrts_popc32(uint32_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

static int32_t futrts_popc64(uint64_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}
#endif

#if defined(__OPENCL_VERSION__)
static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b) {
  return mul_hi(a, b);
}

static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b) {
  return mul_hi(a, b);
}

static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b) {
  return mul_hi(a, b);
}

static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b) {
  return mul_hi(a, b);
}

#elif defined(__CUDA_ARCH__)

static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b) {
  uint16_t aa = a;
  uint16_t bb = b;

  return aa * bb >> 8;
}

static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b) {
  uint32_t aa = a;
  uint32_t bb = b;

  return aa * bb >> 16;
}

static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b) {
  return mulhi(a, b);
}

static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b) {
  return mul64hi(a, b);
}

#else // Not OpenCL or CUDA, but plain C.

static uint8_t futrts_mul_hi8(uint8_t a, uint8_t b) {
  uint16_t aa = a;
  uint16_t bb = b;

  return aa * bb >> 8;
}

static uint16_t futrts_mul_hi16(uint16_t a, uint16_t b) {
  uint32_t aa = a;
  uint32_t bb = b;

  return aa * bb >> 16;
}

static uint32_t futrts_mul_hi32(uint32_t a, uint32_t b) {
  uint64_t aa = a;
  uint64_t bb = b;

  return aa * bb >> 32;
}

static uint64_t futrts_mul_hi64(uint64_t a, uint64_t b) {
  __uint128_t aa = a;
  __uint128_t bb = b;

  return aa * bb >> 64;
}
#endif

#if defined(__OPENCL_VERSION__)
static uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c) {
  return mad_hi(a, b, c);
}

static uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c) {
  return mad_hi(a, b, c);
}

static uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c) {
  return mad_hi(a, b, c);
}

static uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c) {
  return mad_hi(a, b, c);
}

#else // Not OpenCL

static uint8_t futrts_mad_hi8(uint8_t a, uint8_t b, uint8_t c) {
  return futrts_mul_hi8(a, b) + c;
}

static uint16_t futrts_mad_hi16(uint16_t a, uint16_t b, uint16_t c) {
  return futrts_mul_hi16(a, b) + c;
}

static uint32_t futrts_mad_hi32(uint32_t a, uint32_t b, uint32_t c) {
  return futrts_mul_hi32(a, b) + c;
}

static uint64_t futrts_mad_hi64(uint64_t a, uint64_t b, uint64_t c) {
  return futrts_mul_hi64(a, b) + c;
}
#endif

#if defined(__OPENCL_VERSION__)
static int32_t futrts_clzz8(int8_t x) {
  return clz(x);
}

static int32_t futrts_clzz16(int16_t x) {
  return clz(x);
}

static int32_t futrts_clzz32(int32_t x) {
  return clz(x);
}

static int32_t futrts_clzz64(int64_t x) {
  return clz(x);
}

#elif defined(__CUDA_ARCH__)

static int32_t futrts_clzz8(int8_t x) {
  return __clz(zext_i8_i32(x)) - 24;
}

static int32_t futrts_clzz16(int16_t x) {
  return __clz(zext_i16_i32(x)) - 16;
}

static int32_t futrts_clzz32(int32_t x) {
  return __clz(x);
}

static int32_t futrts_clzz64(int64_t x) {
  return __clzll(x);
}

#else // Not OpenCL or CUDA, but plain C.

static int32_t futrts_clzz8(int8_t x) {
  return x == 0 ? 8 : __builtin_clz((uint32_t)zext_i8_i32(x)) - 24;
}

static int32_t futrts_clzz16(int16_t x) {
  return x == 0 ? 16 : __builtin_clz((uint32_t)zext_i16_i32(x)) - 16;
}

static int32_t futrts_clzz32(int32_t x) {
  return x == 0 ? 32 : __builtin_clz((uint32_t)x);
}

static int32_t futrts_clzz64(int64_t x) {
  return x == 0 ? 64 : __builtin_clzll((uint64_t)x);
}
#endif

#if defined(__OPENCL_VERSION__)
static int32_t futrts_ctzz8(int8_t x) {
  int i = 0;
  for (; i < 8 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

static int32_t futrts_ctzz16(int16_t x) {
  int i = 0;
  for (; i < 16 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

static int32_t futrts_ctzz32(int32_t x) {
  int i = 0;
  for (; i < 32 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

static int32_t futrts_ctzz64(int64_t x) {
  int i = 0;
  for (; i < 64 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

#elif defined(__CUDA_ARCH__)

static int32_t futrts_ctzz8(int8_t x) {
  int y = __ffs(x);
  return y == 0 ? 8 : y - 1;
}

static int32_t futrts_ctzz16(int16_t x) {
  int y = __ffs(x);
  return y == 0 ? 16 : y - 1;
}

static int32_t futrts_ctzz32(int32_t x) {
  int y = __ffs(x);
  return y == 0 ? 32 : y - 1;
}

static int32_t futrts_ctzz64(int64_t x) {
  int y = __ffsll(x);
  return y == 0 ? 64 : y - 1;
}

#else // Not OpenCL or CUDA, but plain C.

static int32_t futrts_ctzz8(int8_t x) {
  return x == 0 ? 8 : __builtin_ctz((uint32_t)x);
}

static int32_t futrts_ctzz16(int16_t x) {
  return x == 0 ? 16 : __builtin_ctz((uint32_t)x);
}

static int32_t futrts_ctzz32(int32_t x) {
  return x == 0 ? 32 : __builtin_ctz((uint32_t)x);
}

static int32_t futrts_ctzz64(int64_t x) {
  return x == 0 ? 64 : __builtin_ctzll((uint64_t)x);
}
#endif

static inline float fdiv32(float x, float y) {
  return x / y;
}

static inline float fadd32(float x, float y) {
  return x + y;
}

static inline float fsub32(float x, float y) {
  return x - y;
}

static inline float fmul32(float x, float y) {
  return x * y;
}

static inline bool cmplt32(float x, float y) {
  return x < y;
}

static inline bool cmple32(float x, float y) {
  return x <= y;
}

static inline float sitofp_i8_f32(int8_t x) {
  return (float) x;
}

static inline float sitofp_i16_f32(int16_t x) {
  return (float) x;
}

static inline float sitofp_i32_f32(int32_t x) {
  return (float) x;
}

static inline float sitofp_i64_f32(int64_t x) {
  return (float) x;
}

static inline float uitofp_i8_f32(uint8_t x) {
  return (float) x;
}

static inline float uitofp_i16_f32(uint16_t x) {
  return (float) x;
}

static inline float uitofp_i32_f32(uint32_t x) {
  return (float) x;
}

static inline float uitofp_i64_f32(uint64_t x) {
  return (float) x;
}

static inline int8_t fptosi_f32_i8(float x) {
  return (int8_t) x;
}

static inline int16_t fptosi_f32_i16(float x) {
  return (int16_t) x;
}

static inline int32_t fptosi_f32_i32(float x) {
  return (int32_t) x;
}

static inline int64_t fptosi_f32_i64(float x) {
  return (int64_t) x;
}

static inline uint8_t fptoui_f32_i8(float x) {
  return (uint8_t) x;
}

static inline uint16_t fptoui_f32_i16(float x) {
  return (uint16_t) x;
}

static inline uint32_t fptoui_f32_i32(float x) {
  return (uint32_t) x;
}

static inline uint64_t fptoui_f32_i64(float x) {
  return (uint64_t) x;
}

#ifdef __OPENCL_VERSION__
static inline float fabs32(float x) {
  return fabs(x);
}

static inline float fmax32(float x, float y) {
  return fmax(x, y);
}

static inline float fmin32(float x, float y) {
  return fmin(x, y);
}

static inline float fpow32(float x, float y) {
  return pow(x, y);
}

#else // Not OpenCL, but CUDA or plain C.

static inline float fabs32(float x) {
  return fabsf(x);
}

static inline float fmax32(float x, float y) {
  return fmaxf(x, y);
}

static inline float fmin32(float x, float y) {
  return fminf(x, y);
}

static inline float fpow32(float x, float y) {
  return powf(x, y);
}
#endif

static inline bool futrts_isnan32(float x) {
  return isnan(x);
}

static inline bool futrts_isinf32(float x) {
  return isinf(x);
}

#ifdef __OPENCL_VERSION__
static inline float futrts_log32(float x) {
  return log(x);
}

static inline float futrts_log2_32(float x) {
  return log2(x);
}

static inline float futrts_log10_32(float x) {
  return log10(x);
}

static inline float futrts_sqrt32(float x) {
  return sqrt(x);
}

static inline float futrts_exp32(float x) {
  return exp(x);
}

static inline float futrts_cos32(float x) {
  return cos(x);
}

static inline float futrts_sin32(float x) {
  return sin(x);
}

static inline float futrts_tan32(float x) {
  return tan(x);
}

static inline float futrts_acos32(float x) {
  return acos(x);
}

static inline float futrts_asin32(float x) {
  return asin(x);
}

static inline float futrts_atan32(float x) {
  return atan(x);
}

static inline float futrts_cosh32(float x) {
  return cosh(x);
}

static inline float futrts_sinh32(float x) {
  return sinh(x);
}

static inline float futrts_tanh32(float x) {
  return tanh(x);
}

static inline float futrts_acosh32(float x) {
  return acosh(x);
}

static inline float futrts_asinh32(float x) {
  return asinh(x);
}

static inline float futrts_atanh32(float x) {
  return atanh(x);
}

static inline float futrts_atan2_32(float x, float y) {
  return atan2(x, y);
}

static inline float futrts_hypot32(float x, float y) {
  return hypot(x, y);
}

static inline float futrts_gamma32(float x) {
  return tgamma(x);
}

static inline float futrts_lgamma32(float x) {
  return lgamma(x);
}

static inline float fmod32(float x, float y) {
  return fmod(x, y);
}

static inline float futrts_round32(float x) {
  return rint(x);
}

static inline float futrts_floor32(float x) {
  return floor(x);
}

static inline float futrts_ceil32(float x) {
  return ceil(x);
}

static inline float futrts_lerp32(float v0, float v1, float t) {
  return mix(v0, v1, t);
}

static inline float futrts_mad32(float a, float b, float c) {
  return mad(a, b, c);
}

static inline float futrts_fma32(float a, float b, float c) {
  return fma(a, b, c);
}

#else // Not OpenCL, but CUDA or plain C.

static inline float futrts_log32(float x) {
  return logf(x);
}

static inline float futrts_log2_32(float x) {
  return log2f(x);
}

static inline float futrts_log10_32(float x) {
  return log10f(x);
}

static inline float futrts_sqrt32(float x) {
  return sqrtf(x);
}

static inline float futrts_exp32(float x) {
  return expf(x);
}

static inline float futrts_cos32(float x) {
  return cosf(x);
}

static inline float futrts_sin32(float x) {
  return sinf(x);
}

static inline float futrts_tan32(float x) {
  return tanf(x);
}

static inline float futrts_acos32(float x) {
  return acosf(x);
}

static inline float futrts_asin32(float x) {
  return asinf(x);
}

static inline float futrts_atan32(float x) {
  return atanf(x);
}

static inline float futrts_cosh32(float x) {
  return coshf(x);
}

static inline float futrts_sinh32(float x) {
  return sinhf(x);
}

static inline float futrts_tanh32(float x) {
  return tanhf(x);
}

static inline float futrts_acosh32(float x) {
  return acoshf(x);
}

static inline float futrts_asinh32(float x) {
  return asinhf(x);
}

static inline float futrts_atanh32(float x) {
  return atanhf(x);
}

static inline float futrts_atan2_32(float x, float y) {
  return atan2f(x, y);
}

static inline float futrts_hypot32(float x, float y) {
  return hypotf(x, y);
}

static inline float futrts_gamma32(float x) {
  return tgammaf(x);
}

static inline float futrts_lgamma32(float x) {
  return lgammaf(x);
}

static inline float fmod32(float x, float y) {
  return fmodf(x, y);
}

static inline float futrts_round32(float x) {
  return rintf(x);
}

static inline float futrts_floor32(float x) {
  return floorf(x);
}

static inline float futrts_ceil32(float x) {
  return ceilf(x);
}

static inline float futrts_lerp32(float v0, float v1, float t) {
  return v0 + (v1 - v0) * t;
}

static inline float futrts_mad32(float a, float b, float c) {
  return a * b + c;
}

static inline float futrts_fma32(float a, float b, float c) {
  return fmaf(a, b, c);
}
#endif

static inline int32_t futrts_to_bits32(float x) {
  union {
    float f;
    int32_t t;
  } p;

  p.f = x;
  return p.t;
}

static inline float futrts_from_bits32(int32_t x) {
  union {
    int32_t f;
    float t;
  } p;

  p.f = x;
  return p.t;
}

static inline float fsignum32(float x) {
  return futrts_isnan32(x) ? x : (x > 0) - (x < 0);
}

#ifdef FUTHARK_F64_ENABLED

static inline double fdiv64(double x, double y) {
  return x / y;
}

static inline double fadd64(double x, double y) {
  return x + y;
}

static inline double fsub64(double x, double y) {
  return x - y;
}

static inline double fmul64(double x, double y) {
  return x * y;
}

static inline bool cmplt64(double x, double y) {
  return x < y;
}

static inline bool cmple64(double x, double y) {
  return x <= y;
}

static inline double sitofp_i8_f64(int8_t x) {
  return (double) x;
}

static inline double sitofp_i16_f64(int16_t x) {
  return (double) x;
}

static inline double sitofp_i32_f64(int32_t x) {
  return (double) x;
}

static inline double sitofp_i64_f64(int64_t x) {
  return (double) x;
}

static inline double uitofp_i8_f64(uint8_t x) {
  return (double) x;
}

static inline double uitofp_i16_f64(uint16_t x) {
  return (double) x;
}

static inline double uitofp_i32_f64(uint32_t x) {
  return (double) x;
}

static inline double uitofp_i64_f64(uint64_t x) {
  return (double) x;
}

static inline int8_t fptosi_f64_i8(double x) {
  return (int8_t) x;
}

static inline int16_t fptosi_f64_i16(double x) {
  return (int16_t) x;
}

static inline int32_t fptosi_f64_i32(double x) {
  return (int32_t) x;
}

static inline int64_t fptosi_f64_i64(double x) {
  return (int64_t) x;
}

static inline uint8_t fptoui_f64_i8(double x) {
  return (uint8_t) x;
}

static inline uint16_t fptoui_f64_i16(double x) {
  return (uint16_t) x;
}

static inline uint32_t fptoui_f64_i32(double x) {
  return (uint32_t) x;
}

static inline uint64_t fptoui_f64_i64(double x) {
  return (uint64_t) x;
}

static inline double fabs64(double x) {
  return fabs(x);
}

static inline double fmax64(double x, double y) {
  return fmax(x, y);
}

static inline double fmin64(double x, double y) {
  return fmin(x, y);
}

static inline double fpow64(double x, double y) {
  return pow(x, y);
}

static inline double futrts_log64(double x) {
  return log(x);
}

static inline double futrts_log2_64(double x) {
  return log2(x);
}

static inline double futrts_log10_64(double x) {
  return log10(x);
}

static inline double futrts_sqrt64(double x) {
  return sqrt(x);
}

static inline double futrts_exp64(double x) {
  return exp(x);
}

static inline double futrts_cos64(double x) {
  return cos(x);
}

static inline double futrts_sin64(double x) {
  return sin(x);
}

static inline double futrts_tan64(double x) {
  return tan(x);
}

static inline double futrts_acos64(double x) {
  return acos(x);
}

static inline double futrts_asin64(double x) {
  return asin(x);
}

static inline double futrts_atan64(double x) {
  return atan(x);
}

static inline double futrts_cosh64(double x) {
  return cosh(x);
}

static inline double futrts_sinh64(double x) {
  return sinh(x);
}

static inline double futrts_tanh64(double x) {
  return tanh(x);
}

static inline double futrts_acosh64(double x) {
  return acosh(x);
}

static inline double futrts_asinh64(double x) {
  return asinh(x);
}

static inline double futrts_atanh64(double x) {
  return atanh(x);
}

static inline double futrts_atan2_64(double x, double y) {
  return atan2(x, y);
}

static inline double futrts_hypot64(double x, double y) {
  return hypot(x, y);
}

static inline double futrts_gamma64(double x) {
  return tgamma(x);
}

static inline double futrts_lgamma64(double x) {
  return lgamma(x);
}

static inline double futrts_fma64(double a, double b, double c) {
  return fma(a, b, c);
}

static inline double futrts_round64(double x) {
  return rint(x);
}

static inline double futrts_ceil64(double x) {
  return ceil(x);
}

static inline double futrts_floor64(double x) {
  return floor(x);
}

static inline bool futrts_isnan64(double x) {
  return isnan(x);
}

static inline bool futrts_isinf64(double x) {
  return isinf(x);
}

static inline int64_t futrts_to_bits64(double x) {
  union {
    double f;
    int64_t t;
  } p;

  p.f = x;
  return p.t;
}

static inline double futrts_from_bits64(int64_t x) {
  union {
    int64_t f;
    double t;
  } p;

  p.f = x;
  return p.t;
}

static inline double fmod64(double x, double y) {
  return fmod(x, y);
}

static inline double fsignum64(double x) {
  return futrts_isnan64(x) ? x : (x > 0) - (x < 0);
}

static inline double futrts_lerp64(double v0, double v1, double t) {
#ifdef __OPENCL_VERSION__
  return mix(v0, v1, t);
#else
  return v0 + (v1 - v0) * t;
#endif
}

static inline double futrts_mad64(double a, double b, double c) {
#ifdef __OPENCL_VERSION__
  return mad(a, b, c);
#else
  return a * b + c;
#endif
}

static inline float fpconv_f32_f32(float x) {
  return (float) x;
}

static inline double fpconv_f32_f64(float x) {
  return (double) x;
}

static inline float fpconv_f64_f32(double x) {
  return (float) x;
}

static inline double fpconv_f64_f64(double x) {
  return (double) x;
}

#endif

// End of scalar.h.
// Start of scalar_f16.h.

// Half-precision is emulated if needed (e.g. in straight C) with the
// native type used if possible.  The emulation works by typedef'ing
// 'float' to 'f16', and then implementing all operations on single
// precision.  To cut down on duplication, we use the same code for
// those Futhark functions that require just operators or casts.  The
// in-memory representation for arrays will still be 16 bits even
// under emulation, so the compiler will have to be careful when
// generating reads or writes.

#if !defined(cl_khr_fp16) && !(defined(__CUDA_ARCH__) && __CUDA_ARCH__ >= 600)
#define EMULATE_F16
#endif

#if !defined(EMULATE_F16) && defined(__OPENCL_VERSION__)
#pragma OPENCL EXTENSION cl_khr_fp16 : enable
#endif

#ifdef EMULATE_F16

// Note that the half-precision storage format is still 16 bits - the
// compiler will have to be real careful!
typedef float f16;

#else

#ifdef __CUDA_ARCH__
#include <cuda_fp16.h>
#endif

typedef half f16;

#endif

// Some of these functions convert to single precision because half
// precision versions are not available.

static inline f16 fadd16(f16 x, f16 y) {
  return x + y;
}

static inline f16 fsub16(f16 x, f16 y) {
  return x - y;
}

static inline f16 fmul16(f16 x, f16 y) {
  return x * y;
}

static inline bool cmplt16(f16 x, f16 y) {
  return x < y;
}

static inline bool cmple16(f16 x, f16 y) {
  return x <= y;
}

static inline f16 sitofp_i8_f16(int8_t x) {
  return (f16) x;
}

static inline f16 sitofp_i16_f16(int16_t x) {
  return (f16) x;
}

static inline f16 sitofp_i32_f16(int32_t x) {
  return (f16) x;
}

static inline f16 sitofp_i64_f16(int64_t x) {
  return (f16) x;
}

static inline f16 uitofp_i8_f16(uint8_t x) {
  return (f16) x;
}

static inline f16 uitofp_i16_f16(uint16_t x) {
  return (f16) x;
}

static inline f16 uitofp_i32_f16(uint32_t x) {
  return (f16) x;
}

static inline f16 uitofp_i64_f16(uint64_t x) {
  return (f16) x;
}

static inline int8_t fptosi_f16_i8(f16 x) {
  return (int8_t) (float) x;
}

static inline int16_t fptosi_f16_i16(f16 x) {
  return (int16_t) x;
}

static inline int32_t fptosi_f16_i32(f16 x) {
  return (int32_t) x;
}

static inline int64_t fptosi_f16_i64(f16 x) {
  return (int64_t) x;
}

static inline uint8_t fptoui_f16_i8(f16 x) {
  return (uint8_t) (float) x;
}

static inline uint16_t fptoui_f16_i16(f16 x) {
  return (uint16_t) x;
}

static inline uint32_t fptoui_f16_i32(f16 x) {
  return (uint32_t) x;
}

static inline uint64_t fptoui_f16_i64(f16 x) {
  return (uint64_t) x;
}

#ifndef EMULATE_F16

#ifdef __OPENCL_VERSION__
static inline f16 fabs16(f16 x) {
  return fabs(x);
}

static inline f16 fmax16(f16 x, f16 y) {
  return fmax(x, y);
}

static inline f16 fmin16(f16 x, f16 y) {
  return fmin(x, y);
}

static inline f16 fpow16(f16 x, f16 y) {
  return pow(x, y);
}

#else // Assuming CUDA.

static inline f16 fabs16(f16 x) {
  return fabsf(x);
}

static inline f16 fmax16(f16 x, f16 y) {
  return fmaxf(x, y);
}

static inline f16 fmin16(f16 x, f16 y) {
  return fminf(x, y);
}

static inline f16 fpow16(f16 x, f16 y) {
  return powf(x, y);
}
#endif

static inline bool futrts_isnan16(f16 x) {
  return isnan((float)x);
}

static inline bool futrts_isinf16(f16 x) {
  return isinf((float)x);
}

#ifdef __OPENCL_VERSION__
static inline f16 futrts_log16(f16 x) {
  return log(x);
}

static inline f16 futrts_log2_16(f16 x) {
  return log2(x);
}

static inline f16 futrts_log10_16(f16 x) {
  return log10(x);
}

static inline f16 futrts_sqrt16(f16 x) {
  return sqrt(x);
}

static inline f16 futrts_exp16(f16 x) {
  return exp(x);
}

static inline f16 futrts_cos16(f16 x) {
  return cos(x);
}

static inline f16 futrts_sin16(f16 x) {
  return sin(x);
}

static inline f16 futrts_tan16(f16 x) {
  return tan(x);
}

static inline f16 futrts_acos16(f16 x) {
  return acos(x);
}

static inline f16 futrts_asin16(f16 x) {
  return asin(x);
}

static inline f16 futrts_atan16(f16 x) {
  return atan(x);
}

static inline f16 futrts_cosh16(f16 x) {
  return cosh(x);
}

static inline f16 futrts_sinh16(f16 x) {
  return sinh(x);
}

static inline f16 futrts_tanh16(f16 x) {
  return tanh(x);
}

static inline f16 futrts_acosh16(f16 x) {
  return acosh(x);
}

static inline f16 futrts_asinh16(f16 x) {
  return asinh(x);
}

static inline f16 futrts_atanh16(f16 x) {
  return atanh(x);
}

static inline f16 futrts_atan2_16(f16 x, f16 y) {
  return atan2(x, y);
}

static inline f16 futrts_hypot16(f16 x, f16 y) {
  return hypot(x, y);
}

static inline f16 futrts_gamma16(f16 x) {
  return tgamma(x);
}

static inline f16 futrts_lgamma16(f16 x) {
  return lgamma(x);
}

static inline f16 fmod16(f16 x, f16 y) {
  return fmod(x, y);
}

static inline f16 futrts_round16(f16 x) {
  return rint(x);
}

static inline f16 futrts_floor16(f16 x) {
  return floor(x);
}

static inline f16 futrts_ceil16(f16 x) {
  return ceil(x);
}

static inline f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return mix(v0, v1, t);
}

static inline f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return mad(a, b, c);
}

static inline f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return fma(a, b, c);
}

#else // Assume CUDA.

static inline f16 futrts_log16(f16 x) {
  return hlog(x);
}

static inline f16 futrts_log2_16(f16 x) {
  return hlog2(x);
}

static inline f16 futrts_log10_16(f16 x) {
  return hlog10(x);
}

static inline f16 futrts_sqrt16(f16 x) {
  return hsqrt(x);
}

static inline f16 futrts_exp16(f16 x) {
  return hexp(x);
}

static inline f16 futrts_cos16(f16 x) {
  return hcos(x);
}

static inline f16 futrts_sin16(f16 x) {
  return hsin(x);
}

static inline f16 futrts_tan16(f16 x) {
  return tanf(x);
}

static inline f16 futrts_acos16(f16 x) {
  return acosf(x);
}

static inline f16 futrts_asin16(f16 x) {
  return asinf(x);
}

static inline f16 futrts_atan16(f16 x) {
  return atanf(x);
}

static inline f16 futrts_cosh16(f16 x) {
  return coshf(x);
}

static inline f16 futrts_sinh16(f16 x) {
  return sinhf(x);
}

static inline f16 futrts_tanh16(f16 x) {
  return tanhf(x);
}

static inline f16 futrts_acosh16(f16 x) {
  return acoshf(x);
}

static inline f16 futrts_asinh16(f16 x) {
  return asinhf(x);
}

static inline f16 futrts_atanh16(f16 x) {
  return atanhf(x);
}

static inline f16 futrts_atan2_16(f16 x, f16 y) {
  return atan2f(x, y);
}

static inline f16 futrts_hypot16(f16 x, f16 y) {
  return hypotf(x, y);
}

static inline f16 futrts_gamma16(f16 x) {
  return tgammaf(x);
}

static inline f16 futrts_lgamma16(f16 x) {
  return lgammaf(x);
}

static inline f16 fmod16(f16 x, f16 y) {
  return fmodf(x, y);
}

static inline f16 futrts_round16(f16 x) {
  return rintf(x);
}

static inline f16 futrts_floor16(f16 x) {
  return hfloor(x);
}

static inline f16 futrts_ceil16(f16 x) {
  return hceil(x);
}

static inline f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return v0 + (v1 - v0) * t;
}

static inline f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

static inline f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return fmaf(a, b, c);
}

#endif

// The CUDA __half type cannot be put in unions for some reason, so we
// use bespoke conversion functions instead.
#ifdef __CUDA_ARCH__
static inline int16_t futrts_to_bits16(f16 x) {
  return __half_as_ushort(x);
}
static inline f16 futrts_from_bits16(int16_t x) {
  return __ushort_as_half(x);
}
#else
static inline int16_t futrts_to_bits16(f16 x) {
  union {
    f16 f;
    int16_t t;
  } p;

  p.f = x;
  return p.t;
}

static inline f16 futrts_from_bits16(int16_t x) {
  union {
    int16_t f;
    f16 t;
  } p;

  p.f = x;
  return p.t;
}
#endif

#else // No native f16 - emulate.

static inline f16 fabs16(f16 x) {
  return fabs32(x);
}

static inline f16 fmax16(f16 x, f16 y) {
  return fmax32(x, y);
}

static inline f16 fmin16(f16 x, f16 y) {
  return fmin32(x, y);
}

static inline f16 fpow16(f16 x, f16 y) {
  return fpow32(x, y);
}

static inline bool futrts_isnan16(f16 x) {
  return futrts_isnan32(x);
}

static inline bool futrts_isinf16(f16 x) {
  return futrts_isinf32(x);
}

static inline f16 futrts_log16(f16 x) {
  return futrts_log32(x);
}

static inline f16 futrts_log2_16(f16 x) {
  return futrts_log2_32(x);
}

static inline f16 futrts_log10_16(f16 x) {
  return futrts_log10_32(x);
}

static inline f16 futrts_sqrt16(f16 x) {
  return futrts_sqrt32(x);
}

static inline f16 futrts_exp16(f16 x) {
  return futrts_exp32(x);
}

static inline f16 futrts_cos16(f16 x) {
  return futrts_cos32(x);
}

static inline f16 futrts_sin16(f16 x) {
  return futrts_sin32(x);
}

static inline f16 futrts_tan16(f16 x) {
  return futrts_tan32(x);
}

static inline f16 futrts_acos16(f16 x) {
  return futrts_acos32(x);
}

static inline f16 futrts_asin16(f16 x) {
  return futrts_asin32(x);
}

static inline f16 futrts_atan16(f16 x) {
  return futrts_atan32(x);
}

static inline f16 futrts_cosh16(f16 x) {
  return futrts_cosh32(x);
}

static inline f16 futrts_sinh16(f16 x) {
  return futrts_sinh32(x);
}

static inline f16 futrts_tanh16(f16 x) {
  return futrts_tanh32(x);
}

static inline f16 futrts_acosh16(f16 x) {
  return futrts_acosh32(x);
}

static inline f16 futrts_asinh16(f16 x) {
  return futrts_asinh32(x);
}

static inline f16 futrts_atanh16(f16 x) {
  return futrts_atanh32(x);
}

static inline f16 futrts_atan2_16(f16 x, f16 y) {
  return futrts_atan2_32(x, y);
}

static inline f16 futrts_hypot16(f16 x, f16 y) {
  return futrts_hypot32(x, y);
}

static inline f16 futrts_gamma16(f16 x) {
  return futrts_gamma32(x);
}

static inline f16 futrts_lgamma16(f16 x) {
  return futrts_lgamma32(x);
}

static inline f16 fmod16(f16 x, f16 y) {
  return fmod32(x, y);
}

static inline f16 futrts_round16(f16 x) {
  return futrts_round32(x);
}

static inline f16 futrts_floor16(f16 x) {
  return futrts_floor32(x);
}

static inline f16 futrts_ceil16(f16 x) {
  return futrts_ceil32(x);
}

static inline f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return futrts_lerp32(v0, v1, t);
}

static inline f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return futrts_mad32(a, b, c);
}

static inline f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return futrts_fma32(a, b, c);
}

// Even when we are using an OpenCL that does not support cl_khr_fp16,
// it must still support vload_half for actually creating a
// half-precision number, which can then be efficiently converted to a
// float.  Similarly for vstore_half.
#ifdef __OPENCL_VERSION__

static inline int16_t futrts_to_bits16(f16 x) {
  int16_t y;
  // Violating strict aliasing here.
  vstore_half((float)x, 0, (half*)&y);
  return y;
}

static inline f16 futrts_from_bits16(int16_t x) {
  return (f16)vload_half(0, (half*)&x);
}

#else

static inline int16_t futrts_to_bits16(f16 x) {
  return (int16_t)float2halfbits(x);
}

static inline f16 futrts_from_bits16(int16_t x) {
  return halfbits2float((uint16_t)x);
}

static inline f16 fsignum16(f16 x) {
  return futrts_isnan16(x) ? x : (x > 0) - (x < 0);
}

#endif

#endif

static inline float fpconv_f16_f16(f16 x) {
  return x;
}

static inline float fpconv_f16_f32(f16 x) {
  return x;
}

static inline f16 fpconv_f32_f16(float x) {
  return x;
}

#ifdef FUTHARK_F64_ENABLED

static inline double fpconv_f16_f64(f16 x) {
  return (double) x;
}

static inline f16 fpconv_f64_f16(double x) {
  return (f16) x;
}

#endif


// End of scalar_f16.h.
// Start of atomics.h

inline int32_t atomic_xchg_i32_global(volatile __global int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicExch((int32_t*)p, x);
#else
  return atomic_xor(p, x);
#endif
}

inline int32_t atomic_xchg_i32_local(volatile __local int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicExch((int32_t*)p, x);
#else
  return atomic_xor(p, x);
#endif
}

inline int32_t atomic_cmpxchg_i32_global(volatile __global int32_t *p,
                                         int32_t cmp, int32_t val) {
#ifdef FUTHARK_CUDA
  return atomicCAS((int32_t*)p, cmp, val);
#else
  return atomic_cmpxchg(p, cmp, val);
#endif
}

inline int32_t atomic_cmpxchg_i32_local(volatile __local int32_t *p,
                                        int32_t cmp, int32_t val) {
#ifdef FUTHARK_CUDA
  return atomicCAS((int32_t*)p, cmp, val);
#else
  return atomic_cmpxchg(p, cmp, val);
#endif
}

inline int32_t atomic_add_i32_global(volatile __global int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicAdd((int32_t*)p, x);
#else
  return atomic_add(p, x);
#endif
}

inline int32_t atomic_add_i32_local(volatile __local int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicAdd((int32_t*)p, x);
#else
  return atomic_add(p, x);
#endif
}

inline float atomic_fadd_f32_global(volatile __global float *p, float x) {
#ifdef FUTHARK_CUDA
  return atomicAdd((float*)p, x);
#else
  union { int32_t i; float f; } old;
  union { int32_t i; float f; } assumed;
  old.f = *p;
  do {
    assumed.f = old.f;
    old.f = old.f + x;
    old.i = atomic_cmpxchg_i32_global((volatile __global int32_t*)p, assumed.i, old.i);
  } while (assumed.i != old.i);
  return old.f;
#endif
}

inline float atomic_fadd_f32_local(volatile __local float *p, float x) {
#ifdef FUTHARK_CUDA
  return atomicAdd((float*)p, x);
#else
  union { int32_t i; float f; } old;
  union { int32_t i; float f; } assumed;
  old.f = *p;
  do {
    assumed.f = old.f;
    old.f = old.f + x;
    old.i = atomic_cmpxchg_i32_local((volatile __local int32_t*)p, assumed.i, old.i);
  } while (assumed.i != old.i);
  return old.f;
#endif
}

inline int32_t atomic_smax_i32_global(volatile __global int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicMax((int32_t*)p, x);
#else
  return atomic_max(p, x);
#endif
}

inline int32_t atomic_smax_i32_local(volatile __local int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicMax((int32_t*)p, x);
#else
  return atomic_max(p, x);
#endif
}

inline int32_t atomic_smin_i32_global(volatile __global int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicMin((int32_t*)p, x);
#else
  return atomic_min(p, x);
#endif
}

inline int32_t atomic_smin_i32_local(volatile __local int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicMin((int32_t*)p, x);
#else
  return atomic_min(p, x);
#endif
}

inline uint32_t atomic_umax_i32_global(volatile __global uint32_t *p, uint32_t x) {
#ifdef FUTHARK_CUDA
  return atomicMax((uint32_t*)p, x);
#else
  return atomic_max(p, x);
#endif
}

inline uint32_t atomic_umax_i32_local(volatile __local uint32_t *p, uint32_t x) {
#ifdef FUTHARK_CUDA
  return atomicMax((uint32_t*)p, x);
#else
  return atomic_max(p, x);
#endif
}

inline uint32_t atomic_umin_i32_global(volatile __global uint32_t *p, uint32_t x) {
#ifdef FUTHARK_CUDA
  return atomicMin((uint32_t*)p, x);
#else
  return atomic_min(p, x);
#endif
}

inline uint32_t atomic_umin_i32_local(volatile __local uint32_t *p, uint32_t x) {
#ifdef FUTHARK_CUDA
  return atomicMin((uint32_t*)p, x);
#else
  return atomic_min(p, x);
#endif
}

inline int32_t atomic_and_i32_global(volatile __global int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicAnd((int32_t*)p, x);
#else
  return atomic_and(p, x);
#endif
}

inline int32_t atomic_and_i32_local(volatile __local int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicAnd((int32_t*)p, x);
#else
  return atomic_and(p, x);
#endif
}

inline int32_t atomic_or_i32_global(volatile __global int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicOr((int32_t*)p, x);
#else
  return atomic_or(p, x);
#endif
}

inline int32_t atomic_or_i32_local(volatile __local int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicOr((int32_t*)p, x);
#else
  return atomic_or(p, x);
#endif
}

inline int32_t atomic_xor_i32_global(volatile __global int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicXor((int32_t*)p, x);
#else
  return atomic_xor(p, x);
#endif
}

inline int32_t atomic_xor_i32_local(volatile __local int32_t *p, int32_t x) {
#ifdef FUTHARK_CUDA
  return atomicXor((int32_t*)p, x);
#else
  return atomic_xor(p, x);
#endif
}

// Start of 64 bit atomics

inline int64_t atomic_xchg_i64_global(volatile __global int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicExch((uint64_t*)p, x);
#else
  return atom_xor(p, x);
#endif
}

inline int64_t atomic_xchg_i64_local(volatile __local int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicExch((uint64_t*)p, x);
#else
  return atom_xor(p, x);
#endif
}

inline int64_t atomic_cmpxchg_i64_global(volatile __global int64_t *p,
                                         int64_t cmp, int64_t val) {
#ifdef FUTHARK_CUDA
  return atomicCAS((uint64_t*)p, cmp, val);
#else
  return atom_cmpxchg(p, cmp, val);
#endif
}

inline int64_t atomic_cmpxchg_i64_local(volatile __local int64_t *p,
                                        int64_t cmp, int64_t val) {
#ifdef FUTHARK_CUDA
  return atomicCAS((uint64_t*)p, cmp, val);
#else
  return atom_cmpxchg(p, cmp, val);
#endif
}

inline int64_t atomic_add_i64_global(volatile __global int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicAdd((uint64_t*)p, x);
#else
  return atom_add(p, x);
#endif
}

inline int64_t atomic_add_i64_local(volatile __local int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicAdd((uint64_t*)p, x);
#else
  return atom_add(p, x);
#endif
}

#ifdef FUTHARK_F64_ENABLED

inline double atomic_fadd_f64_global(volatile __global double *p, double x) {
#if defined(FUTHARK_CUDA) && __CUDA_ARCH__ >= 600
  return atomicAdd((double*)p, x);
#else
  union { int64_t i; double f; } old;
  union { int64_t i; double f; } assumed;
  old.f = *p;
  do {
    assumed.f = old.f;
    old.f = old.f + x;
    old.i = atomic_cmpxchg_i64_global((volatile __global int64_t*)p, assumed.i, old.i);
  } while (assumed.i != old.i);
  return old.f;
#endif
}

inline double atomic_fadd_f64_local(volatile __local double *p, double x) {
#if defined(FUTHARK_CUDA) && __CUDA_ARCH__ >= 600
  return atomicAdd((double*)p, x);
#else
  union { int64_t i; double f; } old;
  union { int64_t i; double f; } assumed;
  old.f = *p;
  do {
    assumed.f = old.f;
    old.f = old.f + x;
    old.i = atomic_cmpxchg_i64_local((volatile __local int64_t*)p, assumed.i, old.i);
  } while (assumed.i != old.i);
  return old.f;
#endif
}

#endif

inline int64_t atomic_smax_i64_global(volatile __global int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicMax((int64_t*)p, x);
#else
  return atom_max(p, x);
#endif
}

inline int64_t atomic_smax_i64_local(volatile __local int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicMax((int64_t*)p, x);
#else
  return atom_max(p, x);
#endif
}

inline int64_t atomic_smin_i64_global(volatile __global int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicMin((int64_t*)p, x);
#else
  return atom_min(p, x);
#endif
}

inline int64_t atomic_smin_i64_local(volatile __local int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicMin((int64_t*)p, x);
#else
  return atom_min(p, x);
#endif
}

inline uint64_t atomic_umax_i64_global(volatile __global uint64_t *p, uint64_t x) {
#ifdef FUTHARK_CUDA
  return atomicMax((uint64_t*)p, x);
#else
  return atom_max(p, x);
#endif
}

inline uint64_t atomic_umax_i64_local(volatile __local uint64_t *p, uint64_t x) {
#ifdef FUTHARK_CUDA
  return atomicMax((uint64_t*)p, x);
#else
  return atom_max(p, x);
#endif
}

inline uint64_t atomic_umin_i64_global(volatile __global uint64_t *p, uint64_t x) {
#ifdef FUTHARK_CUDA
  return atomicMin((uint64_t*)p, x);
#else
  return atom_min(p, x);
#endif
}

inline uint64_t atomic_umin_i64_local(volatile __local uint64_t *p, uint64_t x) {
#ifdef FUTHARK_CUDA
  return atomicMin((uint64_t*)p, x);
#else
  return atom_min(p, x);
#endif
}

inline int64_t atomic_and_i64_global(volatile __global int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicAnd((int64_t*)p, x);
#else
  return atom_and(p, x);
#endif
}

inline int64_t atomic_and_i64_local(volatile __local int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicAnd((int64_t*)p, x);
#else
  return atom_and(p, x);
#endif
}

inline int64_t atomic_or_i64_global(volatile __global int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicOr((int64_t*)p, x);
#else
  return atom_or(p, x);
#endif
}

inline int64_t atomic_or_i64_local(volatile __local int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicOr((int64_t*)p, x);
#else
  return atom_or(p, x);
#endif
}

inline int64_t atomic_xor_i64_global(volatile __global int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicXor((int64_t*)p, x);
#else
  return atom_xor(p, x);
#endif
}

inline int64_t atomic_xor_i64_local(volatile __local int64_t *p, int64_t x) {
#ifdef FUTHARK_CUDA
  return atomicXor((int64_t*)p, x);
#else
  return atom_xor(p, x);
#endif
}

// End of atomics.h



__kernel void builtinzhreplicate_f64zireplicate_19928(int32_t num_elems_19925,
                                                      double val_19926, __global
                                                      unsigned char *mem_19924)
{
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    int32_t replicate_gtid_19928;
    int32_t replicate_ltid_19929;
    int32_t replicate_gid_19930;
    
    replicate_gtid_19928 = get_global_id(0);
    replicate_ltid_19929 = get_local_id(0);
    replicate_gid_19930 = get_group_id(0);
    
    int64_t slice_19934 = num_elems_19925;
    int64_t rep_i_19933 = sext_i32_i64(replicate_gtid_19928);
    int64_t remnant_19935 = sext_i32_i64(replicate_gtid_19928) - rep_i_19933;
    
    if (slt64(replicate_gtid_19928, num_elems_19925)) {
        ((__global double *) mem_19924)[rep_i_19933] = val_19926;
    }
    
  error_0:
    return;
}
__kernel void builtinzhreplicate_i64zireplicate_20488(int32_t num_elems_20485,
                                                      int64_t val_20486,
                                                      __global
                                                      unsigned char *mem_20484)
{
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    int32_t replicate_gtid_20488;
    int32_t replicate_ltid_20489;
    int32_t replicate_gid_20490;
    
    replicate_gtid_20488 = get_global_id(0);
    replicate_ltid_20489 = get_local_id(0);
    replicate_gid_20490 = get_group_id(0);
    
    int64_t slice_20494 = num_elems_20485;
    int64_t rep_i_20493 = sext_i32_i64(replicate_gtid_20488);
    int64_t remnant_20495 = sext_i32_i64(replicate_gtid_20488) - rep_i_20493;
    
    if (slt64(replicate_gtid_20488, num_elems_20485)) {
        ((__global int64_t *) mem_20484)[rep_i_20493] = val_20486;
    }
    
  error_0:
    return;
}
__kernel void criterionzisegmap_17417(__global int *global_failure,
                                      int failure_is_an_option, __global
                                      int64_t *global_failure_args,
                                      int64_t implz2081U_16706,
                                      int64_t implz2088U_16707,
                                      int64_t implz2082U_16708,
                                      int64_t implz2083U_16709,
                                      int64_t implz2085U_16711,
                                      double i64_res_16726,
                                      int64_t num_threads_19894, __global
                                      unsigned char *zz_mem_19395, __global
                                      unsigned char *beta_mem_19396, __global
                                      unsigned char *d_mem_19398, __global
                                      unsigned char *mem_19452, __global
                                      unsigned char *mem_19501, __global
                                      unsigned char *color_19872, __global
                                      unsigned char *color_19873)
{
    #define segmap_group_sizze_17780 (criterionzisegmap_group_sizze_17419)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_19962;
    int32_t local_tid_19963;
    int64_t group_sizze_19966;
    int32_t wave_sizze_19965;
    int32_t group_tid_19964;
    
    global_tid_19962 = get_global_id(0);
    local_tid_19963 = get_local_id(0);
    group_sizze_19966 = get_local_size(0);
    wave_sizze_19965 = LOCKSTEP_WIDTH;
    group_tid_19964 = get_group_id(0);
    
    int32_t phys_tid_17417 = global_tid_19962;
    int64_t global_tid_19967 = sext_i32_i64(group_tid_19964) *
            segmap_group_sizze_17780 + sext_i32_i64(local_tid_19963);
    int64_t slice_19968 = implz2088U_16707;
    int64_t gtid_17416 = global_tid_19967;
    int64_t remnant_19969 = global_tid_19967 - gtid_17416;
    
    if (slt64(gtid_17416, implz2088U_16707)) {
        int64_t x_17784 = ((__global int64_t *) d_mem_19398)[gtid_17416];
        
        for (int64_t i_19354 = 0; i_19354 < implz2082U_16708; i_19354++) {
            double defunc_2_reduce_res_17787;
            double redout_19356 = 0.0;
            
            for (int64_t i_19357 = 0; i_19357 < implz2081U_16706; i_19357++) {
                double x_17791 = ((__global double *) mem_19452)[i_19357 *
                                                                 implz2088U_16707 +
                                                                 gtid_17416];
                int64_t binop_x_19384 = implz2082U_16708 * i_19357;
                int64_t binop_x_19385 = i_19354 + binop_x_19384;
                int64_t new_index_19386 = squot64(binop_x_19385,
                                                  implz2085U_16711);
                int64_t binop_y_19392 = implz2085U_16711 * new_index_19386;
                int64_t new_index_19393 = binop_x_19385 - binop_y_19392;
                double x_17792 = ((__global
                                   double *) beta_mem_19396)[new_index_19386 *
                                                             implz2085U_16711 +
                                                             new_index_19393];
                double defunc_1_f_res_17793 = x_17791 * x_17792;
                double defunc_1_op_res_17790 = defunc_1_f_res_17793 +
                       redout_19356;
                double redout_tmp_19971 = defunc_1_op_res_17790;
                
                redout_19356 = redout_tmp_19971;
            }
            defunc_2_reduce_res_17787 = redout_19356;
            ((__global double *) color_19872)[phys_tid_17417 + i_19354 *
                                              num_threads_19894] =
                defunc_2_reduce_res_17787;
        }
        
        double defunc_2_reduce_res_17794;
        double redout_19359 = -INFINITY;
        
        for (int64_t i_19361 = 0; i_19361 < implz2083U_16709; i_19361++) {
            double defunc_2_reduce_res_17800;
            double redout_19363 = 0.0;
            
            for (int64_t i_19364 = 0; i_19364 < implz2082U_16708; i_19364++) {
                double x_17804 = ((__global
                                   double *) color_19872)[phys_tid_17417 +
                                                          i_19364 *
                                                          num_threads_19894];
                double x_17805 = ((__global double *) zz_mem_19395)[i_19364 *
                                                                    implz2083U_16709 +
                                                                    i_19361];
                double defunc_1_f_res_17806 = x_17804 * x_17805;
                double defunc_1_op_res_17803 = defunc_1_f_res_17806 +
                       redout_19363;
                double redout_tmp_19974 = defunc_1_op_res_17803;
                
                redout_19363 = redout_tmp_19974;
            }
            defunc_2_reduce_res_17800 = redout_19363;
            
            double defunc_1_op_res_17798 = fmax64(defunc_2_reduce_res_17800,
                                                  redout_19359);
            
            ((__global double *) color_19873)[phys_tid_17417 + i_19361 *
                                              num_threads_19894] =
                defunc_2_reduce_res_17800;
            
            double redout_tmp_19972 = defunc_1_op_res_17798;
            
            redout_19359 = redout_tmp_19972;
        }
        defunc_2_reduce_res_17794 = redout_19359;
        
        double defunc_2_reduce_res_17807;
        double redout_19366 = 0.0;
        
        for (int64_t i_19368 = 0; i_19368 < implz2083U_16709; i_19368++) {
            double x_17812 = ((__global double *) color_19873)[phys_tid_17417 +
                                                               i_19368 *
                                                               num_threads_19894];
            double defunc_0_f_res_17813 = x_17812 - defunc_2_reduce_res_17794;
            double defunc_0_f_res_17814;
            
            defunc_0_f_res_17814 = futrts_exp64(defunc_0_f_res_17813);
            
            double defunc_1_op_res_17811 = defunc_0_f_res_17814 + redout_19366;
            
            ((__global double *) color_19872)[phys_tid_17417 + i_19368 *
                                              num_threads_19894] =
                defunc_0_f_res_17813;
            
            double redout_tmp_19975 = defunc_1_op_res_17811;
            
            redout_19366 = redout_tmp_19975;
        }
        defunc_2_reduce_res_17807 = redout_19366;
        
        double defunc_0_g_res_17815;
        
        defunc_0_g_res_17815 = futrts_log64(defunc_2_reduce_res_17807);
        
        bool x_17816 = sle64((int64_t) 0, x_17784);
        bool y_17817 = slt64(x_17784, implz2083U_16709);
        bool bounds_check_17818 = x_17816 && y_17817;
        bool index_certs_17819;
        
        if (!bounds_check_17818) {
            {
                if (atomic_cmpxchg_i32_global(global_failure, -1, 1) == -1) {
                    global_failure_args[0] = (int64_t) x_17784;
                    global_failure_args[1] = (int64_t) implz2083U_16709;
                    ;
                }
                return;
            }
        }
        
        double defunc_1_f_res_17820 = ((__global
                                        double *) color_19872)[phys_tid_17417 +
                                                               x_17784 *
                                                               num_threads_19894];
        double defunc_1_f_res_17821 = defunc_1_f_res_17820 -
               defunc_0_g_res_17815;
        double defunc_0_f_res_17822 = defunc_1_f_res_17821 / i64_res_16726;
        
        ((__global double *) mem_19501)[gtid_17416] = defunc_0_f_res_17822;
    }
    
  error_0:
    return;
    #undef segmap_group_sizze_17780
}
__kernel void criterionzisegmap_17555(__global int *global_failure,
                                      int failure_is_an_option, __global
                                      int64_t *global_failure_args,
                                      int64_t implz2088U_16707,
                                      int64_t implz2083U_16709,
                                      double i64_res_16726, __global
                                      unsigned char *d_mem_19398, __global
                                      unsigned char *mem_19730, __global
                                      unsigned char *mem_19734, __global
                                      unsigned char *mem_19738)
{
    #define segmap_group_sizze_17934 (criterionzisegmap_group_sizze_17557)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20290;
    int32_t local_tid_20291;
    int64_t group_sizze_20294;
    int32_t wave_sizze_20293;
    int32_t group_tid_20292;
    
    global_tid_20290 = get_global_id(0);
    local_tid_20291 = get_local_id(0);
    group_sizze_20294 = get_local_size(0);
    wave_sizze_20293 = LOCKSTEP_WIDTH;
    group_tid_20292 = get_group_id(0);
    
    int32_t phys_tid_17555 = global_tid_20290;
    int64_t global_tid_20295 = sext_i32_i64(group_tid_20292) *
            segmap_group_sizze_17934 + sext_i32_i64(local_tid_20291);
    int64_t slice_20296 = implz2088U_16707;
    int64_t gtid_17554 = global_tid_20295;
    int64_t remnant_20297 = global_tid_20295 - gtid_17554;
    
    if (slt64(gtid_17554, implz2088U_16707)) {
        int64_t x_17937 = ((__global int64_t *) d_mem_19398)[gtid_17554];
        double defunc_2_reduce_res_17938 = ((__global
                                             double *) mem_19730)[gtid_17554];
        double defunc_0_g_res_17940;
        
        defunc_0_g_res_17940 = futrts_log64(defunc_2_reduce_res_17938);
        
        bool x_17941 = sle64((int64_t) 0, x_17937);
        bool y_17942 = slt64(x_17937, implz2083U_16709);
        bool bounds_check_17943 = x_17941 && y_17942;
        bool index_certs_17944;
        
        if (!bounds_check_17943) {
            {
                if (atomic_cmpxchg_i32_global(global_failure, -1, 3) == -1) {
                    global_failure_args[0] = (int64_t) x_17937;
                    global_failure_args[1] = (int64_t) implz2083U_16709;
                    ;
                }
                return;
            }
        }
        
        double defunc_1_f_res_17945 = ((__global
                                        double *) mem_19734)[gtid_17554 *
                                                             implz2083U_16709 +
                                                             x_17937];
        double defunc_1_f_res_17946 = defunc_1_f_res_17945 -
               defunc_0_g_res_17940;
        double defunc_0_f_res_17947 = defunc_1_f_res_17946 / i64_res_16726;
        
        ((__global double *) mem_19738)[gtid_17554] = defunc_0_f_res_17947;
    }
    
  error_0:
    return;
    #undef segmap_group_sizze_17934
}
__kernel void criterionzisegmap_intragroup_17413(__global int *global_failure,
                                                 int failure_is_an_option,
                                                 __global
                                                 int64_t *global_failure_args,
                                                 __local volatile
                                                 int64_t *red_arr_mem_20012_backing_aligned_0,
                                                 __local volatile
                                                 int64_t *red_arr_mem_20007_backing_aligned_1,
                                                 __local volatile
                                                 int64_t *red_arr_mem_19993_backing_aligned_2,
                                                 __local volatile
                                                 int64_t *color_19876_backing_aligned_3,
                                                 __local volatile
                                                 int64_t *color_19875_backing_aligned_4,
                                                 int64_t implz2081U_16706,
                                                 int64_t implz2088U_16707,
                                                 int64_t implz2082U_16708,
                                                 int64_t implz2083U_16709,
                                                 int64_t implz2085U_16711,
                                                 double i64_res_16726,
                                                 int64_t computed_group_sizze_17771,
                                                 __global
                                                 unsigned char *x_mem_19394,
                                                 __global
                                                 unsigned char *zz_mem_19395,
                                                 __global
                                                 unsigned char *beta_mem_19396,
                                                 __global
                                                 unsigned char *d_mem_19398,
                                                 __global
                                                 unsigned char *mem_19517)
{
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20012_backing_4 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20012_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_20007_backing_3 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20007_backing_aligned_1;
    __local volatile unsigned char *restrict red_arr_mem_19993_backing_2 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_19993_backing_aligned_2;
    __local volatile unsigned char *restrict color_19876_backing_1 =
                                   (__local volatile
                                    unsigned char *) color_19876_backing_aligned_3;
    __local volatile unsigned char *restrict color_19875_backing_0 =
                                   (__local volatile
                                    unsigned char *) color_19875_backing_aligned_4;
    volatile __local bool local_failure;
    
    if (failure_is_an_option) {
        int failed = *global_failure >= 0;
        
        if (failed)
            return;
    }
    local_failure = false;
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t global_tid_19977;
    int32_t local_tid_19978;
    int64_t group_sizze_19981;
    int32_t wave_sizze_19980;
    int32_t group_tid_19979;
    
    global_tid_19977 = get_global_id(0);
    local_tid_19978 = get_local_id(0);
    group_sizze_19981 = get_local_size(0);
    wave_sizze_19980 = LOCKSTEP_WIDTH;
    group_tid_19979 = get_group_id(0);
    
    int32_t phys_tid_17413 = group_tid_19979;
    int64_t slice_19984 = implz2081U_16706;
    int64_t slice_19985 = implz2082U_16708 * slice_19984;
    int64_t ltid_pre_19982 = squot64(sext_i32_i64(local_tid_19978),
                                     slice_19984);
    int64_t remnant_19986 = sext_i32_i64(local_tid_19978) - ltid_pre_19982 *
            slice_19984;
    int64_t ltid_pre_19983 = remnant_19986;
    int64_t remnant_19987 = remnant_19986 - ltid_pre_19983;
    int64_t slice_19989 = implz2083U_16709;
    int64_t ltid_pre_19988 = sext_i32_i64(local_tid_19978);
    int64_t remnant_19990 = sext_i32_i64(local_tid_19978) - ltid_pre_19988;
    int64_t slice_19991 = implz2088U_16707;
    int64_t gtid_17392 = sext_i32_i64(group_tid_19979);
    int64_t remnant_19992 = sext_i32_i64(group_tid_19979) - gtid_17392;
    __local unsigned char *color_19875;
    
    color_19875 = (__local unsigned char *) color_19875_backing_0;
    
    __local unsigned char *color_19876;
    
    color_19876 = (__local unsigned char *) color_19876_backing_1;
    
    int64_t x_17827 = ((__global int64_t *) d_mem_19398)[gtid_17392];
    int64_t gtid_17395 = sext_i32_i64(sext_i64_i32(ltid_pre_19982));
    int64_t gtid_17396 = sext_i32_i64(sext_i64_i32(ltid_pre_19983));
    int32_t phys_tid_17397 = local_tid_19978;
    __local unsigned char *red_arr_mem_19993;
    
    red_arr_mem_19993 = (__local unsigned char *) red_arr_mem_19993_backing_2;
    if (slt64(gtid_17395, implz2082U_16708) && slt64(gtid_17396,
                                                     implz2081U_16706)) {
        double x_17833 = ((__global double *) x_mem_19394)[gtid_17392 *
                                                           implz2081U_16706 +
                                                           gtid_17396];
        int64_t binop_x_18821 = implz2082U_16708 * gtid_17396;
        int64_t binop_x_18822 = gtid_17395 + binop_x_18821;
        int64_t new_index_18823 = squot64(binop_x_18822, implz2085U_16711);
        int64_t binop_y_18829 = implz2085U_16711 * new_index_18823;
        int64_t new_index_18830 = binop_x_18822 - binop_y_18829;
        double x_17834 = ((__global double *) beta_mem_19396)[new_index_18823 *
                                                              implz2085U_16711 +
                                                              new_index_18830];
        double defunc_1_f_res_17835 = x_17833 * x_17834;
        
        ((__local double *) red_arr_mem_19993)[gtid_17395 * implz2081U_16706 +
                                               gtid_17396] =
            defunc_1_f_res_17835;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int64_t dims_flat_19995 = implz2082U_16708 * implz2081U_16706;
    double x_17829;
    double x_17830;
    double x_19997;
    double x_19998;
    bool ltid_in_bounds_20000 = slt64(sext_i32_i64(local_tid_19978),
                                      implz2082U_16708 * implz2081U_16706);
    int32_t skip_threads_20001;
    
    // read input for in-block scan
    {
        if (ltid_in_bounds_20000) {
            x_17830 = ((volatile __local
                        double *) red_arr_mem_19993)[sext_i32_i64(local_tid_19978)];
            if ((local_tid_19978 - squot32(local_tid_19978, 32) * 32) == 0) {
                x_17829 = x_17830;
            }
        }
    }
    // in-block scan (hopefully no barriers needed)
    {
        skip_threads_20001 = 1;
        while (slt32(skip_threads_20001, 32)) {
            if (sle32(skip_threads_20001, local_tid_19978 -
                      squot32(local_tid_19978, 32) * 32) &&
                ltid_in_bounds_20000) {
                // read operands
                {
                    x_17829 = ((volatile __local
                                double *) red_arr_mem_19993)[sext_i32_i64(local_tid_19978) -
                                                             sext_i32_i64(skip_threads_20001)];
                }
                // perform operation
                {
                    bool inactive_20002 =
                         slt64(srem64(sext_i32_i64(local_tid_19978),
                                      implz2081U_16706),
                               sext_i32_i64(local_tid_19978) -
                               sext_i32_i64(local_tid_19978 -
                               skip_threads_20001));
                    
                    if (inactive_20002) {
                        x_17829 = x_17830;
                    }
                    if (!inactive_20002) {
                        double defunc_1_op_res_17831 = x_17829 + x_17830;
                        
                        x_17829 = defunc_1_op_res_17831;
                    }
                }
            }
            if (sle32(wave_sizze_19980, skip_threads_20001)) {
                barrier(CLK_LOCAL_MEM_FENCE);
            }
            if (sle32(skip_threads_20001, local_tid_19978 -
                      squot32(local_tid_19978, 32) * 32) &&
                ltid_in_bounds_20000) {
                // write result
                {
                    ((volatile __local
                      double *) red_arr_mem_19993)[sext_i32_i64(local_tid_19978)] =
                        x_17829;
                    x_17830 = x_17829;
                }
            }
            if (sle32(wave_sizze_19980, skip_threads_20001)) {
                barrier(CLK_LOCAL_MEM_FENCE);
            }
            skip_threads_20001 *= 2;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // last thread of block 'i' writes its result to offset 'i'
    {
        if ((local_tid_19978 - squot32(local_tid_19978, 32) * 32) == 31 &&
            ltid_in_bounds_20000) {
            ((volatile __local
              double *) red_arr_mem_19993)[sext_i32_i64(squot32(local_tid_19978,
                                                                32))] = x_17829;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
    {
        int32_t skip_threads_20003;
        
        // read input for in-block scan
        {
            if (squot32(local_tid_19978, 32) == 0 && ltid_in_bounds_20000) {
                x_19998 = ((volatile __local
                            double *) red_arr_mem_19993)[sext_i32_i64(local_tid_19978)];
                if ((local_tid_19978 - squot32(local_tid_19978, 32) * 32) ==
                    0) {
                    x_19997 = x_19998;
                }
            }
        }
        // in-block scan (hopefully no barriers needed)
        {
            skip_threads_20003 = 1;
            while (slt32(skip_threads_20003, 32)) {
                if (sle32(skip_threads_20003, local_tid_19978 -
                          squot32(local_tid_19978, 32) * 32) &&
                    (squot32(local_tid_19978, 32) == 0 &&
                     ltid_in_bounds_20000)) {
                    // read operands
                    {
                        x_19997 = ((volatile __local
                                    double *) red_arr_mem_19993)[sext_i32_i64(local_tid_19978) -
                                                                 sext_i32_i64(skip_threads_20003)];
                    }
                    // perform operation
                    {
                        bool inactive_20004 =
                             slt64(srem64(sext_i32_i64(local_tid_19978 * 32 +
                                          32 - 1), implz2081U_16706),
                                   sext_i32_i64(local_tid_19978 * 32 + 32 - 1) -
                                   sext_i32_i64((local_tid_19978 -
                                                 skip_threads_20003) * 32 + 32 -
                                   1));
                        
                        if (inactive_20004) {
                            x_19997 = x_19998;
                        }
                        if (!inactive_20004) {
                            double defunc_1_op_res_19999 = x_19997 + x_19998;
                            
                            x_19997 = defunc_1_op_res_19999;
                        }
                    }
                }
                if (sle32(wave_sizze_19980, skip_threads_20003)) {
                    barrier(CLK_LOCAL_MEM_FENCE);
                }
                if (sle32(skip_threads_20003, local_tid_19978 -
                          squot32(local_tid_19978, 32) * 32) &&
                    (squot32(local_tid_19978, 32) == 0 &&
                     ltid_in_bounds_20000)) {
                    // write result
                    {
                        ((volatile __local
                          double *) red_arr_mem_19993)[sext_i32_i64(local_tid_19978)] =
                            x_19997;
                        x_19998 = x_19997;
                    }
                }
                if (sle32(wave_sizze_19980, skip_threads_20003)) {
                    barrier(CLK_LOCAL_MEM_FENCE);
                }
                skip_threads_20003 *= 2;
            }
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // carry-in for every block except the first
    {
        if (!(squot32(local_tid_19978, 32) == 0 || !ltid_in_bounds_20000)) {
            // read operands
            {
                x_17830 = x_17829;
                x_17829 = ((__local
                            double *) red_arr_mem_19993)[sext_i32_i64(squot32(local_tid_19978,
                                                                              32)) -
                                                         (int64_t) 1];
            }
            // perform operation
            {
                bool inactive_20005 =
                     slt64(srem64(sext_i32_i64(local_tid_19978),
                                  implz2081U_16706),
                           sext_i32_i64(local_tid_19978) -
                           sext_i32_i64(squot32(local_tid_19978, 32) * 32 - 1));
                
                if (inactive_20005) {
                    x_17829 = x_17830;
                }
                if (!inactive_20005) {
                    double defunc_1_op_res_17831 = x_17829 + x_17830;
                    
                    x_17829 = defunc_1_op_res_17831;
                }
            }
            // write final result
            {
                ((__local
                  double *) red_arr_mem_19993)[sext_i32_i64(local_tid_19978)] =
                    x_17829;
            }
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // restore correct values for first block
    {
        if (squot32(local_tid_19978, 32) == 0) {
            ((__local
              double *) red_arr_mem_19993)[sext_i32_i64(local_tid_19978)] =
                x_17830;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    barrier(CLK_LOCAL_MEM_FENCE);
    for (int64_t i_20006 = 0; i_20006 < sdiv_up64(implz2082U_16708 -
                                                  sext_i32_i64(local_tid_19978),
                                                  computed_group_sizze_17771);
         i_20006++) {
        ((__local double *) color_19875)[i_20006 * computed_group_sizze_17771 +
                                         sext_i32_i64(local_tid_19978)] =
            ((__local double *) red_arr_mem_19993)[implz2081U_16706 -
                                                   (int64_t) 1 + (i_20006 *
                                                                  computed_group_sizze_17771 +
                                                                  sext_i32_i64(local_tid_19978)) *
                                                   implz2081U_16706];
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    barrier(CLK_LOCAL_MEM_FENCE);
    
    double defunc_2_reduce_res_17836;
    int64_t gtid_17405 = sext_i32_i64(sext_i64_i32(ltid_pre_19988));
    int32_t phys_tid_17406 = local_tid_19978;
    __local unsigned char *red_arr_mem_20007;
    
    red_arr_mem_20007 = (__local unsigned char *) red_arr_mem_20007_backing_3;
    if (slt64(gtid_17405, implz2083U_16709)) {
        double defunc_2_reduce_res_17842;
        double redout_19370 = 0.0;
        
        for (int64_t i_19371 = 0; i_19371 < implz2082U_16708; i_19371++) {
            double x_17846 = ((__local double *) color_19875)[i_19371];
            double x_17847 = ((__global double *) zz_mem_19395)[i_19371 *
                                                                implz2083U_16709 +
                                                                gtid_17405];
            double defunc_1_f_res_17848 = x_17846 * x_17847;
            double defunc_1_op_res_17845 = defunc_1_f_res_17848 + redout_19370;
            double redout_tmp_20009 = defunc_1_op_res_17845;
            
            redout_19370 = redout_tmp_20009;
        }
        defunc_2_reduce_res_17842 = redout_19370;
        ((__local double *) red_arr_mem_20007)[gtid_17405] =
            defunc_2_reduce_res_17842;
        ((__local double *) color_19876)[gtid_17405] =
            defunc_2_reduce_res_17842;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t offset_20010;
    int32_t skip_waves_20011 = 1;
    double x_17838;
    double x_17839;
    
    offset_20010 = 0;
    // participating threads read initial accumulator
    {
        if (slt32(local_tid_19978, sext_i64_i32(implz2083U_16709))) {
            x_17838 = ((__local
                        double *) red_arr_mem_20007)[sext_i32_i64(local_tid_19978 +
                                                     offset_20010)];
        }
    }
    offset_20010 = 1;
    while (slt32(offset_20010, wave_sizze_19980)) {
        if (slt32(local_tid_19978 + offset_20010,
                  sext_i64_i32(implz2083U_16709)) && ((local_tid_19978 -
                                                       squot32(local_tid_19978,
                                                               wave_sizze_19980) *
                                                       wave_sizze_19980) & (2 *
                                                                            offset_20010 -
                                                                            1)) ==
            0) {
            // read array element
            {
                x_17839 = ((volatile __local
                            double *) red_arr_mem_20007)[sext_i32_i64(local_tid_19978 +
                                                         offset_20010)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_17840 = fmax64(x_17838, x_17839);
                
                x_17838 = defunc_1_op_res_17840;
            }
            // write result of operation
            {
                ((volatile __local
                  double *) red_arr_mem_20007)[sext_i32_i64(local_tid_19978)] =
                    x_17838;
            }
        }
        offset_20010 *= 2;
    }
    while (slt32(skip_waves_20011,
                 squot32(sext_i64_i32(computed_group_sizze_17771) +
                         wave_sizze_19980 - 1, wave_sizze_19980))) {
        barrier(CLK_LOCAL_MEM_FENCE);
        offset_20010 = skip_waves_20011 * wave_sizze_19980;
        if (slt32(local_tid_19978 + offset_20010,
                  sext_i64_i32(implz2083U_16709)) && ((local_tid_19978 -
                                                       squot32(local_tid_19978,
                                                               wave_sizze_19980) *
                                                       wave_sizze_19980) == 0 &&
                                                      (squot32(local_tid_19978,
                                                               wave_sizze_19980) &
                                                       (2 * skip_waves_20011 -
                                                        1)) == 0)) {
            // read array element
            {
                x_17839 = ((__local
                            double *) red_arr_mem_20007)[sext_i32_i64(local_tid_19978 +
                                                         offset_20010)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_17840 = fmax64(x_17838, x_17839);
                
                x_17838 = defunc_1_op_res_17840;
            }
            // write result of operation
            {
                ((__local
                  double *) red_arr_mem_20007)[sext_i32_i64(local_tid_19978)] =
                    x_17838;
            }
        }
        skip_waves_20011 *= 2;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    defunc_2_reduce_res_17836 = ((__local
                                  double *) red_arr_mem_20007)[(int64_t) 0];
    
    double defunc_2_reduce_res_17849;
    int64_t gtid_17407 = sext_i32_i64(sext_i64_i32(ltid_pre_19988));
    int32_t phys_tid_17408 = local_tid_19978;
    __local unsigned char *red_arr_mem_20012;
    
    red_arr_mem_20012 = (__local unsigned char *) red_arr_mem_20012_backing_4;
    if (slt64(gtid_17407, implz2083U_16709)) {
        double x_17854 = ((__local double *) color_19876)[gtid_17407];
        double defunc_0_f_res_17855 = x_17854 - defunc_2_reduce_res_17836;
        double defunc_0_f_res_17856;
        
        defunc_0_f_res_17856 = futrts_exp64(defunc_0_f_res_17855);
        ((__local double *) red_arr_mem_20012)[gtid_17407] =
            defunc_0_f_res_17856;
        ((__local double *) color_19875)[gtid_17407] = defunc_0_f_res_17855;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t offset_20014;
    int32_t skip_waves_20015 = 1;
    double x_17851;
    double x_17852;
    
    offset_20014 = 0;
    // participating threads read initial accumulator
    {
        if (slt32(local_tid_19978, sext_i64_i32(implz2083U_16709))) {
            x_17851 = ((__local
                        double *) red_arr_mem_20012)[sext_i32_i64(local_tid_19978 +
                                                     offset_20014)];
        }
    }
    offset_20014 = 1;
    while (slt32(offset_20014, wave_sizze_19980)) {
        if (slt32(local_tid_19978 + offset_20014,
                  sext_i64_i32(implz2083U_16709)) && ((local_tid_19978 -
                                                       squot32(local_tid_19978,
                                                               wave_sizze_19980) *
                                                       wave_sizze_19980) & (2 *
                                                                            offset_20014 -
                                                                            1)) ==
            0) {
            // read array element
            {
                x_17852 = ((volatile __local
                            double *) red_arr_mem_20012)[sext_i32_i64(local_tid_19978 +
                                                         offset_20014)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_17853 = x_17851 + x_17852;
                
                x_17851 = defunc_1_op_res_17853;
            }
            // write result of operation
            {
                ((volatile __local
                  double *) red_arr_mem_20012)[sext_i32_i64(local_tid_19978)] =
                    x_17851;
            }
        }
        offset_20014 *= 2;
    }
    while (slt32(skip_waves_20015,
                 squot32(sext_i64_i32(computed_group_sizze_17771) +
                         wave_sizze_19980 - 1, wave_sizze_19980))) {
        barrier(CLK_LOCAL_MEM_FENCE);
        offset_20014 = skip_waves_20015 * wave_sizze_19980;
        if (slt32(local_tid_19978 + offset_20014,
                  sext_i64_i32(implz2083U_16709)) && ((local_tid_19978 -
                                                       squot32(local_tid_19978,
                                                               wave_sizze_19980) *
                                                       wave_sizze_19980) == 0 &&
                                                      (squot32(local_tid_19978,
                                                               wave_sizze_19980) &
                                                       (2 * skip_waves_20015 -
                                                        1)) == 0)) {
            // read array element
            {
                x_17852 = ((__local
                            double *) red_arr_mem_20012)[sext_i32_i64(local_tid_19978 +
                                                         offset_20014)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_17853 = x_17851 + x_17852;
                
                x_17851 = defunc_1_op_res_17853;
            }
            // write result of operation
            {
                ((__local
                  double *) red_arr_mem_20012)[sext_i32_i64(local_tid_19978)] =
                    x_17851;
            }
        }
        skip_waves_20015 *= 2;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    defunc_2_reduce_res_17849 = ((__local
                                  double *) red_arr_mem_20012)[(int64_t) 0];
    
    double defunc_0_g_res_17857;
    
    defunc_0_g_res_17857 = futrts_log64(defunc_2_reduce_res_17849);
    
    bool x_17858 = sle64((int64_t) 0, x_17827);
    bool y_17859 = slt64(x_17827, implz2083U_16709);
    bool bounds_check_17860 = x_17858 && y_17859;
    bool index_certs_17861;
    
    if (!bounds_check_17860) {
        {
            if (atomic_cmpxchg_i32_global(global_failure, -1, 2) == -1) {
                global_failure_args[0] = (int64_t) x_17827;
                global_failure_args[1] = (int64_t) implz2083U_16709;
                ;
            }
            local_failure = true;
            goto error_6;
        }
    }
    
    double defunc_1_f_res_17862 = ((__local double *) color_19875)[x_17827];
    double defunc_1_f_res_17863 = defunc_1_f_res_17862 - defunc_0_g_res_17857;
    double defunc_0_f_res_17864 = defunc_1_f_res_17863 / i64_res_16726;
    
    if (local_tid_19978 == 0) {
        ((__global double *) mem_19517)[gtid_17392] = defunc_0_f_res_17864;
    }
    
  error_6:
    return;
}
__kernel void criterionzisegmap_intragroup_18877(__global int *global_failure,
                                                 __local volatile
                                                 int64_t *color_19890_backing_aligned_0,
                                                 __local volatile
                                                 int64_t *color_19889_backing_aligned_1,
                                                 int64_t implz2081U_16706,
                                                 int64_t implz2088U_16707,
                                                 int64_t implz2082U_16708,
                                                 int64_t implz2085U_16711,
                                                 int64_t gridDim_x_18871,
                                                 int64_t gridDim_y_18872,
                                                 int64_t full_tiles_18902,
                                                 int64_t kk_19105, __global
                                                 unsigned char *x_mem_19394,
                                                 __global
                                                 unsigned char *beta_mem_19396,
                                                 __global
                                                 unsigned char *mem_19712)
{
    #define Ty_18858 (criterionziTy_18855)
    #define Ry_18859 (criterionziRy_18857)
    #define Tx_18860 (criterionziTx_18854)
    #define Rx_18861 (criterionziRx_18856)
    #define Tk_18862 (criterionziTk_18853)
    #define tk_div_tx_18863 (sdiv_up64(criterionziTk_18853, criterionziTx_18854))
    #define tk_div_ty_18864 (sdiv_up64(criterionziTk_18853, criterionziTy_18855))
    #define TxRx_18865 (criterionziTx_18854 * criterionziRx_18856)
    #define TyRy_18866 (criterionziTy_18855 * criterionziRy_18857)
    #define a_loc_szz_18868 (criterionziTk_18853 * (criterionziTy_18855 * criterionziRy_18857))
    #define b_loc_szz_18870 (criterionziRx_18856 * (criterionziTx_18854 * criterionziTk_18853))
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict color_19890_backing_1 =
                                   (__local volatile
                                    unsigned char *) color_19890_backing_aligned_0;
    __local volatile unsigned char *restrict color_19889_backing_0 =
                                   (__local volatile
                                    unsigned char *) color_19889_backing_aligned_1;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20016;
    int32_t local_tid_20017;
    int64_t group_sizze_20020;
    int32_t wave_sizze_20019;
    int32_t group_tid_20018;
    
    global_tid_20016 = get_global_id(0);
    local_tid_20017 = get_local_id(0);
    group_sizze_20020 = get_local_size(0);
    wave_sizze_20019 = LOCKSTEP_WIDTH;
    group_tid_20018 = get_group_id(0);
    
    int32_t gid_flat_18877 = group_tid_20018;
    int64_t slice_20023 = Tx_18860;
    int64_t slice_20024 = Ty_18858 * slice_20023;
    int64_t ltid_pre_20021 = squot64(sext_i32_i64(local_tid_20017),
                                     slice_20023);
    int64_t remnant_20025 = sext_i32_i64(local_tid_20017) - ltid_pre_20021 *
            slice_20023;
    int64_t ltid_pre_20022 = remnant_20025;
    int64_t remnant_20026 = remnant_20025 - ltid_pre_20022;
    int64_t slice_20027 = gridDim_x_18871;
    int64_t slice_20028 = gridDim_y_18872 * slice_20027;
    int64_t gid_y_18876 = squot64(sext_i32_i64(group_tid_20018), slice_20027);
    int64_t remnant_20029 = sext_i32_i64(group_tid_20018) - gid_y_18876 *
            slice_20027;
    int64_t gid_x_18875 = remnant_20029;
    int64_t remnant_20030 = remnant_20029 - gid_x_18875;
    double color_19884[Ry_18859 * Rx_18861];
    double color_19885[Ry_18859 * Rx_18861];
    double color_19886[Ry_18859 * Rx_18861];
    double color_19887[Rx_18861];
    double color_19888[Ry_18859];
    __local unsigned char *color_19889;
    
    color_19889 = (__local unsigned char *) color_19889_backing_0;
    
    __local unsigned char *color_19890;
    
    color_19890 = (__local unsigned char *) color_19890_backing_1;
    
    int64_t iii_18878 = TyRy_18866 * gid_y_18876;
    int64_t jjj_18879 = TxRx_18865 * gid_x_18875;
    int64_t ltid_y_18882 = sext_i32_i64(sext_i64_i32(ltid_pre_20021));
    int64_t ltid_x_18880 = sext_i32_i64(sext_i64_i32(ltid_pre_20022));
    int32_t ltid_flat_18881 = local_tid_20017;
    double color_19877[Ry_18859 * Rx_18861];
    
    for (int64_t i_18893 = 0; i_18893 < Ry_18859; i_18893++) {
        for (int64_t i_18896 = 0; i_18896 < Rx_18861; i_18896++) {
            color_19877[i_18893 * Rx_18861 + i_18896] = 0.0;
        }
    }
    for (int64_t i_20033 = 0; i_20033 < Ry_18859; i_20033++) {
        for (int64_t i_20034 = 0; i_20034 < Rx_18861; i_20034++) {
            color_19886[i_20033 * Rx_18861 + i_20034] = color_19877[i_20033 *
                                                                    Rx_18861 +
                                                                    i_20034];
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    double ext_mem_19627[Ry_18859 * Rx_18861];
    double mem_param_19538[Ry_18859 * Rx_18861];
    
    for (int32_t i_2 = 0; i_2 < Ry_18859 * Rx_18861; i_2++)
        mem_param_19538[i_2] = color_19886[i_2];
    for (int64_t i_18903 = 0; i_18903 < full_tiles_18902; i_18903++) {
        int64_t kk_18907 = Tk_18862 * i_18903;
        
        for (int64_t i_18908 = 0; i_18908 < Ry_18859; i_18908++) {
            int64_t binop_y_18931 = Ty_18858 * i_18908;
            
            for (int64_t i_18910 = 0; i_18910 < tk_div_tx_18863; i_18910++) {
                int64_t binop_y_18929 = Tx_18860 * i_18910;
                int64_t ltid_x_18912 =
                        sext_i32_i64(sext_i64_i32(ltid_pre_20021));
                int64_t ltid_y_18913 =
                        sext_i32_i64(sext_i64_i32(ltid_pre_20022));
                int32_t ltid_flat_18914 = local_tid_20017;
                int64_t k_18930 = ltid_y_18913 + binop_y_18929;
                int64_t i_18932 = ltid_x_18912 + binop_y_18931;
                int64_t gtid_18933 = iii_18878 + i_18932;
                int64_t A_col_idx_18934 = kk_18907 + k_18930;
                bool cond_18935 = slt64(gtid_18933, implz2088U_16707);
                double A_elem_18936;
                
                if (cond_18935) {
                    double A_elem_18938 = ((__global
                                            double *) x_mem_19394)[gtid_18933 *
                                                                   implz2081U_16706 +
                                                                   A_col_idx_18934];
                    
                    A_elem_18936 = A_elem_18938;
                } else {
                    A_elem_18936 = 0.0;
                }
                
                bool cond_18940 = slt64(k_18930, Tk_18862);
                int64_t a_loc_ind_18941;
                
                if (cond_18940) {
                    int64_t binop_y_18942 = Tk_18862 * i_18932;
                    int64_t loc_fi_18943 = k_18930 + binop_y_18942;
                    
                    a_loc_ind_18941 = loc_fi_18943;
                } else {
                    a_loc_ind_18941 = (int64_t) -1;
                }
                if (sle64((int64_t) 0, a_loc_ind_18941) &&
                    slt64(a_loc_ind_18941, a_loc_szz_18868)) {
                    ((__local double *) color_19890)[a_loc_ind_18941] =
                        A_elem_18936;
                }
                barrier(CLK_LOCAL_MEM_FENCE);
            }
        }
        for (int64_t i_18948 = 0; i_18948 < tk_div_ty_18864; i_18948++) {
            int64_t binop_y_18969 = Ty_18858 * i_18948;
            
            for (int64_t i_18950 = 0; i_18950 < Rx_18861; i_18950++) {
                int64_t binop_y_18971 = Tx_18860 * i_18950;
                int64_t ltid_x_18952 =
                        sext_i32_i64(sext_i64_i32(ltid_pre_20021));
                int64_t ltid_y_18953 =
                        sext_i32_i64(sext_i64_i32(ltid_pre_20022));
                int32_t ltid_flat_18954 = local_tid_20017;
                int64_t k_18970 = ltid_x_18952 + binop_y_18969;
                int64_t j_18972 = ltid_y_18953 + binop_y_18971;
                int64_t gtid_18973 = jjj_18879 + j_18972;
                int64_t B_row_idx_18974 = kk_18907 + k_18970;
                bool cond_18975 = slt64(gtid_18973, implz2082U_16708);
                double B_elem_18976;
                
                if (cond_18975) {
                    int64_t binop_x_19314 = implz2082U_16708 * B_row_idx_18974;
                    int64_t binop_x_19315 = gtid_18973 + binop_x_19314;
                    int64_t new_index_19316 = squot64(binop_x_19315,
                                                      implz2085U_16711);
                    int64_t binop_y_19322 = implz2085U_16711 * new_index_19316;
                    int64_t new_index_19323 = binop_x_19315 - binop_y_19322;
                    double B_elem_18978 = ((__global
                                            double *) beta_mem_19396)[new_index_19316 *
                                                                      implz2085U_16711 +
                                                                      new_index_19323];
                    
                    B_elem_18976 = B_elem_18978;
                } else {
                    B_elem_18976 = 0.0;
                }
                
                bool cond_18980 = slt64(k_18970, Tk_18862);
                int64_t b_loc_ind_18981;
                
                if (cond_18980) {
                    int64_t binop_y_18982 = TxRx_18865 * k_18970;
                    int64_t loc_fi_18983 = j_18972 + binop_y_18982;
                    
                    b_loc_ind_18981 = loc_fi_18983;
                } else {
                    b_loc_ind_18981 = (int64_t) -1;
                }
                if (sle64((int64_t) 0, b_loc_ind_18981) &&
                    slt64(b_loc_ind_18981, b_loc_szz_18870)) {
                    ((__local double *) color_19889)[b_loc_ind_18981] =
                        B_elem_18976;
                }
                barrier(CLK_LOCAL_MEM_FENCE);
            }
        }
        for (int64_t i_20043 = 0; i_20043 < Ry_18859; i_20043++) {
            for (int64_t i_20044 = 0; i_20044 < Rx_18861; i_20044++) {
                color_19884[i_20043 * Rx_18861 + i_20044] =
                    mem_param_19538[i_20043 * Rx_18861 + i_20044];
            }
        }
        
        double ext_mem_19624[Ry_18859 * Rx_18861];
        double ext_mem_unused_19854[Ry_18859 * Rx_18861];
        double mem_param_19595[Ry_18859 * Rx_18861];
        double mem_param_out_19855[Ry_18859 * Rx_18861];
        
        for (int32_t i_3 = 0; i_3 < Ry_18859 * Rx_18861; i_3++)
            mem_param_19595[i_3] = color_19884[i_3];
        for (int32_t i_4 = 0; i_4 < Ry_18859 * Rx_18861; i_4++)
            mem_param_out_19855[i_4] = color_19885[i_4];
        for (int64_t i_18988 = 0; i_18988 < Tk_18862; i_18988++) {
            int64_t binop_y_19027 = TxRx_18865 * i_18988;
            int64_t ltid_y_18992 = sext_i32_i64(sext_i64_i32(ltid_pre_20021));
            int64_t ltid_x_18990 = sext_i32_i64(sext_i64_i32(ltid_pre_20022));
            int32_t ltid_flat_18991 = local_tid_20017;
            double color_19878[Rx_18861];
            double color_19879[Ry_18859];
            int64_t binop_x_19018 = Ry_18859 * ltid_y_18992;
            
            for (int64_t i_19016 = 0; i_19016 < Ry_18859; i_19016++) {
                int64_t binop_x_19019 = i_19016 + binop_x_19018;
                int64_t binop_y_19020 = Tk_18862 * binop_x_19019;
                int64_t a_loc_ind_19021 = i_18988 + binop_y_19020;
                
                for (int64_t i_20049 = 0; i_20049 < (int64_t) 1; i_20049++) {
                    color_19879[i_19016 + i_20049] = ((__local
                                                       double *) color_19890)[a_loc_ind_19021 +
                                                                              i_20049];
                }
            }
            
            int64_t binop_y_19029 = Rx_18861 * ltid_x_18990;
            
            for (int64_t i_19025 = 0; i_19025 < Rx_18861; i_19025++) {
                int64_t binop_x_19028 = i_19025 + binop_y_19027;
                int64_t b_loc_ind_19030 = binop_x_19028 + binop_y_19029;
                
                for (int64_t i_20051 = 0; i_20051 < (int64_t) 1; i_20051++) {
                    color_19878[i_19025 + i_20051] = ((__local
                                                       double *) color_19889)[b_loc_ind_19030 +
                                                                              i_20051];
                }
            }
            for (int64_t i_20052 = 0; i_20052 < Ry_18859; i_20052++) {
                color_19888[i_20052] = color_19879[i_20052];
            }
            for (int64_t i_20053 = 0; i_20053 < Rx_18861; i_20053++) {
                color_19887[i_20053] = color_19878[i_20053];
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            
            int64_t ltid_y_19037 = sext_i32_i64(sext_i64_i32(ltid_pre_20021));
            int64_t ltid_x_19035 = sext_i32_i64(sext_i64_i32(ltid_pre_20022));
            int32_t ltid_flat_19036 = local_tid_20017;
            int64_t binop_y_19078 = Ry_18859 * ltid_y_19037;
            int64_t binop_y_19082 = Rx_18861 * ltid_x_19035;
            
            for (int64_t i_19072 = 0; i_19072 < Ry_18859; i_19072++) {
                int64_t binop_x_19077 = iii_18878 + i_19072;
                int64_t cmpop_x_19079 = binop_x_19077 + binop_y_19078;
                bool binop_x_19080 = slt64(cmpop_x_19079, implz2088U_16707);
                
                for (int64_t i_19075 = 0; i_19075 < Rx_18861; i_19075++) {
                    int64_t binop_x_19081 = jjj_18879 + i_19075;
                    int64_t cmpop_x_19083 = binop_x_19081 + binop_y_19082;
                    bool binop_y_19084 = slt64(cmpop_x_19083, implz2082U_16708);
                    bool cond_19085 = binop_x_19080 && binop_y_19084;
                    
                    if (cond_19085) {
                        double a_19087 = color_19888[i_19072];
                        double b_19088 = color_19887[i_19075];
                        double c_19089 = mem_param_19595[i_19072 * Rx_18861 +
                                                         i_19075];
                        double defunc_1_f_res_19092 = a_19087 * b_19088;
                        double defunc_1_op_res_19096 = c_19089 +
                               defunc_1_f_res_19092;
                        
                        mem_param_19595[i_19072 * Rx_18861 + i_19075] =
                            defunc_1_op_res_19096;
                    }
                }
            }
            for (int64_t i_20056 = 0; i_20056 < Ry_18859; i_20056++) {
                for (int64_t i_20057 = 0; i_20057 < Rx_18861; i_20057++) {
                    mem_param_out_19855[i_20056 * Rx_18861 + i_20057] =
                        mem_param_19595[i_20056 * Rx_18861 + i_20057];
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            
            double mem_param_tmp_20045[Ry_18859 * Rx_18861];
            
            for (int32_t i_5 = 0; i_5 < Ry_18859 * Rx_18861; i_5++)
                mem_param_tmp_20045[i_5] = mem_param_out_19855[i_5];
            
            double mem_param_out_tmp_20046[Ry_18859 * Rx_18861];
            
            for (int32_t i_6 = 0; i_6 < Ry_18859 * Rx_18861; i_6++)
                mem_param_out_tmp_20046[i_6] = mem_param_19595[i_6];
            for (int32_t i_7 = 0; i_7 < Ry_18859 * Rx_18861; i_7++)
                mem_param_19595[i_7] = mem_param_tmp_20045[i_7];
            for (int32_t i_8 = 0; i_8 < Ry_18859 * Rx_18861; i_8++)
                mem_param_out_19855[i_8] = mem_param_out_tmp_20046[i_8];
        }
        for (int32_t i_9 = 0; i_9 < Ry_18859 * Rx_18861; i_9++)
            ext_mem_19624[i_9] = mem_param_19595[i_9];
        for (int32_t i_10 = 0; i_10 < Ry_18859 * Rx_18861; i_10++)
            ext_mem_unused_19854[i_10] = mem_param_out_19855[i_10];
        
        double mem_param_tmp_20035[Ry_18859 * Rx_18861];
        
        for (int32_t i_11 = 0; i_11 < Ry_18859 * Rx_18861; i_11++)
            mem_param_tmp_20035[i_11] = ext_mem_19624[i_11];
        for (int32_t i_12 = 0; i_12 < Ry_18859 * Rx_18861; i_12++)
            mem_param_19538[i_12] = mem_param_tmp_20035[i_12];
    }
    for (int32_t i_13 = 0; i_13 < Ry_18859 * Rx_18861; i_13++)
        ext_mem_19627[i_13] = mem_param_19538[i_13];
    for (int64_t i_19106 = 0; i_19106 < Ry_18859; i_19106++) {
        int64_t binop_y_19131 = Ty_18858 * i_19106;
        
        for (int64_t i_19108 = 0; i_19108 < tk_div_tx_18863; i_19108++) {
            int64_t binop_y_19129 = Tx_18860 * i_19108;
            int64_t ltid_x_19110 = sext_i32_i64(sext_i64_i32(ltid_pre_20021));
            int64_t ltid_y_19111 = sext_i32_i64(sext_i64_i32(ltid_pre_20022));
            int32_t ltid_flat_19112 = local_tid_20017;
            int64_t k_19130 = ltid_y_19111 + binop_y_19129;
            int64_t i_19132 = ltid_x_19110 + binop_y_19131;
            int64_t gtid_19133 = iii_18878 + i_19132;
            int64_t A_col_idx_19134 = kk_19105 + k_19130;
            bool binop_x_19135 = slt64(gtid_19133, implz2088U_16707);
            bool binop_y_19136 = slt64(A_col_idx_19134, implz2081U_16706);
            bool cond_19137 = binop_x_19135 && binop_y_19136;
            double A_elem_19138;
            
            if (cond_19137) {
                double A_elem_19140 = ((__global
                                        double *) x_mem_19394)[gtid_19133 *
                                                               implz2081U_16706 +
                                                               A_col_idx_19134];
                
                A_elem_19138 = A_elem_19140;
            } else {
                A_elem_19138 = 0.0;
            }
            
            bool cond_19142 = slt64(k_19130, Tk_18862);
            int64_t a_loc_ind_19143;
            
            if (cond_19142) {
                int64_t binop_y_19144 = Tk_18862 * i_19132;
                int64_t loc_fi_19145 = k_19130 + binop_y_19144;
                
                a_loc_ind_19143 = loc_fi_19145;
            } else {
                a_loc_ind_19143 = (int64_t) -1;
            }
            if (sle64((int64_t) 0, a_loc_ind_19143) && slt64(a_loc_ind_19143,
                                                             a_loc_szz_18868)) {
                ((__local double *) color_19890)[a_loc_ind_19143] =
                    A_elem_19138;
            }
            barrier(CLK_LOCAL_MEM_FENCE);
        }
    }
    for (int64_t i_19150 = 0; i_19150 < tk_div_ty_18864; i_19150++) {
        int64_t binop_y_19173 = Ty_18858 * i_19150;
        
        for (int64_t i_19152 = 0; i_19152 < Rx_18861; i_19152++) {
            int64_t binop_y_19175 = Tx_18860 * i_19152;
            int64_t ltid_x_19154 = sext_i32_i64(sext_i64_i32(ltid_pre_20021));
            int64_t ltid_y_19155 = sext_i32_i64(sext_i64_i32(ltid_pre_20022));
            int32_t ltid_flat_19156 = local_tid_20017;
            int64_t k_19174 = ltid_x_19154 + binop_y_19173;
            int64_t j_19176 = ltid_y_19155 + binop_y_19175;
            int64_t gtid_19177 = jjj_18879 + j_19176;
            int64_t B_row_idx_19178 = kk_19105 + k_19174;
            bool binop_x_19179 = slt64(gtid_19177, implz2082U_16708);
            bool binop_y_19180 = slt64(B_row_idx_19178, implz2081U_16706);
            bool cond_19181 = binop_x_19179 && binop_y_19180;
            double B_elem_19182;
            
            if (cond_19181) {
                int64_t binop_x_19324 = implz2082U_16708 * B_row_idx_19178;
                int64_t binop_x_19325 = gtid_19177 + binop_x_19324;
                int64_t new_index_19326 = squot64(binop_x_19325,
                                                  implz2085U_16711);
                int64_t binop_y_19332 = implz2085U_16711 * new_index_19326;
                int64_t new_index_19333 = binop_x_19325 - binop_y_19332;
                double B_elem_19184 = ((__global
                                        double *) beta_mem_19396)[new_index_19326 *
                                                                  implz2085U_16711 +
                                                                  new_index_19333];
                
                B_elem_19182 = B_elem_19184;
            } else {
                B_elem_19182 = 0.0;
            }
            
            bool cond_19186 = slt64(k_19174, Tk_18862);
            int64_t b_loc_ind_19187;
            
            if (cond_19186) {
                int64_t binop_y_19188 = TxRx_18865 * k_19174;
                int64_t loc_fi_19189 = j_19176 + binop_y_19188;
                
                b_loc_ind_19187 = loc_fi_19189;
            } else {
                b_loc_ind_19187 = (int64_t) -1;
            }
            if (sle64((int64_t) 0, b_loc_ind_19187) && slt64(b_loc_ind_19187,
                                                             b_loc_szz_18870)) {
                ((__local double *) color_19889)[b_loc_ind_19187] =
                    B_elem_19182;
            }
            barrier(CLK_LOCAL_MEM_FENCE);
        }
    }
    for (int64_t i_20062 = 0; i_20062 < Ry_18859; i_20062++) {
        for (int64_t i_20063 = 0; i_20063 < Rx_18861; i_20063++) {
            color_19884[i_20062 * Rx_18861 + i_20063] = ext_mem_19627[i_20062 *
                                                                      Rx_18861 +
                                                                      i_20063];
        }
    }
    
    double ext_mem_19708[Ry_18859 * Rx_18861];
    double ext_mem_unused_19862[Ry_18859 * Rx_18861];
    double mem_param_19678[Ry_18859 * Rx_18861];
    double mem_param_out_19863[Ry_18859 * Rx_18861];
    
    for (int32_t i_14 = 0; i_14 < Ry_18859 * Rx_18861; i_14++)
        mem_param_19678[i_14] = color_19884[i_14];
    for (int32_t i_15 = 0; i_15 < Ry_18859 * Rx_18861; i_15++)
        mem_param_out_19863[i_15] = color_19885[i_15];
    for (int64_t i_19194 = 0; i_19194 < Tk_18862; i_19194++) {
        int64_t cmpop_x_19196 = kk_19105 + i_19194;
        bool cond_19197 = slt64(cmpop_x_19196, implz2081U_16706);
        
        if (cond_19197) {
            int64_t binop_y_19235 = TxRx_18865 * i_19194;
            int64_t bytes_19680 = (int64_t) 8 * Ry_18859;
            int64_t bytes_19682 = (int64_t) 8 * Rx_18861;
            int64_t ltid_y_19200 = sext_i32_i64(sext_i64_i32(ltid_pre_20021));
            int64_t ltid_x_19198 = sext_i32_i64(sext_i64_i32(ltid_pre_20022));
            int32_t ltid_flat_19199 = local_tid_20017;
            double color_19880[Rx_18861];
            double color_19881[Ry_18859];
            int64_t binop_x_19226 = Ry_18859 * ltid_y_19200;
            
            for (int64_t i_19224 = 0; i_19224 < Ry_18859; i_19224++) {
                int64_t binop_x_19227 = i_19224 + binop_x_19226;
                int64_t binop_y_19228 = Tk_18862 * binop_x_19227;
                int64_t a_loc_ind_19229 = i_19194 + binop_y_19228;
                
                for (int64_t i_20068 = 0; i_20068 < (int64_t) 1; i_20068++) {
                    color_19881[i_19224 + i_20068] = ((__local
                                                       double *) color_19890)[a_loc_ind_19229 +
                                                                              i_20068];
                }
            }
            
            int64_t binop_y_19237 = Rx_18861 * ltid_x_19198;
            
            for (int64_t i_19233 = 0; i_19233 < Rx_18861; i_19233++) {
                int64_t binop_x_19236 = i_19233 + binop_y_19235;
                int64_t b_loc_ind_19238 = binop_x_19236 + binop_y_19237;
                
                for (int64_t i_20070 = 0; i_20070 < (int64_t) 1; i_20070++) {
                    color_19880[i_19233 + i_20070] = ((__local
                                                       double *) color_19889)[b_loc_ind_19238 +
                                                                              i_20070];
                }
            }
            for (int64_t i_20071 = 0; i_20071 < Ry_18859; i_20071++) {
                color_19888[i_20071] = color_19881[i_20071];
            }
            for (int64_t i_20072 = 0; i_20072 < Rx_18861; i_20072++) {
                color_19887[i_20072] = color_19880[i_20072];
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            
            int64_t ltid_y_19245 = sext_i32_i64(sext_i64_i32(ltid_pre_20021));
            int64_t ltid_x_19243 = sext_i32_i64(sext_i64_i32(ltid_pre_20022));
            int32_t ltid_flat_19244 = local_tid_20017;
            int64_t binop_y_19286 = Ry_18859 * ltid_y_19245;
            int64_t binop_y_19290 = Rx_18861 * ltid_x_19243;
            
            for (int64_t i_19280 = 0; i_19280 < Ry_18859; i_19280++) {
                int64_t binop_x_19285 = iii_18878 + i_19280;
                int64_t cmpop_x_19287 = binop_x_19285 + binop_y_19286;
                bool binop_x_19288 = slt64(cmpop_x_19287, implz2088U_16707);
                
                for (int64_t i_19283 = 0; i_19283 < Rx_18861; i_19283++) {
                    int64_t binop_x_19289 = jjj_18879 + i_19283;
                    int64_t cmpop_x_19291 = binop_x_19289 + binop_y_19290;
                    bool binop_y_19292 = slt64(cmpop_x_19291, implz2082U_16708);
                    bool cond_19293 = binop_x_19288 && binop_y_19292;
                    
                    if (cond_19293) {
                        double a_19295 = color_19888[i_19280];
                        double b_19296 = color_19887[i_19283];
                        double c_19297 = mem_param_19678[i_19280 * Rx_18861 +
                                                         i_19283];
                        double defunc_1_f_res_19300 = a_19295 * b_19296;
                        double defunc_1_op_res_19304 = c_19297 +
                               defunc_1_f_res_19300;
                        
                        mem_param_19678[i_19280 * Rx_18861 + i_19283] =
                            defunc_1_op_res_19304;
                    }
                }
            }
            for (int64_t i_20075 = 0; i_20075 < Ry_18859; i_20075++) {
                for (int64_t i_20076 = 0; i_20076 < Rx_18861; i_20076++) {
                    color_19886[i_20075 * Rx_18861 + i_20076] =
                        mem_param_19678[i_20075 * Rx_18861 + i_20076];
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            for (int64_t i_20077 = 0; i_20077 < Ry_18859; i_20077++) {
                for (int64_t i_20078 = 0; i_20078 < Rx_18861; i_20078++) {
                    mem_param_out_19863[i_20077 * Rx_18861 + i_20078] =
                        color_19886[i_20077 * Rx_18861 + i_20078];
                }
            }
        } else {
            for (int64_t i_20079 = 0; i_20079 < Ry_18859; i_20079++) {
                for (int64_t i_20080 = 0; i_20080 < Rx_18861; i_20080++) {
                    mem_param_out_19863[i_20079 * Rx_18861 + i_20080] =
                        mem_param_19678[i_20079 * Rx_18861 + i_20080];
                }
            }
        }
        
        double mem_param_tmp_20064[Ry_18859 * Rx_18861];
        
        for (int32_t i_16 = 0; i_16 < Ry_18859 * Rx_18861; i_16++)
            mem_param_tmp_20064[i_16] = mem_param_out_19863[i_16];
        
        double mem_param_out_tmp_20065[Ry_18859 * Rx_18861];
        
        for (int32_t i_17 = 0; i_17 < Ry_18859 * Rx_18861; i_17++)
            mem_param_out_tmp_20065[i_17] = mem_param_19678[i_17];
        for (int32_t i_18 = 0; i_18 < Ry_18859 * Rx_18861; i_18++)
            mem_param_19678[i_18] = mem_param_tmp_20064[i_18];
        for (int32_t i_19 = 0; i_19 < Ry_18859 * Rx_18861; i_19++)
            mem_param_out_19863[i_19] = mem_param_out_tmp_20065[i_19];
    }
    for (int32_t i_20 = 0; i_20 < Ry_18859 * Rx_18861; i_20++)
        ext_mem_19708[i_20] = mem_param_19678[i_20];
    for (int32_t i_21 = 0; i_21 < Ry_18859 * Rx_18861; i_21++)
        ext_mem_unused_19862[i_21] = mem_param_out_19863[i_21];
    
    int64_t slice_20083 = Tx_18860;
    int64_t slice_20084 = Ty_18858 * slice_20083;
    int64_t reg_tile_i_20081 = squot64(sext_i32_i64(local_tid_20017),
                                       slice_20083);
    int64_t remnant_20085 = sext_i32_i64(local_tid_20017) - reg_tile_i_20081 *
            slice_20083;
    int64_t reg_tile_i_20082 = remnant_20085;
    int64_t remnant_20086 = remnant_20085 - reg_tile_i_20082;
    int64_t tile_dim_start_20087 = Ry_18859 * (Ty_18858 * gid_y_18876 +
                                               reg_tile_i_20081);
    int64_t tile_dim_start_20088 = Rx_18861 * (Tx_18860 * gid_x_18875 +
                                               reg_tile_i_20082);
    
    for (int64_t nest_i_20089 = 0; nest_i_20089 < Ry_18859; nest_i_20089++) {
        for (int64_t nest_i_20090 = 0; nest_i_20090 < Rx_18861;
             nest_i_20090++) {
            if (slt64(tile_dim_start_20087 + nest_i_20089, implz2088U_16707) &&
                slt64(tile_dim_start_20088 + nest_i_20090, implz2082U_16708)) {
                ((__global double *) mem_19712)[(tile_dim_start_20087 +
                                                 nest_i_20089) *
                                                implz2082U_16708 +
                                                (tile_dim_start_20088 +
                                                 nest_i_20090)] =
                    ext_mem_19708[nest_i_20089 * Rx_18861 + nest_i_20090];
            }
        }
    }
    
  error_9:
    return;
    #undef Ty_18858
    #undef Ry_18859
    #undef Tx_18860
    #undef Rx_18861
    #undef Tk_18862
    #undef tk_div_tx_18863
    #undef tk_div_ty_18864
    #undef TxRx_18865
    #undef TyRy_18866
    #undef a_loc_szz_18868
    #undef b_loc_szz_18870
}
__kernel void criterionzisegred_large_17582(__global int *global_failure,
                                            __local volatile
                                            int64_t *sync_arr_mem_20265_backing_aligned_0,
                                            __local volatile
                                            int64_t *red_arr_mem_20263_backing_aligned_1,
                                            int64_t implz2088U_16707,
                                            int64_t implz2083U_16709,
                                            int64_t num_groups_17921,
                                            int64_t groups_per_segment_20249,
                                            int64_t elements_per_thread_20250,
                                            int64_t virt_num_groups_20251,
                                            int64_t threads_per_segment_20253,
                                            __global unsigned char *mem_19722,
                                            __global unsigned char *mem_19726,
                                            __global unsigned char *mem_19730,
                                            __global unsigned char *mem_19734,
                                            __global
                                            unsigned char *segred_tmp_mem_20254,
                                            __global
                                            unsigned char *criterionzicounter_mem_20256)
{
    #define segred_group_sizze_17920 (criterionzisegred_group_sizze_17576)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict sync_arr_mem_20265_backing_1 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_20265_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_20263_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20263_backing_aligned_1;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20258;
    int32_t local_tid_20259;
    int64_t group_sizze_20262;
    int32_t wave_sizze_20261;
    int32_t group_tid_20260;
    
    global_tid_20258 = get_global_id(0);
    local_tid_20259 = get_local_id(0);
    group_sizze_20262 = get_local_size(0);
    wave_sizze_20261 = LOCKSTEP_WIDTH;
    group_tid_20260 = get_group_id(0);
    
    int32_t phys_tid_17582 = global_tid_20258;
    __local unsigned char *red_arr_mem_20263;
    
    red_arr_mem_20263 = (__local unsigned char *) red_arr_mem_20263_backing_0;
    
    __local unsigned char *sync_arr_mem_20265;
    
    sync_arr_mem_20265 = (__local unsigned char *) sync_arr_mem_20265_backing_1;
    
    int32_t phys_group_id_20267;
    
    phys_group_id_20267 = get_group_id(0);
    for (int32_t i_20268 = 0; i_20268 <
         sdiv_up32(sext_i64_i32(virt_num_groups_20251) - phys_group_id_20267,
                   sext_i64_i32(num_groups_17921)); i_20268++) {
        int32_t virt_group_id_20269 = phys_group_id_20267 + i_20268 *
                sext_i64_i32(num_groups_17921);
        int32_t flat_segment_id_20270 = squot32(virt_group_id_20269,
                                                sext_i64_i32(groups_per_segment_20249));
        int64_t global_tid_20271 = srem64(sext_i32_i64(virt_group_id_20269) *
                                          segred_group_sizze_17920 +
                                          sext_i32_i64(local_tid_20259),
                                          segred_group_sizze_17920 *
                                          groups_per_segment_20249);
        int64_t slice_20272 = implz2088U_16707;
        int64_t gtid_17573 = sext_i32_i64(flat_segment_id_20270);
        int64_t remnant_20273 = sext_i32_i64(flat_segment_id_20270) -
                gtid_17573;
        int64_t gtid_17581;
        double x_acc_20274;
        int64_t chunk_sizze_20275 = smin64(elements_per_thread_20250,
                                           sdiv_up64(implz2083U_16709 -
                                                     global_tid_20271,
                                                     threads_per_segment_20253));
        double x_17925;
        double x_17926;
        
        // neutral-initialise the accumulators
        {
            x_acc_20274 = 0.0;
        }
        for (int64_t i_20279 = 0; i_20279 < chunk_sizze_20275; i_20279++) {
            gtid_17581 = global_tid_20271 + threads_per_segment_20253 * i_20279;
            // apply map function
            {
                double defunc_2_reduce_res_17928 = ((__global
                                                     double *) mem_19722)[gtid_17573];
                double x_17930 = ((__global double *) mem_19726)[gtid_17573 *
                                                                 implz2083U_16709 +
                                                                 gtid_17581];
                double defunc_0_f_res_17931 = x_17930 -
                       defunc_2_reduce_res_17928;
                double defunc_0_f_res_17932;
                
                defunc_0_f_res_17932 = futrts_exp64(defunc_0_f_res_17931);
                // save map-out results
                {
                    ((__global double *) mem_19734)[gtid_17573 *
                                                    implz2083U_16709 +
                                                    gtid_17581] =
                        defunc_0_f_res_17931;
                }
                // load accumulator
                {
                    x_17925 = x_acc_20274;
                }
                // load new values
                {
                    x_17926 = defunc_0_f_res_17932;
                }
                // apply reduction operator
                {
                    double defunc_1_op_res_17927 = x_17925 + x_17926;
                    
                    // store in accumulator
                    {
                        x_acc_20274 = defunc_1_op_res_17927;
                    }
                }
            }
        }
        // to reduce current chunk, first store our result in memory
        {
            x_17925 = x_acc_20274;
            ((__local
              double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259)] =
                x_17925;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        
        int32_t offset_20280;
        int32_t skip_waves_20281 = 1;
        double x_20276;
        double x_20277;
        
        offset_20280 = 0;
        // participating threads read initial accumulator
        {
            if (slt32(local_tid_20259,
                      sext_i64_i32(segred_group_sizze_17920))) {
                x_20276 = ((__local
                            double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259 +
                                                         offset_20280)];
            }
        }
        offset_20280 = 1;
        while (slt32(offset_20280, wave_sizze_20261)) {
            if (slt32(local_tid_20259 + offset_20280,
                      sext_i64_i32(segred_group_sizze_17920)) &&
                ((local_tid_20259 - squot32(local_tid_20259, wave_sizze_20261) *
                  wave_sizze_20261) & (2 * offset_20280 - 1)) == 0) {
                // read array element
                {
                    x_20277 = ((volatile __local
                                double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259 +
                                                             offset_20280)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20278 = x_20276 + x_20277;
                    
                    x_20276 = defunc_1_op_res_20278;
                }
                // write result of operation
                {
                    ((volatile __local
                      double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259)] =
                        x_20276;
                }
            }
            offset_20280 *= 2;
        }
        while (slt32(skip_waves_20281,
                     squot32(sext_i64_i32(segred_group_sizze_17920) +
                             wave_sizze_20261 - 1, wave_sizze_20261))) {
            barrier(CLK_LOCAL_MEM_FENCE);
            offset_20280 = skip_waves_20281 * wave_sizze_20261;
            if (slt32(local_tid_20259 + offset_20280,
                      sext_i64_i32(segred_group_sizze_17920)) &&
                ((local_tid_20259 - squot32(local_tid_20259, wave_sizze_20261) *
                  wave_sizze_20261) == 0 && (squot32(local_tid_20259,
                                                     wave_sizze_20261) & (2 *
                                                                          skip_waves_20281 -
                                                                          1)) ==
                 0)) {
                // read array element
                {
                    x_20277 = ((__local
                                double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259 +
                                                             offset_20280)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20278 = x_20276 + x_20277;
                    
                    x_20276 = defunc_1_op_res_20278;
                }
                // write result of operation
                {
                    ((__local
                      double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259)] =
                        x_20276;
                }
            }
            skip_waves_20281 *= 2;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // first thread saves the result in accumulator
        {
            if (sext_i32_i64(local_tid_20259) == (int64_t) 0) {
                x_acc_20274 = x_20276;
            }
        }
        if (groups_per_segment_20249 == (int64_t) 1) {
            // first thread in group saves final result to memory
            {
                if (local_tid_20259 == 0) {
                    ((__global double *) mem_19730)[gtid_17573] = x_acc_20274;
                }
            }
        } else {
            int32_t old_counter_20282;
            
            // first thread in group saves group result to global memory
            {
                if (local_tid_20259 == 0) {
                    ((__global
                      double *) segred_tmp_mem_20254)[sext_i32_i64(virt_group_id_20269)] =
                        x_acc_20274;
                    mem_fence_global();
                    old_counter_20282 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) criterionzicounter_mem_20256)[sext_i32_i64(srem32(flat_segment_id_20270,
                                                                                                          10240))],
                                              (int) 1);
                    ((__local bool *) sync_arr_mem_20265)[(int64_t) 0] =
                        old_counter_20282 == groups_per_segment_20249 -
                        (int64_t) 1;
                }
            }
            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
            
            bool is_last_group_20283 = ((__local
                                         bool *) sync_arr_mem_20265)[(int64_t) 0];
            
            if (is_last_group_20283) {
                if (local_tid_20259 == 0) {
                    old_counter_20282 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) criterionzicounter_mem_20256)[sext_i32_i64(srem32(flat_segment_id_20270,
                                                                                                          10240))],
                                              (int) ((int64_t) 0 -
                                                     groups_per_segment_20249));
                }
                // read in the per-group-results
                {
                    int64_t read_per_thread_20284 =
                            sdiv_up64(groups_per_segment_20249,
                                      segred_group_sizze_17920);
                    
                    x_17925 = 0.0;
                    for (int64_t i_20285 = 0; i_20285 < read_per_thread_20284;
                         i_20285++) {
                        int64_t group_res_id_20286 =
                                sext_i32_i64(local_tid_20259) *
                                read_per_thread_20284 + i_20285;
                        int64_t index_of_group_res_20287 =
                                sext_i32_i64(flat_segment_id_20270) *
                                groups_per_segment_20249 + group_res_id_20286;
                        
                        if (slt64(group_res_id_20286,
                                  groups_per_segment_20249)) {
                            x_17926 = ((__global
                                        double *) segred_tmp_mem_20254)[index_of_group_res_20287];
                            
                            double defunc_1_op_res_17927 = x_17925 + x_17926;
                            
                            x_17925 = defunc_1_op_res_17927;
                        }
                    }
                }
                ((__local
                  double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259)] =
                    x_17925;
                barrier(CLK_LOCAL_MEM_FENCE);
                // reduce the per-group results
                {
                    int32_t offset_20288;
                    int32_t skip_waves_20289 = 1;
                    double x_20276;
                    double x_20277;
                    
                    offset_20288 = 0;
                    // participating threads read initial accumulator
                    {
                        if (slt32(local_tid_20259,
                                  sext_i64_i32(segred_group_sizze_17920))) {
                            x_20276 = ((__local
                                        double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259 +
                                                                     offset_20288)];
                        }
                    }
                    offset_20288 = 1;
                    while (slt32(offset_20288, wave_sizze_20261)) {
                        if (slt32(local_tid_20259 + offset_20288,
                                  sext_i64_i32(segred_group_sizze_17920)) &&
                            ((local_tid_20259 - squot32(local_tid_20259,
                                                        wave_sizze_20261) *
                              wave_sizze_20261) & (2 * offset_20288 - 1)) ==
                            0) {
                            // read array element
                            {
                                x_20277 = ((volatile __local
                                            double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259 +
                                                                         offset_20288)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20278 = x_20276 +
                                       x_20277;
                                
                                x_20276 = defunc_1_op_res_20278;
                            }
                            // write result of operation
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259)] =
                                    x_20276;
                            }
                        }
                        offset_20288 *= 2;
                    }
                    while (slt32(skip_waves_20289,
                                 squot32(sext_i64_i32(segred_group_sizze_17920) +
                                         wave_sizze_20261 - 1,
                                         wave_sizze_20261))) {
                        barrier(CLK_LOCAL_MEM_FENCE);
                        offset_20288 = skip_waves_20289 * wave_sizze_20261;
                        if (slt32(local_tid_20259 + offset_20288,
                                  sext_i64_i32(segred_group_sizze_17920)) &&
                            ((local_tid_20259 - squot32(local_tid_20259,
                                                        wave_sizze_20261) *
                              wave_sizze_20261) == 0 &&
                             (squot32(local_tid_20259, wave_sizze_20261) & (2 *
                                                                            skip_waves_20289 -
                                                                            1)) ==
                             0)) {
                            // read array element
                            {
                                x_20277 = ((__local
                                            double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259 +
                                                                         offset_20288)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20278 = x_20276 +
                                       x_20277;
                                
                                x_20276 = defunc_1_op_res_20278;
                            }
                            // write result of operation
                            {
                                ((__local
                                  double *) red_arr_mem_20263)[sext_i32_i64(local_tid_20259)] =
                                    x_20276;
                            }
                        }
                        skip_waves_20289 *= 2;
                    }
                    // and back to memory with the final result
                    {
                        if (local_tid_20259 == 0) {
                            ((__global double *) mem_19730)[gtid_17573] =
                                x_20276;
                        }
                    }
                }
            }
        }
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17920
}
__kernel void criterionzisegred_large_17601(__global int *global_failure,
                                            __local volatile
                                            int64_t *sync_arr_mem_20200_backing_aligned_0,
                                            __local volatile
                                            int64_t *red_arr_mem_20198_backing_aligned_1,
                                            int64_t implz2088U_16707,
                                            int64_t implz2082U_16708,
                                            int64_t implz2083U_16709,
                                            int64_t num_groups_17902,
                                            int64_t groups_per_segment_20184,
                                            int64_t elements_per_thread_20185,
                                            int64_t virt_num_groups_20186,
                                            int64_t threads_per_segment_20188,
                                            __global
                                            unsigned char *zz_mem_19395,
                                            __global
                                            unsigned char *ext_mem_19718,
                                            __global unsigned char *mem_19722,
                                            __global unsigned char *mem_19726,
                                            __global
                                            unsigned char *segred_tmp_mem_20189,
                                            __global
                                            unsigned char *criterionzicounter_mem_20191)
{
    #define segred_group_sizze_17901 (criterionzisegred_group_sizze_17595)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict sync_arr_mem_20200_backing_1 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_20200_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_20198_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20198_backing_aligned_1;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20193;
    int32_t local_tid_20194;
    int64_t group_sizze_20197;
    int32_t wave_sizze_20196;
    int32_t group_tid_20195;
    
    global_tid_20193 = get_global_id(0);
    local_tid_20194 = get_local_id(0);
    group_sizze_20197 = get_local_size(0);
    wave_sizze_20196 = LOCKSTEP_WIDTH;
    group_tid_20195 = get_group_id(0);
    
    int32_t phys_tid_17601 = global_tid_20193;
    __local unsigned char *red_arr_mem_20198;
    
    red_arr_mem_20198 = (__local unsigned char *) red_arr_mem_20198_backing_0;
    
    __local unsigned char *sync_arr_mem_20200;
    
    sync_arr_mem_20200 = (__local unsigned char *) sync_arr_mem_20200_backing_1;
    
    int32_t phys_group_id_20202;
    
    phys_group_id_20202 = get_group_id(0);
    for (int32_t i_20203 = 0; i_20203 <
         sdiv_up32(sext_i64_i32(virt_num_groups_20186) - phys_group_id_20202,
                   sext_i64_i32(num_groups_17902)); i_20203++) {
        int32_t virt_group_id_20204 = phys_group_id_20202 + i_20203 *
                sext_i64_i32(num_groups_17902);
        int32_t flat_segment_id_20205 = squot32(virt_group_id_20204,
                                                sext_i64_i32(groups_per_segment_20184));
        int64_t global_tid_20206 = srem64(sext_i32_i64(virt_group_id_20204) *
                                          segred_group_sizze_17901 +
                                          sext_i32_i64(local_tid_20194),
                                          segred_group_sizze_17901 *
                                          groups_per_segment_20184);
        int64_t slice_20207 = implz2088U_16707;
        int64_t gtid_17592 = sext_i32_i64(flat_segment_id_20205);
        int64_t remnant_20208 = sext_i32_i64(flat_segment_id_20205) -
                gtid_17592;
        int64_t gtid_17600;
        double x_acc_20209;
        int64_t chunk_sizze_20210 = smin64(elements_per_thread_20185,
                                           sdiv_up64(implz2083U_16709 -
                                                     global_tid_20206,
                                                     threads_per_segment_20188));
        double x_17906;
        double x_17907;
        
        // neutral-initialise the accumulators
        {
            x_acc_20209 = -INFINITY;
        }
        for (int64_t i_20214 = 0; i_20214 < chunk_sizze_20210; i_20214++) {
            gtid_17600 = global_tid_20206 + threads_per_segment_20188 * i_20214;
            // apply map function
            {
                double defunc_2_reduce_res_17911;
                double redout_19372 = 0.0;
                
                for (int64_t i_19373 = 0; i_19373 < implz2082U_16708;
                     i_19373++) {
                    double x_17915 = ((__global
                                       double *) ext_mem_19718)[gtid_17592 *
                                                                implz2082U_16708 +
                                                                i_19373];
                    double x_17916 = ((__global
                                       double *) zz_mem_19395)[i_19373 *
                                                               implz2083U_16709 +
                                                               gtid_17600];
                    double defunc_1_f_res_17917 = x_17915 * x_17916;
                    double defunc_1_op_res_17914 = defunc_1_f_res_17917 +
                           redout_19372;
                    double redout_tmp_20215 = defunc_1_op_res_17914;
                    
                    redout_19372 = redout_tmp_20215;
                }
                defunc_2_reduce_res_17911 = redout_19372;
                // save map-out results
                {
                    ((__global double *) mem_19726)[gtid_17592 *
                                                    implz2083U_16709 +
                                                    gtid_17600] =
                        defunc_2_reduce_res_17911;
                }
                // load accumulator
                {
                    x_17906 = x_acc_20209;
                }
                // load new values
                {
                    x_17907 = defunc_2_reduce_res_17911;
                }
                // apply reduction operator
                {
                    double defunc_1_op_res_17908 = fmax64(x_17906, x_17907);
                    
                    // store in accumulator
                    {
                        x_acc_20209 = defunc_1_op_res_17908;
                    }
                }
            }
        }
        // to reduce current chunk, first store our result in memory
        {
            x_17906 = x_acc_20209;
            ((__local
              double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194)] =
                x_17906;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        
        int32_t offset_20216;
        int32_t skip_waves_20217 = 1;
        double x_20211;
        double x_20212;
        
        offset_20216 = 0;
        // participating threads read initial accumulator
        {
            if (slt32(local_tid_20194,
                      sext_i64_i32(segred_group_sizze_17901))) {
                x_20211 = ((__local
                            double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194 +
                                                         offset_20216)];
            }
        }
        offset_20216 = 1;
        while (slt32(offset_20216, wave_sizze_20196)) {
            if (slt32(local_tid_20194 + offset_20216,
                      sext_i64_i32(segred_group_sizze_17901)) &&
                ((local_tid_20194 - squot32(local_tid_20194, wave_sizze_20196) *
                  wave_sizze_20196) & (2 * offset_20216 - 1)) == 0) {
                // read array element
                {
                    x_20212 = ((volatile __local
                                double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194 +
                                                             offset_20216)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20213 = fmax64(x_20211, x_20212);
                    
                    x_20211 = defunc_1_op_res_20213;
                }
                // write result of operation
                {
                    ((volatile __local
                      double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194)] =
                        x_20211;
                }
            }
            offset_20216 *= 2;
        }
        while (slt32(skip_waves_20217,
                     squot32(sext_i64_i32(segred_group_sizze_17901) +
                             wave_sizze_20196 - 1, wave_sizze_20196))) {
            barrier(CLK_LOCAL_MEM_FENCE);
            offset_20216 = skip_waves_20217 * wave_sizze_20196;
            if (slt32(local_tid_20194 + offset_20216,
                      sext_i64_i32(segred_group_sizze_17901)) &&
                ((local_tid_20194 - squot32(local_tid_20194, wave_sizze_20196) *
                  wave_sizze_20196) == 0 && (squot32(local_tid_20194,
                                                     wave_sizze_20196) & (2 *
                                                                          skip_waves_20217 -
                                                                          1)) ==
                 0)) {
                // read array element
                {
                    x_20212 = ((__local
                                double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194 +
                                                             offset_20216)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20213 = fmax64(x_20211, x_20212);
                    
                    x_20211 = defunc_1_op_res_20213;
                }
                // write result of operation
                {
                    ((__local
                      double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194)] =
                        x_20211;
                }
            }
            skip_waves_20217 *= 2;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // first thread saves the result in accumulator
        {
            if (sext_i32_i64(local_tid_20194) == (int64_t) 0) {
                x_acc_20209 = x_20211;
            }
        }
        if (groups_per_segment_20184 == (int64_t) 1) {
            // first thread in group saves final result to memory
            {
                if (local_tid_20194 == 0) {
                    ((__global double *) mem_19722)[gtid_17592] = x_acc_20209;
                }
            }
        } else {
            int32_t old_counter_20218;
            
            // first thread in group saves group result to global memory
            {
                if (local_tid_20194 == 0) {
                    ((__global
                      double *) segred_tmp_mem_20189)[sext_i32_i64(virt_group_id_20204)] =
                        x_acc_20209;
                    mem_fence_global();
                    old_counter_20218 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) criterionzicounter_mem_20191)[sext_i32_i64(srem32(flat_segment_id_20205,
                                                                                                          10240))],
                                              (int) 1);
                    ((__local bool *) sync_arr_mem_20200)[(int64_t) 0] =
                        old_counter_20218 == groups_per_segment_20184 -
                        (int64_t) 1;
                }
            }
            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
            
            bool is_last_group_20219 = ((__local
                                         bool *) sync_arr_mem_20200)[(int64_t) 0];
            
            if (is_last_group_20219) {
                if (local_tid_20194 == 0) {
                    old_counter_20218 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) criterionzicounter_mem_20191)[sext_i32_i64(srem32(flat_segment_id_20205,
                                                                                                          10240))],
                                              (int) ((int64_t) 0 -
                                                     groups_per_segment_20184));
                }
                // read in the per-group-results
                {
                    int64_t read_per_thread_20220 =
                            sdiv_up64(groups_per_segment_20184,
                                      segred_group_sizze_17901);
                    
                    x_17906 = -INFINITY;
                    for (int64_t i_20221 = 0; i_20221 < read_per_thread_20220;
                         i_20221++) {
                        int64_t group_res_id_20222 =
                                sext_i32_i64(local_tid_20194) *
                                read_per_thread_20220 + i_20221;
                        int64_t index_of_group_res_20223 =
                                sext_i32_i64(flat_segment_id_20205) *
                                groups_per_segment_20184 + group_res_id_20222;
                        
                        if (slt64(group_res_id_20222,
                                  groups_per_segment_20184)) {
                            x_17907 = ((__global
                                        double *) segred_tmp_mem_20189)[index_of_group_res_20223];
                            
                            double defunc_1_op_res_17908 = fmax64(x_17906,
                                                                  x_17907);
                            
                            x_17906 = defunc_1_op_res_17908;
                        }
                    }
                }
                ((__local
                  double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194)] =
                    x_17906;
                barrier(CLK_LOCAL_MEM_FENCE);
                // reduce the per-group results
                {
                    int32_t offset_20224;
                    int32_t skip_waves_20225 = 1;
                    double x_20211;
                    double x_20212;
                    
                    offset_20224 = 0;
                    // participating threads read initial accumulator
                    {
                        if (slt32(local_tid_20194,
                                  sext_i64_i32(segred_group_sizze_17901))) {
                            x_20211 = ((__local
                                        double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194 +
                                                                     offset_20224)];
                        }
                    }
                    offset_20224 = 1;
                    while (slt32(offset_20224, wave_sizze_20196)) {
                        if (slt32(local_tid_20194 + offset_20224,
                                  sext_i64_i32(segred_group_sizze_17901)) &&
                            ((local_tid_20194 - squot32(local_tid_20194,
                                                        wave_sizze_20196) *
                              wave_sizze_20196) & (2 * offset_20224 - 1)) ==
                            0) {
                            // read array element
                            {
                                x_20212 = ((volatile __local
                                            double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194 +
                                                                         offset_20224)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20213 = fmax64(x_20211,
                                                                      x_20212);
                                
                                x_20211 = defunc_1_op_res_20213;
                            }
                            // write result of operation
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194)] =
                                    x_20211;
                            }
                        }
                        offset_20224 *= 2;
                    }
                    while (slt32(skip_waves_20225,
                                 squot32(sext_i64_i32(segred_group_sizze_17901) +
                                         wave_sizze_20196 - 1,
                                         wave_sizze_20196))) {
                        barrier(CLK_LOCAL_MEM_FENCE);
                        offset_20224 = skip_waves_20225 * wave_sizze_20196;
                        if (slt32(local_tid_20194 + offset_20224,
                                  sext_i64_i32(segred_group_sizze_17901)) &&
                            ((local_tid_20194 - squot32(local_tid_20194,
                                                        wave_sizze_20196) *
                              wave_sizze_20196) == 0 &&
                             (squot32(local_tid_20194, wave_sizze_20196) & (2 *
                                                                            skip_waves_20225 -
                                                                            1)) ==
                             0)) {
                            // read array element
                            {
                                x_20212 = ((__local
                                            double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194 +
                                                                         offset_20224)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20213 = fmax64(x_20211,
                                                                      x_20212);
                                
                                x_20211 = defunc_1_op_res_20213;
                            }
                            // write result of operation
                            {
                                ((__local
                                  double *) red_arr_mem_20198)[sext_i32_i64(local_tid_20194)] =
                                    x_20211;
                            }
                        }
                        skip_waves_20225 *= 2;
                    }
                    // and back to memory with the final result
                    {
                        if (local_tid_20194 == 0) {
                            ((__global double *) mem_19722)[gtid_17592] =
                                x_20211;
                        }
                    }
                }
            }
        }
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17901
}
__kernel void criterionzisegred_large_17646(__global int *global_failure,
                                            __local volatile
                                            int64_t *sync_arr_mem_20132_backing_aligned_0,
                                            __local volatile
                                            int64_t *red_arr_mem_20130_backing_aligned_1,
                                            int64_t implz2081U_16706,
                                            int64_t implz2088U_16707,
                                            int64_t implz2082U_16708,
                                            int64_t implz2085U_16711,
                                            int64_t num_groups_17887,
                                            int64_t groups_per_segment_20116,
                                            int64_t elements_per_thread_20117,
                                            int64_t virt_num_groups_20118,
                                            int64_t threads_per_segment_20120,
                                            __global unsigned char *x_mem_19394,
                                            __global
                                            unsigned char *beta_mem_19396,
                                            __global unsigned char *mem_19717,
                                            __global
                                            unsigned char *segred_tmp_mem_20121,
                                            __global
                                            unsigned char *criterionzicounter_mem_20123)
{
    #define segred_group_sizze_17886 (criterionzisegred_group_sizze_17640)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict sync_arr_mem_20132_backing_1 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_20132_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_20130_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20130_backing_aligned_1;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20125;
    int32_t local_tid_20126;
    int64_t group_sizze_20129;
    int32_t wave_sizze_20128;
    int32_t group_tid_20127;
    
    global_tid_20125 = get_global_id(0);
    local_tid_20126 = get_local_id(0);
    group_sizze_20129 = get_local_size(0);
    wave_sizze_20128 = LOCKSTEP_WIDTH;
    group_tid_20127 = get_group_id(0);
    
    int32_t phys_tid_17646 = global_tid_20125;
    __local unsigned char *red_arr_mem_20130;
    
    red_arr_mem_20130 = (__local unsigned char *) red_arr_mem_20130_backing_0;
    
    __local unsigned char *sync_arr_mem_20132;
    
    sync_arr_mem_20132 = (__local unsigned char *) sync_arr_mem_20132_backing_1;
    
    int32_t phys_group_id_20134;
    
    phys_group_id_20134 = get_group_id(0);
    for (int32_t i_20135 = 0; i_20135 <
         sdiv_up32(sext_i64_i32(virt_num_groups_20118) - phys_group_id_20134,
                   sext_i64_i32(num_groups_17887)); i_20135++) {
        int32_t virt_group_id_20136 = phys_group_id_20134 + i_20135 *
                sext_i64_i32(num_groups_17887);
        int32_t flat_segment_id_20137 = squot32(virt_group_id_20136,
                                                sext_i64_i32(groups_per_segment_20116));
        int64_t global_tid_20138 = srem64(sext_i32_i64(virt_group_id_20136) *
                                          segred_group_sizze_17886 +
                                          sext_i32_i64(local_tid_20126),
                                          segred_group_sizze_17886 *
                                          groups_per_segment_20116);
        int64_t slice_20139 = implz2082U_16708;
        int64_t slice_20140 = implz2088U_16707 * slice_20139;
        int64_t gtid_17635 = squot64(sext_i32_i64(flat_segment_id_20137),
                                     slice_20139);
        int64_t remnant_20141 = sext_i32_i64(flat_segment_id_20137) -
                gtid_17635 * slice_20139;
        int64_t gtid_17636 = remnant_20141;
        int64_t remnant_20142 = remnant_20141 - gtid_17636;
        int64_t gtid_17645;
        double x_acc_20143;
        int64_t chunk_sizze_20144 = smin64(elements_per_thread_20117,
                                           sdiv_up64(implz2081U_16706 -
                                                     global_tid_20138,
                                                     threads_per_segment_20120));
        double x_17890;
        double x_17891;
        
        // neutral-initialise the accumulators
        {
            x_acc_20143 = 0.0;
        }
        for (int64_t i_20148 = 0; i_20148 < chunk_sizze_20144; i_20148++) {
            gtid_17645 = global_tid_20138 + threads_per_segment_20120 * i_20148;
            // apply map function
            {
                double x_17895 = ((__global double *) x_mem_19394)[gtid_17635 *
                                                                   implz2081U_16706 +
                                                                   gtid_17645];
                int64_t binop_x_18831 = implz2082U_16708 * gtid_17645;
                int64_t binop_x_18832 = gtid_17636 + binop_x_18831;
                int64_t new_index_18833 = squot64(binop_x_18832,
                                                  implz2085U_16711);
                int64_t binop_y_18839 = implz2085U_16711 * new_index_18833;
                int64_t new_index_18840 = binop_x_18832 - binop_y_18839;
                double x_17896 = ((__global
                                   double *) beta_mem_19396)[new_index_18833 *
                                                             implz2085U_16711 +
                                                             new_index_18840];
                double defunc_1_f_res_17897 = x_17895 * x_17896;
                
                // save map-out results
                { }
                // load accumulator
                {
                    x_17890 = x_acc_20143;
                }
                // load new values
                {
                    x_17891 = defunc_1_f_res_17897;
                }
                // apply reduction operator
                {
                    double defunc_1_op_res_17892 = x_17890 + x_17891;
                    
                    // store in accumulator
                    {
                        x_acc_20143 = defunc_1_op_res_17892;
                    }
                }
            }
        }
        // to reduce current chunk, first store our result in memory
        {
            x_17890 = x_acc_20143;
            ((__local
              double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126)] =
                x_17890;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        
        int32_t offset_20149;
        int32_t skip_waves_20150 = 1;
        double x_20145;
        double x_20146;
        
        offset_20149 = 0;
        // participating threads read initial accumulator
        {
            if (slt32(local_tid_20126,
                      sext_i64_i32(segred_group_sizze_17886))) {
                x_20145 = ((__local
                            double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126 +
                                                         offset_20149)];
            }
        }
        offset_20149 = 1;
        while (slt32(offset_20149, wave_sizze_20128)) {
            if (slt32(local_tid_20126 + offset_20149,
                      sext_i64_i32(segred_group_sizze_17886)) &&
                ((local_tid_20126 - squot32(local_tid_20126, wave_sizze_20128) *
                  wave_sizze_20128) & (2 * offset_20149 - 1)) == 0) {
                // read array element
                {
                    x_20146 = ((volatile __local
                                double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126 +
                                                             offset_20149)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20147 = x_20145 + x_20146;
                    
                    x_20145 = defunc_1_op_res_20147;
                }
                // write result of operation
                {
                    ((volatile __local
                      double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126)] =
                        x_20145;
                }
            }
            offset_20149 *= 2;
        }
        while (slt32(skip_waves_20150,
                     squot32(sext_i64_i32(segred_group_sizze_17886) +
                             wave_sizze_20128 - 1, wave_sizze_20128))) {
            barrier(CLK_LOCAL_MEM_FENCE);
            offset_20149 = skip_waves_20150 * wave_sizze_20128;
            if (slt32(local_tid_20126 + offset_20149,
                      sext_i64_i32(segred_group_sizze_17886)) &&
                ((local_tid_20126 - squot32(local_tid_20126, wave_sizze_20128) *
                  wave_sizze_20128) == 0 && (squot32(local_tid_20126,
                                                     wave_sizze_20128) & (2 *
                                                                          skip_waves_20150 -
                                                                          1)) ==
                 0)) {
                // read array element
                {
                    x_20146 = ((__local
                                double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126 +
                                                             offset_20149)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20147 = x_20145 + x_20146;
                    
                    x_20145 = defunc_1_op_res_20147;
                }
                // write result of operation
                {
                    ((__local
                      double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126)] =
                        x_20145;
                }
            }
            skip_waves_20150 *= 2;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // first thread saves the result in accumulator
        {
            if (sext_i32_i64(local_tid_20126) == (int64_t) 0) {
                x_acc_20143 = x_20145;
            }
        }
        if (groups_per_segment_20116 == (int64_t) 1) {
            // first thread in group saves final result to memory
            {
                if (local_tid_20126 == 0) {
                    ((__global double *) mem_19717)[gtid_17635 *
                                                    implz2082U_16708 +
                                                    gtid_17636] = x_acc_20143;
                }
            }
        } else {
            int32_t old_counter_20151;
            
            // first thread in group saves group result to global memory
            {
                if (local_tid_20126 == 0) {
                    ((__global
                      double *) segred_tmp_mem_20121)[sext_i32_i64(virt_group_id_20136)] =
                        x_acc_20143;
                    mem_fence_global();
                    old_counter_20151 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) criterionzicounter_mem_20123)[sext_i32_i64(srem32(flat_segment_id_20137,
                                                                                                          10240))],
                                              (int) 1);
                    ((__local bool *) sync_arr_mem_20132)[(int64_t) 0] =
                        old_counter_20151 == groups_per_segment_20116 -
                        (int64_t) 1;
                }
            }
            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
            
            bool is_last_group_20152 = ((__local
                                         bool *) sync_arr_mem_20132)[(int64_t) 0];
            
            if (is_last_group_20152) {
                if (local_tid_20126 == 0) {
                    old_counter_20151 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) criterionzicounter_mem_20123)[sext_i32_i64(srem32(flat_segment_id_20137,
                                                                                                          10240))],
                                              (int) ((int64_t) 0 -
                                                     groups_per_segment_20116));
                }
                // read in the per-group-results
                {
                    int64_t read_per_thread_20153 =
                            sdiv_up64(groups_per_segment_20116,
                                      segred_group_sizze_17886);
                    
                    x_17890 = 0.0;
                    for (int64_t i_20154 = 0; i_20154 < read_per_thread_20153;
                         i_20154++) {
                        int64_t group_res_id_20155 =
                                sext_i32_i64(local_tid_20126) *
                                read_per_thread_20153 + i_20154;
                        int64_t index_of_group_res_20156 =
                                sext_i32_i64(flat_segment_id_20137) *
                                groups_per_segment_20116 + group_res_id_20155;
                        
                        if (slt64(group_res_id_20155,
                                  groups_per_segment_20116)) {
                            x_17891 = ((__global
                                        double *) segred_tmp_mem_20121)[index_of_group_res_20156];
                            
                            double defunc_1_op_res_17892 = x_17890 + x_17891;
                            
                            x_17890 = defunc_1_op_res_17892;
                        }
                    }
                }
                ((__local
                  double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126)] =
                    x_17890;
                barrier(CLK_LOCAL_MEM_FENCE);
                // reduce the per-group results
                {
                    int32_t offset_20157;
                    int32_t skip_waves_20158 = 1;
                    double x_20145;
                    double x_20146;
                    
                    offset_20157 = 0;
                    // participating threads read initial accumulator
                    {
                        if (slt32(local_tid_20126,
                                  sext_i64_i32(segred_group_sizze_17886))) {
                            x_20145 = ((__local
                                        double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126 +
                                                                     offset_20157)];
                        }
                    }
                    offset_20157 = 1;
                    while (slt32(offset_20157, wave_sizze_20128)) {
                        if (slt32(local_tid_20126 + offset_20157,
                                  sext_i64_i32(segred_group_sizze_17886)) &&
                            ((local_tid_20126 - squot32(local_tid_20126,
                                                        wave_sizze_20128) *
                              wave_sizze_20128) & (2 * offset_20157 - 1)) ==
                            0) {
                            // read array element
                            {
                                x_20146 = ((volatile __local
                                            double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126 +
                                                                         offset_20157)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20147 = x_20145 +
                                       x_20146;
                                
                                x_20145 = defunc_1_op_res_20147;
                            }
                            // write result of operation
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126)] =
                                    x_20145;
                            }
                        }
                        offset_20157 *= 2;
                    }
                    while (slt32(skip_waves_20158,
                                 squot32(sext_i64_i32(segred_group_sizze_17886) +
                                         wave_sizze_20128 - 1,
                                         wave_sizze_20128))) {
                        barrier(CLK_LOCAL_MEM_FENCE);
                        offset_20157 = skip_waves_20158 * wave_sizze_20128;
                        if (slt32(local_tid_20126 + offset_20157,
                                  sext_i64_i32(segred_group_sizze_17886)) &&
                            ((local_tid_20126 - squot32(local_tid_20126,
                                                        wave_sizze_20128) *
                              wave_sizze_20128) == 0 &&
                             (squot32(local_tid_20126, wave_sizze_20128) & (2 *
                                                                            skip_waves_20158 -
                                                                            1)) ==
                             0)) {
                            // read array element
                            {
                                x_20146 = ((__local
                                            double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126 +
                                                                         offset_20157)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20147 = x_20145 +
                                       x_20146;
                                
                                x_20145 = defunc_1_op_res_20147;
                            }
                            // write result of operation
                            {
                                ((__local
                                  double *) red_arr_mem_20130)[sext_i32_i64(local_tid_20126)] =
                                    x_20145;
                            }
                        }
                        skip_waves_20158 *= 2;
                    }
                    // and back to memory with the final result
                    {
                        if (local_tid_20126 == 0) {
                            ((__global double *) mem_19717)[gtid_17635 *
                                                            implz2082U_16708 +
                                                            gtid_17636] =
                                x_20145;
                        }
                    }
                }
            }
        }
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17886
}
__kernel void criterionzisegred_nonseg_17340(__global int *global_failure,
                                             int failure_is_an_option, __global
                                             int64_t *global_failure_args,
                                             __local volatile
                                             int64_t *red_arr_mem_19937_backing_aligned_0,
                                             __local volatile
                                             int64_t *sync_arr_mem_19935_backing_aligned_1,
                                             int64_t implz2081U_16706,
                                             int64_t implz2088U_16707,
                                             int64_t implz2082U_16708,
                                             int64_t implz2083U_16709,
                                             int64_t implz2085U_16711,
                                             double i64_res_16726,
                                             int64_t num_groups_17343,
                                             int64_t num_threads_19891,
                                             int64_t num_threads_19929, __global
                                             unsigned char *zz_mem_19395,
                                             __global
                                             unsigned char *beta_mem_19396,
                                             __global
                                             unsigned char *d_mem_19398,
                                             __global unsigned char *mem_19401,
                                             __global unsigned char *mem_19449,
                                             __global
                                             unsigned char *color_19869,
                                             __global
                                             unsigned char *color_19870,
                                             __global
                                             unsigned char *criterionzicounter_mem_19925,
                                             __global
                                             unsigned char *segred_tmp_mem_19927)
{
    #define segred_group_sizze_17342 (criterionzisegred_group_sizze_17332)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_19937_backing_1 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_19937_backing_aligned_0;
    __local volatile unsigned char *restrict sync_arr_mem_19935_backing_0 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_19935_backing_aligned_1;
    volatile __local bool local_failure;
    
    if (failure_is_an_option) {
        int failed = *global_failure >= 0;
        
        if (failed)
            return;
    }
    local_failure = false;
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t global_tid_19930;
    int32_t local_tid_19931;
    int64_t group_sizze_19934;
    int32_t wave_sizze_19933;
    int32_t group_tid_19932;
    
    global_tid_19930 = get_global_id(0);
    local_tid_19931 = get_local_id(0);
    group_sizze_19934 = get_local_size(0);
    wave_sizze_19933 = LOCKSTEP_WIDTH;
    group_tid_19932 = get_group_id(0);
    
    int32_t phys_tid_17340 = global_tid_19930;
    __local unsigned char *sync_arr_mem_19935;
    
    sync_arr_mem_19935 = (__local unsigned char *) sync_arr_mem_19935_backing_0;
    
    __local unsigned char *red_arr_mem_19937;
    
    red_arr_mem_19937 = (__local unsigned char *) red_arr_mem_19937_backing_1;
    
    int64_t dummy_17338 = (int64_t) 0;
    int64_t gtid_17339 = (int64_t) 0;
    double x_acc_19939;
    int64_t chunk_sizze_19940 = smin64(sdiv_up64(implz2088U_16707,
                                                 sext_i32_i64(sext_i64_i32(segred_group_sizze_17342 *
                                                 num_groups_17343))),
                                       sdiv_up64(implz2088U_16707 -
                                                 phys_tid_17340,
                                                 num_threads_19929));
    double x_17346;
    double x_17347;
    
    // neutral-initialise the accumulators
    {
        x_acc_19939 = 0.0;
    }
    for (int64_t i_19944 = 0; i_19944 < chunk_sizze_19940; i_19944++) {
        gtid_17339 = phys_tid_17340 + num_threads_19929 * i_19944;
        // apply map function
        {
            int64_t x_17350 = ((__global int64_t *) d_mem_19398)[gtid_17339];
            
            for (int64_t i_19336 = 0; i_19336 < implz2082U_16708; i_19336++) {
                double defunc_2_reduce_res_17353;
                double redout_19338 = 0.0;
                
                for (int64_t i_19339 = 0; i_19339 < implz2081U_16706;
                     i_19339++) {
                    double x_17357 = ((__global double *) mem_19401)[i_19339 *
                                                                     implz2088U_16707 +
                                                                     gtid_17339];
                    int64_t binop_x_19374 = implz2082U_16708 * i_19339;
                    int64_t binop_x_19375 = i_19336 + binop_x_19374;
                    int64_t new_index_19376 = squot64(binop_x_19375,
                                                      implz2085U_16711);
                    int64_t binop_y_19382 = implz2085U_16711 * new_index_19376;
                    int64_t new_index_19383 = binop_x_19375 - binop_y_19382;
                    double x_17358 = ((__global
                                       double *) beta_mem_19396)[new_index_19376 *
                                                                 implz2085U_16711 +
                                                                 new_index_19383];
                    double defunc_1_f_res_17359 = x_17357 * x_17358;
                    double defunc_1_op_res_17356 = defunc_1_f_res_17359 +
                           redout_19338;
                    double redout_tmp_19946 = defunc_1_op_res_17356;
                    
                    redout_19338 = redout_tmp_19946;
                }
                defunc_2_reduce_res_17353 = redout_19338;
                ((__global double *) color_19869)[phys_tid_17340 + i_19336 *
                                                  num_threads_19891] =
                    defunc_2_reduce_res_17353;
            }
            
            double defunc_2_reduce_res_17360;
            double redout_19341 = -INFINITY;
            
            for (int64_t i_19343 = 0; i_19343 < implz2083U_16709; i_19343++) {
                double defunc_2_reduce_res_17366;
                double redout_19345 = 0.0;
                
                for (int64_t i_19346 = 0; i_19346 < implz2082U_16708;
                     i_19346++) {
                    double x_17370 = ((__global
                                       double *) color_19869)[phys_tid_17340 +
                                                              i_19346 *
                                                              num_threads_19891];
                    double x_17371 = ((__global
                                       double *) zz_mem_19395)[i_19346 *
                                                               implz2083U_16709 +
                                                               i_19343];
                    double defunc_1_f_res_17372 = x_17370 * x_17371;
                    double defunc_1_op_res_17369 = defunc_1_f_res_17372 +
                           redout_19345;
                    double redout_tmp_19949 = defunc_1_op_res_17369;
                    
                    redout_19345 = redout_tmp_19949;
                }
                defunc_2_reduce_res_17366 = redout_19345;
                
                double defunc_1_op_res_17364 = fmax64(defunc_2_reduce_res_17366,
                                                      redout_19341);
                
                ((__global double *) color_19870)[phys_tid_17340 + i_19343 *
                                                  num_threads_19891] =
                    defunc_2_reduce_res_17366;
                
                double redout_tmp_19947 = defunc_1_op_res_17364;
                
                redout_19341 = redout_tmp_19947;
            }
            defunc_2_reduce_res_17360 = redout_19341;
            
            double defunc_2_reduce_res_17373;
            double redout_19348 = 0.0;
            
            for (int64_t i_19350 = 0; i_19350 < implz2083U_16709; i_19350++) {
                double x_17378 = ((__global
                                   double *) color_19870)[phys_tid_17340 +
                                                          i_19350 *
                                                          num_threads_19891];
                double defunc_0_f_res_17379 = x_17378 -
                       defunc_2_reduce_res_17360;
                double defunc_0_f_res_17380;
                
                defunc_0_f_res_17380 = futrts_exp64(defunc_0_f_res_17379);
                
                double defunc_1_op_res_17377 = defunc_0_f_res_17380 +
                       redout_19348;
                
                ((__global double *) color_19869)[phys_tid_17340 + i_19350 *
                                                  num_threads_19891] =
                    defunc_0_f_res_17379;
                
                double redout_tmp_19950 = defunc_1_op_res_17377;
                
                redout_19348 = redout_tmp_19950;
            }
            defunc_2_reduce_res_17373 = redout_19348;
            
            double defunc_0_g_res_17381;
            
            defunc_0_g_res_17381 = futrts_log64(defunc_2_reduce_res_17373);
            
            bool x_17382 = sle64((int64_t) 0, x_17350);
            bool y_17383 = slt64(x_17350, implz2083U_16709);
            bool bounds_check_17384 = x_17382 && y_17383;
            bool index_certs_17385;
            
            if (!bounds_check_17384) {
                {
                    if (atomic_cmpxchg_i32_global(global_failure, -1, 0) ==
                        -1) {
                        global_failure_args[0] = (int64_t) x_17350;
                        global_failure_args[1] = (int64_t) implz2083U_16709;
                        ;
                    }
                    local_failure = true;
                    goto error_0;
                }
            }
            
            double defunc_1_f_res_17386 = ((__global
                                            double *) color_19869)[phys_tid_17340 +
                                                                   x_17350 *
                                                                   num_threads_19891];
            double defunc_1_f_res_17387 = defunc_1_f_res_17386 -
                   defunc_0_g_res_17381;
            double defunc_0_f_res_17388 = defunc_1_f_res_17387 / i64_res_16726;
            
            // save map-out results
            { }
            // load accumulator
            {
                x_17346 = x_acc_19939;
            }
            // load new values
            {
                x_17347 = defunc_0_f_res_17388;
            }
            // apply reduction operator
            {
                double defunc_1_op_res_17348 = x_17346 + x_17347;
                
                // store in accumulator
                {
                    x_acc_19939 = defunc_1_op_res_17348;
                }
            }
        }
    }
    // to reduce current chunk, first store our result in memory
    {
        x_17346 = x_acc_19939;
        ((__local double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931)] =
            x_17346;
    }
    
  error_0:
    barrier(CLK_LOCAL_MEM_FENCE);
    if (local_failure)
        return;
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t offset_19952;
    int32_t skip_waves_19953 = 1;
    double x_19941;
    double x_19942;
    
    offset_19952 = 0;
    // participating threads read initial accumulator
    {
        if (slt32(local_tid_19931, sext_i64_i32(segred_group_sizze_17342))) {
            x_19941 = ((__local
                        double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931 +
                                                     offset_19952)];
        }
    }
    offset_19952 = 1;
    while (slt32(offset_19952, wave_sizze_19933)) {
        if (slt32(local_tid_19931 + offset_19952,
                  sext_i64_i32(segred_group_sizze_17342)) && ((local_tid_19931 -
                                                               squot32(local_tid_19931,
                                                                       wave_sizze_19933) *
                                                               wave_sizze_19933) &
                                                              (2 *
                                                               offset_19952 -
                                                               1)) == 0) {
            // read array element
            {
                x_19942 = ((volatile __local
                            double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931 +
                                                         offset_19952)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_19943 = x_19941 + x_19942;
                
                x_19941 = defunc_1_op_res_19943;
            }
            // write result of operation
            {
                ((volatile __local
                  double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931)] =
                    x_19941;
            }
        }
        offset_19952 *= 2;
    }
    while (slt32(skip_waves_19953,
                 squot32(sext_i64_i32(segred_group_sizze_17342) +
                         wave_sizze_19933 - 1, wave_sizze_19933))) {
        barrier(CLK_LOCAL_MEM_FENCE);
        offset_19952 = skip_waves_19953 * wave_sizze_19933;
        if (slt32(local_tid_19931 + offset_19952,
                  sext_i64_i32(segred_group_sizze_17342)) && ((local_tid_19931 -
                                                               squot32(local_tid_19931,
                                                                       wave_sizze_19933) *
                                                               wave_sizze_19933) ==
                                                              0 &&
                                                              (squot32(local_tid_19931,
                                                                       wave_sizze_19933) &
                                                               (2 *
                                                                skip_waves_19953 -
                                                                1)) == 0)) {
            // read array element
            {
                x_19942 = ((__local
                            double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931 +
                                                         offset_19952)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_19943 = x_19941 + x_19942;
                
                x_19941 = defunc_1_op_res_19943;
            }
            // write result of operation
            {
                ((__local
                  double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931)] =
                    x_19941;
            }
        }
        skip_waves_19953 *= 2;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // first thread saves the result in accumulator
    {
        if (sext_i32_i64(local_tid_19931) == (int64_t) 0) {
            x_acc_19939 = x_19941;
        }
    }
    
    int32_t old_counter_19954;
    
    // first thread in group saves group result to global memory
    {
        if (local_tid_19931 == 0) {
            ((__global
              double *) segred_tmp_mem_19927)[sext_i32_i64(group_tid_19932)] =
                x_acc_19939;
            mem_fence_global();
            old_counter_19954 = atomic_add_i32_global(&((volatile __global
                                                         int *) criterionzicounter_mem_19925)[(int64_t) 0],
                                                      (int) 1);
            ((__local bool *) sync_arr_mem_19935)[(int64_t) 0] =
                old_counter_19954 == num_groups_17343 - (int64_t) 1;
        }
    }
    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    
    bool is_last_group_19955 = ((__local
                                 bool *) sync_arr_mem_19935)[(int64_t) 0];
    
    if (is_last_group_19955) {
        if (local_tid_19931 == 0) {
            old_counter_19954 = atomic_add_i32_global(&((volatile __global
                                                         int *) criterionzicounter_mem_19925)[(int64_t) 0],
                                                      (int) ((int64_t) 0 -
                                                             num_groups_17343));
        }
        // read in the per-group-results
        {
            int64_t read_per_thread_19956 = sdiv_up64(num_groups_17343,
                                                      segred_group_sizze_17342);
            
            x_17346 = 0.0;
            for (int64_t i_19957 = 0; i_19957 < read_per_thread_19956;
                 i_19957++) {
                int64_t group_res_id_19958 = sext_i32_i64(local_tid_19931) *
                        read_per_thread_19956 + i_19957;
                int64_t index_of_group_res_19959 = group_res_id_19958;
                
                if (slt64(group_res_id_19958, num_groups_17343)) {
                    x_17347 = ((__global
                                double *) segred_tmp_mem_19927)[index_of_group_res_19959];
                    
                    double defunc_1_op_res_17348 = x_17346 + x_17347;
                    
                    x_17346 = defunc_1_op_res_17348;
                }
            }
        }
        ((__local double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931)] =
            x_17346;
        barrier(CLK_LOCAL_MEM_FENCE);
        // reduce the per-group results
        {
            int32_t offset_19960;
            int32_t skip_waves_19961 = 1;
            double x_19941;
            double x_19942;
            
            offset_19960 = 0;
            // participating threads read initial accumulator
            {
                if (slt32(local_tid_19931,
                          sext_i64_i32(segred_group_sizze_17342))) {
                    x_19941 = ((__local
                                double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931 +
                                                             offset_19960)];
                }
            }
            offset_19960 = 1;
            while (slt32(offset_19960, wave_sizze_19933)) {
                if (slt32(local_tid_19931 + offset_19960,
                          sext_i64_i32(segred_group_sizze_17342)) &&
                    ((local_tid_19931 - squot32(local_tid_19931,
                                                wave_sizze_19933) *
                      wave_sizze_19933) & (2 * offset_19960 - 1)) == 0) {
                    // read array element
                    {
                        x_19942 = ((volatile __local
                                    double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931 +
                                                                 offset_19960)];
                    }
                    // apply reduction operation
                    {
                        double defunc_1_op_res_19943 = x_19941 + x_19942;
                        
                        x_19941 = defunc_1_op_res_19943;
                    }
                    // write result of operation
                    {
                        ((volatile __local
                          double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931)] =
                            x_19941;
                    }
                }
                offset_19960 *= 2;
            }
            while (slt32(skip_waves_19961,
                         squot32(sext_i64_i32(segred_group_sizze_17342) +
                                 wave_sizze_19933 - 1, wave_sizze_19933))) {
                barrier(CLK_LOCAL_MEM_FENCE);
                offset_19960 = skip_waves_19961 * wave_sizze_19933;
                if (slt32(local_tid_19931 + offset_19960,
                          sext_i64_i32(segred_group_sizze_17342)) &&
                    ((local_tid_19931 - squot32(local_tid_19931,
                                                wave_sizze_19933) *
                      wave_sizze_19933) == 0 && (squot32(local_tid_19931,
                                                         wave_sizze_19933) &
                                                 (2 * skip_waves_19961 - 1)) ==
                     0)) {
                    // read array element
                    {
                        x_19942 = ((__local
                                    double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931 +
                                                                 offset_19960)];
                    }
                    // apply reduction operation
                    {
                        double defunc_1_op_res_19943 = x_19941 + x_19942;
                        
                        x_19941 = defunc_1_op_res_19943;
                    }
                    // write result of operation
                    {
                        ((__local
                          double *) red_arr_mem_19937)[sext_i32_i64(local_tid_19931)] =
                            x_19941;
                    }
                }
                skip_waves_19961 *= 2;
            }
            // and back to memory with the final result
            {
                if (local_tid_19931 == 0) {
                    ((__global double *) mem_19449)[(int64_t) 0] = x_19941;
                }
            }
        }
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17342
}
__kernel void criterionzisegred_nonseg_17765(__global int *global_failure,
                                             __local volatile
                                             int64_t *red_arr_mem_20312_backing_aligned_0,
                                             __local volatile
                                             int64_t *sync_arr_mem_20310_backing_aligned_1,
                                             int64_t implz2088U_16707,
                                             int64_t num_groups_17951,
                                             int64_t num_threads_20304, __global
                                             unsigned char *ext_mem_19740,
                                             __global unsigned char *mem_19743,
                                             __global
                                             unsigned char *criterionzicounter_mem_20300,
                                             __global
                                             unsigned char *segred_tmp_mem_20302)
{
    #define segred_group_sizze_17950 (criterionzisegred_group_sizze_17757)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20312_backing_1 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20312_backing_aligned_0;
    __local volatile unsigned char *restrict sync_arr_mem_20310_backing_0 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_20310_backing_aligned_1;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20305;
    int32_t local_tid_20306;
    int64_t group_sizze_20309;
    int32_t wave_sizze_20308;
    int32_t group_tid_20307;
    
    global_tid_20305 = get_global_id(0);
    local_tid_20306 = get_local_id(0);
    group_sizze_20309 = get_local_size(0);
    wave_sizze_20308 = LOCKSTEP_WIDTH;
    group_tid_20307 = get_group_id(0);
    
    int32_t phys_tid_17765 = global_tid_20305;
    __local unsigned char *sync_arr_mem_20310;
    
    sync_arr_mem_20310 = (__local unsigned char *) sync_arr_mem_20310_backing_0;
    
    __local unsigned char *red_arr_mem_20312;
    
    red_arr_mem_20312 = (__local unsigned char *) red_arr_mem_20312_backing_1;
    
    int64_t dummy_17763 = (int64_t) 0;
    int64_t gtid_17764 = (int64_t) 0;
    double x_acc_20314;
    int64_t chunk_sizze_20315 = smin64(sdiv_up64(implz2088U_16707,
                                                 sext_i32_i64(sext_i64_i32(segred_group_sizze_17950 *
                                                 num_groups_17951))),
                                       sdiv_up64(implz2088U_16707 -
                                                 phys_tid_17765,
                                                 num_threads_20304));
    double x_17954;
    double x_17955;
    
    // neutral-initialise the accumulators
    {
        x_acc_20314 = 0.0;
    }
    for (int64_t i_20319 = 0; i_20319 < chunk_sizze_20315; i_20319++) {
        gtid_17764 = phys_tid_17765 + num_threads_20304 * i_20319;
        // apply map function
        {
            double x_17957 = ((__global double *) ext_mem_19740)[gtid_17764];
            
            // save map-out results
            { }
            // load accumulator
            {
                x_17954 = x_acc_20314;
            }
            // load new values
            {
                x_17955 = x_17957;
            }
            // apply reduction operator
            {
                double defunc_1_op_res_17956 = x_17954 + x_17955;
                
                // store in accumulator
                {
                    x_acc_20314 = defunc_1_op_res_17956;
                }
            }
        }
    }
    // to reduce current chunk, first store our result in memory
    {
        x_17954 = x_acc_20314;
        ((__local double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306)] =
            x_17954;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t offset_20320;
    int32_t skip_waves_20321 = 1;
    double x_20316;
    double x_20317;
    
    offset_20320 = 0;
    // participating threads read initial accumulator
    {
        if (slt32(local_tid_20306, sext_i64_i32(segred_group_sizze_17950))) {
            x_20316 = ((__local
                        double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306 +
                                                     offset_20320)];
        }
    }
    offset_20320 = 1;
    while (slt32(offset_20320, wave_sizze_20308)) {
        if (slt32(local_tid_20306 + offset_20320,
                  sext_i64_i32(segred_group_sizze_17950)) && ((local_tid_20306 -
                                                               squot32(local_tid_20306,
                                                                       wave_sizze_20308) *
                                                               wave_sizze_20308) &
                                                              (2 *
                                                               offset_20320 -
                                                               1)) == 0) {
            // read array element
            {
                x_20317 = ((volatile __local
                            double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306 +
                                                         offset_20320)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_20318 = x_20316 + x_20317;
                
                x_20316 = defunc_1_op_res_20318;
            }
            // write result of operation
            {
                ((volatile __local
                  double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306)] =
                    x_20316;
            }
        }
        offset_20320 *= 2;
    }
    while (slt32(skip_waves_20321,
                 squot32(sext_i64_i32(segred_group_sizze_17950) +
                         wave_sizze_20308 - 1, wave_sizze_20308))) {
        barrier(CLK_LOCAL_MEM_FENCE);
        offset_20320 = skip_waves_20321 * wave_sizze_20308;
        if (slt32(local_tid_20306 + offset_20320,
                  sext_i64_i32(segred_group_sizze_17950)) && ((local_tid_20306 -
                                                               squot32(local_tid_20306,
                                                                       wave_sizze_20308) *
                                                               wave_sizze_20308) ==
                                                              0 &&
                                                              (squot32(local_tid_20306,
                                                                       wave_sizze_20308) &
                                                               (2 *
                                                                skip_waves_20321 -
                                                                1)) == 0)) {
            // read array element
            {
                x_20317 = ((__local
                            double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306 +
                                                         offset_20320)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_20318 = x_20316 + x_20317;
                
                x_20316 = defunc_1_op_res_20318;
            }
            // write result of operation
            {
                ((__local
                  double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306)] =
                    x_20316;
            }
        }
        skip_waves_20321 *= 2;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // first thread saves the result in accumulator
    {
        if (sext_i32_i64(local_tid_20306) == (int64_t) 0) {
            x_acc_20314 = x_20316;
        }
    }
    
    int32_t old_counter_20322;
    
    // first thread in group saves group result to global memory
    {
        if (local_tid_20306 == 0) {
            ((__global
              double *) segred_tmp_mem_20302)[sext_i32_i64(group_tid_20307)] =
                x_acc_20314;
            mem_fence_global();
            old_counter_20322 = atomic_add_i32_global(&((volatile __global
                                                         int *) criterionzicounter_mem_20300)[(int64_t) 0],
                                                      (int) 1);
            ((__local bool *) sync_arr_mem_20310)[(int64_t) 0] =
                old_counter_20322 == num_groups_17951 - (int64_t) 1;
        }
    }
    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    
    bool is_last_group_20323 = ((__local
                                 bool *) sync_arr_mem_20310)[(int64_t) 0];
    
    if (is_last_group_20323) {
        if (local_tid_20306 == 0) {
            old_counter_20322 = atomic_add_i32_global(&((volatile __global
                                                         int *) criterionzicounter_mem_20300)[(int64_t) 0],
                                                      (int) ((int64_t) 0 -
                                                             num_groups_17951));
        }
        // read in the per-group-results
        {
            int64_t read_per_thread_20324 = sdiv_up64(num_groups_17951,
                                                      segred_group_sizze_17950);
            
            x_17954 = 0.0;
            for (int64_t i_20325 = 0; i_20325 < read_per_thread_20324;
                 i_20325++) {
                int64_t group_res_id_20326 = sext_i32_i64(local_tid_20306) *
                        read_per_thread_20324 + i_20325;
                int64_t index_of_group_res_20327 = group_res_id_20326;
                
                if (slt64(group_res_id_20326, num_groups_17951)) {
                    x_17955 = ((__global
                                double *) segred_tmp_mem_20302)[index_of_group_res_20327];
                    
                    double defunc_1_op_res_17956 = x_17954 + x_17955;
                    
                    x_17954 = defunc_1_op_res_17956;
                }
            }
        }
        ((__local double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306)] =
            x_17954;
        barrier(CLK_LOCAL_MEM_FENCE);
        // reduce the per-group results
        {
            int32_t offset_20328;
            int32_t skip_waves_20329 = 1;
            double x_20316;
            double x_20317;
            
            offset_20328 = 0;
            // participating threads read initial accumulator
            {
                if (slt32(local_tid_20306,
                          sext_i64_i32(segred_group_sizze_17950))) {
                    x_20316 = ((__local
                                double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306 +
                                                             offset_20328)];
                }
            }
            offset_20328 = 1;
            while (slt32(offset_20328, wave_sizze_20308)) {
                if (slt32(local_tid_20306 + offset_20328,
                          sext_i64_i32(segred_group_sizze_17950)) &&
                    ((local_tid_20306 - squot32(local_tid_20306,
                                                wave_sizze_20308) *
                      wave_sizze_20308) & (2 * offset_20328 - 1)) == 0) {
                    // read array element
                    {
                        x_20317 = ((volatile __local
                                    double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306 +
                                                                 offset_20328)];
                    }
                    // apply reduction operation
                    {
                        double defunc_1_op_res_20318 = x_20316 + x_20317;
                        
                        x_20316 = defunc_1_op_res_20318;
                    }
                    // write result of operation
                    {
                        ((volatile __local
                          double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306)] =
                            x_20316;
                    }
                }
                offset_20328 *= 2;
            }
            while (slt32(skip_waves_20329,
                         squot32(sext_i64_i32(segred_group_sizze_17950) +
                                 wave_sizze_20308 - 1, wave_sizze_20308))) {
                barrier(CLK_LOCAL_MEM_FENCE);
                offset_20328 = skip_waves_20329 * wave_sizze_20308;
                if (slt32(local_tid_20306 + offset_20328,
                          sext_i64_i32(segred_group_sizze_17950)) &&
                    ((local_tid_20306 - squot32(local_tid_20306,
                                                wave_sizze_20308) *
                      wave_sizze_20308) == 0 && (squot32(local_tid_20306,
                                                         wave_sizze_20308) &
                                                 (2 * skip_waves_20329 - 1)) ==
                     0)) {
                    // read array element
                    {
                        x_20317 = ((__local
                                    double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306 +
                                                                 offset_20328)];
                    }
                    // apply reduction operation
                    {
                        double defunc_1_op_res_20318 = x_20316 + x_20317;
                        
                        x_20316 = defunc_1_op_res_20318;
                    }
                    // write result of operation
                    {
                        ((__local
                          double *) red_arr_mem_20312)[sext_i32_i64(local_tid_20306)] =
                            x_20316;
                    }
                }
                skip_waves_20329 *= 2;
            }
            // and back to memory with the final result
            {
                if (local_tid_20306 == 0) {
                    ((__global double *) mem_19743)[(int64_t) 0] = x_20316;
                }
            }
        }
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17950
}
__kernel void criterionzisegred_small_17582(__global int *global_failure,
                                            __local volatile
                                            int64_t *red_arr_mem_20233_backing_aligned_0,
                                            int64_t implz2088U_16707,
                                            int64_t implz2083U_16709,
                                            int64_t num_groups_17921,
                                            int64_t segment_sizze_nonzzero_20226,
                                            __global unsigned char *mem_19722,
                                            __global unsigned char *mem_19726,
                                            __global unsigned char *mem_19730,
                                            __global unsigned char *mem_19734)
{
    #define segred_group_sizze_17920 (criterionzisegred_group_sizze_17576)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20233_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20233_backing_aligned_0;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20228;
    int32_t local_tid_20229;
    int64_t group_sizze_20232;
    int32_t wave_sizze_20231;
    int32_t group_tid_20230;
    
    global_tid_20228 = get_global_id(0);
    local_tid_20229 = get_local_id(0);
    group_sizze_20232 = get_local_size(0);
    wave_sizze_20231 = LOCKSTEP_WIDTH;
    group_tid_20230 = get_group_id(0);
    
    int32_t phys_tid_17582 = global_tid_20228;
    __local unsigned char *red_arr_mem_20233;
    
    red_arr_mem_20233 = (__local unsigned char *) red_arr_mem_20233_backing_0;
    
    int32_t phys_group_id_20235;
    
    phys_group_id_20235 = get_group_id(0);
    for (int32_t i_20236 = 0; i_20236 <
         sdiv_up32(sext_i64_i32(sdiv_up64(implz2088U_16707,
                                          squot64(segred_group_sizze_17920,
                                                  segment_sizze_nonzzero_20226))) -
                   phys_group_id_20235, sext_i64_i32(num_groups_17921));
         i_20236++) {
        int32_t virt_group_id_20237 = phys_group_id_20235 + i_20236 *
                sext_i64_i32(num_groups_17921);
        int64_t slice_20238 = implz2088U_16707;
        int64_t gtid_17573 = squot64(sext_i32_i64(local_tid_20229),
                                     segment_sizze_nonzzero_20226) +
                sext_i32_i64(virt_group_id_20237) *
                squot64(segred_group_sizze_17920, segment_sizze_nonzzero_20226);
        int64_t remnant_20239 = squot64(sext_i32_i64(local_tid_20229),
                                        segment_sizze_nonzzero_20226) +
                sext_i32_i64(virt_group_id_20237) *
                squot64(segred_group_sizze_17920,
                        segment_sizze_nonzzero_20226) - gtid_17573;
        int64_t gtid_17581 = srem64(sext_i32_i64(local_tid_20229),
                                    implz2083U_16709);
        
        // apply map function if in bounds
        {
            if (slt64((int64_t) 0, implz2083U_16709) && (slt64(gtid_17573,
                                                               implz2088U_16707) &&
                                                         slt64(sext_i32_i64(local_tid_20229),
                                                               implz2083U_16709 *
                                                               squot64(segred_group_sizze_17920,
                                                                       segment_sizze_nonzzero_20226)))) {
                double defunc_2_reduce_res_17928 = ((__global
                                                     double *) mem_19722)[gtid_17573];
                double x_17930 = ((__global double *) mem_19726)[gtid_17573 *
                                                                 implz2083U_16709 +
                                                                 gtid_17581];
                double defunc_0_f_res_17931 = x_17930 -
                       defunc_2_reduce_res_17928;
                double defunc_0_f_res_17932;
                
                defunc_0_f_res_17932 = futrts_exp64(defunc_0_f_res_17931);
                // save map-out results
                {
                    ((__global double *) mem_19734)[gtid_17573 *
                                                    implz2083U_16709 +
                                                    gtid_17581] =
                        defunc_0_f_res_17931;
                }
                // save results to be reduced
                {
                    ((__local
                      double *) red_arr_mem_20233)[sext_i32_i64(local_tid_20229)] =
                        defunc_0_f_res_17932;
                }
            } else {
                ((__local
                  double *) red_arr_mem_20233)[sext_i32_i64(local_tid_20229)] =
                    0.0;
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        if (slt64((int64_t) 0, implz2083U_16709)) {
            // perform segmented scan to imitate reduction
            {
                double x_17925;
                double x_17926;
                double x_20240;
                double x_20241;
                bool ltid_in_bounds_20243 = slt64(sext_i32_i64(local_tid_20229),
                                                  implz2083U_16709 *
                                                  squot64(segred_group_sizze_17920,
                                                          segment_sizze_nonzzero_20226));
                int32_t skip_threads_20244;
                
                // read input for in-block scan
                {
                    if (ltid_in_bounds_20243) {
                        x_17926 = ((volatile __local
                                    double *) red_arr_mem_20233)[sext_i32_i64(local_tid_20229)];
                        if ((local_tid_20229 - squot32(local_tid_20229, 32) *
                             32) == 0) {
                            x_17925 = x_17926;
                        }
                    }
                }
                // in-block scan (hopefully no barriers needed)
                {
                    skip_threads_20244 = 1;
                    while (slt32(skip_threads_20244, 32)) {
                        if (sle32(skip_threads_20244, local_tid_20229 -
                                  squot32(local_tid_20229, 32) * 32) &&
                            ltid_in_bounds_20243) {
                            // read operands
                            {
                                x_17925 = ((volatile __local
                                            double *) red_arr_mem_20233)[sext_i32_i64(local_tid_20229) -
                                                                         sext_i32_i64(skip_threads_20244)];
                            }
                            // perform operation
                            {
                                bool inactive_20245 =
                                     slt64(srem64(sext_i32_i64(local_tid_20229),
                                                  implz2083U_16709),
                                           sext_i32_i64(local_tid_20229) -
                                           sext_i32_i64(local_tid_20229 -
                                           skip_threads_20244));
                                
                                if (inactive_20245) {
                                    x_17925 = x_17926;
                                }
                                if (!inactive_20245) {
                                    double defunc_1_op_res_17927 = x_17925 +
                                           x_17926;
                                    
                                    x_17925 = defunc_1_op_res_17927;
                                }
                            }
                        }
                        if (sle32(wave_sizze_20231, skip_threads_20244)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        if (sle32(skip_threads_20244, local_tid_20229 -
                                  squot32(local_tid_20229, 32) * 32) &&
                            ltid_in_bounds_20243) {
                            // write result
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20233)[sext_i32_i64(local_tid_20229)] =
                                    x_17925;
                                x_17926 = x_17925;
                            }
                        }
                        if (sle32(wave_sizze_20231, skip_threads_20244)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        skip_threads_20244 *= 2;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // last thread of block 'i' writes its result to offset 'i'
                {
                    if ((local_tid_20229 - squot32(local_tid_20229, 32) * 32) ==
                        31 && ltid_in_bounds_20243) {
                        ((volatile __local
                          double *) red_arr_mem_20233)[sext_i32_i64(squot32(local_tid_20229,
                                                                            32))] =
                            x_17925;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
                {
                    int32_t skip_threads_20246;
                    
                    // read input for in-block scan
                    {
                        if (squot32(local_tid_20229, 32) == 0 &&
                            ltid_in_bounds_20243) {
                            x_20241 = ((volatile __local
                                        double *) red_arr_mem_20233)[sext_i32_i64(local_tid_20229)];
                            if ((local_tid_20229 - squot32(local_tid_20229,
                                                           32) * 32) == 0) {
                                x_20240 = x_20241;
                            }
                        }
                    }
                    // in-block scan (hopefully no barriers needed)
                    {
                        skip_threads_20246 = 1;
                        while (slt32(skip_threads_20246, 32)) {
                            if (sle32(skip_threads_20246, local_tid_20229 -
                                      squot32(local_tid_20229, 32) * 32) &&
                                (squot32(local_tid_20229, 32) == 0 &&
                                 ltid_in_bounds_20243)) {
                                // read operands
                                {
                                    x_20240 = ((volatile __local
                                                double *) red_arr_mem_20233)[sext_i32_i64(local_tid_20229) -
                                                                             sext_i32_i64(skip_threads_20246)];
                                }
                                // perform operation
                                {
                                    bool inactive_20247 =
                                         slt64(srem64(sext_i32_i64(local_tid_20229 *
                                                      32 + 32 - 1),
                                                      implz2083U_16709),
                                               sext_i32_i64(local_tid_20229 *
                                               32 + 32 - 1) -
                                               sext_i32_i64((local_tid_20229 -
                                                             skip_threads_20246) *
                                               32 + 32 - 1));
                                    
                                    if (inactive_20247) {
                                        x_20240 = x_20241;
                                    }
                                    if (!inactive_20247) {
                                        double defunc_1_op_res_20242 = x_20240 +
                                               x_20241;
                                        
                                        x_20240 = defunc_1_op_res_20242;
                                    }
                                }
                            }
                            if (sle32(wave_sizze_20231, skip_threads_20246)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            if (sle32(skip_threads_20246, local_tid_20229 -
                                      squot32(local_tid_20229, 32) * 32) &&
                                (squot32(local_tid_20229, 32) == 0 &&
                                 ltid_in_bounds_20243)) {
                                // write result
                                {
                                    ((volatile __local
                                      double *) red_arr_mem_20233)[sext_i32_i64(local_tid_20229)] =
                                        x_20240;
                                    x_20241 = x_20240;
                                }
                            }
                            if (sle32(wave_sizze_20231, skip_threads_20246)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            skip_threads_20246 *= 2;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // carry-in for every block except the first
                {
                    if (!(squot32(local_tid_20229, 32) == 0 ||
                          !ltid_in_bounds_20243)) {
                        // read operands
                        {
                            x_17926 = x_17925;
                            x_17925 = ((__local
                                        double *) red_arr_mem_20233)[sext_i32_i64(squot32(local_tid_20229,
                                                                                          32)) -
                                                                     (int64_t) 1];
                        }
                        // perform operation
                        {
                            bool inactive_20248 =
                                 slt64(srem64(sext_i32_i64(local_tid_20229),
                                              implz2083U_16709),
                                       sext_i32_i64(local_tid_20229) -
                                       sext_i32_i64(squot32(local_tid_20229,
                                                            32) * 32 - 1));
                            
                            if (inactive_20248) {
                                x_17925 = x_17926;
                            }
                            if (!inactive_20248) {
                                double defunc_1_op_res_17927 = x_17925 +
                                       x_17926;
                                
                                x_17925 = defunc_1_op_res_17927;
                            }
                        }
                        // write final result
                        {
                            ((__local
                              double *) red_arr_mem_20233)[sext_i32_i64(local_tid_20229)] =
                                x_17925;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // restore correct values for first block
                {
                    if (squot32(local_tid_20229, 32) == 0) {
                        ((__local
                          double *) red_arr_mem_20233)[sext_i32_i64(local_tid_20229)] =
                            x_17926;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // save final values of segments
        {
            if (slt64(sext_i32_i64(virt_group_id_20237) *
                      squot64(segred_group_sizze_17920,
                              segment_sizze_nonzzero_20226) +
                      sext_i32_i64(local_tid_20229), implz2088U_16707) &&
                slt64(sext_i32_i64(local_tid_20229),
                      squot64(segred_group_sizze_17920,
                              segment_sizze_nonzzero_20226))) {
                ((__global
                  double *) mem_19730)[sext_i32_i64(virt_group_id_20237) *
                                       squot64(segred_group_sizze_17920,
                                               segment_sizze_nonzzero_20226) +
                                       sext_i32_i64(local_tid_20229)] =
                    ((__local
                      double *) red_arr_mem_20233)[(sext_i32_i64(local_tid_20229) +
                                                    (int64_t) 1) *
                                                   segment_sizze_nonzzero_20226 -
                                                   (int64_t) 1];
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17920
}
__kernel void criterionzisegred_small_17601(__global int *global_failure,
                                            __local volatile
                                            int64_t *red_arr_mem_20167_backing_aligned_0,
                                            int64_t implz2088U_16707,
                                            int64_t implz2082U_16708,
                                            int64_t implz2083U_16709,
                                            int64_t num_groups_17902,
                                            int64_t segment_sizze_nonzzero_20160,
                                            __global
                                            unsigned char *zz_mem_19395,
                                            __global
                                            unsigned char *ext_mem_19718,
                                            __global unsigned char *mem_19722,
                                            __global unsigned char *mem_19726)
{
    #define segred_group_sizze_17901 (criterionzisegred_group_sizze_17595)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20167_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20167_backing_aligned_0;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20162;
    int32_t local_tid_20163;
    int64_t group_sizze_20166;
    int32_t wave_sizze_20165;
    int32_t group_tid_20164;
    
    global_tid_20162 = get_global_id(0);
    local_tid_20163 = get_local_id(0);
    group_sizze_20166 = get_local_size(0);
    wave_sizze_20165 = LOCKSTEP_WIDTH;
    group_tid_20164 = get_group_id(0);
    
    int32_t phys_tid_17601 = global_tid_20162;
    __local unsigned char *red_arr_mem_20167;
    
    red_arr_mem_20167 = (__local unsigned char *) red_arr_mem_20167_backing_0;
    
    int32_t phys_group_id_20169;
    
    phys_group_id_20169 = get_group_id(0);
    for (int32_t i_20170 = 0; i_20170 <
         sdiv_up32(sext_i64_i32(sdiv_up64(implz2088U_16707,
                                          squot64(segred_group_sizze_17901,
                                                  segment_sizze_nonzzero_20160))) -
                   phys_group_id_20169, sext_i64_i32(num_groups_17902));
         i_20170++) {
        int32_t virt_group_id_20171 = phys_group_id_20169 + i_20170 *
                sext_i64_i32(num_groups_17902);
        int64_t slice_20172 = implz2088U_16707;
        int64_t gtid_17592 = squot64(sext_i32_i64(local_tid_20163),
                                     segment_sizze_nonzzero_20160) +
                sext_i32_i64(virt_group_id_20171) *
                squot64(segred_group_sizze_17901, segment_sizze_nonzzero_20160);
        int64_t remnant_20173 = squot64(sext_i32_i64(local_tid_20163),
                                        segment_sizze_nonzzero_20160) +
                sext_i32_i64(virt_group_id_20171) *
                squot64(segred_group_sizze_17901,
                        segment_sizze_nonzzero_20160) - gtid_17592;
        int64_t gtid_17600 = srem64(sext_i32_i64(local_tid_20163),
                                    implz2083U_16709);
        
        // apply map function if in bounds
        {
            if (slt64((int64_t) 0, implz2083U_16709) && (slt64(gtid_17592,
                                                               implz2088U_16707) &&
                                                         slt64(sext_i32_i64(local_tid_20163),
                                                               implz2083U_16709 *
                                                               squot64(segred_group_sizze_17901,
                                                                       segment_sizze_nonzzero_20160)))) {
                double defunc_2_reduce_res_17911;
                double redout_19372 = 0.0;
                
                for (int64_t i_19373 = 0; i_19373 < implz2082U_16708;
                     i_19373++) {
                    double x_17915 = ((__global
                                       double *) ext_mem_19718)[gtid_17592 *
                                                                implz2082U_16708 +
                                                                i_19373];
                    double x_17916 = ((__global
                                       double *) zz_mem_19395)[i_19373 *
                                                               implz2083U_16709 +
                                                               gtid_17600];
                    double defunc_1_f_res_17917 = x_17915 * x_17916;
                    double defunc_1_op_res_17914 = defunc_1_f_res_17917 +
                           redout_19372;
                    double redout_tmp_20174 = defunc_1_op_res_17914;
                    
                    redout_19372 = redout_tmp_20174;
                }
                defunc_2_reduce_res_17911 = redout_19372;
                // save map-out results
                {
                    ((__global double *) mem_19726)[gtid_17592 *
                                                    implz2083U_16709 +
                                                    gtid_17600] =
                        defunc_2_reduce_res_17911;
                }
                // save results to be reduced
                {
                    ((__local
                      double *) red_arr_mem_20167)[sext_i32_i64(local_tid_20163)] =
                        defunc_2_reduce_res_17911;
                }
            } else {
                ((__local
                  double *) red_arr_mem_20167)[sext_i32_i64(local_tid_20163)] =
                    -INFINITY;
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        if (slt64((int64_t) 0, implz2083U_16709)) {
            // perform segmented scan to imitate reduction
            {
                double x_17906;
                double x_17907;
                double x_20175;
                double x_20176;
                bool ltid_in_bounds_20178 = slt64(sext_i32_i64(local_tid_20163),
                                                  implz2083U_16709 *
                                                  squot64(segred_group_sizze_17901,
                                                          segment_sizze_nonzzero_20160));
                int32_t skip_threads_20179;
                
                // read input for in-block scan
                {
                    if (ltid_in_bounds_20178) {
                        x_17907 = ((volatile __local
                                    double *) red_arr_mem_20167)[sext_i32_i64(local_tid_20163)];
                        if ((local_tid_20163 - squot32(local_tid_20163, 32) *
                             32) == 0) {
                            x_17906 = x_17907;
                        }
                    }
                }
                // in-block scan (hopefully no barriers needed)
                {
                    skip_threads_20179 = 1;
                    while (slt32(skip_threads_20179, 32)) {
                        if (sle32(skip_threads_20179, local_tid_20163 -
                                  squot32(local_tid_20163, 32) * 32) &&
                            ltid_in_bounds_20178) {
                            // read operands
                            {
                                x_17906 = ((volatile __local
                                            double *) red_arr_mem_20167)[sext_i32_i64(local_tid_20163) -
                                                                         sext_i32_i64(skip_threads_20179)];
                            }
                            // perform operation
                            {
                                bool inactive_20180 =
                                     slt64(srem64(sext_i32_i64(local_tid_20163),
                                                  implz2083U_16709),
                                           sext_i32_i64(local_tid_20163) -
                                           sext_i32_i64(local_tid_20163 -
                                           skip_threads_20179));
                                
                                if (inactive_20180) {
                                    x_17906 = x_17907;
                                }
                                if (!inactive_20180) {
                                    double defunc_1_op_res_17908 =
                                           fmax64(x_17906, x_17907);
                                    
                                    x_17906 = defunc_1_op_res_17908;
                                }
                            }
                        }
                        if (sle32(wave_sizze_20165, skip_threads_20179)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        if (sle32(skip_threads_20179, local_tid_20163 -
                                  squot32(local_tid_20163, 32) * 32) &&
                            ltid_in_bounds_20178) {
                            // write result
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20167)[sext_i32_i64(local_tid_20163)] =
                                    x_17906;
                                x_17907 = x_17906;
                            }
                        }
                        if (sle32(wave_sizze_20165, skip_threads_20179)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        skip_threads_20179 *= 2;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // last thread of block 'i' writes its result to offset 'i'
                {
                    if ((local_tid_20163 - squot32(local_tid_20163, 32) * 32) ==
                        31 && ltid_in_bounds_20178) {
                        ((volatile __local
                          double *) red_arr_mem_20167)[sext_i32_i64(squot32(local_tid_20163,
                                                                            32))] =
                            x_17906;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
                {
                    int32_t skip_threads_20181;
                    
                    // read input for in-block scan
                    {
                        if (squot32(local_tid_20163, 32) == 0 &&
                            ltid_in_bounds_20178) {
                            x_20176 = ((volatile __local
                                        double *) red_arr_mem_20167)[sext_i32_i64(local_tid_20163)];
                            if ((local_tid_20163 - squot32(local_tid_20163,
                                                           32) * 32) == 0) {
                                x_20175 = x_20176;
                            }
                        }
                    }
                    // in-block scan (hopefully no barriers needed)
                    {
                        skip_threads_20181 = 1;
                        while (slt32(skip_threads_20181, 32)) {
                            if (sle32(skip_threads_20181, local_tid_20163 -
                                      squot32(local_tid_20163, 32) * 32) &&
                                (squot32(local_tid_20163, 32) == 0 &&
                                 ltid_in_bounds_20178)) {
                                // read operands
                                {
                                    x_20175 = ((volatile __local
                                                double *) red_arr_mem_20167)[sext_i32_i64(local_tid_20163) -
                                                                             sext_i32_i64(skip_threads_20181)];
                                }
                                // perform operation
                                {
                                    bool inactive_20182 =
                                         slt64(srem64(sext_i32_i64(local_tid_20163 *
                                                      32 + 32 - 1),
                                                      implz2083U_16709),
                                               sext_i32_i64(local_tid_20163 *
                                               32 + 32 - 1) -
                                               sext_i32_i64((local_tid_20163 -
                                                             skip_threads_20181) *
                                               32 + 32 - 1));
                                    
                                    if (inactive_20182) {
                                        x_20175 = x_20176;
                                    }
                                    if (!inactive_20182) {
                                        double defunc_1_op_res_20177 =
                                               fmax64(x_20175, x_20176);
                                        
                                        x_20175 = defunc_1_op_res_20177;
                                    }
                                }
                            }
                            if (sle32(wave_sizze_20165, skip_threads_20181)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            if (sle32(skip_threads_20181, local_tid_20163 -
                                      squot32(local_tid_20163, 32) * 32) &&
                                (squot32(local_tid_20163, 32) == 0 &&
                                 ltid_in_bounds_20178)) {
                                // write result
                                {
                                    ((volatile __local
                                      double *) red_arr_mem_20167)[sext_i32_i64(local_tid_20163)] =
                                        x_20175;
                                    x_20176 = x_20175;
                                }
                            }
                            if (sle32(wave_sizze_20165, skip_threads_20181)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            skip_threads_20181 *= 2;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // carry-in for every block except the first
                {
                    if (!(squot32(local_tid_20163, 32) == 0 ||
                          !ltid_in_bounds_20178)) {
                        // read operands
                        {
                            x_17907 = x_17906;
                            x_17906 = ((__local
                                        double *) red_arr_mem_20167)[sext_i32_i64(squot32(local_tid_20163,
                                                                                          32)) -
                                                                     (int64_t) 1];
                        }
                        // perform operation
                        {
                            bool inactive_20183 =
                                 slt64(srem64(sext_i32_i64(local_tid_20163),
                                              implz2083U_16709),
                                       sext_i32_i64(local_tid_20163) -
                                       sext_i32_i64(squot32(local_tid_20163,
                                                            32) * 32 - 1));
                            
                            if (inactive_20183) {
                                x_17906 = x_17907;
                            }
                            if (!inactive_20183) {
                                double defunc_1_op_res_17908 = fmax64(x_17906,
                                                                      x_17907);
                                
                                x_17906 = defunc_1_op_res_17908;
                            }
                        }
                        // write final result
                        {
                            ((__local
                              double *) red_arr_mem_20167)[sext_i32_i64(local_tid_20163)] =
                                x_17906;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // restore correct values for first block
                {
                    if (squot32(local_tid_20163, 32) == 0) {
                        ((__local
                          double *) red_arr_mem_20167)[sext_i32_i64(local_tid_20163)] =
                            x_17907;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // save final values of segments
        {
            if (slt64(sext_i32_i64(virt_group_id_20171) *
                      squot64(segred_group_sizze_17901,
                              segment_sizze_nonzzero_20160) +
                      sext_i32_i64(local_tid_20163), implz2088U_16707) &&
                slt64(sext_i32_i64(local_tid_20163),
                      squot64(segred_group_sizze_17901,
                              segment_sizze_nonzzero_20160))) {
                ((__global
                  double *) mem_19722)[sext_i32_i64(virt_group_id_20171) *
                                       squot64(segred_group_sizze_17901,
                                               segment_sizze_nonzzero_20160) +
                                       sext_i32_i64(local_tid_20163)] =
                    ((__local
                      double *) red_arr_mem_20167)[(sext_i32_i64(local_tid_20163) +
                                                    (int64_t) 1) *
                                                   segment_sizze_nonzzero_20160 -
                                                   (int64_t) 1];
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17901
}
__kernel void criterionzisegred_small_17646(__global int *global_failure,
                                            __local volatile
                                            int64_t *red_arr_mem_20098_backing_aligned_0,
                                            int64_t implz2081U_16706,
                                            int64_t implz2088U_16707,
                                            int64_t implz2082U_16708,
                                            int64_t implz2085U_16711,
                                            int64_t num_groups_17887,
                                            int64_t segment_sizze_nonzzero_20091,
                                            __global unsigned char *x_mem_19394,
                                            __global
                                            unsigned char *beta_mem_19396,
                                            __global unsigned char *mem_19717)
{
    #define segred_group_sizze_17886 (criterionzisegred_group_sizze_17640)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20098_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20098_backing_aligned_0;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20093;
    int32_t local_tid_20094;
    int64_t group_sizze_20097;
    int32_t wave_sizze_20096;
    int32_t group_tid_20095;
    
    global_tid_20093 = get_global_id(0);
    local_tid_20094 = get_local_id(0);
    group_sizze_20097 = get_local_size(0);
    wave_sizze_20096 = LOCKSTEP_WIDTH;
    group_tid_20095 = get_group_id(0);
    
    int32_t phys_tid_17646 = global_tid_20093;
    __local unsigned char *red_arr_mem_20098;
    
    red_arr_mem_20098 = (__local unsigned char *) red_arr_mem_20098_backing_0;
    
    int32_t phys_group_id_20100;
    
    phys_group_id_20100 = get_group_id(0);
    for (int32_t i_20101 = 0; i_20101 <
         sdiv_up32(sext_i64_i32(sdiv_up64(implz2088U_16707 * implz2082U_16708,
                                          squot64(segred_group_sizze_17886,
                                                  segment_sizze_nonzzero_20091))) -
                   phys_group_id_20100, sext_i64_i32(num_groups_17887));
         i_20101++) {
        int32_t virt_group_id_20102 = phys_group_id_20100 + i_20101 *
                sext_i64_i32(num_groups_17887);
        int64_t slice_20103 = implz2082U_16708;
        int64_t slice_20104 = implz2088U_16707 * slice_20103;
        int64_t gtid_17635 = squot64(squot64(sext_i32_i64(local_tid_20094),
                                             segment_sizze_nonzzero_20091) +
                                     sext_i32_i64(virt_group_id_20102) *
                                     squot64(segred_group_sizze_17886,
                                             segment_sizze_nonzzero_20091),
                                     slice_20103);
        int64_t remnant_20105 = squot64(sext_i32_i64(local_tid_20094),
                                        segment_sizze_nonzzero_20091) +
                sext_i32_i64(virt_group_id_20102) *
                squot64(segred_group_sizze_17886,
                        segment_sizze_nonzzero_20091) - gtid_17635 *
                slice_20103;
        int64_t gtid_17636 = remnant_20105;
        int64_t remnant_20106 = remnant_20105 - gtid_17636;
        int64_t gtid_17645 = srem64(sext_i32_i64(local_tid_20094),
                                    implz2081U_16706);
        
        // apply map function if in bounds
        {
            if (slt64((int64_t) 0, implz2081U_16706) && ((slt64(gtid_17635,
                                                                implz2088U_16707) &&
                                                          slt64(gtid_17636,
                                                                implz2082U_16708)) &&
                                                         slt64(sext_i32_i64(local_tid_20094),
                                                               implz2081U_16706 *
                                                               squot64(segred_group_sizze_17886,
                                                                       segment_sizze_nonzzero_20091)))) {
                double x_17895 = ((__global double *) x_mem_19394)[gtid_17635 *
                                                                   implz2081U_16706 +
                                                                   gtid_17645];
                int64_t binop_x_18831 = implz2082U_16708 * gtid_17645;
                int64_t binop_x_18832 = gtid_17636 + binop_x_18831;
                int64_t new_index_18833 = squot64(binop_x_18832,
                                                  implz2085U_16711);
                int64_t binop_y_18839 = implz2085U_16711 * new_index_18833;
                int64_t new_index_18840 = binop_x_18832 - binop_y_18839;
                double x_17896 = ((__global
                                   double *) beta_mem_19396)[new_index_18833 *
                                                             implz2085U_16711 +
                                                             new_index_18840];
                double defunc_1_f_res_17897 = x_17895 * x_17896;
                
                // save map-out results
                { }
                // save results to be reduced
                {
                    ((__local
                      double *) red_arr_mem_20098)[sext_i32_i64(local_tid_20094)] =
                        defunc_1_f_res_17897;
                }
            } else {
                ((__local
                  double *) red_arr_mem_20098)[sext_i32_i64(local_tid_20094)] =
                    0.0;
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        if (slt64((int64_t) 0, implz2081U_16706)) {
            // perform segmented scan to imitate reduction
            {
                double x_17890;
                double x_17891;
                double x_20107;
                double x_20108;
                bool ltid_in_bounds_20110 = slt64(sext_i32_i64(local_tid_20094),
                                                  implz2081U_16706 *
                                                  squot64(segred_group_sizze_17886,
                                                          segment_sizze_nonzzero_20091));
                int32_t skip_threads_20111;
                
                // read input for in-block scan
                {
                    if (ltid_in_bounds_20110) {
                        x_17891 = ((volatile __local
                                    double *) red_arr_mem_20098)[sext_i32_i64(local_tid_20094)];
                        if ((local_tid_20094 - squot32(local_tid_20094, 32) *
                             32) == 0) {
                            x_17890 = x_17891;
                        }
                    }
                }
                // in-block scan (hopefully no barriers needed)
                {
                    skip_threads_20111 = 1;
                    while (slt32(skip_threads_20111, 32)) {
                        if (sle32(skip_threads_20111, local_tid_20094 -
                                  squot32(local_tid_20094, 32) * 32) &&
                            ltid_in_bounds_20110) {
                            // read operands
                            {
                                x_17890 = ((volatile __local
                                            double *) red_arr_mem_20098)[sext_i32_i64(local_tid_20094) -
                                                                         sext_i32_i64(skip_threads_20111)];
                            }
                            // perform operation
                            {
                                bool inactive_20112 =
                                     slt64(srem64(sext_i32_i64(local_tid_20094),
                                                  implz2081U_16706),
                                           sext_i32_i64(local_tid_20094) -
                                           sext_i32_i64(local_tid_20094 -
                                           skip_threads_20111));
                                
                                if (inactive_20112) {
                                    x_17890 = x_17891;
                                }
                                if (!inactive_20112) {
                                    double defunc_1_op_res_17892 = x_17890 +
                                           x_17891;
                                    
                                    x_17890 = defunc_1_op_res_17892;
                                }
                            }
                        }
                        if (sle32(wave_sizze_20096, skip_threads_20111)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        if (sle32(skip_threads_20111, local_tid_20094 -
                                  squot32(local_tid_20094, 32) * 32) &&
                            ltid_in_bounds_20110) {
                            // write result
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20098)[sext_i32_i64(local_tid_20094)] =
                                    x_17890;
                                x_17891 = x_17890;
                            }
                        }
                        if (sle32(wave_sizze_20096, skip_threads_20111)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        skip_threads_20111 *= 2;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // last thread of block 'i' writes its result to offset 'i'
                {
                    if ((local_tid_20094 - squot32(local_tid_20094, 32) * 32) ==
                        31 && ltid_in_bounds_20110) {
                        ((volatile __local
                          double *) red_arr_mem_20098)[sext_i32_i64(squot32(local_tid_20094,
                                                                            32))] =
                            x_17890;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
                {
                    int32_t skip_threads_20113;
                    
                    // read input for in-block scan
                    {
                        if (squot32(local_tid_20094, 32) == 0 &&
                            ltid_in_bounds_20110) {
                            x_20108 = ((volatile __local
                                        double *) red_arr_mem_20098)[sext_i32_i64(local_tid_20094)];
                            if ((local_tid_20094 - squot32(local_tid_20094,
                                                           32) * 32) == 0) {
                                x_20107 = x_20108;
                            }
                        }
                    }
                    // in-block scan (hopefully no barriers needed)
                    {
                        skip_threads_20113 = 1;
                        while (slt32(skip_threads_20113, 32)) {
                            if (sle32(skip_threads_20113, local_tid_20094 -
                                      squot32(local_tid_20094, 32) * 32) &&
                                (squot32(local_tid_20094, 32) == 0 &&
                                 ltid_in_bounds_20110)) {
                                // read operands
                                {
                                    x_20107 = ((volatile __local
                                                double *) red_arr_mem_20098)[sext_i32_i64(local_tid_20094) -
                                                                             sext_i32_i64(skip_threads_20113)];
                                }
                                // perform operation
                                {
                                    bool inactive_20114 =
                                         slt64(srem64(sext_i32_i64(local_tid_20094 *
                                                      32 + 32 - 1),
                                                      implz2081U_16706),
                                               sext_i32_i64(local_tid_20094 *
                                               32 + 32 - 1) -
                                               sext_i32_i64((local_tid_20094 -
                                                             skip_threads_20113) *
                                               32 + 32 - 1));
                                    
                                    if (inactive_20114) {
                                        x_20107 = x_20108;
                                    }
                                    if (!inactive_20114) {
                                        double defunc_1_op_res_20109 = x_20107 +
                                               x_20108;
                                        
                                        x_20107 = defunc_1_op_res_20109;
                                    }
                                }
                            }
                            if (sle32(wave_sizze_20096, skip_threads_20113)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            if (sle32(skip_threads_20113, local_tid_20094 -
                                      squot32(local_tid_20094, 32) * 32) &&
                                (squot32(local_tid_20094, 32) == 0 &&
                                 ltid_in_bounds_20110)) {
                                // write result
                                {
                                    ((volatile __local
                                      double *) red_arr_mem_20098)[sext_i32_i64(local_tid_20094)] =
                                        x_20107;
                                    x_20108 = x_20107;
                                }
                            }
                            if (sle32(wave_sizze_20096, skip_threads_20113)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            skip_threads_20113 *= 2;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // carry-in for every block except the first
                {
                    if (!(squot32(local_tid_20094, 32) == 0 ||
                          !ltid_in_bounds_20110)) {
                        // read operands
                        {
                            x_17891 = x_17890;
                            x_17890 = ((__local
                                        double *) red_arr_mem_20098)[sext_i32_i64(squot32(local_tid_20094,
                                                                                          32)) -
                                                                     (int64_t) 1];
                        }
                        // perform operation
                        {
                            bool inactive_20115 =
                                 slt64(srem64(sext_i32_i64(local_tid_20094),
                                              implz2081U_16706),
                                       sext_i32_i64(local_tid_20094) -
                                       sext_i32_i64(squot32(local_tid_20094,
                                                            32) * 32 - 1));
                            
                            if (inactive_20115) {
                                x_17890 = x_17891;
                            }
                            if (!inactive_20115) {
                                double defunc_1_op_res_17892 = x_17890 +
                                       x_17891;
                                
                                x_17890 = defunc_1_op_res_17892;
                            }
                        }
                        // write final result
                        {
                            ((__local
                              double *) red_arr_mem_20098)[sext_i32_i64(local_tid_20094)] =
                                x_17890;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // restore correct values for first block
                {
                    if (squot32(local_tid_20094, 32) == 0) {
                        ((__local
                          double *) red_arr_mem_20098)[sext_i32_i64(local_tid_20094)] =
                            x_17891;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // save final values of segments
        {
            if (slt64(sext_i32_i64(virt_group_id_20102) *
                      squot64(segred_group_sizze_17886,
                              segment_sizze_nonzzero_20091) +
                      sext_i32_i64(local_tid_20094), implz2088U_16707 *
                      implz2082U_16708) && slt64(sext_i32_i64(local_tid_20094),
                                                 squot64(segred_group_sizze_17886,
                                                         segment_sizze_nonzzero_20091))) {
                ((__global
                  double *) mem_19717)[squot64(sext_i32_i64(virt_group_id_20102) *
                                               squot64(segred_group_sizze_17886,
                                                       segment_sizze_nonzzero_20091) +
                                               sext_i32_i64(local_tid_20094),
                                               implz2082U_16708) *
                                       implz2082U_16708 +
                                       (sext_i32_i64(virt_group_id_20102) *
                                        squot64(segred_group_sizze_17886,
                                                segment_sizze_nonzzero_20091) +
                                        sext_i32_i64(local_tid_20094) -
                                        squot64(sext_i32_i64(virt_group_id_20102) *
                                                squot64(segred_group_sizze_17886,
                                                        segment_sizze_nonzzero_20091) +
                                                sext_i32_i64(local_tid_20094),
                                                implz2082U_16708) *
                                        implz2082U_16708)] = ((__local
                                                               double *) red_arr_mem_20098)[(sext_i32_i64(local_tid_20094) +
                                                                                             (int64_t) 1) *
                                                                                            segment_sizze_nonzzero_20091 -
                                                                                            (int64_t) 1];
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17886
}
__kernel void generate_datazicopy_19975(int64_t N_16778, int64_t Kx_16781,
                                        int64_t rand_matrix_arg_16810, __global
                                        unsigned char *mem_19397, __global
                                        unsigned char *mem_19405)
{
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    int32_t copy_gtid_19975;
    int32_t copy_ltid_19976;
    int32_t copy_gid_19977;
    
    copy_gtid_19975 = get_global_id(0);
    copy_ltid_19976 = get_local_id(0);
    copy_gid_19977 = get_group_id(0);
    
    int64_t slice_19982 = rand_matrix_arg_16810;
    int64_t slice_19983 = N_16778 * slice_19982;
    int64_t copy_i_19980 = squot64(sext_i32_i64(copy_gtid_19975), slice_19982);
    int64_t remnant_19984 = sext_i32_i64(copy_gtid_19975) - copy_i_19980 *
            slice_19982;
    int64_t copy_i_19981 = remnant_19984;
    int64_t remnant_19985 = remnant_19984 - copy_i_19981;
    
    if (slt64(sext_i32_i64(copy_gtid_19975), N_16778 * rand_matrix_arg_16810)) {
        ((__global double *) mem_19397)[(int64_t) 1 + (copy_i_19980 * Kx_16781 +
                                                       copy_i_19981)] =
            ((__global double *) mem_19405)[copy_i_19980 *
                                            rand_matrix_arg_16810 +
                                            copy_i_19981];
    }
    
  error_0:
    return;
}
__kernel void generate_dataziscan_stage1_18528(__global int *global_failure,
                                               __local volatile
                                               int64_t *scan_arr_mem_20426_backing_aligned_0,
                                               int64_t N_16778, int64_t J_16779,
                                               int32_t num_threads_20420,
                                               __global
                                               unsigned char *mem_19765,
                                               __global
                                               unsigned char *mem_19769,
                                               __global
                                               unsigned char *mem_19774,
                                               __global
                                               unsigned char *mem_19778)
{
    #define segscan_group_sizze_18706 (generate_datazisegscan_group_sizze_18522)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict scan_arr_mem_20426_backing_0 =
                                   (__local volatile
                                    unsigned char *) scan_arr_mem_20426_backing_aligned_0;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20421;
    int32_t local_tid_20422;
    int64_t group_sizze_20425;
    int32_t wave_sizze_20424;
    int32_t group_tid_20423;
    
    global_tid_20421 = get_global_id(0);
    local_tid_20422 = get_local_id(0);
    group_sizze_20425 = get_local_size(0);
    wave_sizze_20424 = LOCKSTEP_WIDTH;
    group_tid_20423 = get_group_id(0);
    
    int32_t phys_tid_18528 = global_tid_20421;
    __local unsigned char *scan_arr_mem_20426;
    
    scan_arr_mem_20426 = (__local unsigned char *) scan_arr_mem_20426_backing_0;
    
    double x_18711;
    double x_18712;
    
    x_18711 = 0.0;
    for (int64_t j_20428 = 0; j_20428 < sdiv_up64(N_16778 * J_16779,
                                                  sext_i32_i64(num_threads_20420));
         j_20428++) {
        int64_t chunk_offset_20429 = segscan_group_sizze_18706 * j_20428 +
                sext_i32_i64(group_tid_20423) * (segscan_group_sizze_18706 *
                                                 sdiv_up64(N_16778 * J_16779,
                                                           sext_i32_i64(num_threads_20420)));
        int64_t flat_idx_20430 = chunk_offset_20429 +
                sext_i32_i64(local_tid_20422);
        int64_t gtid_18519 = squot64(flat_idx_20430, J_16779);
        int64_t gtid_18527 = flat_idx_20430 - squot64(flat_idx_20430, J_16779) *
                J_16779;
        
        // threads in bounds read input
        {
            if (slt64(gtid_18519, N_16778) && slt64(gtid_18527, J_16779)) {
                double defunc_2_reduce_res_18714 = ((__global
                                                     double *) mem_19765)[gtid_18519];
                double x_18716 = ((__global double *) mem_19769)[gtid_18519 *
                                                                 J_16779 +
                                                                 gtid_18527];
                double defunc_0_f_res_18717 = x_18716 /
                       defunc_2_reduce_res_18714;
                
                // write to-scan values to parameters
                {
                    x_18712 = defunc_0_f_res_18717;
                }
                // write mapped values results to global memory
                {
                    ((__global double *) mem_19778)[gtid_18519 * J_16779 +
                                                    gtid_18527] =
                        defunc_0_f_res_18717;
                }
            }
        }
        // do one intra-group scan operation
        {
            // maybe restore some to-scan values to parameters, or read neutral
            {
                if (!(slt64(gtid_18519, N_16778) && slt64(gtid_18527,
                                                          J_16779))) {
                    x_18712 = 0.0;
                }
            }
            // combine with carry and write to local memory
            {
                double defunc_1_op_res_18713 = x_18711 + x_18712;
                
                ((__local
                  double *) scan_arr_mem_20426)[sext_i32_i64(local_tid_20422)] =
                    defunc_1_op_res_18713;
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            
            double x_20431;
            double x_20432;
            double x_20434;
            double x_20435;
            bool ltid_in_bounds_20437 = slt64(sext_i32_i64(local_tid_20422),
                                              segscan_group_sizze_18706);
            int32_t skip_threads_20438;
            
            // read input for in-block scan
            {
                if (ltid_in_bounds_20437) {
                    x_20432 = ((volatile __local
                                double *) scan_arr_mem_20426)[sext_i32_i64(local_tid_20422)];
                    if ((local_tid_20422 - squot32(local_tid_20422, 32) * 32) ==
                        0) {
                        x_20431 = x_20432;
                    }
                }
            }
            // in-block scan (hopefully no barriers needed)
            {
                skip_threads_20438 = 1;
                while (slt32(skip_threads_20438, 32)) {
                    if (sle32(skip_threads_20438, local_tid_20422 -
                              squot32(local_tid_20422, 32) * 32) &&
                        ltid_in_bounds_20437) {
                        // read operands
                        {
                            x_20431 = ((volatile __local
                                        double *) scan_arr_mem_20426)[sext_i32_i64(local_tid_20422) -
                                                                      sext_i32_i64(skip_threads_20438)];
                        }
                        // perform operation
                        {
                            bool inactive_20439 =
                                 slt64(srem64(sext_i32_i64(local_tid_20422) +
                                              chunk_offset_20429, J_16779),
                                       sext_i32_i64(local_tid_20422) +
                                       chunk_offset_20429 -
                                       (sext_i32_i64(local_tid_20422 -
                                        skip_threads_20438) +
                                        chunk_offset_20429));
                            
                            if (inactive_20439) {
                                x_20431 = x_20432;
                            }
                            if (!inactive_20439) {
                                double defunc_1_op_res_20433 = x_20431 +
                                       x_20432;
                                
                                x_20431 = defunc_1_op_res_20433;
                            }
                        }
                    }
                    if (sle32(wave_sizze_20424, skip_threads_20438)) {
                        barrier(CLK_LOCAL_MEM_FENCE);
                    }
                    if (sle32(skip_threads_20438, local_tid_20422 -
                              squot32(local_tid_20422, 32) * 32) &&
                        ltid_in_bounds_20437) {
                        // write result
                        {
                            ((volatile __local
                              double *) scan_arr_mem_20426)[sext_i32_i64(local_tid_20422)] =
                                x_20431;
                            x_20432 = x_20431;
                        }
                    }
                    if (sle32(wave_sizze_20424, skip_threads_20438)) {
                        barrier(CLK_LOCAL_MEM_FENCE);
                    }
                    skip_threads_20438 *= 2;
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            // last thread of block 'i' writes its result to offset 'i'
            {
                if ((local_tid_20422 - squot32(local_tid_20422, 32) * 32) ==
                    31 && ltid_in_bounds_20437) {
                    ((volatile __local
                      double *) scan_arr_mem_20426)[sext_i32_i64(squot32(local_tid_20422,
                                                                         32))] =
                        x_20431;
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
            {
                int32_t skip_threads_20440;
                
                // read input for in-block scan
                {
                    if (squot32(local_tid_20422, 32) == 0 &&
                        ltid_in_bounds_20437) {
                        x_20435 = ((volatile __local
                                    double *) scan_arr_mem_20426)[sext_i32_i64(local_tid_20422)];
                        if ((local_tid_20422 - squot32(local_tid_20422, 32) *
                             32) == 0) {
                            x_20434 = x_20435;
                        }
                    }
                }
                // in-block scan (hopefully no barriers needed)
                {
                    skip_threads_20440 = 1;
                    while (slt32(skip_threads_20440, 32)) {
                        if (sle32(skip_threads_20440, local_tid_20422 -
                                  squot32(local_tid_20422, 32) * 32) &&
                            (squot32(local_tid_20422, 32) == 0 &&
                             ltid_in_bounds_20437)) {
                            // read operands
                            {
                                x_20434 = ((volatile __local
                                            double *) scan_arr_mem_20426)[sext_i32_i64(local_tid_20422) -
                                                                          sext_i32_i64(skip_threads_20440)];
                            }
                            // perform operation
                            {
                                bool inactive_20441 =
                                     slt64(srem64(sext_i32_i64(local_tid_20422 *
                                                  32 + 32 - 1) +
                                                  chunk_offset_20429, J_16779),
                                           sext_i32_i64(local_tid_20422 * 32 +
                                           32 - 1) + chunk_offset_20429 -
                                           (sext_i32_i64((local_tid_20422 -
                                                          skip_threads_20440) *
                                            32 + 32 - 1) + chunk_offset_20429));
                                
                                if (inactive_20441) {
                                    x_20434 = x_20435;
                                }
                                if (!inactive_20441) {
                                    double defunc_1_op_res_20436 = x_20434 +
                                           x_20435;
                                    
                                    x_20434 = defunc_1_op_res_20436;
                                }
                            }
                        }
                        if (sle32(wave_sizze_20424, skip_threads_20440)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        if (sle32(skip_threads_20440, local_tid_20422 -
                                  squot32(local_tid_20422, 32) * 32) &&
                            (squot32(local_tid_20422, 32) == 0 &&
                             ltid_in_bounds_20437)) {
                            // write result
                            {
                                ((volatile __local
                                  double *) scan_arr_mem_20426)[sext_i32_i64(local_tid_20422)] =
                                    x_20434;
                                x_20435 = x_20434;
                            }
                        }
                        if (sle32(wave_sizze_20424, skip_threads_20440)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        skip_threads_20440 *= 2;
                    }
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            // carry-in for every block except the first
            {
                if (!(squot32(local_tid_20422, 32) == 0 ||
                      !ltid_in_bounds_20437)) {
                    // read operands
                    {
                        x_20432 = x_20431;
                        x_20431 = ((__local
                                    double *) scan_arr_mem_20426)[sext_i32_i64(squot32(local_tid_20422,
                                                                                       32)) -
                                                                  (int64_t) 1];
                    }
                    // perform operation
                    {
                        bool inactive_20442 =
                             slt64(srem64(sext_i32_i64(local_tid_20422) +
                                          chunk_offset_20429, J_16779),
                                   sext_i32_i64(local_tid_20422) +
                                   chunk_offset_20429 -
                                   (sext_i32_i64(squot32(local_tid_20422, 32) *
                                    32 - 1) + chunk_offset_20429));
                        
                        if (inactive_20442) {
                            x_20431 = x_20432;
                        }
                        if (!inactive_20442) {
                            double defunc_1_op_res_20433 = x_20431 + x_20432;
                            
                            x_20431 = defunc_1_op_res_20433;
                        }
                    }
                    // write final result
                    {
                        ((__local
                          double *) scan_arr_mem_20426)[sext_i32_i64(local_tid_20422)] =
                            x_20431;
                    }
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            // restore correct values for first block
            {
                if (squot32(local_tid_20422, 32) == 0) {
                    ((__local
                      double *) scan_arr_mem_20426)[sext_i32_i64(local_tid_20422)] =
                        x_20432;
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            // threads in bounds write partial scan result
            {
                if (slt64(gtid_18519, N_16778) && slt64(gtid_18527, J_16779)) {
                    ((__global double *) mem_19774)[gtid_18519 * J_16779 +
                                                    gtid_18527] = ((__local
                                                                    double *) scan_arr_mem_20426)[sext_i32_i64(local_tid_20422)];
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            // first thread reads last element as carry-in for next iteration
            {
                bool crosses_segment_20443 = slt64(srem64(chunk_offset_20429 +
                                                          segscan_group_sizze_18706,
                                                          J_16779),
                                                   chunk_offset_20429 +
                                                   segscan_group_sizze_18706 -
                                                   (chunk_offset_20429 +
                                                    segscan_group_sizze_18706 -
                                                    (int64_t) 1));
                bool should_load_carry_20444 = local_tid_20422 == 0 &&
                     !crosses_segment_20443;
                
                if (should_load_carry_20444) {
                    x_18711 = ((__local
                                double *) scan_arr_mem_20426)[segscan_group_sizze_18706 -
                                                              (int64_t) 1];
                }
                if (!should_load_carry_20444) {
                    x_18711 = 0.0;
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
        }
    }
    
  error_1:
    return;
    #undef segscan_group_sizze_18706
}
__kernel void generate_dataziscan_stage2_18528(__global int *global_failure,
                                               __local volatile
                                               int64_t *scan_arr_mem_20450_backing_aligned_0,
                                               int64_t N_16778, int64_t J_16779,
                                               int64_t stage1_num_groups_20419,
                                               int32_t num_threads_20420,
                                               __global
                                               unsigned char *mem_19774)
{
    #define segscan_group_sizze_18706 (generate_datazisegscan_group_sizze_18522)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict scan_arr_mem_20450_backing_0 =
                                   (__local volatile
                                    unsigned char *) scan_arr_mem_20450_backing_aligned_0;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20445;
    int32_t local_tid_20446;
    int64_t group_sizze_20449;
    int32_t wave_sizze_20448;
    int32_t group_tid_20447;
    
    global_tid_20445 = get_global_id(0);
    local_tid_20446 = get_local_id(0);
    group_sizze_20449 = get_local_size(0);
    wave_sizze_20448 = LOCKSTEP_WIDTH;
    group_tid_20447 = get_group_id(0);
    
    int32_t phys_tid_18528 = global_tid_20445;
    __local unsigned char *scan_arr_mem_20450;
    
    scan_arr_mem_20450 = (__local unsigned char *) scan_arr_mem_20450_backing_0;
    
    int64_t flat_idx_20452 = (sext_i32_i64(local_tid_20446) + (int64_t) 1) *
            (segscan_group_sizze_18706 * sdiv_up64(N_16778 * J_16779,
                                                   sext_i32_i64(num_threads_20420))) -
            (int64_t) 1;
    int64_t gtid_18519 = squot64(flat_idx_20452, J_16779);
    int64_t gtid_18527 = flat_idx_20452 - squot64(flat_idx_20452, J_16779) *
            J_16779;
    
    // threads in bound read carries; others get neutral element
    {
        if (slt64(gtid_18519, N_16778) && slt64(gtid_18527, J_16779)) {
            ((__local
              double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446)] =
                ((__global double *) mem_19774)[gtid_18519 * J_16779 +
                                                gtid_18527];
        } else {
            ((__local
              double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446)] =
                0.0;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    double x_18711;
    double x_18712;
    double x_20453;
    double x_20454;
    bool ltid_in_bounds_20456 = slt64(sext_i32_i64(local_tid_20446),
                                      stage1_num_groups_20419);
    int32_t skip_threads_20457;
    
    // read input for in-block scan
    {
        if (ltid_in_bounds_20456) {
            x_18712 = ((volatile __local
                        double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446)];
            if ((local_tid_20446 - squot32(local_tid_20446, 32) * 32) == 0) {
                x_18711 = x_18712;
            }
        }
    }
    // in-block scan (hopefully no barriers needed)
    {
        skip_threads_20457 = 1;
        while (slt32(skip_threads_20457, 32)) {
            if (sle32(skip_threads_20457, local_tid_20446 -
                      squot32(local_tid_20446, 32) * 32) &&
                ltid_in_bounds_20456) {
                // read operands
                {
                    x_18711 = ((volatile __local
                                double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446) -
                                                              sext_i32_i64(skip_threads_20457)];
                }
                // perform operation
                {
                    bool inactive_20458 =
                         slt64(srem64((sext_i32_i64(local_tid_20446) +
                                       (int64_t) 1) *
                                      (segscan_group_sizze_18706 *
                                       sdiv_up64(N_16778 * J_16779,
                                                 sext_i32_i64(num_threads_20420))) -
                                      (int64_t) 1, J_16779),
                               (sext_i32_i64(local_tid_20446) + (int64_t) 1) *
                               (segscan_group_sizze_18706 * sdiv_up64(N_16778 *
                                                                      J_16779,
                                                                      sext_i32_i64(num_threads_20420))) -
                               (int64_t) 1 - ((sext_i32_i64(local_tid_20446 -
                                               skip_threads_20457) +
                                               (int64_t) 1) *
                                              (segscan_group_sizze_18706 *
                                               sdiv_up64(N_16778 * J_16779,
                                                         sext_i32_i64(num_threads_20420))) -
                                              (int64_t) 1));
                    
                    if (inactive_20458) {
                        x_18711 = x_18712;
                    }
                    if (!inactive_20458) {
                        double defunc_1_op_res_18713 = x_18711 + x_18712;
                        
                        x_18711 = defunc_1_op_res_18713;
                    }
                }
            }
            if (sle32(wave_sizze_20448, skip_threads_20457)) {
                barrier(CLK_LOCAL_MEM_FENCE);
            }
            if (sle32(skip_threads_20457, local_tid_20446 -
                      squot32(local_tid_20446, 32) * 32) &&
                ltid_in_bounds_20456) {
                // write result
                {
                    ((volatile __local
                      double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446)] =
                        x_18711;
                    x_18712 = x_18711;
                }
            }
            if (sle32(wave_sizze_20448, skip_threads_20457)) {
                barrier(CLK_LOCAL_MEM_FENCE);
            }
            skip_threads_20457 *= 2;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // last thread of block 'i' writes its result to offset 'i'
    {
        if ((local_tid_20446 - squot32(local_tid_20446, 32) * 32) == 31 &&
            ltid_in_bounds_20456) {
            ((volatile __local
              double *) scan_arr_mem_20450)[sext_i32_i64(squot32(local_tid_20446,
                                                                 32))] =
                x_18711;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
    {
        int32_t skip_threads_20459;
        
        // read input for in-block scan
        {
            if (squot32(local_tid_20446, 32) == 0 && ltid_in_bounds_20456) {
                x_20454 = ((volatile __local
                            double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446)];
                if ((local_tid_20446 - squot32(local_tid_20446, 32) * 32) ==
                    0) {
                    x_20453 = x_20454;
                }
            }
        }
        // in-block scan (hopefully no barriers needed)
        {
            skip_threads_20459 = 1;
            while (slt32(skip_threads_20459, 32)) {
                if (sle32(skip_threads_20459, local_tid_20446 -
                          squot32(local_tid_20446, 32) * 32) &&
                    (squot32(local_tid_20446, 32) == 0 &&
                     ltid_in_bounds_20456)) {
                    // read operands
                    {
                        x_20453 = ((volatile __local
                                    double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446) -
                                                                  sext_i32_i64(skip_threads_20459)];
                    }
                    // perform operation
                    {
                        bool inactive_20460 =
                             slt64(srem64((sext_i32_i64(local_tid_20446 * 32 +
                                           32 - 1) + (int64_t) 1) *
                                          (segscan_group_sizze_18706 *
                                           sdiv_up64(N_16778 * J_16779,
                                                     sext_i32_i64(num_threads_20420))) -
                                          (int64_t) 1, J_16779),
                                   (sext_i32_i64(local_tid_20446 * 32 + 32 -
                                    1) + (int64_t) 1) *
                                   (segscan_group_sizze_18706 *
                                    sdiv_up64(N_16778 * J_16779,
                                              sext_i32_i64(num_threads_20420))) -
                                   (int64_t) 1 -
                                   ((sext_i32_i64((local_tid_20446 -
                                                   skip_threads_20459) * 32 +
                                     32 - 1) + (int64_t) 1) *
                                    (segscan_group_sizze_18706 *
                                     sdiv_up64(N_16778 * J_16779,
                                               sext_i32_i64(num_threads_20420))) -
                                    (int64_t) 1));
                        
                        if (inactive_20460) {
                            x_20453 = x_20454;
                        }
                        if (!inactive_20460) {
                            double defunc_1_op_res_20455 = x_20453 + x_20454;
                            
                            x_20453 = defunc_1_op_res_20455;
                        }
                    }
                }
                if (sle32(wave_sizze_20448, skip_threads_20459)) {
                    barrier(CLK_LOCAL_MEM_FENCE);
                }
                if (sle32(skip_threads_20459, local_tid_20446 -
                          squot32(local_tid_20446, 32) * 32) &&
                    (squot32(local_tid_20446, 32) == 0 &&
                     ltid_in_bounds_20456)) {
                    // write result
                    {
                        ((volatile __local
                          double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446)] =
                            x_20453;
                        x_20454 = x_20453;
                    }
                }
                if (sle32(wave_sizze_20448, skip_threads_20459)) {
                    barrier(CLK_LOCAL_MEM_FENCE);
                }
                skip_threads_20459 *= 2;
            }
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // carry-in for every block except the first
    {
        if (!(squot32(local_tid_20446, 32) == 0 || !ltid_in_bounds_20456)) {
            // read operands
            {
                x_18712 = x_18711;
                x_18711 = ((__local
                            double *) scan_arr_mem_20450)[sext_i32_i64(squot32(local_tid_20446,
                                                                               32)) -
                                                          (int64_t) 1];
            }
            // perform operation
            {
                bool inactive_20461 =
                     slt64(srem64((sext_i32_i64(local_tid_20446) +
                                   (int64_t) 1) * (segscan_group_sizze_18706 *
                                                   sdiv_up64(N_16778 * J_16779,
                                                             sext_i32_i64(num_threads_20420))) -
                                  (int64_t) 1, J_16779),
                           (sext_i32_i64(local_tid_20446) + (int64_t) 1) *
                           (segscan_group_sizze_18706 * sdiv_up64(N_16778 *
                                                                  J_16779,
                                                                  sext_i32_i64(num_threads_20420))) -
                           (int64_t) 1 - ((sext_i32_i64(squot32(local_tid_20446,
                                                                32) * 32 - 1) +
                                           (int64_t) 1) *
                                          (segscan_group_sizze_18706 *
                                           sdiv_up64(N_16778 * J_16779,
                                                     sext_i32_i64(num_threads_20420))) -
                                          (int64_t) 1));
                
                if (inactive_20461) {
                    x_18711 = x_18712;
                }
                if (!inactive_20461) {
                    double defunc_1_op_res_18713 = x_18711 + x_18712;
                    
                    x_18711 = defunc_1_op_res_18713;
                }
            }
            // write final result
            {
                ((__local
                  double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446)] =
                    x_18711;
            }
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // restore correct values for first block
    {
        if (squot32(local_tid_20446, 32) == 0) {
            ((__local
              double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446)] =
                x_18712;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // threads in bounds write scanned carries
    {
        if (slt64(gtid_18519, N_16778) && slt64(gtid_18527, J_16779)) {
            ((__global double *) mem_19774)[gtid_18519 * J_16779 + gtid_18527] =
                ((__local
                  double *) scan_arr_mem_20450)[sext_i32_i64(local_tid_20446)];
        }
    }
    
  error_0:
    return;
    #undef segscan_group_sizze_18706
}
__kernel void generate_dataziscan_stage3_18528(__global int *global_failure,
                                               int64_t N_16778, int64_t J_16779,
                                               int64_t num_groups_18707,
                                               int32_t num_threads_20420,
                                               int32_t required_groups_20462,
                                               __global
                                               unsigned char *mem_19774)
{
    #define segscan_group_sizze_18706 (generate_datazisegscan_group_sizze_18522)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20463;
    int32_t local_tid_20464;
    int64_t group_sizze_20467;
    int32_t wave_sizze_20466;
    int32_t group_tid_20465;
    
    global_tid_20463 = get_global_id(0);
    local_tid_20464 = get_local_id(0);
    group_sizze_20467 = get_local_size(0);
    wave_sizze_20466 = LOCKSTEP_WIDTH;
    group_tid_20465 = get_group_id(0);
    
    int32_t phys_tid_18528 = global_tid_20463;
    int32_t phys_group_id_20468;
    
    phys_group_id_20468 = get_group_id(0);
    for (int32_t i_20469 = 0; i_20469 < sdiv_up32(required_groups_20462 -
                                                  phys_group_id_20468,
                                                  sext_i64_i32(num_groups_18707));
         i_20469++) {
        int32_t virt_group_id_20470 = phys_group_id_20468 + i_20469 *
                sext_i64_i32(num_groups_18707);
        int64_t flat_idx_20471 = sext_i32_i64(virt_group_id_20470) *
                segscan_group_sizze_18706 + sext_i32_i64(local_tid_20464);
        int64_t gtid_18519 = squot64(flat_idx_20471, J_16779);
        int64_t gtid_18527 = flat_idx_20471 - squot64(flat_idx_20471, J_16779) *
                J_16779;
        int64_t orig_group_20472 = squot64(flat_idx_20471,
                                           segscan_group_sizze_18706 *
                                           sdiv_up64(N_16778 * J_16779,
                                                     sext_i32_i64(num_threads_20420)));
        int64_t carry_in_flat_idx_20473 = orig_group_20472 *
                (segscan_group_sizze_18706 * sdiv_up64(N_16778 * J_16779,
                                                       sext_i32_i64(num_threads_20420))) -
                (int64_t) 1;
        
        if (slt64(gtid_18519, N_16778) && slt64(gtid_18527, J_16779)) {
            if (!(orig_group_20472 == (int64_t) 0 || (flat_idx_20471 ==
                                                      (orig_group_20472 +
                                                       (int64_t) 1) *
                                                      (segscan_group_sizze_18706 *
                                                       sdiv_up64(N_16778 *
                                                                 J_16779,
                                                                 sext_i32_i64(num_threads_20420))) -
                                                      (int64_t) 1 ||
                                                      slt64(srem64(flat_idx_20471,
                                                                   J_16779),
                                                            flat_idx_20471 -
                                                            carry_in_flat_idx_20473)))) {
                double x_18711;
                double x_18712;
                
                x_18711 = ((__global
                            double *) mem_19774)[squot64(carry_in_flat_idx_20473,
                                                         J_16779) * J_16779 +
                                                 (carry_in_flat_idx_20473 -
                                                  squot64(carry_in_flat_idx_20473,
                                                          J_16779) * J_16779)];
                x_18712 = ((__global double *) mem_19774)[gtid_18519 * J_16779 +
                                                          gtid_18527];
                
                double defunc_1_op_res_18713 = x_18711 + x_18712;
                
                x_18711 = defunc_1_op_res_18713;
                ((__global double *) mem_19774)[gtid_18519 * J_16779 +
                                                gtid_18527] = x_18711;
            }
        }
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_0:
    return;
    #undef segscan_group_sizze_18706
}
__kernel void generate_datazisegmap_18027(__global int *global_failure,
                                          int64_t N_16778, int64_t J_16779,
                                          int64_t Kzz_16780, int64_t Kx_16781,
                                          int64_t defunc_2_reduce_res_17040,
                                          int64_t defunc_2_reduce_res_17041,
                                          int64_t num_groups_18161,
                                          int64_t num_threads_19907, __global
                                          unsigned char *mem_19419, __global
                                          unsigned char *mem_19433, __global
                                          unsigned char *mem_19436, __global
                                          unsigned char *mem_19515, __global
                                          unsigned char *mem_19518, __global
                                          unsigned char *mem_19521, __global
                                          unsigned char *color_19869, __global
                                          unsigned char *color_19870, __global
                                          unsigned char *color_19871)
{
    #define segmap_group_sizze_18160 (generate_datazisegmap_group_sizze_18029)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20069;
    int32_t local_tid_20070;
    int64_t group_sizze_20073;
    int32_t wave_sizze_20072;
    int32_t group_tid_20071;
    
    global_tid_20069 = get_global_id(0);
    local_tid_20070 = get_local_id(0);
    group_sizze_20073 = get_local_size(0);
    wave_sizze_20072 = LOCKSTEP_WIDTH;
    group_tid_20071 = get_group_id(0);
    
    int32_t phys_tid_18027 = global_tid_20069;
    int32_t phys_group_id_20074;
    
    phys_group_id_20074 = get_group_id(0);
    for (int32_t i_20075 = 0; i_20075 <
         sdiv_up32(sext_i64_i32(sdiv_up64(N_16778, segmap_group_sizze_18160)) -
                   phys_group_id_20074, sext_i64_i32(num_groups_18161));
         i_20075++) {
        int32_t virt_group_id_20076 = phys_group_id_20074 + i_20075 *
                sext_i64_i32(num_groups_18161);
        int64_t global_tid_20077 = sext_i32_i64(virt_group_id_20076) *
                segmap_group_sizze_18160 + sext_i32_i64(local_tid_20070);
        int64_t slice_20078 = N_16778;
        int64_t gtid_18026 = global_tid_20077;
        int64_t remnant_20079 = global_tid_20077 - gtid_18026;
        
        if (slt64(gtid_18026, N_16778)) {
            for (int64_t i_19336 = 0; i_19336 < Kzz_16780; i_19336++) {
                double defunc_2_reduce_res_18170;
                double redout_19338 = 0.0;
                
                for (int64_t i_19339 = 0; i_19339 < Kx_16781; i_19339++) {
                    double x_18174 = ((__global double *) mem_19436)[i_19339 *
                                                                     N_16778 +
                                                                     gtid_18026];
                    int64_t binop_x_19374 = Kzz_16780 * i_19339;
                    int64_t new_index_19375 = i_19336 + binop_x_19374;
                    double x_18175 = ((__global
                                       double *) mem_19433)[new_index_19375];
                    double defunc_1_f_res_18176 = x_18174 * x_18175;
                    double defunc_1_op_res_18173 = defunc_1_f_res_18176 +
                           redout_19338;
                    double redout_tmp_20081 = defunc_1_op_res_18173;
                    
                    redout_19338 = redout_tmp_20081;
                }
                defunc_2_reduce_res_18170 = redout_19338;
                ((__global double *) color_19870)[phys_tid_18027 + i_19336 *
                                                  num_threads_19907] =
                    defunc_2_reduce_res_18170;
            }
            
            double defunc_2_reduce_res_18177;
            double redout_19341 = -INFINITY;
            
            for (int64_t i_19343 = 0; i_19343 < J_16779; i_19343++) {
                double defunc_2_reduce_res_18183;
                double redout_19345 = 0.0;
                
                for (int64_t i_19346 = 0; i_19346 < Kzz_16780; i_19346++) {
                    double x_18187 = ((__global
                                       double *) color_19870)[phys_tid_18027 +
                                                              i_19346 *
                                                              num_threads_19907];
                    int64_t binop_x_19376 = J_16779 * i_19346;
                    int64_t new_index_19377 = i_19343 + binop_x_19376;
                    double x_18188 = ((__global
                                       double *) mem_19419)[new_index_19377];
                    double defunc_1_f_res_18189 = x_18187 * x_18188;
                    double defunc_1_op_res_18186 = defunc_1_f_res_18189 +
                           redout_19345;
                    double redout_tmp_20084 = defunc_1_op_res_18186;
                    
                    redout_19345 = redout_tmp_20084;
                }
                defunc_2_reduce_res_18183 = redout_19345;
                
                double defunc_1_op_res_18181 = fmax64(defunc_2_reduce_res_18183,
                                                      redout_19341);
                
                ((__global double *) color_19869)[phys_tid_18027 + i_19343 *
                                                  num_threads_19907] =
                    defunc_2_reduce_res_18183;
                
                double redout_tmp_20082 = defunc_1_op_res_18181;
                
                redout_19341 = redout_tmp_20082;
            }
            defunc_2_reduce_res_18177 = redout_19341;
            
            double defunc_2_reduce_res_18190;
            double redout_19348 = 0.0;
            
            for (int64_t i_19350 = 0; i_19350 < J_16779; i_19350++) {
                double x_18195 = ((__global
                                   double *) color_19869)[phys_tid_18027 +
                                                          i_19350 *
                                                          num_threads_19907];
                double defunc_0_f_res_18196 = x_18195 -
                       defunc_2_reduce_res_18177;
                double defunc_0_f_res_18197;
                
                defunc_0_f_res_18197 = futrts_exp64(defunc_0_f_res_18196);
                
                double defunc_1_op_res_18194 = defunc_0_f_res_18197 +
                       redout_19348;
                
                ((__global double *) color_19871)[phys_tid_18027 + i_19350 *
                                                  num_threads_19907] =
                    defunc_0_f_res_18197;
                
                double redout_tmp_20085 = defunc_1_op_res_18194;
                
                redout_19348 = redout_tmp_20085;
            }
            defunc_2_reduce_res_18190 = redout_19348;
            
            double discard_19360;
            double scanacc_19354 = 0.0;
            
            for (int64_t i_19357 = 0; i_19357 < J_16779; i_19357++) {
                double x_18203 = ((__global
                                   double *) color_19871)[phys_tid_18027 +
                                                          i_19357 *
                                                          num_threads_19907];
                double defunc_0_f_res_18204 = x_18203 /
                       defunc_2_reduce_res_18190;
                double defunc_1_op_res_18202 = defunc_0_f_res_18204 +
                       scanacc_19354;
                
                ((__global double *) color_19870)[phys_tid_18027 + i_19357 *
                                                  num_threads_19907] =
                    defunc_1_op_res_18202;
                ((__global double *) color_19869)[phys_tid_18027 + i_19357 *
                                                  num_threads_19907] =
                    defunc_0_f_res_18204;
                
                double scanacc_tmp_20087 = defunc_1_op_res_18202;
                
                scanacc_19354 = scanacc_tmp_20087;
            }
            discard_19360 = scanacc_19354;
            
            int64_t i64_arg_18205 = N_16778 ^ gtid_18026;
            int32_t i64_res_18206 = sext_i64_i32(i64_arg_18205);
            int32_t x_18207 = lshr32(i64_res_18206, 16);
            int32_t x_18208 = i64_res_18206 ^ x_18207;
            int32_t x_18209 = mul32(73244475, x_18208);
            int32_t x_18210 = lshr32(x_18209, 16);
            int32_t x_18211 = x_18209 ^ x_18210;
            int32_t x_18212 = mul32(73244475, x_18211);
            int32_t x_18213 = lshr32(x_18212, 16);
            int32_t x_18214 = x_18212 ^ x_18213;
            int32_t x_18215 = lshr32(x_18214, 16);
            int32_t x_18216 = x_18214 ^ x_18215;
            int32_t x_18217 = mul32(73244475, x_18216);
            int32_t x_18218 = lshr32(x_18217, 16);
            int32_t x_18219 = x_18217 ^ x_18218;
            int32_t x_18220 = mul32(73244475, x_18219);
            int32_t x_18221 = lshr32(x_18220, 16);
            int32_t x_18222 = x_18220 ^ x_18221;
            int64_t unsign_arg_18223 = zext_i32_i64(x_18222);
            int64_t rand_arg_18224 = (int64_t) 539527247 ^ unsign_arg_18223;
            int64_t y_18225 = shl64(rand_arg_18224, (int64_t) 23);
            int64_t x_18226 = rand_arg_18224 ^ y_18225;
            int64_t x_18227 = (int64_t) 824515495 ^ x_18226;
            int64_t y_18228 = lshr64(x_18226, (int64_t) 17);
            int64_t x_18229 = x_18227 ^ y_18228;
            int64_t new_y_18230 = (int64_t) 12 ^ x_18229;
            int64_t x_18231 = (int64_t) 6916537531571111 ^ new_y_18230;
            int64_t x_18232 = (int64_t) 52768993618 ^ x_18231;
            int64_t y_18233 = lshr64(new_y_18230, (int64_t) 26);
            int64_t new_y_18234 = x_18232 ^ y_18233;
            int64_t y_18235 = shl64(new_y_18230, (int64_t) 23);
            int64_t x_18236 = new_y_18230 ^ y_18235;
            int64_t x_18237 = new_y_18234 ^ x_18236;
            int64_t y_18238 = lshr64(x_18236, (int64_t) 17);
            int64_t x_18239 = x_18237 ^ y_18238;
            int64_t y_18240 = lshr64(new_y_18234, (int64_t) 26);
            int64_t new_y_18241 = x_18239 ^ y_18240;
            int64_t y_18242 = shl64(new_y_18234, (int64_t) 23);
            int64_t x_18243 = new_y_18234 ^ y_18242;
            int64_t x_18244 = new_y_18241 ^ x_18243;
            int64_t y_18245 = lshr64(x_18243, (int64_t) 17);
            int64_t x_18246 = x_18244 ^ y_18245;
            int64_t y_18247 = lshr64(new_y_18241, (int64_t) 26);
            int64_t new_y_18248 = x_18246 ^ y_18247;
            int64_t rand_arg_18249 = defunc_2_reduce_res_17040 ^ new_y_18241;
            int64_t rand_arg_18250 = defunc_2_reduce_res_17041 ^ new_y_18248;
            int64_t y_18251 = shl64(rand_arg_18249, (int64_t) 23);
            int64_t x_18252 = rand_arg_18249 ^ y_18251;
            int64_t x_18253 = rand_arg_18250 ^ x_18252;
            int64_t y_18254 = lshr64(x_18252, (int64_t) 17);
            int64_t x_18255 = x_18253 ^ y_18254;
            int64_t y_18256 = lshr64(rand_arg_18250, (int64_t) 26);
            int64_t new_y_18257 = x_18255 ^ y_18256;
            int64_t y_18258 = shl64(rand_arg_18250, (int64_t) 23);
            int64_t x_18259 = rand_arg_18250 ^ y_18258;
            int64_t x_18260 = new_y_18257 ^ x_18259;
            int64_t y_18261 = lshr64(x_18259, (int64_t) 17);
            int64_t x_18262 = x_18260 ^ y_18261;
            int64_t y_18263 = lshr64(new_y_18257, (int64_t) 26);
            int64_t new_y_18264 = x_18262 ^ y_18263;
            int64_t y_18265 = shl64(new_y_18257, (int64_t) 23);
            int64_t x_18266 = new_y_18257 ^ y_18265;
            int64_t x_18267 = new_y_18264 ^ x_18266;
            int64_t y_18268 = lshr64(x_18266, (int64_t) 17);
            int64_t x_18269 = x_18267 ^ y_18268;
            int64_t y_18270 = lshr64(new_y_18264, (int64_t) 26);
            int64_t new_y_18271 = x_18269 ^ y_18270;
            int64_t rand_res_18272 = add64(new_y_18264, new_y_18271);
            int64_t y_18273 = shl64(new_y_18264, (int64_t) 23);
            int64_t x_18274 = new_y_18264 ^ y_18273;
            int64_t x_18275 = new_y_18271 ^ x_18274;
            int64_t y_18276 = lshr64(x_18274, (int64_t) 17);
            int64_t x_18277 = x_18275 ^ y_18276;
            int64_t y_18278 = lshr64(new_y_18271, (int64_t) 26);
            int64_t new_y_18279 = x_18277 ^ y_18278;
            int64_t rand_res_18280 = add64(new_y_18271, new_y_18279);
            double u64_res_18281 = uitofp_i64_f64(rand_res_18272);
            double zs_res_18282 = u64_res_18281 / 1.8446744073709552e19;
            double u64_res_18283 = uitofp_i64_f64(rand_res_18280);
            double zs_res_18284 = u64_res_18283 / 1.8446744073709552e19;
            double log_res_18285;
            
            log_res_18285 = futrts_log64(zs_res_18282);
            
            double zt_res_18286 = -2.0 * log_res_18285;
            double sqrt_res_18287;
            
            sqrt_res_18287 = futrts_sqrt64(zt_res_18286);
            
            double zt_res_18288 = 6.283185307179586 * zs_res_18284;
            double cos_res_18289;
            
            cos_res_18289 = futrts_cos64(zt_res_18288);
            
            double zt_res_18290 = sqrt_res_18287 * cos_res_18289;
            
            ((__global double *) mem_19515)[gtid_18026] = zt_res_18290;
            for (int64_t i_20090 = 0; i_20090 < J_16779; i_20090++) {
                ((__global double *) mem_19518)[gtid_18026 + i_20090 *
                                                N_16778] = ((__global
                                                             double *) color_19870)[phys_tid_18027 +
                                                                                    i_20090 *
                                                                                    num_threads_19907];
            }
            for (int64_t i_20091 = 0; i_20091 < J_16779; i_20091++) {
                ((__global double *) mem_19521)[gtid_18026 + i_20091 *
                                                N_16778] = ((__global
                                                             double *) color_19869)[phys_tid_18027 +
                                                                                    i_20091 *
                                                                                    num_threads_19907];
            }
        }
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_0:
    return;
    #undef segmap_group_sizze_18160
}
__kernel void generate_datazisegmap_18425(__global int *global_failure,
                                          int64_t N_16778,
                                          int64_t defunc_2_reduce_res_17040,
                                          int64_t defunc_2_reduce_res_17041,
                                          __global unsigned char *mem_19782)
{
    #define segmap_group_sizze_18719 (generate_datazisegmap_group_sizze_18427)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20474;
    int32_t local_tid_20475;
    int64_t group_sizze_20478;
    int32_t wave_sizze_20477;
    int32_t group_tid_20476;
    
    global_tid_20474 = get_global_id(0);
    local_tid_20475 = get_local_id(0);
    group_sizze_20478 = get_local_size(0);
    wave_sizze_20477 = LOCKSTEP_WIDTH;
    group_tid_20476 = get_group_id(0);
    
    int32_t phys_tid_18425 = global_tid_20474;
    int64_t global_tid_20479 = sext_i32_i64(group_tid_20476) *
            segmap_group_sizze_18719 + sext_i32_i64(local_tid_20475);
    int64_t slice_20480 = N_16778;
    int64_t gtid_18424 = global_tid_20479;
    int64_t remnant_20481 = global_tid_20479 - gtid_18424;
    
    if (slt64(gtid_18424, N_16778)) {
        int64_t i64_arg_18723 = N_16778 ^ gtid_18424;
        int32_t i64_res_18724 = sext_i64_i32(i64_arg_18723);
        int32_t x_18725 = lshr32(i64_res_18724, 16);
        int32_t x_18726 = i64_res_18724 ^ x_18725;
        int32_t x_18727 = mul32(73244475, x_18726);
        int32_t x_18728 = lshr32(x_18727, 16);
        int32_t x_18729 = x_18727 ^ x_18728;
        int32_t x_18730 = mul32(73244475, x_18729);
        int32_t x_18731 = lshr32(x_18730, 16);
        int32_t x_18732 = x_18730 ^ x_18731;
        int32_t x_18733 = lshr32(x_18732, 16);
        int32_t x_18734 = x_18732 ^ x_18733;
        int32_t x_18735 = mul32(73244475, x_18734);
        int32_t x_18736 = lshr32(x_18735, 16);
        int32_t x_18737 = x_18735 ^ x_18736;
        int32_t x_18738 = mul32(73244475, x_18737);
        int32_t x_18739 = lshr32(x_18738, 16);
        int32_t x_18740 = x_18738 ^ x_18739;
        int64_t unsign_arg_18741 = zext_i32_i64(x_18740);
        int64_t rand_arg_18742 = (int64_t) 539527247 ^ unsign_arg_18741;
        int64_t y_18743 = shl64(rand_arg_18742, (int64_t) 23);
        int64_t x_18744 = rand_arg_18742 ^ y_18743;
        int64_t x_18745 = (int64_t) 824515495 ^ x_18744;
        int64_t y_18746 = lshr64(x_18744, (int64_t) 17);
        int64_t x_18747 = x_18745 ^ y_18746;
        int64_t new_y_18748 = (int64_t) 12 ^ x_18747;
        int64_t x_18749 = (int64_t) 6916537531571111 ^ new_y_18748;
        int64_t x_18750 = (int64_t) 52768993618 ^ x_18749;
        int64_t y_18751 = lshr64(new_y_18748, (int64_t) 26);
        int64_t new_y_18752 = x_18750 ^ y_18751;
        int64_t y_18753 = shl64(new_y_18748, (int64_t) 23);
        int64_t x_18754 = new_y_18748 ^ y_18753;
        int64_t x_18755 = new_y_18752 ^ x_18754;
        int64_t y_18756 = lshr64(x_18754, (int64_t) 17);
        int64_t x_18757 = x_18755 ^ y_18756;
        int64_t y_18758 = lshr64(new_y_18752, (int64_t) 26);
        int64_t new_y_18759 = x_18757 ^ y_18758;
        int64_t y_18760 = shl64(new_y_18752, (int64_t) 23);
        int64_t x_18761 = new_y_18752 ^ y_18760;
        int64_t x_18762 = new_y_18759 ^ x_18761;
        int64_t y_18763 = lshr64(x_18761, (int64_t) 17);
        int64_t x_18764 = x_18762 ^ y_18763;
        int64_t y_18765 = lshr64(new_y_18759, (int64_t) 26);
        int64_t new_y_18766 = x_18764 ^ y_18765;
        int64_t rand_arg_18767 = defunc_2_reduce_res_17040 ^ new_y_18759;
        int64_t rand_arg_18768 = defunc_2_reduce_res_17041 ^ new_y_18766;
        int64_t y_18769 = shl64(rand_arg_18767, (int64_t) 23);
        int64_t x_18770 = rand_arg_18767 ^ y_18769;
        int64_t x_18771 = rand_arg_18768 ^ x_18770;
        int64_t y_18772 = lshr64(x_18770, (int64_t) 17);
        int64_t x_18773 = x_18771 ^ y_18772;
        int64_t y_18774 = lshr64(rand_arg_18768, (int64_t) 26);
        int64_t new_y_18775 = x_18773 ^ y_18774;
        int64_t y_18776 = shl64(rand_arg_18768, (int64_t) 23);
        int64_t x_18777 = rand_arg_18768 ^ y_18776;
        int64_t x_18778 = new_y_18775 ^ x_18777;
        int64_t y_18779 = lshr64(x_18777, (int64_t) 17);
        int64_t x_18780 = x_18778 ^ y_18779;
        int64_t y_18781 = lshr64(new_y_18775, (int64_t) 26);
        int64_t new_y_18782 = x_18780 ^ y_18781;
        int64_t y_18783 = shl64(new_y_18775, (int64_t) 23);
        int64_t x_18784 = new_y_18775 ^ y_18783;
        int64_t x_18785 = new_y_18782 ^ x_18784;
        int64_t y_18786 = lshr64(x_18784, (int64_t) 17);
        int64_t x_18787 = x_18785 ^ y_18786;
        int64_t y_18788 = lshr64(new_y_18782, (int64_t) 26);
        int64_t new_y_18789 = x_18787 ^ y_18788;
        int64_t rand_res_18790 = add64(new_y_18782, new_y_18789);
        int64_t y_18791 = shl64(new_y_18782, (int64_t) 23);
        int64_t x_18792 = new_y_18782 ^ y_18791;
        int64_t x_18793 = new_y_18789 ^ x_18792;
        int64_t y_18794 = lshr64(x_18792, (int64_t) 17);
        int64_t x_18795 = x_18793 ^ y_18794;
        int64_t y_18796 = lshr64(new_y_18789, (int64_t) 26);
        int64_t new_y_18797 = x_18795 ^ y_18796;
        int64_t rand_res_18798 = add64(new_y_18789, new_y_18797);
        double u64_res_18799 = uitofp_i64_f64(rand_res_18790);
        double zs_res_18800 = u64_res_18799 / 1.8446744073709552e19;
        double u64_res_18801 = uitofp_i64_f64(rand_res_18798);
        double zs_res_18802 = u64_res_18801 / 1.8446744073709552e19;
        double log_res_18803;
        
        log_res_18803 = futrts_log64(zs_res_18800);
        
        double zt_res_18804 = -2.0 * log_res_18803;
        double sqrt_res_18805;
        
        sqrt_res_18805 = futrts_sqrt64(zt_res_18804);
        
        double zt_res_18806 = 6.283185307179586 * zs_res_18802;
        double cos_res_18807;
        
        cos_res_18807 = futrts_cos64(zt_res_18806);
        
        double zt_res_18808 = sqrt_res_18805 * cos_res_18807;
        
        ((__global double *) mem_19782)[gtid_18424] = zt_res_18808;
    }
    
  error_0:
    return;
    #undef segmap_group_sizze_18719
}
__kernel void generate_datazisegmap_18816(__global int *global_failure,
                                          int64_t N_16778, int64_t J_16779,
                                          int64_t j_17316,
                                          int64_t replicate_arg_17322, __global
                                          unsigned char *ext_mem_19797, __global
                                          unsigned char *ext_mem_19798, __global
                                          unsigned char *mem_19801)
{
    #define segmap_group_sizze_18819 (generate_datazisegmap_group_sizze_18818)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20497;
    int32_t local_tid_20498;
    int64_t group_sizze_20501;
    int32_t wave_sizze_20500;
    int32_t group_tid_20499;
    
    global_tid_20497 = get_global_id(0);
    local_tid_20498 = get_local_id(0);
    group_sizze_20501 = get_local_size(0);
    wave_sizze_20500 = LOCKSTEP_WIDTH;
    group_tid_20499 = get_group_id(0);
    
    int32_t phys_tid_18816 = global_tid_20497;
    int64_t global_tid_20502 = sext_i32_i64(group_tid_20499) *
            segmap_group_sizze_18819 + sext_i32_i64(local_tid_20498);
    int64_t slice_20503 = N_16778;
    int64_t write_i_18815 = global_tid_20502;
    int64_t remnant_20504 = global_tid_20502 - write_i_18815;
    
    if (slt64(write_i_18815, N_16778)) {
        double x_17325 = ((__global double *) ext_mem_19798)[write_i_18815];
        double x_17326 = ((__global double *) ext_mem_19797)[write_i_18815 *
                                                             J_16779 + j_17316];
        bool cond_17327 = x_17326 < x_17325;
        int64_t defunc_2_f_res_17328;
        
        if (cond_17327) {
            defunc_2_f_res_17328 = write_i_18815;
        } else {
            defunc_2_f_res_17328 = (int64_t) -1;
        }
        if (sle64((int64_t) 0, defunc_2_f_res_17328) &&
            slt64(defunc_2_f_res_17328, N_16778)) {
            ((__global int64_t *) mem_19801)[defunc_2_f_res_17328] =
                replicate_arg_17322;
        }
    }
    
  error_0:
    return;
    #undef segmap_group_sizze_18819
}
__kernel void generate_datazisegmap_intragroup_18023(__global
                                                     int *global_failure,
                                                     __local volatile
                                                     int64_t *red_arr_mem_20127_backing_aligned_0,
                                                     __local volatile
                                                     int64_t *red_arr_mem_20122_backing_aligned_1,
                                                     __local volatile
                                                     int64_t *red_arr_mem_20108_backing_aligned_2,
                                                     __local volatile
                                                     int64_t *color_19875_backing_aligned_3,
                                                     __local volatile
                                                     int64_t *color_19874_backing_aligned_4,
                                                     __local volatile
                                                     int64_t *color_19873_backing_aligned_5,
                                                     int64_t N_16778,
                                                     int64_t J_16779,
                                                     int64_t Kzz_16780,
                                                     int64_t Kx_16781,
                                                     int64_t defunc_2_reduce_res_17040,
                                                     int64_t defunc_2_reduce_res_17041,
                                                     int64_t computed_group_sizze_18002,
                                                     __global
                                                     unsigned char *mem_19397,
                                                     __global
                                                     unsigned char *mem_19419,
                                                     __global
                                                     unsigned char *mem_19433,
                                                     __global
                                                     unsigned char *mem_19544,
                                                     __global
                                                     unsigned char *mem_19548,
                                                     __global
                                                     unsigned char *mem_19552)
{
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20127_backing_5 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20127_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_20122_backing_4 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20122_backing_aligned_1;
    __local volatile unsigned char *restrict red_arr_mem_20108_backing_3 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20108_backing_aligned_2;
    __local volatile unsigned char *restrict color_19875_backing_2 =
                                   (__local volatile
                                    unsigned char *) color_19875_backing_aligned_3;
    __local volatile unsigned char *restrict color_19874_backing_1 =
                                   (__local volatile
                                    unsigned char *) color_19874_backing_aligned_4;
    __local volatile unsigned char *restrict color_19873_backing_0 =
                                   (__local volatile
                                    unsigned char *) color_19873_backing_aligned_5;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20092;
    int32_t local_tid_20093;
    int64_t group_sizze_20096;
    int32_t wave_sizze_20095;
    int32_t group_tid_20094;
    
    global_tid_20092 = get_global_id(0);
    local_tid_20093 = get_local_id(0);
    group_sizze_20096 = get_local_size(0);
    wave_sizze_20095 = LOCKSTEP_WIDTH;
    group_tid_20094 = get_group_id(0);
    
    int32_t phys_tid_18023 = group_tid_20094;
    int64_t slice_20098 = J_16779;
    int64_t ltid_pre_20097 = sext_i32_i64(local_tid_20093);
    int64_t remnant_20099 = sext_i32_i64(local_tid_20093) - ltid_pre_20097;
    int64_t slice_20102 = Kx_16781;
    int64_t slice_20103 = Kzz_16780 * slice_20102;
    int64_t ltid_pre_20100 = squot64(sext_i32_i64(local_tid_20093),
                                     slice_20102);
    int64_t remnant_20104 = sext_i32_i64(local_tid_20093) - ltid_pre_20100 *
            slice_20102;
    int64_t ltid_pre_20101 = remnant_20104;
    int64_t remnant_20105 = remnant_20104 - ltid_pre_20101;
    int64_t slice_20106 = N_16778;
    int64_t gtid_18000 = sext_i32_i64(group_tid_20094);
    int64_t remnant_20107 = sext_i32_i64(group_tid_20094) - gtid_18000;
    __local unsigned char *color_19873;
    
    color_19873 = (__local unsigned char *) color_19873_backing_0;
    
    __local unsigned char *color_19874;
    
    color_19874 = (__local unsigned char *) color_19874_backing_1;
    
    __local unsigned char *color_19875;
    
    color_19875 = (__local unsigned char *) color_19875_backing_2;
    
    int64_t gtid_18003 = sext_i32_i64(sext_i64_i32(ltid_pre_20100));
    int64_t gtid_18004 = sext_i32_i64(sext_i64_i32(ltid_pre_20101));
    int32_t phys_tid_18005 = local_tid_20093;
    __local unsigned char *red_arr_mem_20108;
    
    red_arr_mem_20108 = (__local unsigned char *) red_arr_mem_20108_backing_3;
    if (slt64(gtid_18003, Kzz_16780) && slt64(gtid_18004, Kx_16781)) {
        double x_18307 = ((__global double *) mem_19397)[gtid_18000 * Kx_16781 +
                                                         gtid_18004];
        int64_t binop_x_18836 = Kzz_16780 * gtid_18004;
        int64_t new_index_18837 = gtid_18003 + binop_x_18836;
        double x_18308 = ((__global double *) mem_19433)[new_index_18837];
        double defunc_1_f_res_18309 = x_18307 * x_18308;
        
        ((__local double *) red_arr_mem_20108)[gtid_18003 * Kx_16781 +
                                               gtid_18004] =
            defunc_1_f_res_18309;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int64_t dims_flat_20110 = Kzz_16780 * Kx_16781;
    double x_18303;
    double x_18304;
    double x_20112;
    double x_20113;
    bool ltid_in_bounds_20115 = slt64(sext_i32_i64(local_tid_20093), Kzz_16780 *
                                      Kx_16781);
    int32_t skip_threads_20116;
    
    // read input for in-block scan
    {
        if (ltid_in_bounds_20115) {
            x_18304 = ((volatile __local
                        double *) red_arr_mem_20108)[sext_i32_i64(local_tid_20093)];
            if ((local_tid_20093 - squot32(local_tid_20093, 32) * 32) == 0) {
                x_18303 = x_18304;
            }
        }
    }
    // in-block scan (hopefully no barriers needed)
    {
        skip_threads_20116 = 1;
        while (slt32(skip_threads_20116, 32)) {
            if (sle32(skip_threads_20116, local_tid_20093 -
                      squot32(local_tid_20093, 32) * 32) &&
                ltid_in_bounds_20115) {
                // read operands
                {
                    x_18303 = ((volatile __local
                                double *) red_arr_mem_20108)[sext_i32_i64(local_tid_20093) -
                                                             sext_i32_i64(skip_threads_20116)];
                }
                // perform operation
                {
                    bool inactive_20117 =
                         slt64(srem64(sext_i32_i64(local_tid_20093), Kx_16781),
                               sext_i32_i64(local_tid_20093) -
                               sext_i32_i64(local_tid_20093 -
                               skip_threads_20116));
                    
                    if (inactive_20117) {
                        x_18303 = x_18304;
                    }
                    if (!inactive_20117) {
                        double defunc_1_op_res_18305 = x_18303 + x_18304;
                        
                        x_18303 = defunc_1_op_res_18305;
                    }
                }
            }
            if (sle32(wave_sizze_20095, skip_threads_20116)) {
                barrier(CLK_LOCAL_MEM_FENCE);
            }
            if (sle32(skip_threads_20116, local_tid_20093 -
                      squot32(local_tid_20093, 32) * 32) &&
                ltid_in_bounds_20115) {
                // write result
                {
                    ((volatile __local
                      double *) red_arr_mem_20108)[sext_i32_i64(local_tid_20093)] =
                        x_18303;
                    x_18304 = x_18303;
                }
            }
            if (sle32(wave_sizze_20095, skip_threads_20116)) {
                barrier(CLK_LOCAL_MEM_FENCE);
            }
            skip_threads_20116 *= 2;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // last thread of block 'i' writes its result to offset 'i'
    {
        if ((local_tid_20093 - squot32(local_tid_20093, 32) * 32) == 31 &&
            ltid_in_bounds_20115) {
            ((volatile __local
              double *) red_arr_mem_20108)[sext_i32_i64(squot32(local_tid_20093,
                                                                32))] = x_18303;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
    {
        int32_t skip_threads_20118;
        
        // read input for in-block scan
        {
            if (squot32(local_tid_20093, 32) == 0 && ltid_in_bounds_20115) {
                x_20113 = ((volatile __local
                            double *) red_arr_mem_20108)[sext_i32_i64(local_tid_20093)];
                if ((local_tid_20093 - squot32(local_tid_20093, 32) * 32) ==
                    0) {
                    x_20112 = x_20113;
                }
            }
        }
        // in-block scan (hopefully no barriers needed)
        {
            skip_threads_20118 = 1;
            while (slt32(skip_threads_20118, 32)) {
                if (sle32(skip_threads_20118, local_tid_20093 -
                          squot32(local_tid_20093, 32) * 32) &&
                    (squot32(local_tid_20093, 32) == 0 &&
                     ltid_in_bounds_20115)) {
                    // read operands
                    {
                        x_20112 = ((volatile __local
                                    double *) red_arr_mem_20108)[sext_i32_i64(local_tid_20093) -
                                                                 sext_i32_i64(skip_threads_20118)];
                    }
                    // perform operation
                    {
                        bool inactive_20119 =
                             slt64(srem64(sext_i32_i64(local_tid_20093 * 32 +
                                          32 - 1), Kx_16781),
                                   sext_i32_i64(local_tid_20093 * 32 + 32 - 1) -
                                   sext_i32_i64((local_tid_20093 -
                                                 skip_threads_20118) * 32 + 32 -
                                   1));
                        
                        if (inactive_20119) {
                            x_20112 = x_20113;
                        }
                        if (!inactive_20119) {
                            double defunc_1_op_res_20114 = x_20112 + x_20113;
                            
                            x_20112 = defunc_1_op_res_20114;
                        }
                    }
                }
                if (sle32(wave_sizze_20095, skip_threads_20118)) {
                    barrier(CLK_LOCAL_MEM_FENCE);
                }
                if (sle32(skip_threads_20118, local_tid_20093 -
                          squot32(local_tid_20093, 32) * 32) &&
                    (squot32(local_tid_20093, 32) == 0 &&
                     ltid_in_bounds_20115)) {
                    // write result
                    {
                        ((volatile __local
                          double *) red_arr_mem_20108)[sext_i32_i64(local_tid_20093)] =
                            x_20112;
                        x_20113 = x_20112;
                    }
                }
                if (sle32(wave_sizze_20095, skip_threads_20118)) {
                    barrier(CLK_LOCAL_MEM_FENCE);
                }
                skip_threads_20118 *= 2;
            }
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // carry-in for every block except the first
    {
        if (!(squot32(local_tid_20093, 32) == 0 || !ltid_in_bounds_20115)) {
            // read operands
            {
                x_18304 = x_18303;
                x_18303 = ((__local
                            double *) red_arr_mem_20108)[sext_i32_i64(squot32(local_tid_20093,
                                                                              32)) -
                                                         (int64_t) 1];
            }
            // perform operation
            {
                bool inactive_20120 =
                     slt64(srem64(sext_i32_i64(local_tid_20093), Kx_16781),
                           sext_i32_i64(local_tid_20093) -
                           sext_i32_i64(squot32(local_tid_20093, 32) * 32 - 1));
                
                if (inactive_20120) {
                    x_18303 = x_18304;
                }
                if (!inactive_20120) {
                    double defunc_1_op_res_18305 = x_18303 + x_18304;
                    
                    x_18303 = defunc_1_op_res_18305;
                }
            }
            // write final result
            {
                ((__local
                  double *) red_arr_mem_20108)[sext_i32_i64(local_tid_20093)] =
                    x_18303;
            }
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // restore correct values for first block
    {
        if (squot32(local_tid_20093, 32) == 0) {
            ((__local
              double *) red_arr_mem_20108)[sext_i32_i64(local_tid_20093)] =
                x_18304;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    barrier(CLK_LOCAL_MEM_FENCE);
    for (int64_t i_20121 = 0; i_20121 < sdiv_up64(Kzz_16780 -
                                                  sext_i32_i64(local_tid_20093),
                                                  computed_group_sizze_18002);
         i_20121++) {
        ((__local double *) color_19874)[i_20121 * computed_group_sizze_18002 +
                                         sext_i32_i64(local_tid_20093)] =
            ((__local double *) red_arr_mem_20108)[Kx_16781 - (int64_t) 1 +
                                                   (i_20121 *
                                                    computed_group_sizze_18002 +
                                                    sext_i32_i64(local_tid_20093)) *
                                                   Kx_16781];
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    barrier(CLK_LOCAL_MEM_FENCE);
    
    double defunc_2_reduce_res_18310;
    int64_t gtid_18013 = sext_i32_i64(sext_i64_i32(ltid_pre_20097));
    int32_t phys_tid_18014 = local_tid_20093;
    __local unsigned char *red_arr_mem_20122;
    
    red_arr_mem_20122 = (__local unsigned char *) red_arr_mem_20122_backing_4;
    if (slt64(gtid_18013, J_16779)) {
        double defunc_2_reduce_res_18316;
        double redout_19361 = 0.0;
        
        for (int64_t i_19362 = 0; i_19362 < Kzz_16780; i_19362++) {
            double x_18320 = ((__local double *) color_19874)[i_19362];
            int64_t binop_x_19378 = J_16779 * i_19362;
            int64_t new_index_19379 = gtid_18013 + binop_x_19378;
            double x_18321 = ((__global double *) mem_19419)[new_index_19379];
            double defunc_1_f_res_18322 = x_18320 * x_18321;
            double defunc_1_op_res_18319 = defunc_1_f_res_18322 + redout_19361;
            double redout_tmp_20124 = defunc_1_op_res_18319;
            
            redout_19361 = redout_tmp_20124;
        }
        defunc_2_reduce_res_18316 = redout_19361;
        ((__local double *) red_arr_mem_20122)[gtid_18013] =
            defunc_2_reduce_res_18316;
        ((__local double *) color_19873)[gtid_18013] =
            defunc_2_reduce_res_18316;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t offset_20125;
    int32_t skip_waves_20126 = 1;
    double x_18312;
    double x_18313;
    
    offset_20125 = 0;
    // participating threads read initial accumulator
    {
        if (slt32(local_tid_20093, sext_i64_i32(J_16779))) {
            x_18312 = ((__local
                        double *) red_arr_mem_20122)[sext_i32_i64(local_tid_20093 +
                                                     offset_20125)];
        }
    }
    offset_20125 = 1;
    while (slt32(offset_20125, wave_sizze_20095)) {
        if (slt32(local_tid_20093 + offset_20125, sext_i64_i32(J_16779)) &&
            ((local_tid_20093 - squot32(local_tid_20093, wave_sizze_20095) *
              wave_sizze_20095) & (2 * offset_20125 - 1)) == 0) {
            // read array element
            {
                x_18313 = ((volatile __local
                            double *) red_arr_mem_20122)[sext_i32_i64(local_tid_20093 +
                                                         offset_20125)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_18314 = fmax64(x_18312, x_18313);
                
                x_18312 = defunc_1_op_res_18314;
            }
            // write result of operation
            {
                ((volatile __local
                  double *) red_arr_mem_20122)[sext_i32_i64(local_tid_20093)] =
                    x_18312;
            }
        }
        offset_20125 *= 2;
    }
    while (slt32(skip_waves_20126,
                 squot32(sext_i64_i32(computed_group_sizze_18002) +
                         wave_sizze_20095 - 1, wave_sizze_20095))) {
        barrier(CLK_LOCAL_MEM_FENCE);
        offset_20125 = skip_waves_20126 * wave_sizze_20095;
        if (slt32(local_tid_20093 + offset_20125, sext_i64_i32(J_16779)) &&
            ((local_tid_20093 - squot32(local_tid_20093, wave_sizze_20095) *
              wave_sizze_20095) == 0 && (squot32(local_tid_20093,
                                                 wave_sizze_20095) & (2 *
                                                                      skip_waves_20126 -
                                                                      1)) ==
             0)) {
            // read array element
            {
                x_18313 = ((__local
                            double *) red_arr_mem_20122)[sext_i32_i64(local_tid_20093 +
                                                         offset_20125)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_18314 = fmax64(x_18312, x_18313);
                
                x_18312 = defunc_1_op_res_18314;
            }
            // write result of operation
            {
                ((__local
                  double *) red_arr_mem_20122)[sext_i32_i64(local_tid_20093)] =
                    x_18312;
            }
        }
        skip_waves_20126 *= 2;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    defunc_2_reduce_res_18310 = ((__local
                                  double *) red_arr_mem_20122)[(int64_t) 0];
    
    double defunc_2_reduce_res_18323;
    int64_t gtid_18015 = sext_i32_i64(sext_i64_i32(ltid_pre_20097));
    int32_t phys_tid_18016 = local_tid_20093;
    __local unsigned char *red_arr_mem_20127;
    
    red_arr_mem_20127 = (__local unsigned char *) red_arr_mem_20127_backing_5;
    if (slt64(gtid_18015, J_16779)) {
        double x_18328 = ((__local double *) color_19873)[gtid_18015];
        double defunc_0_f_res_18329 = x_18328 - defunc_2_reduce_res_18310;
        double defunc_0_f_res_18330;
        
        defunc_0_f_res_18330 = futrts_exp64(defunc_0_f_res_18329);
        ((__local double *) red_arr_mem_20127)[gtid_18015] =
            defunc_0_f_res_18330;
        ((__local double *) color_19875)[gtid_18015] = defunc_0_f_res_18330;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t offset_20129;
    int32_t skip_waves_20130 = 1;
    double x_18325;
    double x_18326;
    
    offset_20129 = 0;
    // participating threads read initial accumulator
    {
        if (slt32(local_tid_20093, sext_i64_i32(J_16779))) {
            x_18325 = ((__local
                        double *) red_arr_mem_20127)[sext_i32_i64(local_tid_20093 +
                                                     offset_20129)];
        }
    }
    offset_20129 = 1;
    while (slt32(offset_20129, wave_sizze_20095)) {
        if (slt32(local_tid_20093 + offset_20129, sext_i64_i32(J_16779)) &&
            ((local_tid_20093 - squot32(local_tid_20093, wave_sizze_20095) *
              wave_sizze_20095) & (2 * offset_20129 - 1)) == 0) {
            // read array element
            {
                x_18326 = ((volatile __local
                            double *) red_arr_mem_20127)[sext_i32_i64(local_tid_20093 +
                                                         offset_20129)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_18327 = x_18325 + x_18326;
                
                x_18325 = defunc_1_op_res_18327;
            }
            // write result of operation
            {
                ((volatile __local
                  double *) red_arr_mem_20127)[sext_i32_i64(local_tid_20093)] =
                    x_18325;
            }
        }
        offset_20129 *= 2;
    }
    while (slt32(skip_waves_20130,
                 squot32(sext_i64_i32(computed_group_sizze_18002) +
                         wave_sizze_20095 - 1, wave_sizze_20095))) {
        barrier(CLK_LOCAL_MEM_FENCE);
        offset_20129 = skip_waves_20130 * wave_sizze_20095;
        if (slt32(local_tid_20093 + offset_20129, sext_i64_i32(J_16779)) &&
            ((local_tid_20093 - squot32(local_tid_20093, wave_sizze_20095) *
              wave_sizze_20095) == 0 && (squot32(local_tid_20093,
                                                 wave_sizze_20095) & (2 *
                                                                      skip_waves_20130 -
                                                                      1)) ==
             0)) {
            // read array element
            {
                x_18326 = ((__local
                            double *) red_arr_mem_20127)[sext_i32_i64(local_tid_20093 +
                                                         offset_20129)];
            }
            // apply reduction operation
            {
                double defunc_1_op_res_18327 = x_18325 + x_18326;
                
                x_18325 = defunc_1_op_res_18327;
            }
            // write result of operation
            {
                ((__local
                  double *) red_arr_mem_20127)[sext_i32_i64(local_tid_20093)] =
                    x_18325;
            }
        }
        skip_waves_20130 *= 2;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    defunc_2_reduce_res_18323 = ((__local
                                  double *) red_arr_mem_20127)[(int64_t) 0];
    
    int64_t gtid_18017 = sext_i32_i64(sext_i64_i32(ltid_pre_20097));
    int32_t phys_tid_18018 = local_tid_20093;
    
    if (slt64(gtid_18017, J_16779)) {
        double x_18336 = ((__local double *) color_19875)[gtid_18017];
        double defunc_0_f_res_18337 = x_18336 / defunc_2_reduce_res_18323;
        
        ((__local double *) color_19874)[gtid_18017] = defunc_0_f_res_18337;
        ((__local double *) color_19873)[gtid_18017] = defunc_0_f_res_18337;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int64_t dims_flat_20131 = J_16779;
    double x_18333;
    double x_18334;
    double x_20133;
    double x_20134;
    bool ltid_in_bounds_20136 = slt64(sext_i32_i64(local_tid_20093), J_16779);
    int32_t skip_threads_20137;
    
    // read input for in-block scan
    {
        if (ltid_in_bounds_20136) {
            x_18334 = ((volatile __local
                        double *) color_19874)[sext_i32_i64(local_tid_20093)];
            if ((local_tid_20093 - squot32(local_tid_20093, 32) * 32) == 0) {
                x_18333 = x_18334;
            }
        }
    }
    // in-block scan (hopefully no barriers needed)
    {
        skip_threads_20137 = 1;
        while (slt32(skip_threads_20137, 32)) {
            if (sle32(skip_threads_20137, local_tid_20093 -
                      squot32(local_tid_20093, 32) * 32) &&
                ltid_in_bounds_20136) {
                // read operands
                {
                    x_18333 = ((volatile __local
                                double *) color_19874)[sext_i32_i64(local_tid_20093) -
                                                       sext_i32_i64(skip_threads_20137)];
                }
                // perform operation
                {
                    bool inactive_20138 =
                         slt64(srem64(sext_i32_i64(local_tid_20093), J_16779),
                               sext_i32_i64(local_tid_20093) -
                               sext_i32_i64(local_tid_20093 -
                               skip_threads_20137));
                    
                    if (inactive_20138) {
                        x_18333 = x_18334;
                    }
                    if (!inactive_20138) {
                        double defunc_1_op_res_18335 = x_18333 + x_18334;
                        
                        x_18333 = defunc_1_op_res_18335;
                    }
                }
            }
            if (sle32(wave_sizze_20095, skip_threads_20137)) {
                barrier(CLK_LOCAL_MEM_FENCE);
            }
            if (sle32(skip_threads_20137, local_tid_20093 -
                      squot32(local_tid_20093, 32) * 32) &&
                ltid_in_bounds_20136) {
                // write result
                {
                    ((volatile __local
                      double *) color_19874)[sext_i32_i64(local_tid_20093)] =
                        x_18333;
                    x_18334 = x_18333;
                }
            }
            if (sle32(wave_sizze_20095, skip_threads_20137)) {
                barrier(CLK_LOCAL_MEM_FENCE);
            }
            skip_threads_20137 *= 2;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // last thread of block 'i' writes its result to offset 'i'
    {
        if ((local_tid_20093 - squot32(local_tid_20093, 32) * 32) == 31 &&
            ltid_in_bounds_20136) {
            ((volatile __local
              double *) color_19874)[sext_i32_i64(squot32(local_tid_20093,
                                                          32))] = x_18333;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
    {
        int32_t skip_threads_20139;
        
        // read input for in-block scan
        {
            if (squot32(local_tid_20093, 32) == 0 && ltid_in_bounds_20136) {
                x_20134 = ((volatile __local
                            double *) color_19874)[sext_i32_i64(local_tid_20093)];
                if ((local_tid_20093 - squot32(local_tid_20093, 32) * 32) ==
                    0) {
                    x_20133 = x_20134;
                }
            }
        }
        // in-block scan (hopefully no barriers needed)
        {
            skip_threads_20139 = 1;
            while (slt32(skip_threads_20139, 32)) {
                if (sle32(skip_threads_20139, local_tid_20093 -
                          squot32(local_tid_20093, 32) * 32) &&
                    (squot32(local_tid_20093, 32) == 0 &&
                     ltid_in_bounds_20136)) {
                    // read operands
                    {
                        x_20133 = ((volatile __local
                                    double *) color_19874)[sext_i32_i64(local_tid_20093) -
                                                           sext_i32_i64(skip_threads_20139)];
                    }
                    // perform operation
                    {
                        bool inactive_20140 =
                             slt64(srem64(sext_i32_i64(local_tid_20093 * 32 +
                                          32 - 1), J_16779),
                                   sext_i32_i64(local_tid_20093 * 32 + 32 - 1) -
                                   sext_i32_i64((local_tid_20093 -
                                                 skip_threads_20139) * 32 + 32 -
                                   1));
                        
                        if (inactive_20140) {
                            x_20133 = x_20134;
                        }
                        if (!inactive_20140) {
                            double defunc_1_op_res_20135 = x_20133 + x_20134;
                            
                            x_20133 = defunc_1_op_res_20135;
                        }
                    }
                }
                if (sle32(wave_sizze_20095, skip_threads_20139)) {
                    barrier(CLK_LOCAL_MEM_FENCE);
                }
                if (sle32(skip_threads_20139, local_tid_20093 -
                          squot32(local_tid_20093, 32) * 32) &&
                    (squot32(local_tid_20093, 32) == 0 &&
                     ltid_in_bounds_20136)) {
                    // write result
                    {
                        ((volatile __local
                          double *) color_19874)[sext_i32_i64(local_tid_20093)] =
                            x_20133;
                        x_20134 = x_20133;
                    }
                }
                if (sle32(wave_sizze_20095, skip_threads_20139)) {
                    barrier(CLK_LOCAL_MEM_FENCE);
                }
                skip_threads_20139 *= 2;
            }
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // carry-in for every block except the first
    {
        if (!(squot32(local_tid_20093, 32) == 0 || !ltid_in_bounds_20136)) {
            // read operands
            {
                x_18334 = x_18333;
                x_18333 = ((__local
                            double *) color_19874)[sext_i32_i64(squot32(local_tid_20093,
                                                                        32)) -
                                                   (int64_t) 1];
            }
            // perform operation
            {
                bool inactive_20141 =
                     slt64(srem64(sext_i32_i64(local_tid_20093), J_16779),
                           sext_i32_i64(local_tid_20093) -
                           sext_i32_i64(squot32(local_tid_20093, 32) * 32 - 1));
                
                if (inactive_20141) {
                    x_18333 = x_18334;
                }
                if (!inactive_20141) {
                    double defunc_1_op_res_18335 = x_18333 + x_18334;
                    
                    x_18333 = defunc_1_op_res_18335;
                }
            }
            // write final result
            {
                ((__local
                  double *) color_19874)[sext_i32_i64(local_tid_20093)] =
                    x_18333;
            }
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // restore correct values for first block
    {
        if (squot32(local_tid_20093, 32) == 0) {
            ((__local double *) color_19874)[sext_i32_i64(local_tid_20093)] =
                x_18334;
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int64_t i64_arg_18338 = N_16778 ^ gtid_18000;
    int32_t i64_res_18339 = sext_i64_i32(i64_arg_18338);
    int32_t x_18340 = lshr32(i64_res_18339, 16);
    int32_t x_18341 = i64_res_18339 ^ x_18340;
    int32_t x_18342 = mul32(73244475, x_18341);
    int32_t x_18343 = lshr32(x_18342, 16);
    int32_t x_18344 = x_18342 ^ x_18343;
    int32_t x_18345 = mul32(73244475, x_18344);
    int32_t x_18346 = lshr32(x_18345, 16);
    int32_t x_18347 = x_18345 ^ x_18346;
    int32_t x_18348 = lshr32(x_18347, 16);
    int32_t x_18349 = x_18347 ^ x_18348;
    int32_t x_18350 = mul32(73244475, x_18349);
    int32_t x_18351 = lshr32(x_18350, 16);
    int32_t x_18352 = x_18350 ^ x_18351;
    int32_t x_18353 = mul32(73244475, x_18352);
    int32_t x_18354 = lshr32(x_18353, 16);
    int32_t x_18355 = x_18353 ^ x_18354;
    int64_t unsign_arg_18356 = zext_i32_i64(x_18355);
    int64_t rand_arg_18357 = (int64_t) 539527247 ^ unsign_arg_18356;
    int64_t y_18358 = shl64(rand_arg_18357, (int64_t) 23);
    int64_t x_18359 = rand_arg_18357 ^ y_18358;
    int64_t x_18360 = (int64_t) 824515495 ^ x_18359;
    int64_t y_18361 = lshr64(x_18359, (int64_t) 17);
    int64_t x_18362 = x_18360 ^ y_18361;
    int64_t new_y_18363 = (int64_t) 12 ^ x_18362;
    int64_t x_18364 = (int64_t) 6916537531571111 ^ new_y_18363;
    int64_t x_18365 = (int64_t) 52768993618 ^ x_18364;
    int64_t y_18366 = lshr64(new_y_18363, (int64_t) 26);
    int64_t new_y_18367 = x_18365 ^ y_18366;
    int64_t y_18368 = shl64(new_y_18363, (int64_t) 23);
    int64_t x_18369 = new_y_18363 ^ y_18368;
    int64_t x_18370 = new_y_18367 ^ x_18369;
    int64_t y_18371 = lshr64(x_18369, (int64_t) 17);
    int64_t x_18372 = x_18370 ^ y_18371;
    int64_t y_18373 = lshr64(new_y_18367, (int64_t) 26);
    int64_t new_y_18374 = x_18372 ^ y_18373;
    int64_t y_18375 = shl64(new_y_18367, (int64_t) 23);
    int64_t x_18376 = new_y_18367 ^ y_18375;
    int64_t x_18377 = new_y_18374 ^ x_18376;
    int64_t y_18378 = lshr64(x_18376, (int64_t) 17);
    int64_t x_18379 = x_18377 ^ y_18378;
    int64_t y_18380 = lshr64(new_y_18374, (int64_t) 26);
    int64_t new_y_18381 = x_18379 ^ y_18380;
    int64_t rand_arg_18382 = defunc_2_reduce_res_17040 ^ new_y_18374;
    int64_t rand_arg_18383 = defunc_2_reduce_res_17041 ^ new_y_18381;
    int64_t y_18384 = shl64(rand_arg_18382, (int64_t) 23);
    int64_t x_18385 = rand_arg_18382 ^ y_18384;
    int64_t x_18386 = rand_arg_18383 ^ x_18385;
    int64_t y_18387 = lshr64(x_18385, (int64_t) 17);
    int64_t x_18388 = x_18386 ^ y_18387;
    int64_t y_18389 = lshr64(rand_arg_18383, (int64_t) 26);
    int64_t new_y_18390 = x_18388 ^ y_18389;
    int64_t y_18391 = shl64(rand_arg_18383, (int64_t) 23);
    int64_t x_18392 = rand_arg_18383 ^ y_18391;
    int64_t x_18393 = new_y_18390 ^ x_18392;
    int64_t y_18394 = lshr64(x_18392, (int64_t) 17);
    int64_t x_18395 = x_18393 ^ y_18394;
    int64_t y_18396 = lshr64(new_y_18390, (int64_t) 26);
    int64_t new_y_18397 = x_18395 ^ y_18396;
    int64_t y_18398 = shl64(new_y_18390, (int64_t) 23);
    int64_t x_18399 = new_y_18390 ^ y_18398;
    int64_t x_18400 = new_y_18397 ^ x_18399;
    int64_t y_18401 = lshr64(x_18399, (int64_t) 17);
    int64_t x_18402 = x_18400 ^ y_18401;
    int64_t y_18403 = lshr64(new_y_18397, (int64_t) 26);
    int64_t new_y_18404 = x_18402 ^ y_18403;
    int64_t rand_res_18405 = add64(new_y_18397, new_y_18404);
    int64_t y_18406 = shl64(new_y_18397, (int64_t) 23);
    int64_t x_18407 = new_y_18397 ^ y_18406;
    int64_t x_18408 = new_y_18404 ^ x_18407;
    int64_t y_18409 = lshr64(x_18407, (int64_t) 17);
    int64_t x_18410 = x_18408 ^ y_18409;
    int64_t y_18411 = lshr64(new_y_18404, (int64_t) 26);
    int64_t new_y_18412 = x_18410 ^ y_18411;
    int64_t rand_res_18413 = add64(new_y_18404, new_y_18412);
    double u64_res_18414 = uitofp_i64_f64(rand_res_18405);
    double zs_res_18415 = u64_res_18414 / 1.8446744073709552e19;
    double u64_res_18416 = uitofp_i64_f64(rand_res_18413);
    double zs_res_18417 = u64_res_18416 / 1.8446744073709552e19;
    double log_res_18418;
    
    log_res_18418 = futrts_log64(zs_res_18415);
    
    double zt_res_18419 = -2.0 * log_res_18418;
    double sqrt_res_18420;
    
    sqrt_res_18420 = futrts_sqrt64(zt_res_18419);
    
    double zt_res_18421 = 6.283185307179586 * zs_res_18417;
    double cos_res_18422;
    
    cos_res_18422 = futrts_cos64(zt_res_18421);
    
    double zt_res_18423 = sqrt_res_18420 * cos_res_18422;
    
    if (local_tid_20093 == 0) {
        ((__global double *) mem_19544)[gtid_18000] = zt_res_18423;
    }
    for (int64_t i_20142 = 0; i_20142 < sdiv_up64(J_16779 -
                                                  sext_i32_i64(local_tid_20093),
                                                  computed_group_sizze_18002);
         i_20142++) {
        ((__global double *) mem_19548)[gtid_18000 * J_16779 + (i_20142 *
                                                                computed_group_sizze_18002 +
                                                                sext_i32_i64(local_tid_20093))] =
            ((__local double *) color_19874)[i_20142 *
                                             computed_group_sizze_18002 +
                                             sext_i32_i64(local_tid_20093)];
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    for (int64_t i_20143 = 0; i_20143 < sdiv_up64(J_16779 -
                                                  sext_i32_i64(local_tid_20093),
                                                  computed_group_sizze_18002);
         i_20143++) {
        ((__global double *) mem_19552)[gtid_18000 * J_16779 + (i_20143 *
                                                                computed_group_sizze_18002 +
                                                                sext_i32_i64(local_tid_20093))] =
            ((__local double *) color_19873)[i_20143 *
                                             computed_group_sizze_18002 +
                                             sext_i32_i64(local_tid_20093)];
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
  error_7:
    return;
}
__kernel void generate_datazisegmap_intragroup_18877(__global
                                                     int *global_failure,
                                                     __local volatile
                                                     int64_t *color_19889_backing_aligned_0,
                                                     __local volatile
                                                     int64_t *color_19888_backing_aligned_1,
                                                     int64_t N_16778,
                                                     int64_t Kzz_16780,
                                                     int64_t Kx_16781,
                                                     int64_t gridDim_x_18871,
                                                     int64_t gridDim_y_18872,
                                                     int64_t full_tiles_18902,
                                                     int64_t kk_19105, __global
                                                     unsigned char *mem_19397,
                                                     __global
                                                     unsigned char *mem_19433,
                                                     __global
                                                     unsigned char *mem_19747)
{
    #define Ty_18858 (generate_dataziTy_18855)
    #define Ry_18859 (generate_dataziRy_18857)
    #define Tx_18860 (generate_dataziTx_18854)
    #define Rx_18861 (generate_dataziRx_18856)
    #define Tk_18862 (generate_dataziTk_18853)
    #define tk_div_tx_18863 (sdiv_up64(generate_dataziTk_18853, generate_dataziTx_18854))
    #define tk_div_ty_18864 (sdiv_up64(generate_dataziTk_18853, generate_dataziTy_18855))
    #define TxRx_18865 (generate_dataziTx_18854 * generate_dataziRx_18856)
    #define TyRy_18866 (generate_dataziTy_18855 * generate_dataziRy_18857)
    #define a_loc_szz_18868 (generate_dataziTk_18853 * (generate_dataziTy_18855 * generate_dataziRy_18857))
    #define b_loc_szz_18870 (generate_dataziRx_18856 * (generate_dataziTx_18854 * generate_dataziTk_18853))
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict color_19889_backing_1 =
                                   (__local volatile
                                    unsigned char *) color_19889_backing_aligned_0;
    __local volatile unsigned char *restrict color_19888_backing_0 =
                                   (__local volatile
                                    unsigned char *) color_19888_backing_aligned_1;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20144;
    int32_t local_tid_20145;
    int64_t group_sizze_20148;
    int32_t wave_sizze_20147;
    int32_t group_tid_20146;
    
    global_tid_20144 = get_global_id(0);
    local_tid_20145 = get_local_id(0);
    group_sizze_20148 = get_local_size(0);
    wave_sizze_20147 = LOCKSTEP_WIDTH;
    group_tid_20146 = get_group_id(0);
    
    int32_t gid_flat_18877 = group_tid_20146;
    int64_t slice_20151 = Tx_18860;
    int64_t slice_20152 = Ty_18858 * slice_20151;
    int64_t ltid_pre_20149 = squot64(sext_i32_i64(local_tid_20145),
                                     slice_20151);
    int64_t remnant_20153 = sext_i32_i64(local_tid_20145) - ltid_pre_20149 *
            slice_20151;
    int64_t ltid_pre_20150 = remnant_20153;
    int64_t remnant_20154 = remnant_20153 - ltid_pre_20150;
    int64_t slice_20155 = gridDim_x_18871;
    int64_t slice_20156 = gridDim_y_18872 * slice_20155;
    int64_t gid_y_18876 = squot64(sext_i32_i64(group_tid_20146), slice_20155);
    int64_t remnant_20157 = sext_i32_i64(group_tid_20146) - gid_y_18876 *
            slice_20155;
    int64_t gid_x_18875 = remnant_20157;
    int64_t remnant_20158 = remnant_20157 - gid_x_18875;
    double color_19883[Ry_18859 * Rx_18861];
    double color_19884[Ry_18859 * Rx_18861];
    double color_19885[Ry_18859 * Rx_18861];
    double color_19886[Rx_18861];
    double color_19887[Ry_18859];
    __local unsigned char *color_19888;
    
    color_19888 = (__local unsigned char *) color_19888_backing_0;
    
    __local unsigned char *color_19889;
    
    color_19889 = (__local unsigned char *) color_19889_backing_1;
    
    double color_19890[Ry_18859 * Rx_18861];
    int64_t iii_18878 = TyRy_18866 * gid_y_18876;
    int64_t jjj_18879 = TxRx_18865 * gid_x_18875;
    int64_t ltid_y_18882 = sext_i32_i64(sext_i64_i32(ltid_pre_20149));
    int64_t ltid_x_18880 = sext_i32_i64(sext_i64_i32(ltid_pre_20150));
    int32_t ltid_flat_18881 = local_tid_20145;
    double color_19876[Ry_18859 * Rx_18861];
    
    for (int64_t i_18893 = 0; i_18893 < Ry_18859; i_18893++) {
        for (int64_t i_18896 = 0; i_18896 < Rx_18861; i_18896++) {
            color_19876[i_18893 * Rx_18861 + i_18896] = 0.0;
        }
    }
    for (int64_t i_20161 = 0; i_20161 < Ry_18859; i_20161++) {
        for (int64_t i_20162 = 0; i_20162 < Rx_18861; i_20162++) {
            color_19890[i_20161 * Rx_18861 + i_20162] = color_19876[i_20161 *
                                                                    Rx_18861 +
                                                                    i_20162];
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    double ext_mem_19662[Ry_18859 * Rx_18861];
    double mem_param_19573[Ry_18859 * Rx_18861];
    
    for (int32_t i_2 = 0; i_2 < Ry_18859 * Rx_18861; i_2++)
        mem_param_19573[i_2] = color_19890[i_2];
    for (int64_t i_18903 = 0; i_18903 < full_tiles_18902; i_18903++) {
        int64_t kk_18907 = Tk_18862 * i_18903;
        
        for (int64_t i_18908 = 0; i_18908 < Ry_18859; i_18908++) {
            int64_t binop_y_18931 = Ty_18858 * i_18908;
            
            for (int64_t i_18910 = 0; i_18910 < tk_div_tx_18863; i_18910++) {
                int64_t binop_y_18929 = Tx_18860 * i_18910;
                int64_t ltid_x_18912 =
                        sext_i32_i64(sext_i64_i32(ltid_pre_20149));
                int64_t ltid_y_18913 =
                        sext_i32_i64(sext_i64_i32(ltid_pre_20150));
                int32_t ltid_flat_18914 = local_tid_20145;
                int64_t k_18930 = ltid_y_18913 + binop_y_18929;
                int64_t i_18932 = ltid_x_18912 + binop_y_18931;
                int64_t gtid_18933 = iii_18878 + i_18932;
                int64_t A_col_idx_18934 = kk_18907 + k_18930;
                bool cond_18935 = slt64(gtid_18933, N_16778);
                double A_elem_18936;
                
                if (cond_18935) {
                    double A_elem_18938 = ((__global
                                            double *) mem_19397)[gtid_18933 *
                                                                 Kx_16781 +
                                                                 A_col_idx_18934];
                    
                    A_elem_18936 = A_elem_18938;
                } else {
                    A_elem_18936 = 0.0;
                }
                
                bool cond_18940 = slt64(k_18930, Tk_18862);
                int64_t a_loc_ind_18941;
                
                if (cond_18940) {
                    int64_t binop_y_18942 = Tk_18862 * i_18932;
                    int64_t loc_fi_18943 = k_18930 + binop_y_18942;
                    
                    a_loc_ind_18941 = loc_fi_18943;
                } else {
                    a_loc_ind_18941 = (int64_t) -1;
                }
                if (sle64((int64_t) 0, a_loc_ind_18941) &&
                    slt64(a_loc_ind_18941, a_loc_szz_18868)) {
                    ((__local double *) color_19889)[a_loc_ind_18941] =
                        A_elem_18936;
                }
                barrier(CLK_LOCAL_MEM_FENCE);
            }
        }
        for (int64_t i_18948 = 0; i_18948 < tk_div_ty_18864; i_18948++) {
            int64_t binop_y_18969 = Ty_18858 * i_18948;
            
            for (int64_t i_18950 = 0; i_18950 < Rx_18861; i_18950++) {
                int64_t binop_y_18971 = Tx_18860 * i_18950;
                int64_t ltid_x_18952 =
                        sext_i32_i64(sext_i64_i32(ltid_pre_20149));
                int64_t ltid_y_18953 =
                        sext_i32_i64(sext_i64_i32(ltid_pre_20150));
                int32_t ltid_flat_18954 = local_tid_20145;
                int64_t k_18970 = ltid_x_18952 + binop_y_18969;
                int64_t j_18972 = ltid_y_18953 + binop_y_18971;
                int64_t gtid_18973 = jjj_18879 + j_18972;
                int64_t B_row_idx_18974 = kk_18907 + k_18970;
                bool cond_18975 = slt64(gtid_18973, Kzz_16780);
                double B_elem_18976;
                
                if (cond_18975) {
                    int64_t binop_x_19314 = Kzz_16780 * B_row_idx_18974;
                    int64_t new_index_19315 = gtid_18973 + binop_x_19314;
                    double B_elem_18978 = ((__global
                                            double *) mem_19433)[new_index_19315];
                    
                    B_elem_18976 = B_elem_18978;
                } else {
                    B_elem_18976 = 0.0;
                }
                
                bool cond_18980 = slt64(k_18970, Tk_18862);
                int64_t b_loc_ind_18981;
                
                if (cond_18980) {
                    int64_t binop_y_18982 = TxRx_18865 * k_18970;
                    int64_t loc_fi_18983 = j_18972 + binop_y_18982;
                    
                    b_loc_ind_18981 = loc_fi_18983;
                } else {
                    b_loc_ind_18981 = (int64_t) -1;
                }
                if (sle64((int64_t) 0, b_loc_ind_18981) &&
                    slt64(b_loc_ind_18981, b_loc_szz_18870)) {
                    ((__local double *) color_19888)[b_loc_ind_18981] =
                        B_elem_18976;
                }
                barrier(CLK_LOCAL_MEM_FENCE);
            }
        }
        for (int64_t i_20171 = 0; i_20171 < Ry_18859; i_20171++) {
            for (int64_t i_20172 = 0; i_20172 < Rx_18861; i_20172++) {
                color_19883[i_20171 * Rx_18861 + i_20172] =
                    mem_param_19573[i_20171 * Rx_18861 + i_20172];
            }
        }
        
        double ext_mem_19659[Ry_18859 * Rx_18861];
        double ext_mem_unused_19854[Ry_18859 * Rx_18861];
        double mem_param_19630[Ry_18859 * Rx_18861];
        double mem_param_out_19855[Ry_18859 * Rx_18861];
        
        for (int32_t i_3 = 0; i_3 < Ry_18859 * Rx_18861; i_3++)
            mem_param_19630[i_3] = color_19883[i_3];
        for (int32_t i_4 = 0; i_4 < Ry_18859 * Rx_18861; i_4++)
            mem_param_out_19855[i_4] = color_19884[i_4];
        for (int64_t i_18988 = 0; i_18988 < Tk_18862; i_18988++) {
            int64_t binop_y_19027 = TxRx_18865 * i_18988;
            int64_t ltid_y_18992 = sext_i32_i64(sext_i64_i32(ltid_pre_20149));
            int64_t ltid_x_18990 = sext_i32_i64(sext_i64_i32(ltid_pre_20150));
            int32_t ltid_flat_18991 = local_tid_20145;
            double color_19877[Rx_18861];
            double color_19878[Ry_18859];
            int64_t binop_x_19018 = Ry_18859 * ltid_y_18992;
            
            for (int64_t i_19016 = 0; i_19016 < Ry_18859; i_19016++) {
                int64_t binop_x_19019 = i_19016 + binop_x_19018;
                int64_t binop_y_19020 = Tk_18862 * binop_x_19019;
                int64_t a_loc_ind_19021 = i_18988 + binop_y_19020;
                
                for (int64_t i_20177 = 0; i_20177 < (int64_t) 1; i_20177++) {
                    color_19878[i_19016 + i_20177] = ((__local
                                                       double *) color_19889)[a_loc_ind_19021 +
                                                                              i_20177];
                }
            }
            
            int64_t binop_y_19029 = Rx_18861 * ltid_x_18990;
            
            for (int64_t i_19025 = 0; i_19025 < Rx_18861; i_19025++) {
                int64_t binop_x_19028 = i_19025 + binop_y_19027;
                int64_t b_loc_ind_19030 = binop_x_19028 + binop_y_19029;
                
                for (int64_t i_20179 = 0; i_20179 < (int64_t) 1; i_20179++) {
                    color_19877[i_19025 + i_20179] = ((__local
                                                       double *) color_19888)[b_loc_ind_19030 +
                                                                              i_20179];
                }
            }
            for (int64_t i_20180 = 0; i_20180 < Ry_18859; i_20180++) {
                color_19887[i_20180] = color_19878[i_20180];
            }
            for (int64_t i_20181 = 0; i_20181 < Rx_18861; i_20181++) {
                color_19886[i_20181] = color_19877[i_20181];
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            
            int64_t ltid_y_19037 = sext_i32_i64(sext_i64_i32(ltid_pre_20149));
            int64_t ltid_x_19035 = sext_i32_i64(sext_i64_i32(ltid_pre_20150));
            int32_t ltid_flat_19036 = local_tid_20145;
            int64_t binop_y_19078 = Ry_18859 * ltid_y_19037;
            int64_t binop_y_19082 = Rx_18861 * ltid_x_19035;
            
            for (int64_t i_19072 = 0; i_19072 < Ry_18859; i_19072++) {
                int64_t binop_x_19077 = iii_18878 + i_19072;
                int64_t cmpop_x_19079 = binop_x_19077 + binop_y_19078;
                bool binop_x_19080 = slt64(cmpop_x_19079, N_16778);
                
                for (int64_t i_19075 = 0; i_19075 < Rx_18861; i_19075++) {
                    int64_t binop_x_19081 = jjj_18879 + i_19075;
                    int64_t cmpop_x_19083 = binop_x_19081 + binop_y_19082;
                    bool binop_y_19084 = slt64(cmpop_x_19083, Kzz_16780);
                    bool cond_19085 = binop_x_19080 && binop_y_19084;
                    
                    if (cond_19085) {
                        double a_19087 = color_19887[i_19072];
                        double b_19088 = color_19886[i_19075];
                        double c_19089 = mem_param_19630[i_19072 * Rx_18861 +
                                                         i_19075];
                        double defunc_1_f_res_19092 = a_19087 * b_19088;
                        double defunc_1_op_res_19096 = c_19089 +
                               defunc_1_f_res_19092;
                        
                        mem_param_19630[i_19072 * Rx_18861 + i_19075] =
                            defunc_1_op_res_19096;
                    }
                }
            }
            for (int64_t i_20184 = 0; i_20184 < Ry_18859; i_20184++) {
                for (int64_t i_20185 = 0; i_20185 < Rx_18861; i_20185++) {
                    mem_param_out_19855[i_20184 * Rx_18861 + i_20185] =
                        mem_param_19630[i_20184 * Rx_18861 + i_20185];
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            
            double mem_param_tmp_20173[Ry_18859 * Rx_18861];
            
            for (int32_t i_5 = 0; i_5 < Ry_18859 * Rx_18861; i_5++)
                mem_param_tmp_20173[i_5] = mem_param_out_19855[i_5];
            
            double mem_param_out_tmp_20174[Ry_18859 * Rx_18861];
            
            for (int32_t i_6 = 0; i_6 < Ry_18859 * Rx_18861; i_6++)
                mem_param_out_tmp_20174[i_6] = mem_param_19630[i_6];
            for (int32_t i_7 = 0; i_7 < Ry_18859 * Rx_18861; i_7++)
                mem_param_19630[i_7] = mem_param_tmp_20173[i_7];
            for (int32_t i_8 = 0; i_8 < Ry_18859 * Rx_18861; i_8++)
                mem_param_out_19855[i_8] = mem_param_out_tmp_20174[i_8];
        }
        for (int32_t i_9 = 0; i_9 < Ry_18859 * Rx_18861; i_9++)
            ext_mem_19659[i_9] = mem_param_19630[i_9];
        for (int32_t i_10 = 0; i_10 < Ry_18859 * Rx_18861; i_10++)
            ext_mem_unused_19854[i_10] = mem_param_out_19855[i_10];
        
        double mem_param_tmp_20163[Ry_18859 * Rx_18861];
        
        for (int32_t i_11 = 0; i_11 < Ry_18859 * Rx_18861; i_11++)
            mem_param_tmp_20163[i_11] = ext_mem_19659[i_11];
        for (int32_t i_12 = 0; i_12 < Ry_18859 * Rx_18861; i_12++)
            mem_param_19573[i_12] = mem_param_tmp_20163[i_12];
    }
    for (int32_t i_13 = 0; i_13 < Ry_18859 * Rx_18861; i_13++)
        ext_mem_19662[i_13] = mem_param_19573[i_13];
    for (int64_t i_19106 = 0; i_19106 < Ry_18859; i_19106++) {
        int64_t binop_y_19131 = Ty_18858 * i_19106;
        
        for (int64_t i_19108 = 0; i_19108 < tk_div_tx_18863; i_19108++) {
            int64_t binop_y_19129 = Tx_18860 * i_19108;
            int64_t ltid_x_19110 = sext_i32_i64(sext_i64_i32(ltid_pre_20149));
            int64_t ltid_y_19111 = sext_i32_i64(sext_i64_i32(ltid_pre_20150));
            int32_t ltid_flat_19112 = local_tid_20145;
            int64_t k_19130 = ltid_y_19111 + binop_y_19129;
            int64_t i_19132 = ltid_x_19110 + binop_y_19131;
            int64_t gtid_19133 = iii_18878 + i_19132;
            int64_t A_col_idx_19134 = kk_19105 + k_19130;
            bool binop_x_19135 = slt64(gtid_19133, N_16778);
            bool binop_y_19136 = slt64(A_col_idx_19134, Kx_16781);
            bool cond_19137 = binop_x_19135 && binop_y_19136;
            double A_elem_19138;
            
            if (cond_19137) {
                double A_elem_19140 = ((__global
                                        double *) mem_19397)[gtid_19133 *
                                                             Kx_16781 +
                                                             A_col_idx_19134];
                
                A_elem_19138 = A_elem_19140;
            } else {
                A_elem_19138 = 0.0;
            }
            
            bool cond_19142 = slt64(k_19130, Tk_18862);
            int64_t a_loc_ind_19143;
            
            if (cond_19142) {
                int64_t binop_y_19144 = Tk_18862 * i_19132;
                int64_t loc_fi_19145 = k_19130 + binop_y_19144;
                
                a_loc_ind_19143 = loc_fi_19145;
            } else {
                a_loc_ind_19143 = (int64_t) -1;
            }
            if (sle64((int64_t) 0, a_loc_ind_19143) && slt64(a_loc_ind_19143,
                                                             a_loc_szz_18868)) {
                ((__local double *) color_19889)[a_loc_ind_19143] =
                    A_elem_19138;
            }
            barrier(CLK_LOCAL_MEM_FENCE);
        }
    }
    for (int64_t i_19150 = 0; i_19150 < tk_div_ty_18864; i_19150++) {
        int64_t binop_y_19173 = Ty_18858 * i_19150;
        
        for (int64_t i_19152 = 0; i_19152 < Rx_18861; i_19152++) {
            int64_t binop_y_19175 = Tx_18860 * i_19152;
            int64_t ltid_x_19154 = sext_i32_i64(sext_i64_i32(ltid_pre_20149));
            int64_t ltid_y_19155 = sext_i32_i64(sext_i64_i32(ltid_pre_20150));
            int32_t ltid_flat_19156 = local_tid_20145;
            int64_t k_19174 = ltid_x_19154 + binop_y_19173;
            int64_t j_19176 = ltid_y_19155 + binop_y_19175;
            int64_t gtid_19177 = jjj_18879 + j_19176;
            int64_t B_row_idx_19178 = kk_19105 + k_19174;
            bool binop_x_19179 = slt64(gtid_19177, Kzz_16780);
            bool binop_y_19180 = slt64(B_row_idx_19178, Kx_16781);
            bool cond_19181 = binop_x_19179 && binop_y_19180;
            double B_elem_19182;
            
            if (cond_19181) {
                int64_t binop_x_19316 = Kzz_16780 * B_row_idx_19178;
                int64_t new_index_19317 = gtid_19177 + binop_x_19316;
                double B_elem_19184 = ((__global
                                        double *) mem_19433)[new_index_19317];
                
                B_elem_19182 = B_elem_19184;
            } else {
                B_elem_19182 = 0.0;
            }
            
            bool cond_19186 = slt64(k_19174, Tk_18862);
            int64_t b_loc_ind_19187;
            
            if (cond_19186) {
                int64_t binop_y_19188 = TxRx_18865 * k_19174;
                int64_t loc_fi_19189 = j_19176 + binop_y_19188;
                
                b_loc_ind_19187 = loc_fi_19189;
            } else {
                b_loc_ind_19187 = (int64_t) -1;
            }
            if (sle64((int64_t) 0, b_loc_ind_19187) && slt64(b_loc_ind_19187,
                                                             b_loc_szz_18870)) {
                ((__local double *) color_19888)[b_loc_ind_19187] =
                    B_elem_19182;
            }
            barrier(CLK_LOCAL_MEM_FENCE);
        }
    }
    for (int64_t i_20190 = 0; i_20190 < Ry_18859; i_20190++) {
        for (int64_t i_20191 = 0; i_20191 < Rx_18861; i_20191++) {
            color_19883[i_20190 * Rx_18861 + i_20191] = ext_mem_19662[i_20190 *
                                                                      Rx_18861 +
                                                                      i_20191];
        }
    }
    
    double ext_mem_19743[Ry_18859 * Rx_18861];
    double ext_mem_unused_19862[Ry_18859 * Rx_18861];
    double mem_param_19713[Ry_18859 * Rx_18861];
    double mem_param_out_19863[Ry_18859 * Rx_18861];
    
    for (int32_t i_14 = 0; i_14 < Ry_18859 * Rx_18861; i_14++)
        mem_param_19713[i_14] = color_19883[i_14];
    for (int32_t i_15 = 0; i_15 < Ry_18859 * Rx_18861; i_15++)
        mem_param_out_19863[i_15] = color_19884[i_15];
    for (int64_t i_19194 = 0; i_19194 < Tk_18862; i_19194++) {
        int64_t cmpop_x_19196 = kk_19105 + i_19194;
        bool cond_19197 = slt64(cmpop_x_19196, Kx_16781);
        
        if (cond_19197) {
            int64_t binop_y_19235 = TxRx_18865 * i_19194;
            int64_t bytes_19715 = (int64_t) 8 * Ry_18859;
            int64_t bytes_19717 = (int64_t) 8 * Rx_18861;
            int64_t ltid_y_19200 = sext_i32_i64(sext_i64_i32(ltid_pre_20149));
            int64_t ltid_x_19198 = sext_i32_i64(sext_i64_i32(ltid_pre_20150));
            int32_t ltid_flat_19199 = local_tid_20145;
            double color_19879[Rx_18861];
            double color_19880[Ry_18859];
            int64_t binop_x_19226 = Ry_18859 * ltid_y_19200;
            
            for (int64_t i_19224 = 0; i_19224 < Ry_18859; i_19224++) {
                int64_t binop_x_19227 = i_19224 + binop_x_19226;
                int64_t binop_y_19228 = Tk_18862 * binop_x_19227;
                int64_t a_loc_ind_19229 = i_19194 + binop_y_19228;
                
                for (int64_t i_20196 = 0; i_20196 < (int64_t) 1; i_20196++) {
                    color_19880[i_19224 + i_20196] = ((__local
                                                       double *) color_19889)[a_loc_ind_19229 +
                                                                              i_20196];
                }
            }
            
            int64_t binop_y_19237 = Rx_18861 * ltid_x_19198;
            
            for (int64_t i_19233 = 0; i_19233 < Rx_18861; i_19233++) {
                int64_t binop_x_19236 = i_19233 + binop_y_19235;
                int64_t b_loc_ind_19238 = binop_x_19236 + binop_y_19237;
                
                for (int64_t i_20198 = 0; i_20198 < (int64_t) 1; i_20198++) {
                    color_19879[i_19233 + i_20198] = ((__local
                                                       double *) color_19888)[b_loc_ind_19238 +
                                                                              i_20198];
                }
            }
            for (int64_t i_20199 = 0; i_20199 < Ry_18859; i_20199++) {
                color_19887[i_20199] = color_19880[i_20199];
            }
            for (int64_t i_20200 = 0; i_20200 < Rx_18861; i_20200++) {
                color_19886[i_20200] = color_19879[i_20200];
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            
            int64_t ltid_y_19245 = sext_i32_i64(sext_i64_i32(ltid_pre_20149));
            int64_t ltid_x_19243 = sext_i32_i64(sext_i64_i32(ltid_pre_20150));
            int32_t ltid_flat_19244 = local_tid_20145;
            int64_t binop_y_19286 = Ry_18859 * ltid_y_19245;
            int64_t binop_y_19290 = Rx_18861 * ltid_x_19243;
            
            for (int64_t i_19280 = 0; i_19280 < Ry_18859; i_19280++) {
                int64_t binop_x_19285 = iii_18878 + i_19280;
                int64_t cmpop_x_19287 = binop_x_19285 + binop_y_19286;
                bool binop_x_19288 = slt64(cmpop_x_19287, N_16778);
                
                for (int64_t i_19283 = 0; i_19283 < Rx_18861; i_19283++) {
                    int64_t binop_x_19289 = jjj_18879 + i_19283;
                    int64_t cmpop_x_19291 = binop_x_19289 + binop_y_19290;
                    bool binop_y_19292 = slt64(cmpop_x_19291, Kzz_16780);
                    bool cond_19293 = binop_x_19288 && binop_y_19292;
                    
                    if (cond_19293) {
                        double a_19295 = color_19887[i_19280];
                        double b_19296 = color_19886[i_19283];
                        double c_19297 = mem_param_19713[i_19280 * Rx_18861 +
                                                         i_19283];
                        double defunc_1_f_res_19300 = a_19295 * b_19296;
                        double defunc_1_op_res_19304 = c_19297 +
                               defunc_1_f_res_19300;
                        
                        mem_param_19713[i_19280 * Rx_18861 + i_19283] =
                            defunc_1_op_res_19304;
                    }
                }
            }
            for (int64_t i_20203 = 0; i_20203 < Ry_18859; i_20203++) {
                for (int64_t i_20204 = 0; i_20204 < Rx_18861; i_20204++) {
                    color_19885[i_20203 * Rx_18861 + i_20204] =
                        mem_param_19713[i_20203 * Rx_18861 + i_20204];
                }
            }
            barrier(CLK_LOCAL_MEM_FENCE);
            for (int64_t i_20205 = 0; i_20205 < Ry_18859; i_20205++) {
                for (int64_t i_20206 = 0; i_20206 < Rx_18861; i_20206++) {
                    mem_param_out_19863[i_20205 * Rx_18861 + i_20206] =
                        color_19885[i_20205 * Rx_18861 + i_20206];
                }
            }
        } else {
            for (int64_t i_20207 = 0; i_20207 < Ry_18859; i_20207++) {
                for (int64_t i_20208 = 0; i_20208 < Rx_18861; i_20208++) {
                    mem_param_out_19863[i_20207 * Rx_18861 + i_20208] =
                        mem_param_19713[i_20207 * Rx_18861 + i_20208];
                }
            }
        }
        
        double mem_param_tmp_20192[Ry_18859 * Rx_18861];
        
        for (int32_t i_16 = 0; i_16 < Ry_18859 * Rx_18861; i_16++)
            mem_param_tmp_20192[i_16] = mem_param_out_19863[i_16];
        
        double mem_param_out_tmp_20193[Ry_18859 * Rx_18861];
        
        for (int32_t i_17 = 0; i_17 < Ry_18859 * Rx_18861; i_17++)
            mem_param_out_tmp_20193[i_17] = mem_param_19713[i_17];
        for (int32_t i_18 = 0; i_18 < Ry_18859 * Rx_18861; i_18++)
            mem_param_19713[i_18] = mem_param_tmp_20192[i_18];
        for (int32_t i_19 = 0; i_19 < Ry_18859 * Rx_18861; i_19++)
            mem_param_out_19863[i_19] = mem_param_out_tmp_20193[i_19];
    }
    for (int32_t i_20 = 0; i_20 < Ry_18859 * Rx_18861; i_20++)
        ext_mem_19743[i_20] = mem_param_19713[i_20];
    for (int32_t i_21 = 0; i_21 < Ry_18859 * Rx_18861; i_21++)
        ext_mem_unused_19862[i_21] = mem_param_out_19863[i_21];
    
    int64_t slice_20211 = Tx_18860;
    int64_t slice_20212 = Ty_18858 * slice_20211;
    int64_t reg_tile_i_20209 = squot64(sext_i32_i64(local_tid_20145),
                                       slice_20211);
    int64_t remnant_20213 = sext_i32_i64(local_tid_20145) - reg_tile_i_20209 *
            slice_20211;
    int64_t reg_tile_i_20210 = remnant_20213;
    int64_t remnant_20214 = remnant_20213 - reg_tile_i_20210;
    int64_t tile_dim_start_20215 = Ry_18859 * (Ty_18858 * gid_y_18876 +
                                               reg_tile_i_20209);
    int64_t tile_dim_start_20216 = Rx_18861 * (Tx_18860 * gid_x_18875 +
                                               reg_tile_i_20210);
    
    for (int64_t nest_i_20217 = 0; nest_i_20217 < Ry_18859; nest_i_20217++) {
        for (int64_t nest_i_20218 = 0; nest_i_20218 < Rx_18861;
             nest_i_20218++) {
            if (slt64(tile_dim_start_20215 + nest_i_20217, N_16778) &&
                slt64(tile_dim_start_20216 + nest_i_20218, Kzz_16780)) {
                ((__global double *) mem_19747)[(tile_dim_start_20215 +
                                                 nest_i_20217) * Kzz_16780 +
                                                (tile_dim_start_20216 +
                                                 nest_i_20218)] =
                    ext_mem_19743[nest_i_20217 * Rx_18861 + nest_i_20218];
            }
        }
    }
    
  error_9:
    return;
    #undef Ty_18858
    #undef Ry_18859
    #undef Tx_18860
    #undef Rx_18861
    #undef Tk_18862
    #undef tk_div_tx_18863
    #undef tk_div_ty_18864
    #undef TxRx_18865
    #undef TyRy_18866
    #undef a_loc_szz_18868
    #undef b_loc_szz_18870
}
__kernel void generate_datazisegred_large_18547(__global int *global_failure,
                                                __local volatile
                                                int64_t *sync_arr_mem_20393_backing_aligned_0,
                                                __local volatile
                                                int64_t *red_arr_mem_20391_backing_aligned_1,
                                                int64_t N_16778,
                                                int64_t J_16779,
                                                int64_t num_groups_18692,
                                                int64_t groups_per_segment_20377,
                                                int64_t elements_per_thread_20378,
                                                int64_t virt_num_groups_20379,
                                                int64_t threads_per_segment_20381,
                                                __global
                                                unsigned char *mem_19757,
                                                __global
                                                unsigned char *mem_19761,
                                                __global
                                                unsigned char *mem_19765,
                                                __global
                                                unsigned char *mem_19769,
                                                __global
                                                unsigned char *segred_tmp_mem_20382,
                                                __global
                                                unsigned char *generate_datazicounter_mem_20384)
{
    #define segred_group_sizze_18691 (generate_datazisegred_group_sizze_18541)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict sync_arr_mem_20393_backing_1 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_20393_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_20391_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20391_backing_aligned_1;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20386;
    int32_t local_tid_20387;
    int64_t group_sizze_20390;
    int32_t wave_sizze_20389;
    int32_t group_tid_20388;
    
    global_tid_20386 = get_global_id(0);
    local_tid_20387 = get_local_id(0);
    group_sizze_20390 = get_local_size(0);
    wave_sizze_20389 = LOCKSTEP_WIDTH;
    group_tid_20388 = get_group_id(0);
    
    int32_t phys_tid_18547 = global_tid_20386;
    __local unsigned char *red_arr_mem_20391;
    
    red_arr_mem_20391 = (__local unsigned char *) red_arr_mem_20391_backing_0;
    
    __local unsigned char *sync_arr_mem_20393;
    
    sync_arr_mem_20393 = (__local unsigned char *) sync_arr_mem_20393_backing_1;
    
    int32_t phys_group_id_20395;
    
    phys_group_id_20395 = get_group_id(0);
    for (int32_t i_20396 = 0; i_20396 <
         sdiv_up32(sext_i64_i32(virt_num_groups_20379) - phys_group_id_20395,
                   sext_i64_i32(num_groups_18692)); i_20396++) {
        int32_t virt_group_id_20397 = phys_group_id_20395 + i_20396 *
                sext_i64_i32(num_groups_18692);
        int32_t flat_segment_id_20398 = squot32(virt_group_id_20397,
                                                sext_i64_i32(groups_per_segment_20377));
        int64_t global_tid_20399 = srem64(sext_i32_i64(virt_group_id_20397) *
                                          segred_group_sizze_18691 +
                                          sext_i32_i64(local_tid_20387),
                                          segred_group_sizze_18691 *
                                          groups_per_segment_20377);
        int64_t slice_20400 = N_16778;
        int64_t gtid_18538 = sext_i32_i64(flat_segment_id_20398);
        int64_t remnant_20401 = sext_i32_i64(flat_segment_id_20398) -
                gtid_18538;
        int64_t gtid_18546;
        double x_acc_20402;
        int64_t chunk_sizze_20403 = smin64(elements_per_thread_20378,
                                           sdiv_up64(J_16779 - global_tid_20399,
                                                     threads_per_segment_20381));
        double x_18696;
        double x_18697;
        
        // neutral-initialise the accumulators
        {
            x_acc_20402 = 0.0;
        }
        for (int64_t i_20407 = 0; i_20407 < chunk_sizze_20403; i_20407++) {
            gtid_18546 = global_tid_20399 + threads_per_segment_20381 * i_20407;
            // apply map function
            {
                double defunc_2_reduce_res_18699 = ((__global
                                                     double *) mem_19757)[gtid_18538];
                double x_18701 = ((__global double *) mem_19761)[gtid_18538 *
                                                                 J_16779 +
                                                                 gtid_18546];
                double defunc_0_f_res_18702 = x_18701 -
                       defunc_2_reduce_res_18699;
                double defunc_0_f_res_18703;
                
                defunc_0_f_res_18703 = futrts_exp64(defunc_0_f_res_18702);
                // save map-out results
                {
                    ((__global double *) mem_19769)[gtid_18538 * J_16779 +
                                                    gtid_18546] =
                        defunc_0_f_res_18703;
                }
                // load accumulator
                {
                    x_18696 = x_acc_20402;
                }
                // load new values
                {
                    x_18697 = defunc_0_f_res_18703;
                }
                // apply reduction operator
                {
                    double defunc_1_op_res_18698 = x_18696 + x_18697;
                    
                    // store in accumulator
                    {
                        x_acc_20402 = defunc_1_op_res_18698;
                    }
                }
            }
        }
        // to reduce current chunk, first store our result in memory
        {
            x_18696 = x_acc_20402;
            ((__local
              double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387)] =
                x_18696;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        
        int32_t offset_20408;
        int32_t skip_waves_20409 = 1;
        double x_20404;
        double x_20405;
        
        offset_20408 = 0;
        // participating threads read initial accumulator
        {
            if (slt32(local_tid_20387,
                      sext_i64_i32(segred_group_sizze_18691))) {
                x_20404 = ((__local
                            double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387 +
                                                         offset_20408)];
            }
        }
        offset_20408 = 1;
        while (slt32(offset_20408, wave_sizze_20389)) {
            if (slt32(local_tid_20387 + offset_20408,
                      sext_i64_i32(segred_group_sizze_18691)) &&
                ((local_tid_20387 - squot32(local_tid_20387, wave_sizze_20389) *
                  wave_sizze_20389) & (2 * offset_20408 - 1)) == 0) {
                // read array element
                {
                    x_20405 = ((volatile __local
                                double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387 +
                                                             offset_20408)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20406 = x_20404 + x_20405;
                    
                    x_20404 = defunc_1_op_res_20406;
                }
                // write result of operation
                {
                    ((volatile __local
                      double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387)] =
                        x_20404;
                }
            }
            offset_20408 *= 2;
        }
        while (slt32(skip_waves_20409,
                     squot32(sext_i64_i32(segred_group_sizze_18691) +
                             wave_sizze_20389 - 1, wave_sizze_20389))) {
            barrier(CLK_LOCAL_MEM_FENCE);
            offset_20408 = skip_waves_20409 * wave_sizze_20389;
            if (slt32(local_tid_20387 + offset_20408,
                      sext_i64_i32(segred_group_sizze_18691)) &&
                ((local_tid_20387 - squot32(local_tid_20387, wave_sizze_20389) *
                  wave_sizze_20389) == 0 && (squot32(local_tid_20387,
                                                     wave_sizze_20389) & (2 *
                                                                          skip_waves_20409 -
                                                                          1)) ==
                 0)) {
                // read array element
                {
                    x_20405 = ((__local
                                double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387 +
                                                             offset_20408)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20406 = x_20404 + x_20405;
                    
                    x_20404 = defunc_1_op_res_20406;
                }
                // write result of operation
                {
                    ((__local
                      double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387)] =
                        x_20404;
                }
            }
            skip_waves_20409 *= 2;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // first thread saves the result in accumulator
        {
            if (sext_i32_i64(local_tid_20387) == (int64_t) 0) {
                x_acc_20402 = x_20404;
            }
        }
        if (groups_per_segment_20377 == (int64_t) 1) {
            // first thread in group saves final result to memory
            {
                if (local_tid_20387 == 0) {
                    ((__global double *) mem_19765)[gtid_18538] = x_acc_20402;
                }
            }
        } else {
            int32_t old_counter_20410;
            
            // first thread in group saves group result to global memory
            {
                if (local_tid_20387 == 0) {
                    ((__global
                      double *) segred_tmp_mem_20382)[sext_i32_i64(virt_group_id_20397)] =
                        x_acc_20402;
                    mem_fence_global();
                    old_counter_20410 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) generate_datazicounter_mem_20384)[sext_i32_i64(srem32(flat_segment_id_20398,
                                                                                                              10240))],
                                              (int) 1);
                    ((__local bool *) sync_arr_mem_20393)[(int64_t) 0] =
                        old_counter_20410 == groups_per_segment_20377 -
                        (int64_t) 1;
                }
            }
            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
            
            bool is_last_group_20411 = ((__local
                                         bool *) sync_arr_mem_20393)[(int64_t) 0];
            
            if (is_last_group_20411) {
                if (local_tid_20387 == 0) {
                    old_counter_20410 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) generate_datazicounter_mem_20384)[sext_i32_i64(srem32(flat_segment_id_20398,
                                                                                                              10240))],
                                              (int) ((int64_t) 0 -
                                                     groups_per_segment_20377));
                }
                // read in the per-group-results
                {
                    int64_t read_per_thread_20412 =
                            sdiv_up64(groups_per_segment_20377,
                                      segred_group_sizze_18691);
                    
                    x_18696 = 0.0;
                    for (int64_t i_20413 = 0; i_20413 < read_per_thread_20412;
                         i_20413++) {
                        int64_t group_res_id_20414 =
                                sext_i32_i64(local_tid_20387) *
                                read_per_thread_20412 + i_20413;
                        int64_t index_of_group_res_20415 =
                                sext_i32_i64(flat_segment_id_20398) *
                                groups_per_segment_20377 + group_res_id_20414;
                        
                        if (slt64(group_res_id_20414,
                                  groups_per_segment_20377)) {
                            x_18697 = ((__global
                                        double *) segred_tmp_mem_20382)[index_of_group_res_20415];
                            
                            double defunc_1_op_res_18698 = x_18696 + x_18697;
                            
                            x_18696 = defunc_1_op_res_18698;
                        }
                    }
                }
                ((__local
                  double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387)] =
                    x_18696;
                barrier(CLK_LOCAL_MEM_FENCE);
                // reduce the per-group results
                {
                    int32_t offset_20416;
                    int32_t skip_waves_20417 = 1;
                    double x_20404;
                    double x_20405;
                    
                    offset_20416 = 0;
                    // participating threads read initial accumulator
                    {
                        if (slt32(local_tid_20387,
                                  sext_i64_i32(segred_group_sizze_18691))) {
                            x_20404 = ((__local
                                        double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387 +
                                                                     offset_20416)];
                        }
                    }
                    offset_20416 = 1;
                    while (slt32(offset_20416, wave_sizze_20389)) {
                        if (slt32(local_tid_20387 + offset_20416,
                                  sext_i64_i32(segred_group_sizze_18691)) &&
                            ((local_tid_20387 - squot32(local_tid_20387,
                                                        wave_sizze_20389) *
                              wave_sizze_20389) & (2 * offset_20416 - 1)) ==
                            0) {
                            // read array element
                            {
                                x_20405 = ((volatile __local
                                            double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387 +
                                                                         offset_20416)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20406 = x_20404 +
                                       x_20405;
                                
                                x_20404 = defunc_1_op_res_20406;
                            }
                            // write result of operation
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387)] =
                                    x_20404;
                            }
                        }
                        offset_20416 *= 2;
                    }
                    while (slt32(skip_waves_20417,
                                 squot32(sext_i64_i32(segred_group_sizze_18691) +
                                         wave_sizze_20389 - 1,
                                         wave_sizze_20389))) {
                        barrier(CLK_LOCAL_MEM_FENCE);
                        offset_20416 = skip_waves_20417 * wave_sizze_20389;
                        if (slt32(local_tid_20387 + offset_20416,
                                  sext_i64_i32(segred_group_sizze_18691)) &&
                            ((local_tid_20387 - squot32(local_tid_20387,
                                                        wave_sizze_20389) *
                              wave_sizze_20389) == 0 &&
                             (squot32(local_tid_20387, wave_sizze_20389) & (2 *
                                                                            skip_waves_20417 -
                                                                            1)) ==
                             0)) {
                            // read array element
                            {
                                x_20405 = ((__local
                                            double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387 +
                                                                         offset_20416)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20406 = x_20404 +
                                       x_20405;
                                
                                x_20404 = defunc_1_op_res_20406;
                            }
                            // write result of operation
                            {
                                ((__local
                                  double *) red_arr_mem_20391)[sext_i32_i64(local_tid_20387)] =
                                    x_20404;
                            }
                        }
                        skip_waves_20417 *= 2;
                    }
                    // and back to memory with the final result
                    {
                        if (local_tid_20387 == 0) {
                            ((__global double *) mem_19765)[gtid_18538] =
                                x_20404;
                        }
                    }
                }
            }
        }
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_18691
}
__kernel void generate_datazisegred_large_18566(__global int *global_failure,
                                                __local volatile
                                                int64_t *sync_arr_mem_20328_backing_aligned_0,
                                                __local volatile
                                                int64_t *red_arr_mem_20326_backing_aligned_1,
                                                int64_t N_16778,
                                                int64_t J_16779,
                                                int64_t Kzz_16780,
                                                int64_t num_groups_18673,
                                                int64_t groups_per_segment_20312,
                                                int64_t elements_per_thread_20313,
                                                int64_t virt_num_groups_20314,
                                                int64_t threads_per_segment_20316,
                                                __global
                                                unsigned char *mem_19419,
                                                __global
                                                unsigned char *ext_mem_19753,
                                                __global
                                                unsigned char *mem_19757,
                                                __global
                                                unsigned char *mem_19761,
                                                __global
                                                unsigned char *segred_tmp_mem_20317,
                                                __global
                                                unsigned char *generate_datazicounter_mem_20319)
{
    #define segred_group_sizze_18672 (generate_datazisegred_group_sizze_18560)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict sync_arr_mem_20328_backing_1 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_20328_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_20326_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20326_backing_aligned_1;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20321;
    int32_t local_tid_20322;
    int64_t group_sizze_20325;
    int32_t wave_sizze_20324;
    int32_t group_tid_20323;
    
    global_tid_20321 = get_global_id(0);
    local_tid_20322 = get_local_id(0);
    group_sizze_20325 = get_local_size(0);
    wave_sizze_20324 = LOCKSTEP_WIDTH;
    group_tid_20323 = get_group_id(0);
    
    int32_t phys_tid_18566 = global_tid_20321;
    __local unsigned char *red_arr_mem_20326;
    
    red_arr_mem_20326 = (__local unsigned char *) red_arr_mem_20326_backing_0;
    
    __local unsigned char *sync_arr_mem_20328;
    
    sync_arr_mem_20328 = (__local unsigned char *) sync_arr_mem_20328_backing_1;
    
    int32_t phys_group_id_20330;
    
    phys_group_id_20330 = get_group_id(0);
    for (int32_t i_20331 = 0; i_20331 <
         sdiv_up32(sext_i64_i32(virt_num_groups_20314) - phys_group_id_20330,
                   sext_i64_i32(num_groups_18673)); i_20331++) {
        int32_t virt_group_id_20332 = phys_group_id_20330 + i_20331 *
                sext_i64_i32(num_groups_18673);
        int32_t flat_segment_id_20333 = squot32(virt_group_id_20332,
                                                sext_i64_i32(groups_per_segment_20312));
        int64_t global_tid_20334 = srem64(sext_i32_i64(virt_group_id_20332) *
                                          segred_group_sizze_18672 +
                                          sext_i32_i64(local_tid_20322),
                                          segred_group_sizze_18672 *
                                          groups_per_segment_20312);
        int64_t slice_20335 = N_16778;
        int64_t gtid_18557 = sext_i32_i64(flat_segment_id_20333);
        int64_t remnant_20336 = sext_i32_i64(flat_segment_id_20333) -
                gtid_18557;
        int64_t gtid_18565;
        double x_acc_20337;
        int64_t chunk_sizze_20338 = smin64(elements_per_thread_20313,
                                           sdiv_up64(J_16779 - global_tid_20334,
                                                     threads_per_segment_20316));
        double x_18677;
        double x_18678;
        
        // neutral-initialise the accumulators
        {
            x_acc_20337 = -INFINITY;
        }
        for (int64_t i_20342 = 0; i_20342 < chunk_sizze_20338; i_20342++) {
            gtid_18565 = global_tid_20334 + threads_per_segment_20316 * i_20342;
            // apply map function
            {
                double defunc_2_reduce_res_18682;
                double redout_19363 = 0.0;
                
                for (int64_t i_19364 = 0; i_19364 < Kzz_16780; i_19364++) {
                    double x_18686 = ((__global
                                       double *) ext_mem_19753)[gtid_18557 *
                                                                Kzz_16780 +
                                                                i_19364];
                    int64_t binop_x_19380 = J_16779 * i_19364;
                    int64_t new_index_19381 = gtid_18565 + binop_x_19380;
                    double x_18687 = ((__global
                                       double *) mem_19419)[new_index_19381];
                    double defunc_1_f_res_18688 = x_18686 * x_18687;
                    double defunc_1_op_res_18685 = defunc_1_f_res_18688 +
                           redout_19363;
                    double redout_tmp_20343 = defunc_1_op_res_18685;
                    
                    redout_19363 = redout_tmp_20343;
                }
                defunc_2_reduce_res_18682 = redout_19363;
                // save map-out results
                {
                    ((__global double *) mem_19761)[gtid_18557 * J_16779 +
                                                    gtid_18565] =
                        defunc_2_reduce_res_18682;
                }
                // load accumulator
                {
                    x_18677 = x_acc_20337;
                }
                // load new values
                {
                    x_18678 = defunc_2_reduce_res_18682;
                }
                // apply reduction operator
                {
                    double defunc_1_op_res_18679 = fmax64(x_18677, x_18678);
                    
                    // store in accumulator
                    {
                        x_acc_20337 = defunc_1_op_res_18679;
                    }
                }
            }
        }
        // to reduce current chunk, first store our result in memory
        {
            x_18677 = x_acc_20337;
            ((__local
              double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322)] =
                x_18677;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        
        int32_t offset_20344;
        int32_t skip_waves_20345 = 1;
        double x_20339;
        double x_20340;
        
        offset_20344 = 0;
        // participating threads read initial accumulator
        {
            if (slt32(local_tid_20322,
                      sext_i64_i32(segred_group_sizze_18672))) {
                x_20339 = ((__local
                            double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322 +
                                                         offset_20344)];
            }
        }
        offset_20344 = 1;
        while (slt32(offset_20344, wave_sizze_20324)) {
            if (slt32(local_tid_20322 + offset_20344,
                      sext_i64_i32(segred_group_sizze_18672)) &&
                ((local_tid_20322 - squot32(local_tid_20322, wave_sizze_20324) *
                  wave_sizze_20324) & (2 * offset_20344 - 1)) == 0) {
                // read array element
                {
                    x_20340 = ((volatile __local
                                double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322 +
                                                             offset_20344)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20341 = fmax64(x_20339, x_20340);
                    
                    x_20339 = defunc_1_op_res_20341;
                }
                // write result of operation
                {
                    ((volatile __local
                      double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322)] =
                        x_20339;
                }
            }
            offset_20344 *= 2;
        }
        while (slt32(skip_waves_20345,
                     squot32(sext_i64_i32(segred_group_sizze_18672) +
                             wave_sizze_20324 - 1, wave_sizze_20324))) {
            barrier(CLK_LOCAL_MEM_FENCE);
            offset_20344 = skip_waves_20345 * wave_sizze_20324;
            if (slt32(local_tid_20322 + offset_20344,
                      sext_i64_i32(segred_group_sizze_18672)) &&
                ((local_tid_20322 - squot32(local_tid_20322, wave_sizze_20324) *
                  wave_sizze_20324) == 0 && (squot32(local_tid_20322,
                                                     wave_sizze_20324) & (2 *
                                                                          skip_waves_20345 -
                                                                          1)) ==
                 0)) {
                // read array element
                {
                    x_20340 = ((__local
                                double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322 +
                                                             offset_20344)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20341 = fmax64(x_20339, x_20340);
                    
                    x_20339 = defunc_1_op_res_20341;
                }
                // write result of operation
                {
                    ((__local
                      double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322)] =
                        x_20339;
                }
            }
            skip_waves_20345 *= 2;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // first thread saves the result in accumulator
        {
            if (sext_i32_i64(local_tid_20322) == (int64_t) 0) {
                x_acc_20337 = x_20339;
            }
        }
        if (groups_per_segment_20312 == (int64_t) 1) {
            // first thread in group saves final result to memory
            {
                if (local_tid_20322 == 0) {
                    ((__global double *) mem_19757)[gtid_18557] = x_acc_20337;
                }
            }
        } else {
            int32_t old_counter_20346;
            
            // first thread in group saves group result to global memory
            {
                if (local_tid_20322 == 0) {
                    ((__global
                      double *) segred_tmp_mem_20317)[sext_i32_i64(virt_group_id_20332)] =
                        x_acc_20337;
                    mem_fence_global();
                    old_counter_20346 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) generate_datazicounter_mem_20319)[sext_i32_i64(srem32(flat_segment_id_20333,
                                                                                                              10240))],
                                              (int) 1);
                    ((__local bool *) sync_arr_mem_20328)[(int64_t) 0] =
                        old_counter_20346 == groups_per_segment_20312 -
                        (int64_t) 1;
                }
            }
            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
            
            bool is_last_group_20347 = ((__local
                                         bool *) sync_arr_mem_20328)[(int64_t) 0];
            
            if (is_last_group_20347) {
                if (local_tid_20322 == 0) {
                    old_counter_20346 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) generate_datazicounter_mem_20319)[sext_i32_i64(srem32(flat_segment_id_20333,
                                                                                                              10240))],
                                              (int) ((int64_t) 0 -
                                                     groups_per_segment_20312));
                }
                // read in the per-group-results
                {
                    int64_t read_per_thread_20348 =
                            sdiv_up64(groups_per_segment_20312,
                                      segred_group_sizze_18672);
                    
                    x_18677 = -INFINITY;
                    for (int64_t i_20349 = 0; i_20349 < read_per_thread_20348;
                         i_20349++) {
                        int64_t group_res_id_20350 =
                                sext_i32_i64(local_tid_20322) *
                                read_per_thread_20348 + i_20349;
                        int64_t index_of_group_res_20351 =
                                sext_i32_i64(flat_segment_id_20333) *
                                groups_per_segment_20312 + group_res_id_20350;
                        
                        if (slt64(group_res_id_20350,
                                  groups_per_segment_20312)) {
                            x_18678 = ((__global
                                        double *) segred_tmp_mem_20317)[index_of_group_res_20351];
                            
                            double defunc_1_op_res_18679 = fmax64(x_18677,
                                                                  x_18678);
                            
                            x_18677 = defunc_1_op_res_18679;
                        }
                    }
                }
                ((__local
                  double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322)] =
                    x_18677;
                barrier(CLK_LOCAL_MEM_FENCE);
                // reduce the per-group results
                {
                    int32_t offset_20352;
                    int32_t skip_waves_20353 = 1;
                    double x_20339;
                    double x_20340;
                    
                    offset_20352 = 0;
                    // participating threads read initial accumulator
                    {
                        if (slt32(local_tid_20322,
                                  sext_i64_i32(segred_group_sizze_18672))) {
                            x_20339 = ((__local
                                        double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322 +
                                                                     offset_20352)];
                        }
                    }
                    offset_20352 = 1;
                    while (slt32(offset_20352, wave_sizze_20324)) {
                        if (slt32(local_tid_20322 + offset_20352,
                                  sext_i64_i32(segred_group_sizze_18672)) &&
                            ((local_tid_20322 - squot32(local_tid_20322,
                                                        wave_sizze_20324) *
                              wave_sizze_20324) & (2 * offset_20352 - 1)) ==
                            0) {
                            // read array element
                            {
                                x_20340 = ((volatile __local
                                            double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322 +
                                                                         offset_20352)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20341 = fmax64(x_20339,
                                                                      x_20340);
                                
                                x_20339 = defunc_1_op_res_20341;
                            }
                            // write result of operation
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322)] =
                                    x_20339;
                            }
                        }
                        offset_20352 *= 2;
                    }
                    while (slt32(skip_waves_20353,
                                 squot32(sext_i64_i32(segred_group_sizze_18672) +
                                         wave_sizze_20324 - 1,
                                         wave_sizze_20324))) {
                        barrier(CLK_LOCAL_MEM_FENCE);
                        offset_20352 = skip_waves_20353 * wave_sizze_20324;
                        if (slt32(local_tid_20322 + offset_20352,
                                  sext_i64_i32(segred_group_sizze_18672)) &&
                            ((local_tid_20322 - squot32(local_tid_20322,
                                                        wave_sizze_20324) *
                              wave_sizze_20324) == 0 &&
                             (squot32(local_tid_20322, wave_sizze_20324) & (2 *
                                                                            skip_waves_20353 -
                                                                            1)) ==
                             0)) {
                            // read array element
                            {
                                x_20340 = ((__local
                                            double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322 +
                                                                         offset_20352)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20341 = fmax64(x_20339,
                                                                      x_20340);
                                
                                x_20339 = defunc_1_op_res_20341;
                            }
                            // write result of operation
                            {
                                ((__local
                                  double *) red_arr_mem_20326)[sext_i32_i64(local_tid_20322)] =
                                    x_20339;
                            }
                        }
                        skip_waves_20353 *= 2;
                    }
                    // and back to memory with the final result
                    {
                        if (local_tid_20322 == 0) {
                            ((__global double *) mem_19757)[gtid_18557] =
                                x_20339;
                        }
                    }
                }
            }
        }
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_18672
}
__kernel void generate_datazisegred_large_18611(__global int *global_failure,
                                                __local volatile
                                                int64_t *sync_arr_mem_20260_backing_aligned_0,
                                                __local volatile
                                                int64_t *red_arr_mem_20258_backing_aligned_1,
                                                int64_t N_16778,
                                                int64_t Kzz_16780,
                                                int64_t Kx_16781,
                                                int64_t num_groups_18658,
                                                int64_t groups_per_segment_20244,
                                                int64_t elements_per_thread_20245,
                                                int64_t virt_num_groups_20246,
                                                int64_t threads_per_segment_20248,
                                                __global
                                                unsigned char *mem_19397,
                                                __global
                                                unsigned char *mem_19433,
                                                __global
                                                unsigned char *mem_19752,
                                                __global
                                                unsigned char *segred_tmp_mem_20249,
                                                __global
                                                unsigned char *generate_datazicounter_mem_20251)
{
    #define segred_group_sizze_18657 (generate_datazisegred_group_sizze_18605)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict sync_arr_mem_20260_backing_1 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_20260_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_20258_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20258_backing_aligned_1;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20253;
    int32_t local_tid_20254;
    int64_t group_sizze_20257;
    int32_t wave_sizze_20256;
    int32_t group_tid_20255;
    
    global_tid_20253 = get_global_id(0);
    local_tid_20254 = get_local_id(0);
    group_sizze_20257 = get_local_size(0);
    wave_sizze_20256 = LOCKSTEP_WIDTH;
    group_tid_20255 = get_group_id(0);
    
    int32_t phys_tid_18611 = global_tid_20253;
    __local unsigned char *red_arr_mem_20258;
    
    red_arr_mem_20258 = (__local unsigned char *) red_arr_mem_20258_backing_0;
    
    __local unsigned char *sync_arr_mem_20260;
    
    sync_arr_mem_20260 = (__local unsigned char *) sync_arr_mem_20260_backing_1;
    
    int32_t phys_group_id_20262;
    
    phys_group_id_20262 = get_group_id(0);
    for (int32_t i_20263 = 0; i_20263 <
         sdiv_up32(sext_i64_i32(virt_num_groups_20246) - phys_group_id_20262,
                   sext_i64_i32(num_groups_18658)); i_20263++) {
        int32_t virt_group_id_20264 = phys_group_id_20262 + i_20263 *
                sext_i64_i32(num_groups_18658);
        int32_t flat_segment_id_20265 = squot32(virt_group_id_20264,
                                                sext_i64_i32(groups_per_segment_20244));
        int64_t global_tid_20266 = srem64(sext_i32_i64(virt_group_id_20264) *
                                          segred_group_sizze_18657 +
                                          sext_i32_i64(local_tid_20254),
                                          segred_group_sizze_18657 *
                                          groups_per_segment_20244);
        int64_t slice_20267 = Kzz_16780;
        int64_t slice_20268 = N_16778 * slice_20267;
        int64_t gtid_18600 = squot64(sext_i32_i64(flat_segment_id_20265),
                                     slice_20267);
        int64_t remnant_20269 = sext_i32_i64(flat_segment_id_20265) -
                gtid_18600 * slice_20267;
        int64_t gtid_18601 = remnant_20269;
        int64_t remnant_20270 = remnant_20269 - gtid_18601;
        int64_t gtid_18610;
        double x_acc_20271;
        int64_t chunk_sizze_20272 = smin64(elements_per_thread_20245,
                                           sdiv_up64(Kx_16781 -
                                                     global_tid_20266,
                                                     threads_per_segment_20248));
        double x_18661;
        double x_18662;
        
        // neutral-initialise the accumulators
        {
            x_acc_20271 = 0.0;
        }
        for (int64_t i_20276 = 0; i_20276 < chunk_sizze_20272; i_20276++) {
            gtid_18610 = global_tid_20266 + threads_per_segment_20248 * i_20276;
            // apply map function
            {
                double x_18666 = ((__global double *) mem_19397)[gtid_18600 *
                                                                 Kx_16781 +
                                                                 gtid_18610];
                int64_t binop_x_18838 = Kzz_16780 * gtid_18610;
                int64_t new_index_18839 = gtid_18601 + binop_x_18838;
                double x_18667 = ((__global
                                   double *) mem_19433)[new_index_18839];
                double defunc_1_f_res_18668 = x_18666 * x_18667;
                
                // save map-out results
                { }
                // load accumulator
                {
                    x_18661 = x_acc_20271;
                }
                // load new values
                {
                    x_18662 = defunc_1_f_res_18668;
                }
                // apply reduction operator
                {
                    double defunc_1_op_res_18663 = x_18661 + x_18662;
                    
                    // store in accumulator
                    {
                        x_acc_20271 = defunc_1_op_res_18663;
                    }
                }
            }
        }
        // to reduce current chunk, first store our result in memory
        {
            x_18661 = x_acc_20271;
            ((__local
              double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254)] =
                x_18661;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        
        int32_t offset_20277;
        int32_t skip_waves_20278 = 1;
        double x_20273;
        double x_20274;
        
        offset_20277 = 0;
        // participating threads read initial accumulator
        {
            if (slt32(local_tid_20254,
                      sext_i64_i32(segred_group_sizze_18657))) {
                x_20273 = ((__local
                            double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254 +
                                                         offset_20277)];
            }
        }
        offset_20277 = 1;
        while (slt32(offset_20277, wave_sizze_20256)) {
            if (slt32(local_tid_20254 + offset_20277,
                      sext_i64_i32(segred_group_sizze_18657)) &&
                ((local_tid_20254 - squot32(local_tid_20254, wave_sizze_20256) *
                  wave_sizze_20256) & (2 * offset_20277 - 1)) == 0) {
                // read array element
                {
                    x_20274 = ((volatile __local
                                double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254 +
                                                             offset_20277)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20275 = x_20273 + x_20274;
                    
                    x_20273 = defunc_1_op_res_20275;
                }
                // write result of operation
                {
                    ((volatile __local
                      double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254)] =
                        x_20273;
                }
            }
            offset_20277 *= 2;
        }
        while (slt32(skip_waves_20278,
                     squot32(sext_i64_i32(segred_group_sizze_18657) +
                             wave_sizze_20256 - 1, wave_sizze_20256))) {
            barrier(CLK_LOCAL_MEM_FENCE);
            offset_20277 = skip_waves_20278 * wave_sizze_20256;
            if (slt32(local_tid_20254 + offset_20277,
                      sext_i64_i32(segred_group_sizze_18657)) &&
                ((local_tid_20254 - squot32(local_tid_20254, wave_sizze_20256) *
                  wave_sizze_20256) == 0 && (squot32(local_tid_20254,
                                                     wave_sizze_20256) & (2 *
                                                                          skip_waves_20278 -
                                                                          1)) ==
                 0)) {
                // read array element
                {
                    x_20274 = ((__local
                                double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254 +
                                                             offset_20277)];
                }
                // apply reduction operation
                {
                    double defunc_1_op_res_20275 = x_20273 + x_20274;
                    
                    x_20273 = defunc_1_op_res_20275;
                }
                // write result of operation
                {
                    ((__local
                      double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254)] =
                        x_20273;
                }
            }
            skip_waves_20278 *= 2;
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // first thread saves the result in accumulator
        {
            if (sext_i32_i64(local_tid_20254) == (int64_t) 0) {
                x_acc_20271 = x_20273;
            }
        }
        if (groups_per_segment_20244 == (int64_t) 1) {
            // first thread in group saves final result to memory
            {
                if (local_tid_20254 == 0) {
                    ((__global double *) mem_19752)[gtid_18600 * Kzz_16780 +
                                                    gtid_18601] = x_acc_20271;
                }
            }
        } else {
            int32_t old_counter_20279;
            
            // first thread in group saves group result to global memory
            {
                if (local_tid_20254 == 0) {
                    ((__global
                      double *) segred_tmp_mem_20249)[sext_i32_i64(virt_group_id_20264)] =
                        x_acc_20271;
                    mem_fence_global();
                    old_counter_20279 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) generate_datazicounter_mem_20251)[sext_i32_i64(srem32(flat_segment_id_20265,
                                                                                                              10240))],
                                              (int) 1);
                    ((__local bool *) sync_arr_mem_20260)[(int64_t) 0] =
                        old_counter_20279 == groups_per_segment_20244 -
                        (int64_t) 1;
                }
            }
            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
            
            bool is_last_group_20280 = ((__local
                                         bool *) sync_arr_mem_20260)[(int64_t) 0];
            
            if (is_last_group_20280) {
                if (local_tid_20254 == 0) {
                    old_counter_20279 =
                        atomic_add_i32_global(&((volatile __global
                                                 int *) generate_datazicounter_mem_20251)[sext_i32_i64(srem32(flat_segment_id_20265,
                                                                                                              10240))],
                                              (int) ((int64_t) 0 -
                                                     groups_per_segment_20244));
                }
                // read in the per-group-results
                {
                    int64_t read_per_thread_20281 =
                            sdiv_up64(groups_per_segment_20244,
                                      segred_group_sizze_18657);
                    
                    x_18661 = 0.0;
                    for (int64_t i_20282 = 0; i_20282 < read_per_thread_20281;
                         i_20282++) {
                        int64_t group_res_id_20283 =
                                sext_i32_i64(local_tid_20254) *
                                read_per_thread_20281 + i_20282;
                        int64_t index_of_group_res_20284 =
                                sext_i32_i64(flat_segment_id_20265) *
                                groups_per_segment_20244 + group_res_id_20283;
                        
                        if (slt64(group_res_id_20283,
                                  groups_per_segment_20244)) {
                            x_18662 = ((__global
                                        double *) segred_tmp_mem_20249)[index_of_group_res_20284];
                            
                            double defunc_1_op_res_18663 = x_18661 + x_18662;
                            
                            x_18661 = defunc_1_op_res_18663;
                        }
                    }
                }
                ((__local
                  double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254)] =
                    x_18661;
                barrier(CLK_LOCAL_MEM_FENCE);
                // reduce the per-group results
                {
                    int32_t offset_20285;
                    int32_t skip_waves_20286 = 1;
                    double x_20273;
                    double x_20274;
                    
                    offset_20285 = 0;
                    // participating threads read initial accumulator
                    {
                        if (slt32(local_tid_20254,
                                  sext_i64_i32(segred_group_sizze_18657))) {
                            x_20273 = ((__local
                                        double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254 +
                                                                     offset_20285)];
                        }
                    }
                    offset_20285 = 1;
                    while (slt32(offset_20285, wave_sizze_20256)) {
                        if (slt32(local_tid_20254 + offset_20285,
                                  sext_i64_i32(segred_group_sizze_18657)) &&
                            ((local_tid_20254 - squot32(local_tid_20254,
                                                        wave_sizze_20256) *
                              wave_sizze_20256) & (2 * offset_20285 - 1)) ==
                            0) {
                            // read array element
                            {
                                x_20274 = ((volatile __local
                                            double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254 +
                                                                         offset_20285)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20275 = x_20273 +
                                       x_20274;
                                
                                x_20273 = defunc_1_op_res_20275;
                            }
                            // write result of operation
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254)] =
                                    x_20273;
                            }
                        }
                        offset_20285 *= 2;
                    }
                    while (slt32(skip_waves_20286,
                                 squot32(sext_i64_i32(segred_group_sizze_18657) +
                                         wave_sizze_20256 - 1,
                                         wave_sizze_20256))) {
                        barrier(CLK_LOCAL_MEM_FENCE);
                        offset_20285 = skip_waves_20286 * wave_sizze_20256;
                        if (slt32(local_tid_20254 + offset_20285,
                                  sext_i64_i32(segred_group_sizze_18657)) &&
                            ((local_tid_20254 - squot32(local_tid_20254,
                                                        wave_sizze_20256) *
                              wave_sizze_20256) == 0 &&
                             (squot32(local_tid_20254, wave_sizze_20256) & (2 *
                                                                            skip_waves_20286 -
                                                                            1)) ==
                             0)) {
                            // read array element
                            {
                                x_20274 = ((__local
                                            double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254 +
                                                                         offset_20285)];
                            }
                            // apply reduction operation
                            {
                                double defunc_1_op_res_20275 = x_20273 +
                                       x_20274;
                                
                                x_20273 = defunc_1_op_res_20275;
                            }
                            // write result of operation
                            {
                                ((__local
                                  double *) red_arr_mem_20258)[sext_i32_i64(local_tid_20254)] =
                                    x_20273;
                            }
                        }
                        skip_waves_20286 *= 2;
                    }
                    // and back to memory with the final result
                    {
                        if (local_tid_20254 == 0) {
                            ((__global double *) mem_19752)[gtid_18600 *
                                                            Kzz_16780 +
                                                            gtid_18601] =
                                x_20273;
                        }
                    }
                }
            }
        }
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_18657
}
__kernel void generate_datazisegred_nonseg_17971(__global int *global_failure,
                                                 __local volatile
                                                 int64_t *red_arr_mem_19953_backing_aligned_0,
                                                 __local volatile
                                                 int64_t *red_arr_mem_19951_backing_aligned_1,
                                                 __local volatile
                                                 int64_t *sync_arr_mem_19949_backing_aligned_2,
                                                 int64_t new_y_16801,
                                                 int64_t new_y_16808,
                                                 int64_t split_rng_arg_16811,
                                                 int64_t num_groups_17964,
                                                 int64_t num_threads_19943,
                                                 __global
                                                 unsigned char *mem_19400,
                                                 __global
                                                 unsigned char *mem_19402,
                                                 __global
                                                 unsigned char *mem_19405,
                                                 __global
                                                 unsigned char *generate_datazicounter_mem_19937,
                                                 __global
                                                 unsigned char *segred_tmp_mem_19939,
                                                 __global
                                                 unsigned char *segred_tmp_mem_19941)
{
    #define segred_group_sizze_17962 (generate_datazisegred_group_sizze_17961)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_19953_backing_2 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_19953_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_19951_backing_1 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_19951_backing_aligned_1;
    __local volatile unsigned char *restrict sync_arr_mem_19949_backing_0 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_19949_backing_aligned_2;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_19944;
    int32_t local_tid_19945;
    int64_t group_sizze_19948;
    int32_t wave_sizze_19947;
    int32_t group_tid_19946;
    
    global_tid_19944 = get_global_id(0);
    local_tid_19945 = get_local_id(0);
    group_sizze_19948 = get_local_size(0);
    wave_sizze_19947 = LOCKSTEP_WIDTH;
    group_tid_19946 = get_group_id(0);
    
    int32_t phys_tid_17971 = global_tid_19944;
    __local unsigned char *sync_arr_mem_19949;
    
    sync_arr_mem_19949 = (__local unsigned char *) sync_arr_mem_19949_backing_0;
    
    __local unsigned char *red_arr_mem_19951;
    
    red_arr_mem_19951 = (__local unsigned char *) red_arr_mem_19951_backing_1;
    
    __local unsigned char *red_arr_mem_19953;
    
    red_arr_mem_19953 = (__local unsigned char *) red_arr_mem_19953_backing_2;
    
    int64_t dummy_17969 = (int64_t) 0;
    int64_t gtid_17970 = (int64_t) 0;
    int64_t x_acc_19955;
    int64_t x_acc_19956;
    int64_t chunk_sizze_19957 = smin64(sdiv_up64(split_rng_arg_16811,
                                                 sext_i32_i64(sext_i64_i32(segred_group_sizze_17962 *
                                                 num_groups_17964))),
                                       sdiv_up64(split_rng_arg_16811 -
                                                 phys_tid_17971,
                                                 num_threads_19943));
    int64_t x_16819;
    int64_t x_16820;
    int64_t x_16821;
    int64_t x_16822;
    
    // neutral-initialise the accumulators
    {
        x_acc_19955 = (int64_t) 0;
        x_acc_19956 = (int64_t) 0;
    }
    for (int64_t i_19964 = 0; i_19964 < chunk_sizze_19957; i_19964++) {
        gtid_17970 = phys_tid_17971 + num_threads_19943 * i_19964;
        // apply map function
        {
            int64_t i64_arg_16826 = split_rng_arg_16811 ^ gtid_17970;
            int32_t i64_res_16827 = sext_i64_i32(i64_arg_16826);
            int32_t x_16828 = lshr32(i64_res_16827, 16);
            int32_t x_16829 = i64_res_16827 ^ x_16828;
            int32_t x_16830 = mul32(73244475, x_16829);
            int32_t x_16831 = lshr32(x_16830, 16);
            int32_t x_16832 = x_16830 ^ x_16831;
            int32_t x_16833 = mul32(73244475, x_16832);
            int32_t x_16834 = lshr32(x_16833, 16);
            int32_t x_16835 = x_16833 ^ x_16834;
            int32_t x_16836 = lshr32(x_16835, 16);
            int32_t x_16837 = x_16835 ^ x_16836;
            int32_t x_16838 = mul32(73244475, x_16837);
            int32_t x_16839 = lshr32(x_16838, 16);
            int32_t x_16840 = x_16838 ^ x_16839;
            int32_t x_16841 = mul32(73244475, x_16840);
            int32_t x_16842 = lshr32(x_16841, 16);
            int32_t x_16843 = x_16841 ^ x_16842;
            int64_t unsign_arg_16844 = zext_i32_i64(x_16843);
            int64_t rand_arg_16845 = (int64_t) 539527247 ^ unsign_arg_16844;
            int64_t y_16846 = shl64(rand_arg_16845, (int64_t) 23);
            int64_t x_16847 = rand_arg_16845 ^ y_16846;
            int64_t x_16848 = (int64_t) 824515495 ^ x_16847;
            int64_t y_16849 = lshr64(x_16847, (int64_t) 17);
            int64_t x_16850 = x_16848 ^ y_16849;
            int64_t new_y_16851 = (int64_t) 12 ^ x_16850;
            int64_t x_16852 = (int64_t) 6916537531571111 ^ new_y_16851;
            int64_t x_16853 = (int64_t) 52768993618 ^ x_16852;
            int64_t y_16854 = lshr64(new_y_16851, (int64_t) 26);
            int64_t new_y_16855 = x_16853 ^ y_16854;
            int64_t y_16856 = shl64(new_y_16851, (int64_t) 23);
            int64_t x_16857 = new_y_16851 ^ y_16856;
            int64_t x_16858 = new_y_16855 ^ x_16857;
            int64_t y_16859 = lshr64(x_16857, (int64_t) 17);
            int64_t x_16860 = x_16858 ^ y_16859;
            int64_t y_16861 = lshr64(new_y_16855, (int64_t) 26);
            int64_t new_y_16862 = x_16860 ^ y_16861;
            int64_t y_16863 = shl64(new_y_16855, (int64_t) 23);
            int64_t x_16864 = new_y_16855 ^ y_16863;
            int64_t x_16865 = new_y_16862 ^ x_16864;
            int64_t y_16866 = lshr64(x_16864, (int64_t) 17);
            int64_t x_16867 = x_16865 ^ y_16866;
            int64_t y_16868 = lshr64(new_y_16862, (int64_t) 26);
            int64_t new_y_16869 = x_16867 ^ y_16868;
            int64_t rand_arg_16870 = new_y_16801 ^ new_y_16862;
            int64_t rand_arg_16871 = new_y_16808 ^ new_y_16869;
            int64_t y_16872 = shl64(rand_arg_16870, (int64_t) 23);
            int64_t x_16873 = rand_arg_16870 ^ y_16872;
            int64_t x_16874 = rand_arg_16871 ^ x_16873;
            int64_t y_16875 = lshr64(x_16873, (int64_t) 17);
            int64_t x_16876 = x_16874 ^ y_16875;
            int64_t y_16877 = lshr64(rand_arg_16871, (int64_t) 26);
            int64_t new_y_16878 = x_16876 ^ y_16877;
            int64_t y_16879 = shl64(rand_arg_16871, (int64_t) 23);
            int64_t x_16880 = rand_arg_16871 ^ y_16879;
            int64_t x_16881 = new_y_16878 ^ x_16880;
            int64_t y_16882 = lshr64(x_16880, (int64_t) 17);
            int64_t x_16883 = x_16881 ^ y_16882;
            int64_t y_16884 = lshr64(new_y_16878, (int64_t) 26);
            int64_t new_y_16885 = x_16883 ^ y_16884;
            int64_t y_16886 = shl64(new_y_16878, (int64_t) 23);
            int64_t x_16887 = new_y_16878 ^ y_16886;
            int64_t x_16888 = new_y_16885 ^ x_16887;
            int64_t y_16889 = lshr64(x_16887, (int64_t) 17);
            int64_t x_16890 = x_16888 ^ y_16889;
            int64_t y_16891 = lshr64(new_y_16885, (int64_t) 26);
            int64_t new_y_16892 = x_16890 ^ y_16891;
            int64_t rand_res_16893 = add64(new_y_16885, new_y_16892);
            int64_t y_16894 = shl64(new_y_16885, (int64_t) 23);
            int64_t x_16895 = new_y_16885 ^ y_16894;
            int64_t x_16896 = new_y_16892 ^ x_16895;
            int64_t y_16897 = lshr64(x_16895, (int64_t) 17);
            int64_t x_16898 = x_16896 ^ y_16897;
            int64_t y_16899 = lshr64(new_y_16892, (int64_t) 26);
            int64_t new_y_16900 = x_16898 ^ y_16899;
            int64_t rand_res_16901 = add64(new_y_16892, new_y_16900);
            double u64_res_16902 = uitofp_i64_f64(rand_res_16893);
            double zs_res_16903 = u64_res_16902 / 1.8446744073709552e19;
            double u64_res_16904 = uitofp_i64_f64(rand_res_16901);
            double zs_res_16905 = u64_res_16904 / 1.8446744073709552e19;
            double log_res_16906;
            
            log_res_16906 = futrts_log64(zs_res_16903);
            
            double zt_res_16907 = -2.0 * log_res_16906;
            double sqrt_res_16908;
            
            sqrt_res_16908 = futrts_sqrt64(zt_res_16907);
            
            double zt_res_16909 = 6.283185307179586 * zs_res_16905;
            double cos_res_16910;
            
            cos_res_16910 = futrts_cos64(zt_res_16909);
            
            double zt_res_16911 = sqrt_res_16908 * cos_res_16910;
            
            // save map-out results
            {
                ((__global double *) mem_19405)[dummy_17969 *
                                                split_rng_arg_16811 +
                                                gtid_17970] = zt_res_16911;
            }
            // load accumulator
            {
                x_16819 = x_acc_19955;
                x_16820 = x_acc_19956;
            }
            // load new values
            {
                x_16821 = new_y_16892;
                x_16822 = new_y_16900;
            }
            // apply reduction operator
            {
                int64_t defunc_1_op_res_16823 = x_16819 ^ x_16821;
                int64_t defunc_1_op_res_16824 = x_16820 ^ x_16822;
                
                // store in accumulator
                {
                    x_acc_19955 = defunc_1_op_res_16823;
                    x_acc_19956 = defunc_1_op_res_16824;
                }
            }
        }
    }
    // to reduce current chunk, first store our result in memory
    {
        x_16819 = x_acc_19955;
        x_16820 = x_acc_19956;
        ((__local int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945)] =
            x_16819;
        ((__local int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945)] =
            x_16820;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t offset_19965;
    int32_t skip_waves_19966 = 1;
    int64_t x_19958;
    int64_t x_19959;
    int64_t x_19960;
    int64_t x_19961;
    
    offset_19965 = 0;
    // participating threads read initial accumulator
    {
        if (slt32(local_tid_19945, sext_i64_i32(segred_group_sizze_17962))) {
            x_19958 = ((__local
                        int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945 +
                                                      offset_19965)];
            x_19959 = ((__local
                        int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945 +
                                                      offset_19965)];
        }
    }
    offset_19965 = 1;
    while (slt32(offset_19965, wave_sizze_19947)) {
        if (slt32(local_tid_19945 + offset_19965,
                  sext_i64_i32(segred_group_sizze_17962)) && ((local_tid_19945 -
                                                               squot32(local_tid_19945,
                                                                       wave_sizze_19947) *
                                                               wave_sizze_19947) &
                                                              (2 *
                                                               offset_19965 -
                                                               1)) == 0) {
            // read array element
            {
                x_19960 = ((volatile __local
                            int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945 +
                                                          offset_19965)];
                x_19961 = ((volatile __local
                            int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945 +
                                                          offset_19965)];
            }
            // apply reduction operation
            {
                int64_t defunc_1_op_res_19962 = x_19958 ^ x_19960;
                int64_t defunc_1_op_res_19963 = x_19959 ^ x_19961;
                
                x_19958 = defunc_1_op_res_19962;
                x_19959 = defunc_1_op_res_19963;
            }
            // write result of operation
            {
                ((volatile __local
                  int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945)] =
                    x_19958;
                ((volatile __local
                  int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945)] =
                    x_19959;
            }
        }
        offset_19965 *= 2;
    }
    while (slt32(skip_waves_19966,
                 squot32(sext_i64_i32(segred_group_sizze_17962) +
                         wave_sizze_19947 - 1, wave_sizze_19947))) {
        barrier(CLK_LOCAL_MEM_FENCE);
        offset_19965 = skip_waves_19966 * wave_sizze_19947;
        if (slt32(local_tid_19945 + offset_19965,
                  sext_i64_i32(segred_group_sizze_17962)) && ((local_tid_19945 -
                                                               squot32(local_tid_19945,
                                                                       wave_sizze_19947) *
                                                               wave_sizze_19947) ==
                                                              0 &&
                                                              (squot32(local_tid_19945,
                                                                       wave_sizze_19947) &
                                                               (2 *
                                                                skip_waves_19966 -
                                                                1)) == 0)) {
            // read array element
            {
                x_19960 = ((__local
                            int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945 +
                                                          offset_19965)];
                x_19961 = ((__local
                            int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945 +
                                                          offset_19965)];
            }
            // apply reduction operation
            {
                int64_t defunc_1_op_res_19962 = x_19958 ^ x_19960;
                int64_t defunc_1_op_res_19963 = x_19959 ^ x_19961;
                
                x_19958 = defunc_1_op_res_19962;
                x_19959 = defunc_1_op_res_19963;
            }
            // write result of operation
            {
                ((__local
                  int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945)] =
                    x_19958;
                ((__local
                  int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945)] =
                    x_19959;
            }
        }
        skip_waves_19966 *= 2;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // first thread saves the result in accumulator
    {
        if (sext_i32_i64(local_tid_19945) == (int64_t) 0) {
            x_acc_19955 = x_19958;
            x_acc_19956 = x_19959;
        }
    }
    
    int32_t old_counter_19967;
    
    // first thread in group saves group result to global memory
    {
        if (local_tid_19945 == 0) {
            ((__global
              int64_t *) segred_tmp_mem_19939)[sext_i32_i64(group_tid_19946)] =
                x_acc_19955;
            ((__global
              int64_t *) segred_tmp_mem_19941)[sext_i32_i64(group_tid_19946)] =
                x_acc_19956;
            mem_fence_global();
            old_counter_19967 = atomic_add_i32_global(&((volatile __global
                                                         int *) generate_datazicounter_mem_19937)[(int64_t) 0],
                                                      (int) 1);
            ((__local bool *) sync_arr_mem_19949)[(int64_t) 0] =
                old_counter_19967 == num_groups_17964 - (int64_t) 1;
        }
    }
    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    
    bool is_last_group_19968 = ((__local
                                 bool *) sync_arr_mem_19949)[(int64_t) 0];
    
    if (is_last_group_19968) {
        if (local_tid_19945 == 0) {
            old_counter_19967 = atomic_add_i32_global(&((volatile __global
                                                         int *) generate_datazicounter_mem_19937)[(int64_t) 0],
                                                      (int) ((int64_t) 0 -
                                                             num_groups_17964));
        }
        // read in the per-group-results
        {
            int64_t read_per_thread_19969 = sdiv_up64(num_groups_17964,
                                                      segred_group_sizze_17962);
            
            x_16819 = (int64_t) 0;
            x_16820 = (int64_t) 0;
            for (int64_t i_19970 = 0; i_19970 < read_per_thread_19969;
                 i_19970++) {
                int64_t group_res_id_19971 = sext_i32_i64(local_tid_19945) *
                        read_per_thread_19969 + i_19970;
                int64_t index_of_group_res_19972 = group_res_id_19971;
                
                if (slt64(group_res_id_19971, num_groups_17964)) {
                    x_16821 = ((__global
                                int64_t *) segred_tmp_mem_19939)[index_of_group_res_19972];
                    x_16822 = ((__global
                                int64_t *) segred_tmp_mem_19941)[index_of_group_res_19972];
                    
                    int64_t defunc_1_op_res_16823 = x_16819 ^ x_16821;
                    int64_t defunc_1_op_res_16824 = x_16820 ^ x_16822;
                    
                    x_16819 = defunc_1_op_res_16823;
                    x_16820 = defunc_1_op_res_16824;
                }
            }
        }
        ((__local int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945)] =
            x_16819;
        ((__local int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945)] =
            x_16820;
        barrier(CLK_LOCAL_MEM_FENCE);
        // reduce the per-group results
        {
            int32_t offset_19973;
            int32_t skip_waves_19974 = 1;
            int64_t x_19958;
            int64_t x_19959;
            int64_t x_19960;
            int64_t x_19961;
            
            offset_19973 = 0;
            // participating threads read initial accumulator
            {
                if (slt32(local_tid_19945,
                          sext_i64_i32(segred_group_sizze_17962))) {
                    x_19958 = ((__local
                                int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945 +
                                                              offset_19973)];
                    x_19959 = ((__local
                                int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945 +
                                                              offset_19973)];
                }
            }
            offset_19973 = 1;
            while (slt32(offset_19973, wave_sizze_19947)) {
                if (slt32(local_tid_19945 + offset_19973,
                          sext_i64_i32(segred_group_sizze_17962)) &&
                    ((local_tid_19945 - squot32(local_tid_19945,
                                                wave_sizze_19947) *
                      wave_sizze_19947) & (2 * offset_19973 - 1)) == 0) {
                    // read array element
                    {
                        x_19960 = ((volatile __local
                                    int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945 +
                                                                  offset_19973)];
                        x_19961 = ((volatile __local
                                    int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945 +
                                                                  offset_19973)];
                    }
                    // apply reduction operation
                    {
                        int64_t defunc_1_op_res_19962 = x_19958 ^ x_19960;
                        int64_t defunc_1_op_res_19963 = x_19959 ^ x_19961;
                        
                        x_19958 = defunc_1_op_res_19962;
                        x_19959 = defunc_1_op_res_19963;
                    }
                    // write result of operation
                    {
                        ((volatile __local
                          int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945)] =
                            x_19958;
                        ((volatile __local
                          int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945)] =
                            x_19959;
                    }
                }
                offset_19973 *= 2;
            }
            while (slt32(skip_waves_19974,
                         squot32(sext_i64_i32(segred_group_sizze_17962) +
                                 wave_sizze_19947 - 1, wave_sizze_19947))) {
                barrier(CLK_LOCAL_MEM_FENCE);
                offset_19973 = skip_waves_19974 * wave_sizze_19947;
                if (slt32(local_tid_19945 + offset_19973,
                          sext_i64_i32(segred_group_sizze_17962)) &&
                    ((local_tid_19945 - squot32(local_tid_19945,
                                                wave_sizze_19947) *
                      wave_sizze_19947) == 0 && (squot32(local_tid_19945,
                                                         wave_sizze_19947) &
                                                 (2 * skip_waves_19974 - 1)) ==
                     0)) {
                    // read array element
                    {
                        x_19960 = ((__local
                                    int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945 +
                                                                  offset_19973)];
                        x_19961 = ((__local
                                    int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945 +
                                                                  offset_19973)];
                    }
                    // apply reduction operation
                    {
                        int64_t defunc_1_op_res_19962 = x_19958 ^ x_19960;
                        int64_t defunc_1_op_res_19963 = x_19959 ^ x_19961;
                        
                        x_19958 = defunc_1_op_res_19962;
                        x_19959 = defunc_1_op_res_19963;
                    }
                    // write result of operation
                    {
                        ((__local
                          int64_t *) red_arr_mem_19951)[sext_i32_i64(local_tid_19945)] =
                            x_19958;
                        ((__local
                          int64_t *) red_arr_mem_19953)[sext_i32_i64(local_tid_19945)] =
                            x_19959;
                    }
                }
                skip_waves_19974 *= 2;
            }
            // and back to memory with the final result
            {
                if (local_tid_19945 == 0) {
                    ((__global int64_t *) mem_19400)[(int64_t) 0] = x_19958;
                    ((__global int64_t *) mem_19402)[(int64_t) 0] = x_19959;
                }
            }
        }
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17962
}
__kernel void generate_datazisegred_nonseg_17985(__global int *global_failure,
                                                 __local volatile
                                                 int64_t *red_arr_mem_20003_backing_aligned_0,
                                                 __local volatile
                                                 int64_t *red_arr_mem_20001_backing_aligned_1,
                                                 __local volatile
                                                 int64_t *sync_arr_mem_19999_backing_aligned_2,
                                                 int64_t defunc_2_reduce_res_16816,
                                                 int64_t defunc_2_reduce_res_16817,
                                                 int64_t split_rng_arg_16931,
                                                 int64_t num_groups_17976,
                                                 int64_t num_threads_19993,
                                                 __global
                                                 unsigned char *mem_19408,
                                                 __global
                                                 unsigned char *mem_19410,
                                                 __global
                                                 unsigned char *mem_19413,
                                                 __global
                                                 unsigned char *mem_19416,
                                                 __global
                                                 unsigned char *mem_19419,
                                                 __global
                                                 unsigned char *generate_datazicounter_mem_19987,
                                                 __global
                                                 unsigned char *segred_tmp_mem_19989,
                                                 __global
                                                 unsigned char *segred_tmp_mem_19991)
{
    #define segred_group_sizze_17974 (generate_datazisegred_group_sizze_17973)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20003_backing_2 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20003_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_20001_backing_1 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20001_backing_aligned_1;
    __local volatile unsigned char *restrict sync_arr_mem_19999_backing_0 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_19999_backing_aligned_2;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_19994;
    int32_t local_tid_19995;
    int64_t group_sizze_19998;
    int32_t wave_sizze_19997;
    int32_t group_tid_19996;
    
    global_tid_19994 = get_global_id(0);
    local_tid_19995 = get_local_id(0);
    group_sizze_19998 = get_local_size(0);
    wave_sizze_19997 = LOCKSTEP_WIDTH;
    group_tid_19996 = get_group_id(0);
    
    int32_t phys_tid_17985 = global_tid_19994;
    __local unsigned char *sync_arr_mem_19999;
    
    sync_arr_mem_19999 = (__local unsigned char *) sync_arr_mem_19999_backing_0;
    
    __local unsigned char *red_arr_mem_20001;
    
    red_arr_mem_20001 = (__local unsigned char *) red_arr_mem_20001_backing_1;
    
    __local unsigned char *red_arr_mem_20003;
    
    red_arr_mem_20003 = (__local unsigned char *) red_arr_mem_20003_backing_2;
    
    int64_t dummy_17983 = (int64_t) 0;
    int64_t gtid_17984 = (int64_t) 0;
    int64_t x_acc_20005;
    int64_t x_acc_20006;
    int64_t chunk_sizze_20007 = smin64(sdiv_up64(split_rng_arg_16931,
                                                 sext_i32_i64(sext_i64_i32(segred_group_sizze_17974 *
                                                 num_groups_17976))),
                                       sdiv_up64(split_rng_arg_16931 -
                                                 phys_tid_17985,
                                                 num_threads_19993));
    int64_t x_16941;
    int64_t x_16942;
    int64_t x_16943;
    int64_t x_16944;
    
    // neutral-initialise the accumulators
    {
        x_acc_20005 = (int64_t) 0;
        x_acc_20006 = (int64_t) 0;
    }
    for (int64_t i_20014 = 0; i_20014 < chunk_sizze_20007; i_20014++) {
        gtid_17984 = phys_tid_17985 + num_threads_19993 * i_20014;
        // apply map function
        {
            int64_t i64_arg_16948 = split_rng_arg_16931 ^ gtid_17984;
            int32_t i64_res_16949 = sext_i64_i32(i64_arg_16948);
            int32_t x_16950 = lshr32(i64_res_16949, 16);
            int32_t x_16951 = i64_res_16949 ^ x_16950;
            int32_t x_16952 = mul32(73244475, x_16951);
            int32_t x_16953 = lshr32(x_16952, 16);
            int32_t x_16954 = x_16952 ^ x_16953;
            int32_t x_16955 = mul32(73244475, x_16954);
            int32_t x_16956 = lshr32(x_16955, 16);
            int32_t x_16957 = x_16955 ^ x_16956;
            int32_t x_16958 = lshr32(x_16957, 16);
            int32_t x_16959 = x_16957 ^ x_16958;
            int32_t x_16960 = mul32(73244475, x_16959);
            int32_t x_16961 = lshr32(x_16960, 16);
            int32_t x_16962 = x_16960 ^ x_16961;
            int32_t x_16963 = mul32(73244475, x_16962);
            int32_t x_16964 = lshr32(x_16963, 16);
            int32_t x_16965 = x_16963 ^ x_16964;
            int64_t unsign_arg_16966 = zext_i32_i64(x_16965);
            int64_t rand_arg_16967 = (int64_t) 539527247 ^ unsign_arg_16966;
            int64_t y_16968 = shl64(rand_arg_16967, (int64_t) 23);
            int64_t x_16969 = rand_arg_16967 ^ y_16968;
            int64_t x_16970 = (int64_t) 824515495 ^ x_16969;
            int64_t y_16971 = lshr64(x_16969, (int64_t) 17);
            int64_t x_16972 = x_16970 ^ y_16971;
            int64_t new_y_16973 = (int64_t) 12 ^ x_16972;
            int64_t x_16974 = (int64_t) 6916537531571111 ^ new_y_16973;
            int64_t x_16975 = (int64_t) 52768993618 ^ x_16974;
            int64_t y_16976 = lshr64(new_y_16973, (int64_t) 26);
            int64_t new_y_16977 = x_16975 ^ y_16976;
            int64_t y_16978 = shl64(new_y_16973, (int64_t) 23);
            int64_t x_16979 = new_y_16973 ^ y_16978;
            int64_t x_16980 = new_y_16977 ^ x_16979;
            int64_t y_16981 = lshr64(x_16979, (int64_t) 17);
            int64_t x_16982 = x_16980 ^ y_16981;
            int64_t y_16983 = lshr64(new_y_16977, (int64_t) 26);
            int64_t new_y_16984 = x_16982 ^ y_16983;
            int64_t y_16985 = shl64(new_y_16977, (int64_t) 23);
            int64_t x_16986 = new_y_16977 ^ y_16985;
            int64_t x_16987 = new_y_16984 ^ x_16986;
            int64_t y_16988 = lshr64(x_16986, (int64_t) 17);
            int64_t x_16989 = x_16987 ^ y_16988;
            int64_t y_16990 = lshr64(new_y_16984, (int64_t) 26);
            int64_t new_y_16991 = x_16989 ^ y_16990;
            int64_t rand_arg_16992 = defunc_2_reduce_res_16816 ^ new_y_16984;
            int64_t rand_arg_16993 = defunc_2_reduce_res_16817 ^ new_y_16991;
            int64_t y_16994 = shl64(rand_arg_16992, (int64_t) 23);
            int64_t x_16995 = rand_arg_16992 ^ y_16994;
            int64_t x_16996 = rand_arg_16993 ^ x_16995;
            int64_t y_16997 = lshr64(x_16995, (int64_t) 17);
            int64_t x_16998 = x_16996 ^ y_16997;
            int64_t y_16999 = lshr64(rand_arg_16993, (int64_t) 26);
            int64_t new_y_17000 = x_16998 ^ y_16999;
            int64_t y_17001 = shl64(rand_arg_16993, (int64_t) 23);
            int64_t x_17002 = rand_arg_16993 ^ y_17001;
            int64_t x_17003 = new_y_17000 ^ x_17002;
            int64_t y_17004 = lshr64(x_17002, (int64_t) 17);
            int64_t x_17005 = x_17003 ^ y_17004;
            int64_t y_17006 = lshr64(new_y_17000, (int64_t) 26);
            int64_t new_y_17007 = x_17005 ^ y_17006;
            int64_t y_17008 = shl64(new_y_17000, (int64_t) 23);
            int64_t x_17009 = new_y_17000 ^ y_17008;
            int64_t x_17010 = new_y_17007 ^ x_17009;
            int64_t y_17011 = lshr64(x_17009, (int64_t) 17);
            int64_t x_17012 = x_17010 ^ y_17011;
            int64_t y_17013 = lshr64(new_y_17007, (int64_t) 26);
            int64_t new_y_17014 = x_17012 ^ y_17013;
            int64_t rand_res_17015 = add64(new_y_17007, new_y_17014);
            int64_t y_17016 = shl64(new_y_17007, (int64_t) 23);
            int64_t x_17017 = new_y_17007 ^ y_17016;
            int64_t x_17018 = new_y_17014 ^ x_17017;
            int64_t y_17019 = lshr64(x_17017, (int64_t) 17);
            int64_t x_17020 = x_17018 ^ y_17019;
            int64_t y_17021 = lshr64(new_y_17014, (int64_t) 26);
            int64_t new_y_17022 = x_17020 ^ y_17021;
            int64_t rand_res_17023 = add64(new_y_17014, new_y_17022);
            double u64_res_17024 = uitofp_i64_f64(rand_res_17015);
            double zs_res_17025 = u64_res_17024 / 1.8446744073709552e19;
            double u64_res_17026 = uitofp_i64_f64(rand_res_17023);
            double zs_res_17027 = u64_res_17026 / 1.8446744073709552e19;
            double log_res_17028;
            
            log_res_17028 = futrts_log64(zs_res_17025);
            
            double zt_res_17029 = -2.0 * log_res_17028;
            double sqrt_res_17030;
            
            sqrt_res_17030 = futrts_sqrt64(zt_res_17029);
            
            double zt_res_17031 = 6.283185307179586 * zs_res_17027;
            double cos_res_17032;
            
            cos_res_17032 = futrts_cos64(zt_res_17031);
            
            double zt_res_17033 = sqrt_res_17030 * cos_res_17032;
            
            // save map-out results
            {
                ((__global int64_t *) mem_19413)[dummy_17983 *
                                                 split_rng_arg_16931 +
                                                 gtid_17984] = new_y_17014;
                ((__global int64_t *) mem_19416)[dummy_17983 *
                                                 split_rng_arg_16931 +
                                                 gtid_17984] = new_y_17022;
                ((__global double *) mem_19419)[dummy_17983 *
                                                split_rng_arg_16931 +
                                                gtid_17984] = zt_res_17033;
            }
            // load accumulator
            {
                x_16941 = x_acc_20005;
                x_16942 = x_acc_20006;
            }
            // load new values
            {
                x_16943 = new_y_17014;
                x_16944 = new_y_17022;
            }
            // apply reduction operator
            {
                int64_t defunc_1_op_res_16945 = x_16941 ^ x_16943;
                int64_t defunc_1_op_res_16946 = x_16942 ^ x_16944;
                
                // store in accumulator
                {
                    x_acc_20005 = defunc_1_op_res_16945;
                    x_acc_20006 = defunc_1_op_res_16946;
                }
            }
        }
    }
    // to reduce current chunk, first store our result in memory
    {
        x_16941 = x_acc_20005;
        x_16942 = x_acc_20006;
        ((__local int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995)] =
            x_16941;
        ((__local int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995)] =
            x_16942;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t offset_20015;
    int32_t skip_waves_20016 = 1;
    int64_t x_20008;
    int64_t x_20009;
    int64_t x_20010;
    int64_t x_20011;
    
    offset_20015 = 0;
    // participating threads read initial accumulator
    {
        if (slt32(local_tid_19995, sext_i64_i32(segred_group_sizze_17974))) {
            x_20008 = ((__local
                        int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995 +
                                                      offset_20015)];
            x_20009 = ((__local
                        int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995 +
                                                      offset_20015)];
        }
    }
    offset_20015 = 1;
    while (slt32(offset_20015, wave_sizze_19997)) {
        if (slt32(local_tid_19995 + offset_20015,
                  sext_i64_i32(segred_group_sizze_17974)) && ((local_tid_19995 -
                                                               squot32(local_tid_19995,
                                                                       wave_sizze_19997) *
                                                               wave_sizze_19997) &
                                                              (2 *
                                                               offset_20015 -
                                                               1)) == 0) {
            // read array element
            {
                x_20010 = ((volatile __local
                            int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995 +
                                                          offset_20015)];
                x_20011 = ((volatile __local
                            int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995 +
                                                          offset_20015)];
            }
            // apply reduction operation
            {
                int64_t defunc_1_op_res_20012 = x_20008 ^ x_20010;
                int64_t defunc_1_op_res_20013 = x_20009 ^ x_20011;
                
                x_20008 = defunc_1_op_res_20012;
                x_20009 = defunc_1_op_res_20013;
            }
            // write result of operation
            {
                ((volatile __local
                  int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995)] =
                    x_20008;
                ((volatile __local
                  int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995)] =
                    x_20009;
            }
        }
        offset_20015 *= 2;
    }
    while (slt32(skip_waves_20016,
                 squot32(sext_i64_i32(segred_group_sizze_17974) +
                         wave_sizze_19997 - 1, wave_sizze_19997))) {
        barrier(CLK_LOCAL_MEM_FENCE);
        offset_20015 = skip_waves_20016 * wave_sizze_19997;
        if (slt32(local_tid_19995 + offset_20015,
                  sext_i64_i32(segred_group_sizze_17974)) && ((local_tid_19995 -
                                                               squot32(local_tid_19995,
                                                                       wave_sizze_19997) *
                                                               wave_sizze_19997) ==
                                                              0 &&
                                                              (squot32(local_tid_19995,
                                                                       wave_sizze_19997) &
                                                               (2 *
                                                                skip_waves_20016 -
                                                                1)) == 0)) {
            // read array element
            {
                x_20010 = ((__local
                            int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995 +
                                                          offset_20015)];
                x_20011 = ((__local
                            int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995 +
                                                          offset_20015)];
            }
            // apply reduction operation
            {
                int64_t defunc_1_op_res_20012 = x_20008 ^ x_20010;
                int64_t defunc_1_op_res_20013 = x_20009 ^ x_20011;
                
                x_20008 = defunc_1_op_res_20012;
                x_20009 = defunc_1_op_res_20013;
            }
            // write result of operation
            {
                ((__local
                  int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995)] =
                    x_20008;
                ((__local
                  int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995)] =
                    x_20009;
            }
        }
        skip_waves_20016 *= 2;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // first thread saves the result in accumulator
    {
        if (sext_i32_i64(local_tid_19995) == (int64_t) 0) {
            x_acc_20005 = x_20008;
            x_acc_20006 = x_20009;
        }
    }
    
    int32_t old_counter_20017;
    
    // first thread in group saves group result to global memory
    {
        if (local_tid_19995 == 0) {
            ((__global
              int64_t *) segred_tmp_mem_19989)[sext_i32_i64(group_tid_19996)] =
                x_acc_20005;
            ((__global
              int64_t *) segred_tmp_mem_19991)[sext_i32_i64(group_tid_19996)] =
                x_acc_20006;
            mem_fence_global();
            old_counter_20017 = atomic_add_i32_global(&((volatile __global
                                                         int *) generate_datazicounter_mem_19987)[(int64_t) 0],
                                                      (int) 1);
            ((__local bool *) sync_arr_mem_19999)[(int64_t) 0] =
                old_counter_20017 == num_groups_17976 - (int64_t) 1;
        }
    }
    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    
    bool is_last_group_20018 = ((__local
                                 bool *) sync_arr_mem_19999)[(int64_t) 0];
    
    if (is_last_group_20018) {
        if (local_tid_19995 == 0) {
            old_counter_20017 = atomic_add_i32_global(&((volatile __global
                                                         int *) generate_datazicounter_mem_19987)[(int64_t) 0],
                                                      (int) ((int64_t) 0 -
                                                             num_groups_17976));
        }
        // read in the per-group-results
        {
            int64_t read_per_thread_20019 = sdiv_up64(num_groups_17976,
                                                      segred_group_sizze_17974);
            
            x_16941 = (int64_t) 0;
            x_16942 = (int64_t) 0;
            for (int64_t i_20020 = 0; i_20020 < read_per_thread_20019;
                 i_20020++) {
                int64_t group_res_id_20021 = sext_i32_i64(local_tid_19995) *
                        read_per_thread_20019 + i_20020;
                int64_t index_of_group_res_20022 = group_res_id_20021;
                
                if (slt64(group_res_id_20021, num_groups_17976)) {
                    x_16943 = ((__global
                                int64_t *) segred_tmp_mem_19989)[index_of_group_res_20022];
                    x_16944 = ((__global
                                int64_t *) segred_tmp_mem_19991)[index_of_group_res_20022];
                    
                    int64_t defunc_1_op_res_16945 = x_16941 ^ x_16943;
                    int64_t defunc_1_op_res_16946 = x_16942 ^ x_16944;
                    
                    x_16941 = defunc_1_op_res_16945;
                    x_16942 = defunc_1_op_res_16946;
                }
            }
        }
        ((__local int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995)] =
            x_16941;
        ((__local int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995)] =
            x_16942;
        barrier(CLK_LOCAL_MEM_FENCE);
        // reduce the per-group results
        {
            int32_t offset_20023;
            int32_t skip_waves_20024 = 1;
            int64_t x_20008;
            int64_t x_20009;
            int64_t x_20010;
            int64_t x_20011;
            
            offset_20023 = 0;
            // participating threads read initial accumulator
            {
                if (slt32(local_tid_19995,
                          sext_i64_i32(segred_group_sizze_17974))) {
                    x_20008 = ((__local
                                int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995 +
                                                              offset_20023)];
                    x_20009 = ((__local
                                int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995 +
                                                              offset_20023)];
                }
            }
            offset_20023 = 1;
            while (slt32(offset_20023, wave_sizze_19997)) {
                if (slt32(local_tid_19995 + offset_20023,
                          sext_i64_i32(segred_group_sizze_17974)) &&
                    ((local_tid_19995 - squot32(local_tid_19995,
                                                wave_sizze_19997) *
                      wave_sizze_19997) & (2 * offset_20023 - 1)) == 0) {
                    // read array element
                    {
                        x_20010 = ((volatile __local
                                    int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995 +
                                                                  offset_20023)];
                        x_20011 = ((volatile __local
                                    int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995 +
                                                                  offset_20023)];
                    }
                    // apply reduction operation
                    {
                        int64_t defunc_1_op_res_20012 = x_20008 ^ x_20010;
                        int64_t defunc_1_op_res_20013 = x_20009 ^ x_20011;
                        
                        x_20008 = defunc_1_op_res_20012;
                        x_20009 = defunc_1_op_res_20013;
                    }
                    // write result of operation
                    {
                        ((volatile __local
                          int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995)] =
                            x_20008;
                        ((volatile __local
                          int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995)] =
                            x_20009;
                    }
                }
                offset_20023 *= 2;
            }
            while (slt32(skip_waves_20024,
                         squot32(sext_i64_i32(segred_group_sizze_17974) +
                                 wave_sizze_19997 - 1, wave_sizze_19997))) {
                barrier(CLK_LOCAL_MEM_FENCE);
                offset_20023 = skip_waves_20024 * wave_sizze_19997;
                if (slt32(local_tid_19995 + offset_20023,
                          sext_i64_i32(segred_group_sizze_17974)) &&
                    ((local_tid_19995 - squot32(local_tid_19995,
                                                wave_sizze_19997) *
                      wave_sizze_19997) == 0 && (squot32(local_tid_19995,
                                                         wave_sizze_19997) &
                                                 (2 * skip_waves_20024 - 1)) ==
                     0)) {
                    // read array element
                    {
                        x_20010 = ((__local
                                    int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995 +
                                                                  offset_20023)];
                        x_20011 = ((__local
                                    int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995 +
                                                                  offset_20023)];
                    }
                    // apply reduction operation
                    {
                        int64_t defunc_1_op_res_20012 = x_20008 ^ x_20010;
                        int64_t defunc_1_op_res_20013 = x_20009 ^ x_20011;
                        
                        x_20008 = defunc_1_op_res_20012;
                        x_20009 = defunc_1_op_res_20013;
                    }
                    // write result of operation
                    {
                        ((__local
                          int64_t *) red_arr_mem_20001)[sext_i32_i64(local_tid_19995)] =
                            x_20008;
                        ((__local
                          int64_t *) red_arr_mem_20003)[sext_i32_i64(local_tid_19995)] =
                            x_20009;
                    }
                }
                skip_waves_20024 *= 2;
            }
            // and back to memory with the final result
            {
                if (local_tid_19995 == 0) {
                    ((__global int64_t *) mem_19408)[(int64_t) 0] = x_20008;
                    ((__global int64_t *) mem_19410)[(int64_t) 0] = x_20009;
                }
            }
        }
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17974
}
__kernel void generate_datazisegred_nonseg_17999(__global int *global_failure,
                                                 __local volatile
                                                 int64_t *red_arr_mem_20042_backing_aligned_0,
                                                 __local volatile
                                                 int64_t *red_arr_mem_20040_backing_aligned_1,
                                                 __local volatile
                                                 int64_t *sync_arr_mem_20038_backing_aligned_2,
                                                 int64_t defunc_2_reduce_res_16936,
                                                 int64_t defunc_2_reduce_res_16937,
                                                 int64_t split_rng_arg_17035,
                                                 int64_t num_groups_17990,
                                                 int64_t num_threads_20032,
                                                 __global
                                                 unsigned char *mem_19422,
                                                 __global
                                                 unsigned char *mem_19424,
                                                 __global
                                                 unsigned char *mem_19427,
                                                 __global
                                                 unsigned char *mem_19430,
                                                 __global
                                                 unsigned char *mem_19433,
                                                 __global
                                                 unsigned char *generate_datazicounter_mem_20026,
                                                 __global
                                                 unsigned char *segred_tmp_mem_20028,
                                                 __global
                                                 unsigned char *segred_tmp_mem_20030)
{
    #define segred_group_sizze_17988 (generate_datazisegred_group_sizze_17987)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20042_backing_2 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20042_backing_aligned_0;
    __local volatile unsigned char *restrict red_arr_mem_20040_backing_1 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20040_backing_aligned_1;
    __local volatile unsigned char *restrict sync_arr_mem_20038_backing_0 =
                                   (__local volatile
                                    unsigned char *) sync_arr_mem_20038_backing_aligned_2;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20033;
    int32_t local_tid_20034;
    int64_t group_sizze_20037;
    int32_t wave_sizze_20036;
    int32_t group_tid_20035;
    
    global_tid_20033 = get_global_id(0);
    local_tid_20034 = get_local_id(0);
    group_sizze_20037 = get_local_size(0);
    wave_sizze_20036 = LOCKSTEP_WIDTH;
    group_tid_20035 = get_group_id(0);
    
    int32_t phys_tid_17999 = global_tid_20033;
    __local unsigned char *sync_arr_mem_20038;
    
    sync_arr_mem_20038 = (__local unsigned char *) sync_arr_mem_20038_backing_0;
    
    __local unsigned char *red_arr_mem_20040;
    
    red_arr_mem_20040 = (__local unsigned char *) red_arr_mem_20040_backing_1;
    
    __local unsigned char *red_arr_mem_20042;
    
    red_arr_mem_20042 = (__local unsigned char *) red_arr_mem_20042_backing_2;
    
    int64_t dummy_17997 = (int64_t) 0;
    int64_t gtid_17998 = (int64_t) 0;
    int64_t x_acc_20044;
    int64_t x_acc_20045;
    int64_t chunk_sizze_20046 = smin64(sdiv_up64(split_rng_arg_17035,
                                                 sext_i32_i64(sext_i64_i32(segred_group_sizze_17988 *
                                                 num_groups_17990))),
                                       sdiv_up64(split_rng_arg_17035 -
                                                 phys_tid_17999,
                                                 num_threads_20032));
    int64_t x_17045;
    int64_t x_17046;
    int64_t x_17047;
    int64_t x_17048;
    
    // neutral-initialise the accumulators
    {
        x_acc_20044 = (int64_t) 0;
        x_acc_20045 = (int64_t) 0;
    }
    for (int64_t i_20053 = 0; i_20053 < chunk_sizze_20046; i_20053++) {
        gtid_17998 = phys_tid_17999 + num_threads_20032 * i_20053;
        // apply map function
        {
            int64_t i64_arg_17052 = split_rng_arg_17035 ^ gtid_17998;
            int32_t i64_res_17053 = sext_i64_i32(i64_arg_17052);
            int32_t x_17054 = lshr32(i64_res_17053, 16);
            int32_t x_17055 = i64_res_17053 ^ x_17054;
            int32_t x_17056 = mul32(73244475, x_17055);
            int32_t x_17057 = lshr32(x_17056, 16);
            int32_t x_17058 = x_17056 ^ x_17057;
            int32_t x_17059 = mul32(73244475, x_17058);
            int32_t x_17060 = lshr32(x_17059, 16);
            int32_t x_17061 = x_17059 ^ x_17060;
            int32_t x_17062 = lshr32(x_17061, 16);
            int32_t x_17063 = x_17061 ^ x_17062;
            int32_t x_17064 = mul32(73244475, x_17063);
            int32_t x_17065 = lshr32(x_17064, 16);
            int32_t x_17066 = x_17064 ^ x_17065;
            int32_t x_17067 = mul32(73244475, x_17066);
            int32_t x_17068 = lshr32(x_17067, 16);
            int32_t x_17069 = x_17067 ^ x_17068;
            int64_t unsign_arg_17070 = zext_i32_i64(x_17069);
            int64_t rand_arg_17071 = (int64_t) 539527247 ^ unsign_arg_17070;
            int64_t y_17072 = shl64(rand_arg_17071, (int64_t) 23);
            int64_t x_17073 = rand_arg_17071 ^ y_17072;
            int64_t x_17074 = (int64_t) 824515495 ^ x_17073;
            int64_t y_17075 = lshr64(x_17073, (int64_t) 17);
            int64_t x_17076 = x_17074 ^ y_17075;
            int64_t new_y_17077 = (int64_t) 12 ^ x_17076;
            int64_t x_17078 = (int64_t) 6916537531571111 ^ new_y_17077;
            int64_t x_17079 = (int64_t) 52768993618 ^ x_17078;
            int64_t y_17080 = lshr64(new_y_17077, (int64_t) 26);
            int64_t new_y_17081 = x_17079 ^ y_17080;
            int64_t y_17082 = shl64(new_y_17077, (int64_t) 23);
            int64_t x_17083 = new_y_17077 ^ y_17082;
            int64_t x_17084 = new_y_17081 ^ x_17083;
            int64_t y_17085 = lshr64(x_17083, (int64_t) 17);
            int64_t x_17086 = x_17084 ^ y_17085;
            int64_t y_17087 = lshr64(new_y_17081, (int64_t) 26);
            int64_t new_y_17088 = x_17086 ^ y_17087;
            int64_t y_17089 = shl64(new_y_17081, (int64_t) 23);
            int64_t x_17090 = new_y_17081 ^ y_17089;
            int64_t x_17091 = new_y_17088 ^ x_17090;
            int64_t y_17092 = lshr64(x_17090, (int64_t) 17);
            int64_t x_17093 = x_17091 ^ y_17092;
            int64_t y_17094 = lshr64(new_y_17088, (int64_t) 26);
            int64_t new_y_17095 = x_17093 ^ y_17094;
            int64_t rand_arg_17096 = defunc_2_reduce_res_16936 ^ new_y_17088;
            int64_t rand_arg_17097 = defunc_2_reduce_res_16937 ^ new_y_17095;
            int64_t y_17098 = shl64(rand_arg_17096, (int64_t) 23);
            int64_t x_17099 = rand_arg_17096 ^ y_17098;
            int64_t x_17100 = rand_arg_17097 ^ x_17099;
            int64_t y_17101 = lshr64(x_17099, (int64_t) 17);
            int64_t x_17102 = x_17100 ^ y_17101;
            int64_t y_17103 = lshr64(rand_arg_17097, (int64_t) 26);
            int64_t new_y_17104 = x_17102 ^ y_17103;
            int64_t y_17105 = shl64(rand_arg_17097, (int64_t) 23);
            int64_t x_17106 = rand_arg_17097 ^ y_17105;
            int64_t x_17107 = new_y_17104 ^ x_17106;
            int64_t y_17108 = lshr64(x_17106, (int64_t) 17);
            int64_t x_17109 = x_17107 ^ y_17108;
            int64_t y_17110 = lshr64(new_y_17104, (int64_t) 26);
            int64_t new_y_17111 = x_17109 ^ y_17110;
            int64_t y_17112 = shl64(new_y_17104, (int64_t) 23);
            int64_t x_17113 = new_y_17104 ^ y_17112;
            int64_t x_17114 = new_y_17111 ^ x_17113;
            int64_t y_17115 = lshr64(x_17113, (int64_t) 17);
            int64_t x_17116 = x_17114 ^ y_17115;
            int64_t y_17117 = lshr64(new_y_17111, (int64_t) 26);
            int64_t new_y_17118 = x_17116 ^ y_17117;
            int64_t rand_res_17119 = add64(new_y_17111, new_y_17118);
            int64_t y_17120 = shl64(new_y_17111, (int64_t) 23);
            int64_t x_17121 = new_y_17111 ^ y_17120;
            int64_t x_17122 = new_y_17118 ^ x_17121;
            int64_t y_17123 = lshr64(x_17121, (int64_t) 17);
            int64_t x_17124 = x_17122 ^ y_17123;
            int64_t y_17125 = lshr64(new_y_17118, (int64_t) 26);
            int64_t new_y_17126 = x_17124 ^ y_17125;
            int64_t rand_res_17127 = add64(new_y_17118, new_y_17126);
            double u64_res_17128 = uitofp_i64_f64(rand_res_17119);
            double zs_res_17129 = u64_res_17128 / 1.8446744073709552e19;
            double u64_res_17130 = uitofp_i64_f64(rand_res_17127);
            double zs_res_17131 = u64_res_17130 / 1.8446744073709552e19;
            double log_res_17132;
            
            log_res_17132 = futrts_log64(zs_res_17129);
            
            double zt_res_17133 = -2.0 * log_res_17132;
            double sqrt_res_17134;
            
            sqrt_res_17134 = futrts_sqrt64(zt_res_17133);
            
            double zt_res_17135 = 6.283185307179586 * zs_res_17131;
            double cos_res_17136;
            
            cos_res_17136 = futrts_cos64(zt_res_17135);
            
            double zt_res_17137 = sqrt_res_17134 * cos_res_17136;
            
            // save map-out results
            {
                ((__global int64_t *) mem_19427)[dummy_17997 *
                                                 split_rng_arg_17035 +
                                                 gtid_17998] = new_y_17118;
                ((__global int64_t *) mem_19430)[dummy_17997 *
                                                 split_rng_arg_17035 +
                                                 gtid_17998] = new_y_17126;
                ((__global double *) mem_19433)[dummy_17997 *
                                                split_rng_arg_17035 +
                                                gtid_17998] = zt_res_17137;
            }
            // load accumulator
            {
                x_17045 = x_acc_20044;
                x_17046 = x_acc_20045;
            }
            // load new values
            {
                x_17047 = new_y_17118;
                x_17048 = new_y_17126;
            }
            // apply reduction operator
            {
                int64_t defunc_1_op_res_17049 = x_17045 ^ x_17047;
                int64_t defunc_1_op_res_17050 = x_17046 ^ x_17048;
                
                // store in accumulator
                {
                    x_acc_20044 = defunc_1_op_res_17049;
                    x_acc_20045 = defunc_1_op_res_17050;
                }
            }
        }
    }
    // to reduce current chunk, first store our result in memory
    {
        x_17045 = x_acc_20044;
        x_17046 = x_acc_20045;
        ((__local int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034)] =
            x_17045;
        ((__local int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034)] =
            x_17046;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    
    int32_t offset_20054;
    int32_t skip_waves_20055 = 1;
    int64_t x_20047;
    int64_t x_20048;
    int64_t x_20049;
    int64_t x_20050;
    
    offset_20054 = 0;
    // participating threads read initial accumulator
    {
        if (slt32(local_tid_20034, sext_i64_i32(segred_group_sizze_17988))) {
            x_20047 = ((__local
                        int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034 +
                                                      offset_20054)];
            x_20048 = ((__local
                        int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034 +
                                                      offset_20054)];
        }
    }
    offset_20054 = 1;
    while (slt32(offset_20054, wave_sizze_20036)) {
        if (slt32(local_tid_20034 + offset_20054,
                  sext_i64_i32(segred_group_sizze_17988)) && ((local_tid_20034 -
                                                               squot32(local_tid_20034,
                                                                       wave_sizze_20036) *
                                                               wave_sizze_20036) &
                                                              (2 *
                                                               offset_20054 -
                                                               1)) == 0) {
            // read array element
            {
                x_20049 = ((volatile __local
                            int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034 +
                                                          offset_20054)];
                x_20050 = ((volatile __local
                            int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034 +
                                                          offset_20054)];
            }
            // apply reduction operation
            {
                int64_t defunc_1_op_res_20051 = x_20047 ^ x_20049;
                int64_t defunc_1_op_res_20052 = x_20048 ^ x_20050;
                
                x_20047 = defunc_1_op_res_20051;
                x_20048 = defunc_1_op_res_20052;
            }
            // write result of operation
            {
                ((volatile __local
                  int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034)] =
                    x_20047;
                ((volatile __local
                  int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034)] =
                    x_20048;
            }
        }
        offset_20054 *= 2;
    }
    while (slt32(skip_waves_20055,
                 squot32(sext_i64_i32(segred_group_sizze_17988) +
                         wave_sizze_20036 - 1, wave_sizze_20036))) {
        barrier(CLK_LOCAL_MEM_FENCE);
        offset_20054 = skip_waves_20055 * wave_sizze_20036;
        if (slt32(local_tid_20034 + offset_20054,
                  sext_i64_i32(segred_group_sizze_17988)) && ((local_tid_20034 -
                                                               squot32(local_tid_20034,
                                                                       wave_sizze_20036) *
                                                               wave_sizze_20036) ==
                                                              0 &&
                                                              (squot32(local_tid_20034,
                                                                       wave_sizze_20036) &
                                                               (2 *
                                                                skip_waves_20055 -
                                                                1)) == 0)) {
            // read array element
            {
                x_20049 = ((__local
                            int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034 +
                                                          offset_20054)];
                x_20050 = ((__local
                            int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034 +
                                                          offset_20054)];
            }
            // apply reduction operation
            {
                int64_t defunc_1_op_res_20051 = x_20047 ^ x_20049;
                int64_t defunc_1_op_res_20052 = x_20048 ^ x_20050;
                
                x_20047 = defunc_1_op_res_20051;
                x_20048 = defunc_1_op_res_20052;
            }
            // write result of operation
            {
                ((__local
                  int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034)] =
                    x_20047;
                ((__local
                  int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034)] =
                    x_20048;
            }
        }
        skip_waves_20055 *= 2;
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    // first thread saves the result in accumulator
    {
        if (sext_i32_i64(local_tid_20034) == (int64_t) 0) {
            x_acc_20044 = x_20047;
            x_acc_20045 = x_20048;
        }
    }
    
    int32_t old_counter_20056;
    
    // first thread in group saves group result to global memory
    {
        if (local_tid_20034 == 0) {
            ((__global
              int64_t *) segred_tmp_mem_20028)[sext_i32_i64(group_tid_20035)] =
                x_acc_20044;
            ((__global
              int64_t *) segred_tmp_mem_20030)[sext_i32_i64(group_tid_20035)] =
                x_acc_20045;
            mem_fence_global();
            old_counter_20056 = atomic_add_i32_global(&((volatile __global
                                                         int *) generate_datazicounter_mem_20026)[(int64_t) 0],
                                                      (int) 1);
            ((__local bool *) sync_arr_mem_20038)[(int64_t) 0] =
                old_counter_20056 == num_groups_17990 - (int64_t) 1;
        }
    }
    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    
    bool is_last_group_20057 = ((__local
                                 bool *) sync_arr_mem_20038)[(int64_t) 0];
    
    if (is_last_group_20057) {
        if (local_tid_20034 == 0) {
            old_counter_20056 = atomic_add_i32_global(&((volatile __global
                                                         int *) generate_datazicounter_mem_20026)[(int64_t) 0],
                                                      (int) ((int64_t) 0 -
                                                             num_groups_17990));
        }
        // read in the per-group-results
        {
            int64_t read_per_thread_20058 = sdiv_up64(num_groups_17990,
                                                      segred_group_sizze_17988);
            
            x_17045 = (int64_t) 0;
            x_17046 = (int64_t) 0;
            for (int64_t i_20059 = 0; i_20059 < read_per_thread_20058;
                 i_20059++) {
                int64_t group_res_id_20060 = sext_i32_i64(local_tid_20034) *
                        read_per_thread_20058 + i_20059;
                int64_t index_of_group_res_20061 = group_res_id_20060;
                
                if (slt64(group_res_id_20060, num_groups_17990)) {
                    x_17047 = ((__global
                                int64_t *) segred_tmp_mem_20028)[index_of_group_res_20061];
                    x_17048 = ((__global
                                int64_t *) segred_tmp_mem_20030)[index_of_group_res_20061];
                    
                    int64_t defunc_1_op_res_17049 = x_17045 ^ x_17047;
                    int64_t defunc_1_op_res_17050 = x_17046 ^ x_17048;
                    
                    x_17045 = defunc_1_op_res_17049;
                    x_17046 = defunc_1_op_res_17050;
                }
            }
        }
        ((__local int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034)] =
            x_17045;
        ((__local int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034)] =
            x_17046;
        barrier(CLK_LOCAL_MEM_FENCE);
        // reduce the per-group results
        {
            int32_t offset_20062;
            int32_t skip_waves_20063 = 1;
            int64_t x_20047;
            int64_t x_20048;
            int64_t x_20049;
            int64_t x_20050;
            
            offset_20062 = 0;
            // participating threads read initial accumulator
            {
                if (slt32(local_tid_20034,
                          sext_i64_i32(segred_group_sizze_17988))) {
                    x_20047 = ((__local
                                int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034 +
                                                              offset_20062)];
                    x_20048 = ((__local
                                int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034 +
                                                              offset_20062)];
                }
            }
            offset_20062 = 1;
            while (slt32(offset_20062, wave_sizze_20036)) {
                if (slt32(local_tid_20034 + offset_20062,
                          sext_i64_i32(segred_group_sizze_17988)) &&
                    ((local_tid_20034 - squot32(local_tid_20034,
                                                wave_sizze_20036) *
                      wave_sizze_20036) & (2 * offset_20062 - 1)) == 0) {
                    // read array element
                    {
                        x_20049 = ((volatile __local
                                    int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034 +
                                                                  offset_20062)];
                        x_20050 = ((volatile __local
                                    int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034 +
                                                                  offset_20062)];
                    }
                    // apply reduction operation
                    {
                        int64_t defunc_1_op_res_20051 = x_20047 ^ x_20049;
                        int64_t defunc_1_op_res_20052 = x_20048 ^ x_20050;
                        
                        x_20047 = defunc_1_op_res_20051;
                        x_20048 = defunc_1_op_res_20052;
                    }
                    // write result of operation
                    {
                        ((volatile __local
                          int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034)] =
                            x_20047;
                        ((volatile __local
                          int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034)] =
                            x_20048;
                    }
                }
                offset_20062 *= 2;
            }
            while (slt32(skip_waves_20063,
                         squot32(sext_i64_i32(segred_group_sizze_17988) +
                                 wave_sizze_20036 - 1, wave_sizze_20036))) {
                barrier(CLK_LOCAL_MEM_FENCE);
                offset_20062 = skip_waves_20063 * wave_sizze_20036;
                if (slt32(local_tid_20034 + offset_20062,
                          sext_i64_i32(segred_group_sizze_17988)) &&
                    ((local_tid_20034 - squot32(local_tid_20034,
                                                wave_sizze_20036) *
                      wave_sizze_20036) == 0 && (squot32(local_tid_20034,
                                                         wave_sizze_20036) &
                                                 (2 * skip_waves_20063 - 1)) ==
                     0)) {
                    // read array element
                    {
                        x_20049 = ((__local
                                    int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034 +
                                                                  offset_20062)];
                        x_20050 = ((__local
                                    int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034 +
                                                                  offset_20062)];
                    }
                    // apply reduction operation
                    {
                        int64_t defunc_1_op_res_20051 = x_20047 ^ x_20049;
                        int64_t defunc_1_op_res_20052 = x_20048 ^ x_20050;
                        
                        x_20047 = defunc_1_op_res_20051;
                        x_20048 = defunc_1_op_res_20052;
                    }
                    // write result of operation
                    {
                        ((__local
                          int64_t *) red_arr_mem_20040)[sext_i32_i64(local_tid_20034)] =
                            x_20047;
                        ((__local
                          int64_t *) red_arr_mem_20042)[sext_i32_i64(local_tid_20034)] =
                            x_20048;
                    }
                }
                skip_waves_20063 *= 2;
            }
            // and back to memory with the final result
            {
                if (local_tid_20034 == 0) {
                    ((__global int64_t *) mem_19422)[(int64_t) 0] = x_20047;
                    ((__global int64_t *) mem_19424)[(int64_t) 0] = x_20048;
                }
            }
        }
    }
    
  error_1:
    return;
    #undef segred_group_sizze_17988
}
__kernel void generate_datazisegred_small_18547(__global int *global_failure,
                                                __local volatile
                                                int64_t *red_arr_mem_20361_backing_aligned_0,
                                                int64_t N_16778,
                                                int64_t J_16779,
                                                int64_t num_groups_18692,
                                                int64_t segment_sizze_nonzzero_20354,
                                                __global
                                                unsigned char *mem_19757,
                                                __global
                                                unsigned char *mem_19761,
                                                __global
                                                unsigned char *mem_19765,
                                                __global
                                                unsigned char *mem_19769)
{
    #define segred_group_sizze_18691 (generate_datazisegred_group_sizze_18541)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20361_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20361_backing_aligned_0;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20356;
    int32_t local_tid_20357;
    int64_t group_sizze_20360;
    int32_t wave_sizze_20359;
    int32_t group_tid_20358;
    
    global_tid_20356 = get_global_id(0);
    local_tid_20357 = get_local_id(0);
    group_sizze_20360 = get_local_size(0);
    wave_sizze_20359 = LOCKSTEP_WIDTH;
    group_tid_20358 = get_group_id(0);
    
    int32_t phys_tid_18547 = global_tid_20356;
    __local unsigned char *red_arr_mem_20361;
    
    red_arr_mem_20361 = (__local unsigned char *) red_arr_mem_20361_backing_0;
    
    int32_t phys_group_id_20363;
    
    phys_group_id_20363 = get_group_id(0);
    for (int32_t i_20364 = 0; i_20364 <
         sdiv_up32(sext_i64_i32(sdiv_up64(N_16778,
                                          squot64(segred_group_sizze_18691,
                                                  segment_sizze_nonzzero_20354))) -
                   phys_group_id_20363, sext_i64_i32(num_groups_18692));
         i_20364++) {
        int32_t virt_group_id_20365 = phys_group_id_20363 + i_20364 *
                sext_i64_i32(num_groups_18692);
        int64_t slice_20366 = N_16778;
        int64_t gtid_18538 = squot64(sext_i32_i64(local_tid_20357),
                                     segment_sizze_nonzzero_20354) +
                sext_i32_i64(virt_group_id_20365) *
                squot64(segred_group_sizze_18691, segment_sizze_nonzzero_20354);
        int64_t remnant_20367 = squot64(sext_i32_i64(local_tid_20357),
                                        segment_sizze_nonzzero_20354) +
                sext_i32_i64(virt_group_id_20365) *
                squot64(segred_group_sizze_18691,
                        segment_sizze_nonzzero_20354) - gtid_18538;
        int64_t gtid_18546 = srem64(sext_i32_i64(local_tid_20357), J_16779);
        
        // apply map function if in bounds
        {
            if (slt64((int64_t) 0, J_16779) && (slt64(gtid_18538, N_16778) &&
                                                slt64(sext_i32_i64(local_tid_20357),
                                                      J_16779 *
                                                      squot64(segred_group_sizze_18691,
                                                              segment_sizze_nonzzero_20354)))) {
                double defunc_2_reduce_res_18699 = ((__global
                                                     double *) mem_19757)[gtid_18538];
                double x_18701 = ((__global double *) mem_19761)[gtid_18538 *
                                                                 J_16779 +
                                                                 gtid_18546];
                double defunc_0_f_res_18702 = x_18701 -
                       defunc_2_reduce_res_18699;
                double defunc_0_f_res_18703;
                
                defunc_0_f_res_18703 = futrts_exp64(defunc_0_f_res_18702);
                // save map-out results
                {
                    ((__global double *) mem_19769)[gtid_18538 * J_16779 +
                                                    gtid_18546] =
                        defunc_0_f_res_18703;
                }
                // save results to be reduced
                {
                    ((__local
                      double *) red_arr_mem_20361)[sext_i32_i64(local_tid_20357)] =
                        defunc_0_f_res_18703;
                }
            } else {
                ((__local
                  double *) red_arr_mem_20361)[sext_i32_i64(local_tid_20357)] =
                    0.0;
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        if (slt64((int64_t) 0, J_16779)) {
            // perform segmented scan to imitate reduction
            {
                double x_18696;
                double x_18697;
                double x_20368;
                double x_20369;
                bool ltid_in_bounds_20371 = slt64(sext_i32_i64(local_tid_20357),
                                                  J_16779 *
                                                  squot64(segred_group_sizze_18691,
                                                          segment_sizze_nonzzero_20354));
                int32_t skip_threads_20372;
                
                // read input for in-block scan
                {
                    if (ltid_in_bounds_20371) {
                        x_18697 = ((volatile __local
                                    double *) red_arr_mem_20361)[sext_i32_i64(local_tid_20357)];
                        if ((local_tid_20357 - squot32(local_tid_20357, 32) *
                             32) == 0) {
                            x_18696 = x_18697;
                        }
                    }
                }
                // in-block scan (hopefully no barriers needed)
                {
                    skip_threads_20372 = 1;
                    while (slt32(skip_threads_20372, 32)) {
                        if (sle32(skip_threads_20372, local_tid_20357 -
                                  squot32(local_tid_20357, 32) * 32) &&
                            ltid_in_bounds_20371) {
                            // read operands
                            {
                                x_18696 = ((volatile __local
                                            double *) red_arr_mem_20361)[sext_i32_i64(local_tid_20357) -
                                                                         sext_i32_i64(skip_threads_20372)];
                            }
                            // perform operation
                            {
                                bool inactive_20373 =
                                     slt64(srem64(sext_i32_i64(local_tid_20357),
                                                  J_16779),
                                           sext_i32_i64(local_tid_20357) -
                                           sext_i32_i64(local_tid_20357 -
                                           skip_threads_20372));
                                
                                if (inactive_20373) {
                                    x_18696 = x_18697;
                                }
                                if (!inactive_20373) {
                                    double defunc_1_op_res_18698 = x_18696 +
                                           x_18697;
                                    
                                    x_18696 = defunc_1_op_res_18698;
                                }
                            }
                        }
                        if (sle32(wave_sizze_20359, skip_threads_20372)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        if (sle32(skip_threads_20372, local_tid_20357 -
                                  squot32(local_tid_20357, 32) * 32) &&
                            ltid_in_bounds_20371) {
                            // write result
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20361)[sext_i32_i64(local_tid_20357)] =
                                    x_18696;
                                x_18697 = x_18696;
                            }
                        }
                        if (sle32(wave_sizze_20359, skip_threads_20372)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        skip_threads_20372 *= 2;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // last thread of block 'i' writes its result to offset 'i'
                {
                    if ((local_tid_20357 - squot32(local_tid_20357, 32) * 32) ==
                        31 && ltid_in_bounds_20371) {
                        ((volatile __local
                          double *) red_arr_mem_20361)[sext_i32_i64(squot32(local_tid_20357,
                                                                            32))] =
                            x_18696;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
                {
                    int32_t skip_threads_20374;
                    
                    // read input for in-block scan
                    {
                        if (squot32(local_tid_20357, 32) == 0 &&
                            ltid_in_bounds_20371) {
                            x_20369 = ((volatile __local
                                        double *) red_arr_mem_20361)[sext_i32_i64(local_tid_20357)];
                            if ((local_tid_20357 - squot32(local_tid_20357,
                                                           32) * 32) == 0) {
                                x_20368 = x_20369;
                            }
                        }
                    }
                    // in-block scan (hopefully no barriers needed)
                    {
                        skip_threads_20374 = 1;
                        while (slt32(skip_threads_20374, 32)) {
                            if (sle32(skip_threads_20374, local_tid_20357 -
                                      squot32(local_tid_20357, 32) * 32) &&
                                (squot32(local_tid_20357, 32) == 0 &&
                                 ltid_in_bounds_20371)) {
                                // read operands
                                {
                                    x_20368 = ((volatile __local
                                                double *) red_arr_mem_20361)[sext_i32_i64(local_tid_20357) -
                                                                             sext_i32_i64(skip_threads_20374)];
                                }
                                // perform operation
                                {
                                    bool inactive_20375 =
                                         slt64(srem64(sext_i32_i64(local_tid_20357 *
                                                      32 + 32 - 1), J_16779),
                                               sext_i32_i64(local_tid_20357 *
                                               32 + 32 - 1) -
                                               sext_i32_i64((local_tid_20357 -
                                                             skip_threads_20374) *
                                               32 + 32 - 1));
                                    
                                    if (inactive_20375) {
                                        x_20368 = x_20369;
                                    }
                                    if (!inactive_20375) {
                                        double defunc_1_op_res_20370 = x_20368 +
                                               x_20369;
                                        
                                        x_20368 = defunc_1_op_res_20370;
                                    }
                                }
                            }
                            if (sle32(wave_sizze_20359, skip_threads_20374)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            if (sle32(skip_threads_20374, local_tid_20357 -
                                      squot32(local_tid_20357, 32) * 32) &&
                                (squot32(local_tid_20357, 32) == 0 &&
                                 ltid_in_bounds_20371)) {
                                // write result
                                {
                                    ((volatile __local
                                      double *) red_arr_mem_20361)[sext_i32_i64(local_tid_20357)] =
                                        x_20368;
                                    x_20369 = x_20368;
                                }
                            }
                            if (sle32(wave_sizze_20359, skip_threads_20374)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            skip_threads_20374 *= 2;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // carry-in for every block except the first
                {
                    if (!(squot32(local_tid_20357, 32) == 0 ||
                          !ltid_in_bounds_20371)) {
                        // read operands
                        {
                            x_18697 = x_18696;
                            x_18696 = ((__local
                                        double *) red_arr_mem_20361)[sext_i32_i64(squot32(local_tid_20357,
                                                                                          32)) -
                                                                     (int64_t) 1];
                        }
                        // perform operation
                        {
                            bool inactive_20376 =
                                 slt64(srem64(sext_i32_i64(local_tid_20357),
                                              J_16779),
                                       sext_i32_i64(local_tid_20357) -
                                       sext_i32_i64(squot32(local_tid_20357,
                                                            32) * 32 - 1));
                            
                            if (inactive_20376) {
                                x_18696 = x_18697;
                            }
                            if (!inactive_20376) {
                                double defunc_1_op_res_18698 = x_18696 +
                                       x_18697;
                                
                                x_18696 = defunc_1_op_res_18698;
                            }
                        }
                        // write final result
                        {
                            ((__local
                              double *) red_arr_mem_20361)[sext_i32_i64(local_tid_20357)] =
                                x_18696;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // restore correct values for first block
                {
                    if (squot32(local_tid_20357, 32) == 0) {
                        ((__local
                          double *) red_arr_mem_20361)[sext_i32_i64(local_tid_20357)] =
                            x_18697;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // save final values of segments
        {
            if (slt64(sext_i32_i64(virt_group_id_20365) *
                      squot64(segred_group_sizze_18691,
                              segment_sizze_nonzzero_20354) +
                      sext_i32_i64(local_tid_20357), N_16778) &&
                slt64(sext_i32_i64(local_tid_20357),
                      squot64(segred_group_sizze_18691,
                              segment_sizze_nonzzero_20354))) {
                ((__global
                  double *) mem_19765)[sext_i32_i64(virt_group_id_20365) *
                                       squot64(segred_group_sizze_18691,
                                               segment_sizze_nonzzero_20354) +
                                       sext_i32_i64(local_tid_20357)] =
                    ((__local
                      double *) red_arr_mem_20361)[(sext_i32_i64(local_tid_20357) +
                                                    (int64_t) 1) *
                                                   segment_sizze_nonzzero_20354 -
                                                   (int64_t) 1];
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_18691
}
__kernel void generate_datazisegred_small_18566(__global int *global_failure,
                                                __local volatile
                                                int64_t *red_arr_mem_20295_backing_aligned_0,
                                                int64_t N_16778,
                                                int64_t J_16779,
                                                int64_t Kzz_16780,
                                                int64_t num_groups_18673,
                                                int64_t segment_sizze_nonzzero_20288,
                                                __global
                                                unsigned char *mem_19419,
                                                __global
                                                unsigned char *ext_mem_19753,
                                                __global
                                                unsigned char *mem_19757,
                                                __global
                                                unsigned char *mem_19761)
{
    #define segred_group_sizze_18672 (generate_datazisegred_group_sizze_18560)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20295_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20295_backing_aligned_0;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20290;
    int32_t local_tid_20291;
    int64_t group_sizze_20294;
    int32_t wave_sizze_20293;
    int32_t group_tid_20292;
    
    global_tid_20290 = get_global_id(0);
    local_tid_20291 = get_local_id(0);
    group_sizze_20294 = get_local_size(0);
    wave_sizze_20293 = LOCKSTEP_WIDTH;
    group_tid_20292 = get_group_id(0);
    
    int32_t phys_tid_18566 = global_tid_20290;
    __local unsigned char *red_arr_mem_20295;
    
    red_arr_mem_20295 = (__local unsigned char *) red_arr_mem_20295_backing_0;
    
    int32_t phys_group_id_20297;
    
    phys_group_id_20297 = get_group_id(0);
    for (int32_t i_20298 = 0; i_20298 <
         sdiv_up32(sext_i64_i32(sdiv_up64(N_16778,
                                          squot64(segred_group_sizze_18672,
                                                  segment_sizze_nonzzero_20288))) -
                   phys_group_id_20297, sext_i64_i32(num_groups_18673));
         i_20298++) {
        int32_t virt_group_id_20299 = phys_group_id_20297 + i_20298 *
                sext_i64_i32(num_groups_18673);
        int64_t slice_20300 = N_16778;
        int64_t gtid_18557 = squot64(sext_i32_i64(local_tid_20291),
                                     segment_sizze_nonzzero_20288) +
                sext_i32_i64(virt_group_id_20299) *
                squot64(segred_group_sizze_18672, segment_sizze_nonzzero_20288);
        int64_t remnant_20301 = squot64(sext_i32_i64(local_tid_20291),
                                        segment_sizze_nonzzero_20288) +
                sext_i32_i64(virt_group_id_20299) *
                squot64(segred_group_sizze_18672,
                        segment_sizze_nonzzero_20288) - gtid_18557;
        int64_t gtid_18565 = srem64(sext_i32_i64(local_tid_20291), J_16779);
        
        // apply map function if in bounds
        {
            if (slt64((int64_t) 0, J_16779) && (slt64(gtid_18557, N_16778) &&
                                                slt64(sext_i32_i64(local_tid_20291),
                                                      J_16779 *
                                                      squot64(segred_group_sizze_18672,
                                                              segment_sizze_nonzzero_20288)))) {
                double defunc_2_reduce_res_18682;
                double redout_19363 = 0.0;
                
                for (int64_t i_19364 = 0; i_19364 < Kzz_16780; i_19364++) {
                    double x_18686 = ((__global
                                       double *) ext_mem_19753)[gtid_18557 *
                                                                Kzz_16780 +
                                                                i_19364];
                    int64_t binop_x_19380 = J_16779 * i_19364;
                    int64_t new_index_19381 = gtid_18565 + binop_x_19380;
                    double x_18687 = ((__global
                                       double *) mem_19419)[new_index_19381];
                    double defunc_1_f_res_18688 = x_18686 * x_18687;
                    double defunc_1_op_res_18685 = defunc_1_f_res_18688 +
                           redout_19363;
                    double redout_tmp_20302 = defunc_1_op_res_18685;
                    
                    redout_19363 = redout_tmp_20302;
                }
                defunc_2_reduce_res_18682 = redout_19363;
                // save map-out results
                {
                    ((__global double *) mem_19761)[gtid_18557 * J_16779 +
                                                    gtid_18565] =
                        defunc_2_reduce_res_18682;
                }
                // save results to be reduced
                {
                    ((__local
                      double *) red_arr_mem_20295)[sext_i32_i64(local_tid_20291)] =
                        defunc_2_reduce_res_18682;
                }
            } else {
                ((__local
                  double *) red_arr_mem_20295)[sext_i32_i64(local_tid_20291)] =
                    -INFINITY;
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        if (slt64((int64_t) 0, J_16779)) {
            // perform segmented scan to imitate reduction
            {
                double x_18677;
                double x_18678;
                double x_20303;
                double x_20304;
                bool ltid_in_bounds_20306 = slt64(sext_i32_i64(local_tid_20291),
                                                  J_16779 *
                                                  squot64(segred_group_sizze_18672,
                                                          segment_sizze_nonzzero_20288));
                int32_t skip_threads_20307;
                
                // read input for in-block scan
                {
                    if (ltid_in_bounds_20306) {
                        x_18678 = ((volatile __local
                                    double *) red_arr_mem_20295)[sext_i32_i64(local_tid_20291)];
                        if ((local_tid_20291 - squot32(local_tid_20291, 32) *
                             32) == 0) {
                            x_18677 = x_18678;
                        }
                    }
                }
                // in-block scan (hopefully no barriers needed)
                {
                    skip_threads_20307 = 1;
                    while (slt32(skip_threads_20307, 32)) {
                        if (sle32(skip_threads_20307, local_tid_20291 -
                                  squot32(local_tid_20291, 32) * 32) &&
                            ltid_in_bounds_20306) {
                            // read operands
                            {
                                x_18677 = ((volatile __local
                                            double *) red_arr_mem_20295)[sext_i32_i64(local_tid_20291) -
                                                                         sext_i32_i64(skip_threads_20307)];
                            }
                            // perform operation
                            {
                                bool inactive_20308 =
                                     slt64(srem64(sext_i32_i64(local_tid_20291),
                                                  J_16779),
                                           sext_i32_i64(local_tid_20291) -
                                           sext_i32_i64(local_tid_20291 -
                                           skip_threads_20307));
                                
                                if (inactive_20308) {
                                    x_18677 = x_18678;
                                }
                                if (!inactive_20308) {
                                    double defunc_1_op_res_18679 =
                                           fmax64(x_18677, x_18678);
                                    
                                    x_18677 = defunc_1_op_res_18679;
                                }
                            }
                        }
                        if (sle32(wave_sizze_20293, skip_threads_20307)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        if (sle32(skip_threads_20307, local_tid_20291 -
                                  squot32(local_tid_20291, 32) * 32) &&
                            ltid_in_bounds_20306) {
                            // write result
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20295)[sext_i32_i64(local_tid_20291)] =
                                    x_18677;
                                x_18678 = x_18677;
                            }
                        }
                        if (sle32(wave_sizze_20293, skip_threads_20307)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        skip_threads_20307 *= 2;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // last thread of block 'i' writes its result to offset 'i'
                {
                    if ((local_tid_20291 - squot32(local_tid_20291, 32) * 32) ==
                        31 && ltid_in_bounds_20306) {
                        ((volatile __local
                          double *) red_arr_mem_20295)[sext_i32_i64(squot32(local_tid_20291,
                                                                            32))] =
                            x_18677;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
                {
                    int32_t skip_threads_20309;
                    
                    // read input for in-block scan
                    {
                        if (squot32(local_tid_20291, 32) == 0 &&
                            ltid_in_bounds_20306) {
                            x_20304 = ((volatile __local
                                        double *) red_arr_mem_20295)[sext_i32_i64(local_tid_20291)];
                            if ((local_tid_20291 - squot32(local_tid_20291,
                                                           32) * 32) == 0) {
                                x_20303 = x_20304;
                            }
                        }
                    }
                    // in-block scan (hopefully no barriers needed)
                    {
                        skip_threads_20309 = 1;
                        while (slt32(skip_threads_20309, 32)) {
                            if (sle32(skip_threads_20309, local_tid_20291 -
                                      squot32(local_tid_20291, 32) * 32) &&
                                (squot32(local_tid_20291, 32) == 0 &&
                                 ltid_in_bounds_20306)) {
                                // read operands
                                {
                                    x_20303 = ((volatile __local
                                                double *) red_arr_mem_20295)[sext_i32_i64(local_tid_20291) -
                                                                             sext_i32_i64(skip_threads_20309)];
                                }
                                // perform operation
                                {
                                    bool inactive_20310 =
                                         slt64(srem64(sext_i32_i64(local_tid_20291 *
                                                      32 + 32 - 1), J_16779),
                                               sext_i32_i64(local_tid_20291 *
                                               32 + 32 - 1) -
                                               sext_i32_i64((local_tid_20291 -
                                                             skip_threads_20309) *
                                               32 + 32 - 1));
                                    
                                    if (inactive_20310) {
                                        x_20303 = x_20304;
                                    }
                                    if (!inactive_20310) {
                                        double defunc_1_op_res_20305 =
                                               fmax64(x_20303, x_20304);
                                        
                                        x_20303 = defunc_1_op_res_20305;
                                    }
                                }
                            }
                            if (sle32(wave_sizze_20293, skip_threads_20309)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            if (sle32(skip_threads_20309, local_tid_20291 -
                                      squot32(local_tid_20291, 32) * 32) &&
                                (squot32(local_tid_20291, 32) == 0 &&
                                 ltid_in_bounds_20306)) {
                                // write result
                                {
                                    ((volatile __local
                                      double *) red_arr_mem_20295)[sext_i32_i64(local_tid_20291)] =
                                        x_20303;
                                    x_20304 = x_20303;
                                }
                            }
                            if (sle32(wave_sizze_20293, skip_threads_20309)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            skip_threads_20309 *= 2;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // carry-in for every block except the first
                {
                    if (!(squot32(local_tid_20291, 32) == 0 ||
                          !ltid_in_bounds_20306)) {
                        // read operands
                        {
                            x_18678 = x_18677;
                            x_18677 = ((__local
                                        double *) red_arr_mem_20295)[sext_i32_i64(squot32(local_tid_20291,
                                                                                          32)) -
                                                                     (int64_t) 1];
                        }
                        // perform operation
                        {
                            bool inactive_20311 =
                                 slt64(srem64(sext_i32_i64(local_tid_20291),
                                              J_16779),
                                       sext_i32_i64(local_tid_20291) -
                                       sext_i32_i64(squot32(local_tid_20291,
                                                            32) * 32 - 1));
                            
                            if (inactive_20311) {
                                x_18677 = x_18678;
                            }
                            if (!inactive_20311) {
                                double defunc_1_op_res_18679 = fmax64(x_18677,
                                                                      x_18678);
                                
                                x_18677 = defunc_1_op_res_18679;
                            }
                        }
                        // write final result
                        {
                            ((__local
                              double *) red_arr_mem_20295)[sext_i32_i64(local_tid_20291)] =
                                x_18677;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // restore correct values for first block
                {
                    if (squot32(local_tid_20291, 32) == 0) {
                        ((__local
                          double *) red_arr_mem_20295)[sext_i32_i64(local_tid_20291)] =
                            x_18678;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // save final values of segments
        {
            if (slt64(sext_i32_i64(virt_group_id_20299) *
                      squot64(segred_group_sizze_18672,
                              segment_sizze_nonzzero_20288) +
                      sext_i32_i64(local_tid_20291), N_16778) &&
                slt64(sext_i32_i64(local_tid_20291),
                      squot64(segred_group_sizze_18672,
                              segment_sizze_nonzzero_20288))) {
                ((__global
                  double *) mem_19757)[sext_i32_i64(virt_group_id_20299) *
                                       squot64(segred_group_sizze_18672,
                                               segment_sizze_nonzzero_20288) +
                                       sext_i32_i64(local_tid_20291)] =
                    ((__local
                      double *) red_arr_mem_20295)[(sext_i32_i64(local_tid_20291) +
                                                    (int64_t) 1) *
                                                   segment_sizze_nonzzero_20288 -
                                                   (int64_t) 1];
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_18672
}
__kernel void generate_datazisegred_small_18611(__global int *global_failure,
                                                __local volatile
                                                int64_t *red_arr_mem_20226_backing_aligned_0,
                                                int64_t N_16778,
                                                int64_t Kzz_16780,
                                                int64_t Kx_16781,
                                                int64_t num_groups_18658,
                                                int64_t segment_sizze_nonzzero_20219,
                                                __global
                                                unsigned char *mem_19397,
                                                __global
                                                unsigned char *mem_19433,
                                                __global
                                                unsigned char *mem_19752)
{
    #define segred_group_sizze_18657 (generate_datazisegred_group_sizze_18605)
    
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict red_arr_mem_20226_backing_0 =
                                   (__local volatile
                                    unsigned char *) red_arr_mem_20226_backing_aligned_0;
    
    if (*global_failure >= 0)
        return;
    
    int32_t global_tid_20221;
    int32_t local_tid_20222;
    int64_t group_sizze_20225;
    int32_t wave_sizze_20224;
    int32_t group_tid_20223;
    
    global_tid_20221 = get_global_id(0);
    local_tid_20222 = get_local_id(0);
    group_sizze_20225 = get_local_size(0);
    wave_sizze_20224 = LOCKSTEP_WIDTH;
    group_tid_20223 = get_group_id(0);
    
    int32_t phys_tid_18611 = global_tid_20221;
    __local unsigned char *red_arr_mem_20226;
    
    red_arr_mem_20226 = (__local unsigned char *) red_arr_mem_20226_backing_0;
    
    int32_t phys_group_id_20228;
    
    phys_group_id_20228 = get_group_id(0);
    for (int32_t i_20229 = 0; i_20229 <
         sdiv_up32(sext_i64_i32(sdiv_up64(N_16778 * Kzz_16780,
                                          squot64(segred_group_sizze_18657,
                                                  segment_sizze_nonzzero_20219))) -
                   phys_group_id_20228, sext_i64_i32(num_groups_18658));
         i_20229++) {
        int32_t virt_group_id_20230 = phys_group_id_20228 + i_20229 *
                sext_i64_i32(num_groups_18658);
        int64_t slice_20231 = Kzz_16780;
        int64_t slice_20232 = N_16778 * slice_20231;
        int64_t gtid_18600 = squot64(squot64(sext_i32_i64(local_tid_20222),
                                             segment_sizze_nonzzero_20219) +
                                     sext_i32_i64(virt_group_id_20230) *
                                     squot64(segred_group_sizze_18657,
                                             segment_sizze_nonzzero_20219),
                                     slice_20231);
        int64_t remnant_20233 = squot64(sext_i32_i64(local_tid_20222),
                                        segment_sizze_nonzzero_20219) +
                sext_i32_i64(virt_group_id_20230) *
                squot64(segred_group_sizze_18657,
                        segment_sizze_nonzzero_20219) - gtid_18600 *
                slice_20231;
        int64_t gtid_18601 = remnant_20233;
        int64_t remnant_20234 = remnant_20233 - gtid_18601;
        int64_t gtid_18610 = srem64(sext_i32_i64(local_tid_20222), Kx_16781);
        
        // apply map function if in bounds
        {
            if (slt64((int64_t) 0, Kx_16781) && ((slt64(gtid_18600, N_16778) &&
                                                  slt64(gtid_18601,
                                                        Kzz_16780)) &&
                                                 slt64(sext_i32_i64(local_tid_20222),
                                                       Kx_16781 *
                                                       squot64(segred_group_sizze_18657,
                                                               segment_sizze_nonzzero_20219)))) {
                double x_18666 = ((__global double *) mem_19397)[gtid_18600 *
                                                                 Kx_16781 +
                                                                 gtid_18610];
                int64_t binop_x_18838 = Kzz_16780 * gtid_18610;
                int64_t new_index_18839 = gtid_18601 + binop_x_18838;
                double x_18667 = ((__global
                                   double *) mem_19433)[new_index_18839];
                double defunc_1_f_res_18668 = x_18666 * x_18667;
                
                // save map-out results
                { }
                // save results to be reduced
                {
                    ((__local
                      double *) red_arr_mem_20226)[sext_i32_i64(local_tid_20222)] =
                        defunc_1_f_res_18668;
                }
            } else {
                ((__local
                  double *) red_arr_mem_20226)[sext_i32_i64(local_tid_20222)] =
                    0.0;
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        if (slt64((int64_t) 0, Kx_16781)) {
            // perform segmented scan to imitate reduction
            {
                double x_18661;
                double x_18662;
                double x_20235;
                double x_20236;
                bool ltid_in_bounds_20238 = slt64(sext_i32_i64(local_tid_20222),
                                                  Kx_16781 *
                                                  squot64(segred_group_sizze_18657,
                                                          segment_sizze_nonzzero_20219));
                int32_t skip_threads_20239;
                
                // read input for in-block scan
                {
                    if (ltid_in_bounds_20238) {
                        x_18662 = ((volatile __local
                                    double *) red_arr_mem_20226)[sext_i32_i64(local_tid_20222)];
                        if ((local_tid_20222 - squot32(local_tid_20222, 32) *
                             32) == 0) {
                            x_18661 = x_18662;
                        }
                    }
                }
                // in-block scan (hopefully no barriers needed)
                {
                    skip_threads_20239 = 1;
                    while (slt32(skip_threads_20239, 32)) {
                        if (sle32(skip_threads_20239, local_tid_20222 -
                                  squot32(local_tid_20222, 32) * 32) &&
                            ltid_in_bounds_20238) {
                            // read operands
                            {
                                x_18661 = ((volatile __local
                                            double *) red_arr_mem_20226)[sext_i32_i64(local_tid_20222) -
                                                                         sext_i32_i64(skip_threads_20239)];
                            }
                            // perform operation
                            {
                                bool inactive_20240 =
                                     slt64(srem64(sext_i32_i64(local_tid_20222),
                                                  Kx_16781),
                                           sext_i32_i64(local_tid_20222) -
                                           sext_i32_i64(local_tid_20222 -
                                           skip_threads_20239));
                                
                                if (inactive_20240) {
                                    x_18661 = x_18662;
                                }
                                if (!inactive_20240) {
                                    double defunc_1_op_res_18663 = x_18661 +
                                           x_18662;
                                    
                                    x_18661 = defunc_1_op_res_18663;
                                }
                            }
                        }
                        if (sle32(wave_sizze_20224, skip_threads_20239)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        if (sle32(skip_threads_20239, local_tid_20222 -
                                  squot32(local_tid_20222, 32) * 32) &&
                            ltid_in_bounds_20238) {
                            // write result
                            {
                                ((volatile __local
                                  double *) red_arr_mem_20226)[sext_i32_i64(local_tid_20222)] =
                                    x_18661;
                                x_18662 = x_18661;
                            }
                        }
                        if (sle32(wave_sizze_20224, skip_threads_20239)) {
                            barrier(CLK_LOCAL_MEM_FENCE);
                        }
                        skip_threads_20239 *= 2;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // last thread of block 'i' writes its result to offset 'i'
                {
                    if ((local_tid_20222 - squot32(local_tid_20222, 32) * 32) ==
                        31 && ltid_in_bounds_20238) {
                        ((volatile __local
                          double *) red_arr_mem_20226)[sext_i32_i64(squot32(local_tid_20222,
                                                                            32))] =
                            x_18661;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'
                {
                    int32_t skip_threads_20241;
                    
                    // read input for in-block scan
                    {
                        if (squot32(local_tid_20222, 32) == 0 &&
                            ltid_in_bounds_20238) {
                            x_20236 = ((volatile __local
                                        double *) red_arr_mem_20226)[sext_i32_i64(local_tid_20222)];
                            if ((local_tid_20222 - squot32(local_tid_20222,
                                                           32) * 32) == 0) {
                                x_20235 = x_20236;
                            }
                        }
                    }
                    // in-block scan (hopefully no barriers needed)
                    {
                        skip_threads_20241 = 1;
                        while (slt32(skip_threads_20241, 32)) {
                            if (sle32(skip_threads_20241, local_tid_20222 -
                                      squot32(local_tid_20222, 32) * 32) &&
                                (squot32(local_tid_20222, 32) == 0 &&
                                 ltid_in_bounds_20238)) {
                                // read operands
                                {
                                    x_20235 = ((volatile __local
                                                double *) red_arr_mem_20226)[sext_i32_i64(local_tid_20222) -
                                                                             sext_i32_i64(skip_threads_20241)];
                                }
                                // perform operation
                                {
                                    bool inactive_20242 =
                                         slt64(srem64(sext_i32_i64(local_tid_20222 *
                                                      32 + 32 - 1), Kx_16781),
                                               sext_i32_i64(local_tid_20222 *
                                               32 + 32 - 1) -
                                               sext_i32_i64((local_tid_20222 -
                                                             skip_threads_20241) *
                                               32 + 32 - 1));
                                    
                                    if (inactive_20242) {
                                        x_20235 = x_20236;
                                    }
                                    if (!inactive_20242) {
                                        double defunc_1_op_res_20237 = x_20235 +
                                               x_20236;
                                        
                                        x_20235 = defunc_1_op_res_20237;
                                    }
                                }
                            }
                            if (sle32(wave_sizze_20224, skip_threads_20241)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            if (sle32(skip_threads_20241, local_tid_20222 -
                                      squot32(local_tid_20222, 32) * 32) &&
                                (squot32(local_tid_20222, 32) == 0 &&
                                 ltid_in_bounds_20238)) {
                                // write result
                                {
                                    ((volatile __local
                                      double *) red_arr_mem_20226)[sext_i32_i64(local_tid_20222)] =
                                        x_20235;
                                    x_20236 = x_20235;
                                }
                            }
                            if (sle32(wave_sizze_20224, skip_threads_20241)) {
                                barrier(CLK_LOCAL_MEM_FENCE);
                            }
                            skip_threads_20241 *= 2;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // carry-in for every block except the first
                {
                    if (!(squot32(local_tid_20222, 32) == 0 ||
                          !ltid_in_bounds_20238)) {
                        // read operands
                        {
                            x_18662 = x_18661;
                            x_18661 = ((__local
                                        double *) red_arr_mem_20226)[sext_i32_i64(squot32(local_tid_20222,
                                                                                          32)) -
                                                                     (int64_t) 1];
                        }
                        // perform operation
                        {
                            bool inactive_20243 =
                                 slt64(srem64(sext_i32_i64(local_tid_20222),
                                              Kx_16781),
                                       sext_i32_i64(local_tid_20222) -
                                       sext_i32_i64(squot32(local_tid_20222,
                                                            32) * 32 - 1));
                            
                            if (inactive_20243) {
                                x_18661 = x_18662;
                            }
                            if (!inactive_20243) {
                                double defunc_1_op_res_18663 = x_18661 +
                                       x_18662;
                                
                                x_18661 = defunc_1_op_res_18663;
                            }
                        }
                        // write final result
                        {
                            ((__local
                              double *) red_arr_mem_20226)[sext_i32_i64(local_tid_20222)] =
                                x_18661;
                        }
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
                // restore correct values for first block
                {
                    if (squot32(local_tid_20222, 32) == 0) {
                        ((__local
                          double *) red_arr_mem_20226)[sext_i32_i64(local_tid_20222)] =
                            x_18662;
                    }
                }
                barrier(CLK_LOCAL_MEM_FENCE);
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        // save final values of segments
        {
            if (slt64(sext_i32_i64(virt_group_id_20230) *
                      squot64(segred_group_sizze_18657,
                              segment_sizze_nonzzero_20219) +
                      sext_i32_i64(local_tid_20222), N_16778 * Kzz_16780) &&
                slt64(sext_i32_i64(local_tid_20222),
                      squot64(segred_group_sizze_18657,
                              segment_sizze_nonzzero_20219))) {
                ((__global
                  double *) mem_19752)[squot64(sext_i32_i64(virt_group_id_20230) *
                                               squot64(segred_group_sizze_18657,
                                                       segment_sizze_nonzzero_20219) +
                                               sext_i32_i64(local_tid_20222),
                                               Kzz_16780) * Kzz_16780 +
                                       (sext_i32_i64(virt_group_id_20230) *
                                        squot64(segred_group_sizze_18657,
                                                segment_sizze_nonzzero_20219) +
                                        sext_i32_i64(local_tid_20222) -
                                        squot64(sext_i32_i64(virt_group_id_20230) *
                                                squot64(segred_group_sizze_18657,
                                                        segment_sizze_nonzzero_20219) +
                                                sext_i32_i64(local_tid_20222),
                                                Kzz_16780) * Kzz_16780)] =
                    ((__local
                      double *) red_arr_mem_20226)[(sext_i32_i64(local_tid_20222) +
                                                    (int64_t) 1) *
                                                   segment_sizze_nonzzero_20219 -
                                                   (int64_t) 1];
            }
        }
        barrier(CLK_LOCAL_MEM_FENCE);
        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);
    }
    
  error_1:
    return;
    #undef segred_group_sizze_18657
}
__kernel void gpu_map_transpose_f64(__local volatile
                                    int64_t *block_9_backing_aligned_0,
                                    int32_t destoffset_1, int32_t srcoffset_3,
                                    int32_t num_arrays_4, int32_t x_elems_5,
                                    int32_t y_elems_6, int32_t mulx_7,
                                    int32_t muly_8, __global
                                    unsigned char *destmem_0, __global
                                    unsigned char *srcmem_2)
{
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict block_9_backing_0 =
                                   (__local volatile
                                    unsigned char *) block_9_backing_aligned_0;
    __local unsigned char *block_9;
    
    block_9 = (__local unsigned char *) block_9_backing_0;
    
    int32_t get_global_id_0_37;
    
    get_global_id_0_37 = get_global_id(0);
    
    int32_t get_local_id_0_38;
    
    get_local_id_0_38 = get_local_id(0);
    
    int32_t get_local_id_1_39;
    
    get_local_id_1_39 = get_local_id(1);
    
    int32_t get_group_id_0_40;
    
    get_group_id_0_40 = get_group_id(0);
    
    int32_t get_group_id_1_41;
    
    get_group_id_1_41 = get_group_id(1);
    
    int32_t get_group_id_2_42;
    
    get_group_id_2_42 = get_group_id(2);
    
    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;
    int32_t odata_offset_33 = squot32(destoffset_1, 8) + our_array_offset_30;
    int32_t idata_offset_34 = squot32(srcoffset_3, 8) + our_array_offset_30;
    int32_t x_index_31 = get_global_id_0_37;
    int32_t y_index_32 = get_group_id_1_41 * 32 + get_local_id_1_39;
    
    if (slt32(x_index_31, x_elems_5)) {
        for (int32_t j_43 = 0; j_43 < 4; j_43++) {
            int32_t index_in_35 = (y_index_32 + j_43 * 8) * x_elems_5 +
                    x_index_31;
            
            if (slt32(y_index_32 + j_43 * 8, y_elems_6)) {
                ((__local double *) block_9)[sext_i32_i64((get_local_id_1_39 +
                                                           j_43 * 8) * 33 +
                                             get_local_id_0_38)] = ((__global
                                                                     double *) srcmem_2)[sext_i32_i64(idata_offset_34 +
                                                                                         index_in_35)];
            }
        }
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    x_index_31 = get_group_id_1_41 * 32 + get_local_id_0_38;
    y_index_32 = get_group_id_0_40 * 32 + get_local_id_1_39;
    if (slt32(x_index_31, y_elems_6)) {
        for (int32_t j_43 = 0; j_43 < 4; j_43++) {
            int32_t index_out_36 = (y_index_32 + j_43 * 8) * y_elems_6 +
                    x_index_31;
            
            if (slt32(y_index_32 + j_43 * 8, x_elems_5)) {
                ((__global double *) destmem_0)[sext_i32_i64(odata_offset_33 +
                                                index_out_36)] = ((__local
                                                                   double *) block_9)[sext_i32_i64(get_local_id_0_38 *
                                                                                      33 +
                                                                                      get_local_id_1_39 +
                                                                                      j_43 *
                                                                                      8)];
            }
        }
    }
    
  error_0:
    return;
}
__kernel void gpu_map_transpose_f64_low_height(__local volatile
                                               int64_t *block_9_backing_aligned_0,
                                               int32_t destoffset_1,
                                               int32_t srcoffset_3,
                                               int32_t num_arrays_4,
                                               int32_t x_elems_5,
                                               int32_t y_elems_6,
                                               int32_t mulx_7, int32_t muly_8,
                                               __global
                                               unsigned char *destmem_0,
                                               __global unsigned char *srcmem_2)
{
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict block_9_backing_0 =
                                   (__local volatile
                                    unsigned char *) block_9_backing_aligned_0;
    __local unsigned char *block_9;
    
    block_9 = (__local unsigned char *) block_9_backing_0;
    
    int32_t get_global_id_0_37;
    
    get_global_id_0_37 = get_global_id(0);
    
    int32_t get_local_id_0_38;
    
    get_local_id_0_38 = get_local_id(0);
    
    int32_t get_local_id_1_39;
    
    get_local_id_1_39 = get_local_id(1);
    
    int32_t get_group_id_0_40;
    
    get_group_id_0_40 = get_group_id(0);
    
    int32_t get_group_id_1_41;
    
    get_group_id_1_41 = get_group_id(1);
    
    int32_t get_group_id_2_42;
    
    get_group_id_2_42 = get_group_id(2);
    
    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;
    int32_t odata_offset_33 = squot32(destoffset_1, 8) + our_array_offset_30;
    int32_t idata_offset_34 = squot32(srcoffset_3, 8) + our_array_offset_30;
    int32_t x_index_31 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_0_38 +
            srem32(get_local_id_1_39, mulx_7) * 16;
    int32_t y_index_32 = get_group_id_1_41 * 16 + squot32(get_local_id_1_39,
                                                          mulx_7);
    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;
    
    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {
        ((__local double *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +
                                     get_local_id_0_38)] = ((__global
                                                             double *) srcmem_2)[sext_i32_i64(idata_offset_34 +
                                                                                 index_in_35)];
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    x_index_31 = get_group_id_1_41 * 16 + squot32(get_local_id_0_38, mulx_7);
    y_index_32 = get_group_id_0_40 * 16 * mulx_7 + get_local_id_1_39 +
        srem32(get_local_id_0_38, mulx_7) * 16;
    
    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;
    
    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {
        ((__global double *) destmem_0)[sext_i32_i64(odata_offset_33 +
                                        index_out_36)] = ((__local
                                                           double *) block_9)[sext_i32_i64(get_local_id_0_38 *
                                                                              17 +
                                                                              get_local_id_1_39)];
    }
    
  error_0:
    return;
}
__kernel void gpu_map_transpose_f64_low_width(__local volatile
                                              int64_t *block_9_backing_aligned_0,
                                              int32_t destoffset_1,
                                              int32_t srcoffset_3,
                                              int32_t num_arrays_4,
                                              int32_t x_elems_5,
                                              int32_t y_elems_6, int32_t mulx_7,
                                              int32_t muly_8, __global
                                              unsigned char *destmem_0, __global
                                              unsigned char *srcmem_2)
{
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict block_9_backing_0 =
                                   (__local volatile
                                    unsigned char *) block_9_backing_aligned_0;
    __local unsigned char *block_9;
    
    block_9 = (__local unsigned char *) block_9_backing_0;
    
    int32_t get_global_id_0_37;
    
    get_global_id_0_37 = get_global_id(0);
    
    int32_t get_local_id_0_38;
    
    get_local_id_0_38 = get_local_id(0);
    
    int32_t get_local_id_1_39;
    
    get_local_id_1_39 = get_local_id(1);
    
    int32_t get_group_id_0_40;
    
    get_group_id_0_40 = get_group_id(0);
    
    int32_t get_group_id_1_41;
    
    get_group_id_1_41 = get_group_id(1);
    
    int32_t get_group_id_2_42;
    
    get_group_id_2_42 = get_group_id(2);
    
    int32_t our_array_offset_30 = get_group_id_2_42 * x_elems_5 * y_elems_6;
    int32_t odata_offset_33 = squot32(destoffset_1, 8) + our_array_offset_30;
    int32_t idata_offset_34 = squot32(srcoffset_3, 8) + our_array_offset_30;
    int32_t x_index_31 = get_group_id_0_40 * 16 + squot32(get_local_id_0_38,
                                                          muly_8);
    int32_t y_index_32 = get_group_id_1_41 * 16 * muly_8 + get_local_id_1_39 +
            srem32(get_local_id_0_38, muly_8) * 16;
    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;
    
    if (slt32(x_index_31, x_elems_5) && slt32(y_index_32, y_elems_6)) {
        ((__local double *) block_9)[sext_i32_i64(get_local_id_1_39 * 17 +
                                     get_local_id_0_38)] = ((__global
                                                             double *) srcmem_2)[sext_i32_i64(idata_offset_34 +
                                                                                 index_in_35)];
    }
    barrier(CLK_LOCAL_MEM_FENCE);
    x_index_31 = get_group_id_1_41 * 16 * muly_8 + get_local_id_0_38 +
        srem32(get_local_id_1_39, muly_8) * 16;
    y_index_32 = get_group_id_0_40 * 16 + squot32(get_local_id_1_39, muly_8);
    
    int32_t index_out_36 = y_index_32 * y_elems_6 + x_index_31;
    
    if (slt32(x_index_31, y_elems_6) && slt32(y_index_32, x_elems_5)) {
        ((__global double *) destmem_0)[sext_i32_i64(odata_offset_33 +
                                        index_out_36)] = ((__local
                                                           double *) block_9)[sext_i32_i64(get_local_id_0_38 *
                                                                              17 +
                                                                              get_local_id_1_39)];
    }
    
  error_0:
    return;
}
__kernel void gpu_map_transpose_f64_small(__local volatile
                                          int64_t *block_9_backing_aligned_0,
                                          int32_t destoffset_1,
                                          int32_t srcoffset_3,
                                          int32_t num_arrays_4,
                                          int32_t x_elems_5, int32_t y_elems_6,
                                          int32_t mulx_7, int32_t muly_8,
                                          __global unsigned char *destmem_0,
                                          __global unsigned char *srcmem_2)
{
    const int block_dim0 = 0;
    const int block_dim1 = 1;
    const int block_dim2 = 2;
    __local volatile unsigned char *restrict block_9_backing_0 =
                                   (__local volatile
                                    unsigned char *) block_9_backing_aligned_0;
    __local unsigned char *block_9;
    
    block_9 = (__local unsigned char *) block_9_backing_0;
    
    int32_t get_global_id_0_37;
    
    get_global_id_0_37 = get_global_id(0);
    
    int32_t get_local_id_0_38;
    
    get_local_id_0_38 = get_local_id(0);
    
    int32_t get_local_id_1_39;
    
    get_local_id_1_39 = get_local_id(1);
    
    int32_t get_group_id_0_40;
    
    get_group_id_0_40 = get_group_id(0);
    
    int32_t get_group_id_1_41;
    
    get_group_id_1_41 = get_group_id(1);
    
    int32_t get_group_id_2_42;
    
    get_group_id_2_42 = get_group_id(2);
    
    int32_t our_array_offset_30 = squot32(get_global_id_0_37, y_elems_6 *
                                          x_elems_5) * (y_elems_6 * x_elems_5);
    int32_t x_index_31 = squot32(srem32(get_global_id_0_37, y_elems_6 *
                                        x_elems_5), y_elems_6);
    int32_t y_index_32 = srem32(get_global_id_0_37, y_elems_6);
    int32_t odata_offset_33 = squot32(destoffset_1, 8) + our_array_offset_30;
    int32_t idata_offset_34 = squot32(srcoffset_3, 8) + our_array_offset_30;
    int32_t index_in_35 = y_index_32 * x_elems_5 + x_index_31;
    int32_t index_out_36 = x_index_31 * y_elems_6 + y_index_32;
    
    if (slt32(get_global_id_0_37, x_elems_5 * y_elems_6 * num_arrays_4)) {
        ((__global double *) destmem_0)[sext_i32_i64(odata_offset_33 +
                                        index_out_36)] = ((__global
                                                           double *) srcmem_2)[sext_i32_i64(idata_offset_34 +
                                                                               index_in_35)];
    }
    
  error_0:
    return;
}
"""
# Start of values.py.

# Hacky parser/reader/writer for values written in Futhark syntax.
# Used for reading stdin when compiling standalone programs with the
# Python code generator.

import numpy as np
import string
import struct
import sys

class ReaderInput:
    def __init__(self, f):
        self.f = f
        self.lookahead_buffer = []

    def get_char(self):
        if len(self.lookahead_buffer) == 0:
            return self.f.read(1)
        else:
            c = self.lookahead_buffer[0]
            self.lookahead_buffer = self.lookahead_buffer[1:]
            return c

    def unget_char(self, c):
        self.lookahead_buffer = [c] + self.lookahead_buffer

    def get_chars(self, n):
        n1 = min(n, len(self.lookahead_buffer))
        s = b''.join(self.lookahead_buffer[:n1])
        self.lookahead_buffer = self.lookahead_buffer[n1:]
        n2 = n - n1
        if n2 > 0:
            s += self.f.read(n2)
        return s

    def peek_char(self):
        c = self.get_char()
        if c:
            self.unget_char(c)
        return c

def skip_spaces(f):
    c = f.get_char()
    while c != None:
        if c.isspace():
            c = f.get_char()
        elif c == b'-':
          # May be line comment.
          if f.peek_char() == b'-':
            # Yes, line comment. Skip to end of line.
            while (c != b'\n' and c != None):
              c = f.get_char()
          else:
            break
        else:
          break
    if c:
        f.unget_char(c)

def parse_specific_char(f, expected):
    got = f.get_char()
    if got != expected:
        f.unget_char(got)
        raise ValueError
    return True

def parse_specific_string(f, s):
    # This funky mess is intended, and is caused by the fact that if `type(b) ==
    # bytes` then `type(b[0]) == int`, but we need to match each element with a
    # `bytes`, so therefore we make each character an array element
    b = s.encode('utf8')
    bs = [b[i:i+1] for i in range(len(b))]
    read = []
    try:
        for c in bs:
            parse_specific_char(f, c)
            read.append(c)
        return True
    except ValueError:
        for c in read[::-1]:
            f.unget_char(c)
        raise

def optional(p, *args):
    try:
        return p(*args)
    except ValueError:
        return None

def optional_specific_string(f, s):
    c = f.peek_char()
    # This funky mess is intended, and is caused by the fact that if `type(b) ==
    # bytes` then `type(b[0]) == int`, but we need to match each element with a
    # `bytes`, so therefore we make each character an array element
    b = s.encode('utf8')
    bs = [b[i:i+1] for i in range(len(b))]
    if c == bs[0]:
        return parse_specific_string(f, s)
    else:
        return False

def sepBy(p, sep, *args):
    elems = []
    x = optional(p, *args)
    if x != None:
        elems += [x]
        while optional(sep, *args) != None:
            x = p(*args)
            elems += [x]
    return elems

# Assumes '0x' has already been read
def parse_hex_int(f):
    s = b''
    c = f.get_char()
    while c != None:
        if c in b'01234556789ABCDEFabcdef':
            s += c
            c = f.get_char()
        elif c == b'_':
            c = f.get_char() # skip _
        else:
            f.unget_char(c)
            break
    return str(int(s, 16)).encode('utf8') # ugh

def parse_int(f):
    s = b''
    c = f.get_char()
    if c == b'0' and f.peek_char() in b'xX':
        c = f.get_char() # skip X
        return parse_hex_int(f)
    else:
        while c != None:
            if c.isdigit():
                s += c
                c = f.get_char()
            elif c == b'_':
                c = f.get_char() # skip _
            else:
                f.unget_char(c)
                break
        if len(s) == 0:
            raise ValueError
        return s

def parse_int_signed(f):
    s = b''
    c = f.get_char()

    if c == b'-' and f.peek_char().isdigit():
      return c + parse_int(f)
    else:
      if c != b'+':
          f.unget_char(c)
      return parse_int(f)

def read_str_comma(f):
    skip_spaces(f)
    parse_specific_char(f, b',')
    return b','

def read_str_int(f, s):
    skip_spaces(f)
    x = int(parse_int_signed(f))
    optional_specific_string(f, s)
    return x

def read_str_uint(f, s):
    skip_spaces(f)
    x = int(parse_int(f))
    optional_specific_string(f, s)
    return x

def read_str_i8(f):
    return np.int8(read_str_int(f, 'i8'))
def read_str_i16(f):
    return np.int16(read_str_int(f, 'i16'))
def read_str_i32(f):
    return np.int32(read_str_int(f, 'i32'))
def read_str_i64(f):
    return np.int64(read_str_int(f, 'i64'))

def read_str_u8(f):
    return np.uint8(read_str_int(f, 'u8'))
def read_str_u16(f):
    return np.uint16(read_str_int(f, 'u16'))
def read_str_u32(f):
    return np.uint32(read_str_int(f, 'u32'))
def read_str_u64(f):
    return np.uint64(read_str_int(f, 'u64'))

def read_char(f):
    skip_spaces(f)
    parse_specific_char(f, b'\'')
    c = f.get_char()
    parse_specific_char(f, b'\'')
    return c

def read_str_hex_float(f, sign):
    int_part = parse_hex_int(f)
    parse_specific_char(f, b'.')
    frac_part = parse_hex_int(f)
    parse_specific_char(f, b'p')
    exponent = parse_int(f)

    int_val = int(int_part, 16)
    frac_val = float(int(frac_part, 16)) / (16 ** len(frac_part))
    exp_val = int(exponent)

    total_val = (int_val + frac_val) * (2.0 ** exp_val)
    if sign == b'-':
        total_val = -1 * total_val

    return float(total_val)


def read_str_decimal(f):
    skip_spaces(f)
    c = f.get_char()
    if (c == b'-'):
      sign = b'-'
    else:
      f.unget_char(c)
      sign = b''

    # Check for hexadecimal float
    c = f.get_char()
    if (c == '0' and (f.peek_char() in ['x', 'X'])):
        f.get_char()
        return read_str_hex_float(f, sign)
    else:
        f.unget_char(c)

    bef = optional(parse_int, f)
    if bef == None:
        bef = b'0'
        parse_specific_char(f, b'.')
        aft = parse_int(f)
    elif optional(parse_specific_char, f, b'.'):
        aft = parse_int(f)
    else:
        aft = b'0'
    if (optional(parse_specific_char, f, b'E') or
        optional(parse_specific_char, f, b'e')):
        expt = parse_int_signed(f)
    else:
        expt = b'0'
    return float(sign + bef + b'.' + aft + b'E' + expt)

def read_str_f16(f):
    skip_spaces(f)
    try:
        parse_specific_string(f, 'f16.nan')
        return np.float32(np.nan)
    except ValueError:
        try:
            parse_specific_string(f, 'f16.inf')
            return np.float32(np.inf)
        except ValueError:
            try:
               parse_specific_string(f, '-f16.inf')
               return np.float32(-np.inf)
            except ValueError:
               x = read_str_decimal(f)
               optional_specific_string(f, 'f16')
               return x

def read_str_f32(f):
    skip_spaces(f)
    try:
        parse_specific_string(f, 'f32.nan')
        return np.float32(np.nan)
    except ValueError:
        try:
            parse_specific_string(f, 'f32.inf')
            return np.float32(np.inf)
        except ValueError:
            try:
               parse_specific_string(f, '-f32.inf')
               return np.float32(-np.inf)
            except ValueError:
               x = read_str_decimal(f)
               optional_specific_string(f, 'f32')
               return x

def read_str_f64(f):
    skip_spaces(f)
    try:
        parse_specific_string(f, 'f64.nan')
        return np.float64(np.nan)
    except ValueError:
        try:
            parse_specific_string(f, 'f64.inf')
            return np.float64(np.inf)
        except ValueError:
            try:
               parse_specific_string(f, '-f64.inf')
               return np.float64(-np.inf)
            except ValueError:
               x = read_str_decimal(f)
               optional_specific_string(f, 'f64')
               return x

def read_str_bool(f):
    skip_spaces(f)
    if f.peek_char() == b't':
        parse_specific_string(f, 'true')
        return True
    elif f.peek_char() == b'f':
        parse_specific_string(f, 'false')
        return False
    else:
        raise ValueError

def read_str_empty_array(f, type_name, rank):
    parse_specific_string(f, 'empty')
    parse_specific_char(f, b'(')
    dims = []
    for i in range(rank):
        parse_specific_string(f, '[')
        dims += [int(parse_int(f))]
        parse_specific_string(f, ']')
    if np.product(dims) != 0:
        raise ValueError
    parse_specific_string(f, type_name)
    parse_specific_char(f, b')')

    return tuple(dims)

def read_str_array_elems(f, elem_reader, type_name, rank):
    skip_spaces(f)
    try:
        parse_specific_char(f, b'[')
    except ValueError:
        return read_str_empty_array(f, type_name, rank)
    else:
        xs = sepBy(elem_reader, read_str_comma, f)
        skip_spaces(f)
        parse_specific_char(f, b']')
        return xs

def read_str_array_helper(f, elem_reader, type_name, rank):
    def nested_row_reader(_):
        return read_str_array_helper(f, elem_reader, type_name, rank-1)
    if rank == 1:
        row_reader = elem_reader
    else:
        row_reader = nested_row_reader
    return read_str_array_elems(f, row_reader, type_name, rank)

def expected_array_dims(l, rank):
  if rank > 1:
      n = len(l)
      if n == 0:
          elem = []
      else:
          elem = l[0]
      return [n] + expected_array_dims(elem, rank-1)
  else:
      return [len(l)]

def verify_array_dims(l, dims):
    if dims[0] != len(l):
        raise ValueError
    if len(dims) > 1:
        for x in l:
            verify_array_dims(x, dims[1:])

def read_str_array(f, elem_reader, type_name, rank, bt):
    elems = read_str_array_helper(f, elem_reader, type_name, rank)
    if type(elems) == tuple:
        # Empty array
        return np.empty(elems, dtype=bt)
    else:
        dims = expected_array_dims(elems, rank)
        verify_array_dims(elems, dims)
        return np.array(elems, dtype=bt)

################################################################################

READ_BINARY_VERSION = 2

# struct format specified at
# https://docs.python.org/2/library/struct.html#format-characters

def mk_bin_scalar_reader(t):
    def bin_reader(f):
        fmt = FUTHARK_PRIMTYPES[t]['bin_format']
        size = FUTHARK_PRIMTYPES[t]['size']
        tf = FUTHARK_PRIMTYPES[t]['numpy_type']
        return tf(struct.unpack('<' + fmt, f.get_chars(size))[0])
    return bin_reader

read_bin_i8 = mk_bin_scalar_reader('i8')
read_bin_i16 = mk_bin_scalar_reader('i16')
read_bin_i32 = mk_bin_scalar_reader('i32')
read_bin_i64 = mk_bin_scalar_reader('i64')

read_bin_u8 = mk_bin_scalar_reader('u8')
read_bin_u16 = mk_bin_scalar_reader('u16')
read_bin_u32 = mk_bin_scalar_reader('u32')
read_bin_u64 = mk_bin_scalar_reader('u64')

read_bin_f16 = mk_bin_scalar_reader('f16')
read_bin_f32 = mk_bin_scalar_reader('f32')
read_bin_f64 = mk_bin_scalar_reader('f64')

read_bin_bool = mk_bin_scalar_reader('bool')

def read_is_binary(f):
    skip_spaces(f)
    c = f.get_char()
    if c == b'b':
        bin_version = read_bin_u8(f)
        if bin_version != READ_BINARY_VERSION:
            panic(1, "binary-input: File uses version %i, but I only understand version %i.\n",
                  bin_version, READ_BINARY_VERSION)
        return True
    else:
        f.unget_char(c)
        return False

FUTHARK_PRIMTYPES = {
    'i8':  {'binname' : b"  i8",
            'size' : 1,
            'bin_reader': read_bin_i8,
            'str_reader': read_str_i8,
            'bin_format': 'b',
            'numpy_type': np.int8 },

    'i16': {'binname' : b" i16",
            'size' : 2,
            'bin_reader': read_bin_i16,
            'str_reader': read_str_i16,
            'bin_format': 'h',
            'numpy_type': np.int16 },

    'i32': {'binname' : b" i32",
            'size' : 4,
            'bin_reader': read_bin_i32,
            'str_reader': read_str_i32,
            'bin_format': 'i',
            'numpy_type': np.int32 },

    'i64': {'binname' : b" i64",
            'size' : 8,
            'bin_reader': read_bin_i64,
            'str_reader': read_str_i64,
            'bin_format': 'q',
            'numpy_type': np.int64},

    'u8':  {'binname' : b"  u8",
            'size' : 1,
            'bin_reader': read_bin_u8,
            'str_reader': read_str_u8,
            'bin_format': 'B',
            'numpy_type': np.uint8 },

    'u16': {'binname' : b" u16",
            'size' : 2,
            'bin_reader': read_bin_u16,
            'str_reader': read_str_u16,
            'bin_format': 'H',
            'numpy_type': np.uint16 },

    'u32': {'binname' : b" u32",
            'size' : 4,
            'bin_reader': read_bin_u32,
            'str_reader': read_str_u32,
            'bin_format': 'I',
            'numpy_type': np.uint32 },

    'u64': {'binname' : b" u64",
            'size' : 8,
            'bin_reader': read_bin_u64,
            'str_reader': read_str_u64,
            'bin_format': 'Q',
            'numpy_type': np.uint64 },

    'f16': {'binname' : b" f16",
            'size' : 2,
            'bin_reader': read_bin_f16,
            'str_reader': read_str_f16,
            'bin_format': 'e',
            'numpy_type': np.float16 },

    'f32': {'binname' : b" f32",
            'size' : 4,
            'bin_reader': read_bin_f32,
            'str_reader': read_str_f32,
            'bin_format': 'f',
            'numpy_type': np.float32 },

    'f64': {'binname' : b" f64",
            'size' : 8,
            'bin_reader': read_bin_f64,
            'str_reader': read_str_f64,
            'bin_format': 'd',
            'numpy_type': np.float64 },

    'bool': {'binname' : b"bool",
             'size' : 1,
             'bin_reader': read_bin_bool,
             'str_reader': read_str_bool,
             'bin_format': 'b',
             'numpy_type': bool }
}

def read_bin_read_type(f):
    read_binname = f.get_chars(4)

    for (k,v) in FUTHARK_PRIMTYPES.items():
        if v['binname'] == read_binname:
            return k
    panic(1, "binary-input: Did not recognize the type '%s'.\n", read_binname)

def numpy_type_to_type_name(t):
    for (k,v) in FUTHARK_PRIMTYPES.items():
        if v['numpy_type'] == t:
            return k
    raise Exception('Unknown Numpy type: {}'.format(t))

def read_bin_ensure_scalar(f, expected_type):
  dims = read_bin_i8(f)

  if dims != 0:
      panic(1, "binary-input: Expected scalar (0 dimensions), but got array with %i dimensions.\n", dims)

  bin_type = read_bin_read_type(f)
  if bin_type != expected_type:
      panic(1, "binary-input: Expected scalar of type %s but got scalar of type %s.\n",
            expected_type, bin_type)

# ------------------------------------------------------------------------------
# General interface for reading Primitive Futhark Values
# ------------------------------------------------------------------------------

def read_scalar(f, ty):
    if read_is_binary(f):
        read_bin_ensure_scalar(f, ty)
        return FUTHARK_PRIMTYPES[ty]['bin_reader'](f)
    return FUTHARK_PRIMTYPES[ty]['str_reader'](f)

def read_array(f, expected_type, rank):
    if not read_is_binary(f):
        str_reader = FUTHARK_PRIMTYPES[expected_type]['str_reader']
        return read_str_array(f, str_reader, expected_type, rank,
                              FUTHARK_PRIMTYPES[expected_type]['numpy_type'])

    bin_rank = read_bin_u8(f)

    if bin_rank != rank:
        panic(1, "binary-input: Expected %i dimensions, but got array with %i dimensions.\n",
              rank, bin_rank)

    bin_type_enum = read_bin_read_type(f)
    if expected_type != bin_type_enum:
        panic(1, "binary-input: Expected %iD-array with element type '%s' but got %iD-array with element type '%s'.\n",
              rank, expected_type, bin_rank, bin_type_enum)

    shape = []
    elem_count = 1
    for i in range(rank):
        bin_size = read_bin_i64(f)
        elem_count *= bin_size
        shape.append(bin_size)

    bin_fmt = FUTHARK_PRIMTYPES[bin_type_enum]['bin_format']

    # We first read the expected number of types into a bytestring,
    # then use np.frombuffer.  This is because np.fromfile does not
    # work on things that are insufficiently file-like, like a network
    # stream.
    bytes = f.get_chars(elem_count * FUTHARK_PRIMTYPES[expected_type]['size'])
    arr = np.frombuffer(bytes, dtype=FUTHARK_PRIMTYPES[bin_type_enum]['numpy_type'])
    arr.shape = shape

    return arr

if sys.version_info >= (3,0):
    input_reader = ReaderInput(sys.stdin.buffer)
else:
    input_reader = ReaderInput(sys.stdin)

import re

def read_value(type_desc, reader=input_reader):
    """Read a value of the given type.  The type is a string
representation of the Futhark type."""
    m = re.match(r'((?:\[\])*)([a-z0-9]+)$', type_desc)
    if m:
        dims = int(len(m.group(1))/2)
        basetype = m.group(2)
    assert m and basetype in FUTHARK_PRIMTYPES, "Unknown type: {}".format(type_desc)
    if dims > 0:
        return read_array(reader, basetype, dims)
    else:
        return read_scalar(reader, basetype)

def end_of_input(entry, f=input_reader):
    skip_spaces(f)
    if f.get_char() != b'':
        panic(1, "Expected EOF on stdin after reading input for \"%s\".", entry)

def write_value_text(v, out=sys.stdout):
    if type(v) == np.uint8:
        out.write("%uu8" % v)
    elif type(v) == np.uint16:
        out.write("%uu16" % v)
    elif type(v) == np.uint32:
        out.write("%uu32" % v)
    elif type(v) == np.uint64:
        out.write("%uu64" % v)
    elif type(v) == np.int8:
        out.write("%di8" % v)
    elif type(v) == np.int16:
        out.write("%di16" % v)
    elif type(v) == np.int32:
        out.write("%di32" % v)
    elif type(v) == np.int64:
        out.write("%di64" % v)
    elif type(v) in [np.bool, np.bool_]:
        if v:
            out.write("true")
        else:
            out.write("false")
    elif type(v) == np.float16:
        if np.isnan(v):
            out.write('f16.nan')
        elif np.isinf(v):
            if v >= 0:
                out.write('f16.inf')
            else:
                out.write('-f16.inf')
        else:
            out.write("%.6ff16" % v)
    elif type(v) == np.float32:
        if np.isnan(v):
            out.write('f32.nan')
        elif np.isinf(v):
            if v >= 0:
                out.write('f32.inf')
            else:
                out.write('-f32.inf')
        else:
            out.write("%.6ff32" % v)
    elif type(v) == np.float64:
        if np.isnan(v):
            out.write('f64.nan')
        elif np.isinf(v):
            if v >= 0:
                out.write('f64.inf')
            else:
                out.write('-f64.inf')
        else:
            out.write("%.6ff64" % v)
    elif type(v) == np.ndarray:
        if np.product(v.shape) == 0:
            tname = numpy_type_to_type_name(v.dtype)
            out.write('empty({}{})'.format(''.join(['[{}]'.format(d)
                                                    for d in v.shape]), tname))
        else:
            first = True
            out.write('[')
            for x in v:
                if not first: out.write(', ')
                first = False
                write_value(x, out=out)
            out.write(']')
    else:
        raise Exception("Cannot print value of type {}: {}".format(type(v), v))

type_strs = { np.dtype('int8'): b'  i8',
              np.dtype('int16'): b' i16',
              np.dtype('int32'): b' i32',
              np.dtype('int64'): b' i64',
              np.dtype('uint8'): b'  u8',
              np.dtype('uint16'): b' u16',
              np.dtype('uint32'): b' u32',
              np.dtype('uint64'): b' u64',
              np.dtype('float16'): b' f16',
              np.dtype('float32'): b' f32',
              np.dtype('float64'): b' f64',
              np.dtype('bool'): b'bool'}

def construct_binary_value(v):
    t = v.dtype
    shape = v.shape

    elems = 1
    for d in shape:
        elems *= d

    num_bytes = 1 + 1 + 1 + 4 + len(shape) * 8 + elems * t.itemsize
    bytes = bytearray(num_bytes)
    bytes[0] = np.int8(ord('b'))
    bytes[1] = 2
    bytes[2] = np.int8(len(shape))
    bytes[3:7] = type_strs[t]

    for i in range(len(shape)):
        bytes[7+i*8:7+(i+1)*8] = np.int64(shape[i]).tobytes()

    bytes[7+len(shape)*8:] = np.ascontiguousarray(v).tobytes()

    return bytes

def write_value_binary(v, out=sys.stdout):
    if sys.version_info >= (3,0):
        out = out.buffer
    out.write(construct_binary_value(v))

def write_value(v, out=sys.stdout, binary=False):
    if binary:
        return write_value_binary(v, out=out)
    else:
        return write_value_text(v, out=out)

# End of values.py.
# Start of memory.py.

import ctypes as ct

def addressOffset(x, offset, bt):
  return ct.cast(ct.addressof(x.contents)+int(offset), ct.POINTER(bt))

def allocateMem(size):
  return ct.cast((ct.c_byte * max(0,size))(), ct.POINTER(ct.c_byte))

# Copy an array if its is not-None.  This is important for treating
# Numpy arrays as flat memory, but has some overhead.
def normaliseArray(x):
  if (x.base is x) or (x.base is None):
    return x
  else:
    return x.copy()

def unwrapArray(x):
  return normaliseArray(x).ctypes.data_as(ct.POINTER(ct.c_byte))

def createArray(x, shape, t):
  # HACK: np.ctypeslib.as_array may fail if the shape contains zeroes,
  # for some reason.
  if any(map(lambda x: x == 0, shape)):
      return np.ndarray(shape, dtype=t)
  else:
      return np.ctypeslib.as_array(x, shape=shape).view(t)

def indexArray(x, offset, bt):
  return addressOffset(x, offset*ct.sizeof(bt), bt)[0]

def writeScalarArray(x, offset, v):
  ct.memmove(ct.addressof(x.contents)+int(offset)*ct.sizeof(v), ct.addressof(v), ct.sizeof(v))

# An opaque Futhark value.
class opaque(object):
  def __init__(self, desc, *payload):
    self.data = payload
    self.desc = desc

  def __repr__(self):
    return "<opaque Futhark value of type {}>".format(self.desc)

# End of memory.py.
# Start of panic.py.

def panic(exitcode, fmt, *args):
    sys.stderr.write('%s: ' % sys.argv[0])
    sys.stderr.write(fmt % args)
    sys.stderr.write('\n')
    sys.exit(exitcode)

# End of panic.py.
# Start of tuning.py

def read_tuning_file(kvs, f):
    for line in f.read().splitlines():
        size, value = line.split('=')
        kvs[size] = int(value)
    return kvs

# End of tuning.py.
# Start of scalar.py.

import numpy as np
import math
import struct

def intlit(t, x):
  if t == np.int8:
    return np.int8(x)
  elif t == np.int16:
    return np.int16(x)
  elif t == np.int32:
    return np.int32(x)
  else:
    return np.int64(x)

def signed(x):
  if type(x) == np.uint8:
    return np.int8(x)
  elif type(x) == np.uint16:
    return np.int16(x)
  elif type(x) == np.uint32:
    return np.int32(x)
  else:
    return np.int64(x)

def unsigned(x):
  if type(x) == np.int8:
    return np.uint8(x)
  elif type(x) == np.int16:
    return np.uint16(x)
  elif type(x) == np.int32:
    return np.uint32(x)
  else:
    return np.uint64(x)

def shlN(x,y):
  return x << y

def ashrN(x,y):
  return x >> y

# Python is so slow that we just make all the unsafe operations safe,
# always.

def sdivN(x,y):
  if y == 0:
    return intlit(type(x), 0)
  else:
    return x // y

def sdiv_upN(x,y):
  if y == 0:
    return intlit(type(x), 0)
  else:
    return (x+y-intlit(type(x), 1)) // y

def smodN(x,y):
  if y == 0:
    return intlit(type(x), 0)
  else:
    return x % y

def udivN(x,y):
  if y == 0:
    return intlit(type(x), 0)
  else:
    return signed(unsigned(x) // unsigned(y))

def udiv_upN(x,y):
  if y == 0:
    return intlit(type(x), 0)
  else:
    return signed((unsigned(x)+unsigned(y)-unsigned(intlit(type(x),1))) // unsigned(y))

def umodN(x,y):
  if y == 0:
    return intlit(type(x), 0)
  else:
    return signed(unsigned(x) % unsigned(y))

def squotN(x,y):
  if y == 0:
    return intlit(type(x), 0)
  else:
    return np.floor_divide(np.abs(x), np.abs(y)) * np.sign(x) * np.sign(y)

def sremN(x,y):
  if y == 0:
    return intlit(type(x), 0)
  else:
    return np.remainder(np.abs(x), np.abs(y)) * np.sign(x)

def sminN(x,y):
  return min(x,y)

def smaxN(x,y):
  return max(x,y)

def uminN(x,y):
  return signed(min(unsigned(x),unsigned(y)))

def umaxN(x,y):
  return signed(max(unsigned(x),unsigned(y)))

def fminN(x,y):
  return min(x,y)

def fmaxN(x,y):
  return max(x,y)

def powN(x,y):
  return x ** y

def fpowN(x,y):
  return x ** y

def sleN(x,y):
  return x <= y

def sltN(x,y):
  return x < y

def uleN(x,y):
  return unsigned(x) <= unsigned(y)

def ultN(x,y):
  return unsigned(x) < unsigned(y)

def lshr8(x,y):
  return np.int8(np.uint8(x) >> np.uint8(y))

def lshr16(x,y):
  return np.int16(np.uint16(x) >> np.uint16(y))

def lshr32(x,y):
  return np.int32(np.uint32(x) >> np.uint32(y))

def lshr64(x,y):
  return np.int64(np.uint64(x) >> np.uint64(y))

def sext_T_i8(x):
  return np.int8(x)

def sext_T_i16(x):
  return np.int16(x)

def sext_T_i32(x):
  return np.int32(x)

def sext_T_i64(x):
  return np.int64(x)

def itob_T_bool(x):
  return bool(x)

def btoi_bool_i8(x):
  return np.int8(x)

def btoi_bool_i16(x):
  return np.int8(x)

def btoi_bool_i32(x):
  return np.int8(x)

def btoi_bool_i64(x):
  return np.int8(x)

def zext_i8_i8(x):
  return np.int8(np.uint8(x))

def zext_i8_i16(x):
  return np.int16(np.uint8(x))

def zext_i8_i32(x):
  return np.int32(np.uint8(x))

def zext_i8_i64(x):
  return np.int64(np.uint8(x))

def zext_i16_i8(x):
  return np.int8(np.uint16(x))

def zext_i16_i16(x):
  return np.int16(np.uint16(x))

def zext_i16_i32(x):
  return np.int32(np.uint16(x))

def zext_i16_i64(x):
  return np.int64(np.uint16(x))

def zext_i32_i8(x):
  return np.int8(np.uint32(x))

def zext_i32_i16(x):
  return np.int16(np.uint32(x))

def zext_i32_i32(x):
  return np.int32(np.uint32(x))

def zext_i32_i64(x):
  return np.int64(np.uint32(x))

def zext_i64_i8(x):
  return np.int8(np.uint64(x))

def zext_i64_i16(x):
  return np.int16(np.uint64(x))

def zext_i64_i32(x):
  return np.int32(np.uint64(x))

def zext_i64_i64(x):
  return np.int64(np.uint64(x))

sdiv8 = sdiv16 = sdiv32 = sdiv64 = sdivN
sdiv_up8 = sdiv1_up6 = sdiv_up32 = sdiv_up64 = sdiv_upN
sdiv_safe8 = sdiv1_safe6 = sdiv_safe32 = sdiv_safe64 = sdivN
sdiv_up_safe8 = sdiv_up1_safe6 = sdiv_up_safe32 = sdiv_up_safe64 = sdiv_upN
smod8 = smod16 = smod32 = smod64 = smodN
smod_safe8 = smod_safe16 = smod_safe32 = smod_safe64 = smodN
udiv8 = udiv16 = udiv32 = udiv64 = udivN
udiv_up8 = udiv_up16 = udiv_up32 = udiv_up64 = udivN
udiv_safe8 = udiv_safe16 = udiv_safe32 = udiv_safe64 = udiv_upN
udiv_up_safe8 = udiv_up_safe16 = udiv_up_safe32 = udiv_up_safe64 = udiv_upN
umod8 = umod16 = umod32 = umod64 = umodN
umod_safe8 = umod_safe16 = umod_safe32 = umod_safe64 = umodN
squot8 = squot16 = squot32 = squot64 = squotN
squot_safe8 = squot_safe16 = squot_safe32 = squot_safe64 = squotN
srem8 = srem16 = srem32 = srem64 = sremN
srem_safe8 = srem_safe16 = srem_safe32 = srem_safe64 = sremN

shl8 = shl16 = shl32 = shl64 = shlN
ashr8 = ashr16 = ashr32 = ashr64 = ashrN
smax8 = smax16 = smax32 = smax64 = smaxN
smin8 = smin16 = smin32 = smin64 = sminN
umax8 = umax16 = umax32 = umax64 = umaxN
umin8 = umin16 = umin32 = umin64 = uminN
pow8 = pow16 = pow32 = pow64 = powN
fpow16 = fpow32 = fpow64 = fpowN
fmax16 = fmax32 = fmax64 = fmaxN
fmin16 = fmin32 = fmin64 = fminN
sle8 = sle16 = sle32 = sle64 = sleN
slt8 = slt16 = slt32 = slt64 = sltN
ule8 = ule16 = ule32 = ule64 = uleN
ult8 = ult16 = ult32 = ult64 = ultN
sext_i8_i8 = sext_i16_i8 = sext_i32_i8 = sext_i64_i8 = sext_T_i8
sext_i8_i16 = sext_i16_i16 = sext_i32_i16 = sext_i64_i16 = sext_T_i16
sext_i8_i32 = sext_i16_i32 = sext_i32_i32 = sext_i64_i32 = sext_T_i32
sext_i8_i64 = sext_i16_i64 = sext_i32_i64 = sext_i64_i64 = sext_T_i64
itob_i8_bool = itob_i16_bool = itob_i32_bool = itob_i64_bool = itob_T_bool

def clz_T(x):
  n = np.int32(0)
  bits = x.itemsize * 8
  for i in range(bits):
    if x < 0:
      break
    n += 1
    x <<= np.int8(1)
  return n

def ctz_T(x):
  n = np.int32(0)
  bits = x.itemsize * 8
  for i in range(bits):
    if (x & 1) == 1:
      break
    n += 1
    x >>= np.int8(1)
  return n

def popc_T(x):
  c = np.int32(0)
  while x != 0:
    x &= x - np.int8(1)
    c += np.int8(1)
  return c

futhark_popc8 = futhark_popc16 = futhark_popc32 = futhark_popc64 = popc_T
futhark_clzz8 = futhark_clzz16 = futhark_clzz32 = futhark_clzz64 = clz_T
futhark_ctzz8 = futhark_ctzz16 = futhark_ctzz32 = futhark_ctzz64 = ctz_T

def ssignum(x):
  return np.sign(x)

def usignum(x):
  if x < 0:
    return ssignum(-x)
  else:
    return ssignum(x)

def sitofp_T_f32(x):
  return np.float32(x)
sitofp_i8_f32 = sitofp_i16_f32 = sitofp_i32_f32 = sitofp_i64_f32 = sitofp_T_f32

def sitofp_T_f64(x):
  return np.float64(x)
sitofp_i8_f64 = sitofp_i16_f64 = sitofp_i32_f64 = sitofp_i64_f64 = sitofp_T_f64

def uitofp_T_f32(x):
  return np.float32(unsigned(x))
uitofp_i8_f32 = uitofp_i16_f32 = uitofp_i32_f32 = uitofp_i64_f32 = uitofp_T_f32

def uitofp_T_f64(x):
  return np.float64(unsigned(x))
uitofp_i8_f64 = uitofp_i16_f64 = uitofp_i32_f64 = uitofp_i64_f64 = uitofp_T_f64

def fptosi_T_i8(x):
  return np.int8(np.trunc(x))
fptosi_f16_i8 = fptosi_f32_i8 = fptosi_f64_i8 = fptosi_T_i8

def fptosi_T_i16(x):
  return np.int16(np.trunc(x))
fptosi_f16_i16 = fptosi_f32_i16 = fptosi_f64_i16 = fptosi_T_i16

def fptosi_T_i32(x):
  return np.int32(np.trunc(x))
fptosi_f16_i32 = fptosi_f32_i32 = fptosi_f64_i32 = fptosi_T_i32

def fptosi_T_i64(x):
  return np.int64(np.trunc(x))
fptosi_f16_i64 = fptosi_f32_i64 = fptosi_f64_i64 = fptosi_T_i64

def fptoui_T_i8(x):
  return np.uint8(np.trunc(x))
fptoui_f16_i8 = fptoui_f32_i8 = fptoui_f64_i8 = fptoui_T_i8

def fptoui_T_i16(x):
  return np.uint16(np.trunc(x))
fptoui_f16_i16 = fptoui_f32_i16 = fptoui_f64_i16 = fptoui_T_i16

def fptoui_T_i32(x):
  return np.uint32(np.trunc(x))
fptoui_f16_i32 = fptoui_f32_i32 = fptoui_f64_i32 = fptoui_T_i32

def fptoui_T_i64(x):
  return np.uint64(np.trunc(x))
fptoui_f16_i64 = fptoui_f32_i64 = fptoui_f64_i64 = fptoui_T_i64

def fpconv_f16_f32(x):
  return np.float32(x)

def fpconv_f16_f64(x):
  return np.float64(x)

def fpconv_f32_f16(x):
  return np.float16(x)

def fpconv_f32_f64(x):
  return np.float64(x)

def fpconv_f64_f16(x):
  return np.float16(x)

def fpconv_f64_f32(x):
  return np.float32(x)

def futhark_mul_hi8(a, b):
  a = np.uint64(np.uint8(a))
  b = np.uint64(np.uint8(b))
  return np.int8((a*b) >> np.uint64(8))

def futhark_mul_hi16(a, b):
  a = np.uint64(np.uint16(a))
  b = np.uint64(np.uint16(b))
  return np.int16((a*b) >> np.uint64(16))

def futhark_mul_hi32(a, b):
  a = np.uint64(np.uint32(a))
  b = np.uint64(np.uint32(b))
  return np.int32((a*b) >> np.uint64(32))

# This one is done with arbitrary-precision integers.
def futhark_mul_hi64(a, b):
  a = int(np.uint64(a))
  b = int(np.uint64(b))
  return np.int64(np.uint64(a*b >> 64))

def futhark_mad_hi8(a, b, c):
  return futhark_mul_hi8(a,b) + c

def futhark_mad_hi16(a, b, c):
  return futhark_mul_hi16(a,b) + c

def futhark_mad_hi32(a, b, c):
  return futhark_mul_hi32(a,b) + c

def futhark_mad_hi64(a, b, c):
  return futhark_mul_hi64(a,b) + c

def futhark_log64(x):
  return np.float64(np.log(x))

def futhark_log2_64(x):
  return np.float64(np.log2(x))

def futhark_log10_64(x):
  return np.float64(np.log10(x))

def futhark_sqrt64(x):
  return np.sqrt(x)

def futhark_exp64(x):
  return np.exp(x)

def futhark_cos64(x):
  return np.cos(x)

def futhark_sin64(x):
  return np.sin(x)

def futhark_tan64(x):
  return np.tan(x)

def futhark_acos64(x):
  return np.arccos(x)

def futhark_asin64(x):
  return np.arcsin(x)

def futhark_atan64(x):
  return np.arctan(x)

def futhark_cosh64(x):
  return np.cosh(x)

def futhark_sinh64(x):
  return np.sinh(x)

def futhark_tanh64(x):
  return np.tanh(x)

def futhark_acosh64(x):
  return np.arccosh(x)

def futhark_asinh64(x):
  return np.arcsinh(x)

def futhark_atanh64(x):
  return np.arctanh(x)

def futhark_atan2_64(x, y):
  return np.arctan2(x, y)

def futhark_hypot64(x, y):
  return np.hypot(x, y)

def futhark_gamma64(x):
  return np.float64(math.gamma(x))

def futhark_lgamma64(x):
  return np.float64(math.lgamma(x))

def futhark_round64(x):
  return np.round(x)

def futhark_ceil64(x):
  return np.ceil(x)

def futhark_floor64(x):
  return np.floor(x)

def futhark_isnan64(x):
  return np.isnan(x)

def futhark_isinf64(x):
  return np.isinf(x)

def futhark_to_bits64(x):
  s = struct.pack('>d', x)
  return np.int64(struct.unpack('>q', s)[0])

def futhark_from_bits64(x):
  s = struct.pack('>q', x)
  return np.float64(struct.unpack('>d', s)[0])

def futhark_log32(x):
  return np.float32(np.log(x))

def futhark_log2_32(x):
  return np.float32(np.log2(x))

def futhark_log10_32(x):
  return np.float32(np.log10(x))

def futhark_sqrt32(x):
  return np.float32(np.sqrt(x))

def futhark_exp32(x):
  return np.exp(x)

def futhark_cos32(x):
  return np.cos(x)

def futhark_sin32(x):
  return np.sin(x)

def futhark_tan32(x):
  return np.tan(x)

def futhark_acos32(x):
  return np.arccos(x)

def futhark_asin32(x):
  return np.arcsin(x)

def futhark_atan32(x):
  return np.arctan(x)

def futhark_cosh32(x):
  return np.cosh(x)

def futhark_sinh32(x):
  return np.sinh(x)

def futhark_tanh32(x):
  return np.tanh(x)

def futhark_acosh32(x):
  return np.arccosh(x)

def futhark_asinh32(x):
  return np.arcsinh(x)

def futhark_atanh32(x):
  return np.arctanh(x)

def futhark_atan2_32(x, y):
  return np.arctan2(x, y)

def futhark_hypot32(x, y):
  return np.hypot(x, y)

def futhark_gamma32(x):
  return np.float32(math.gamma(x))

def futhark_lgamma32(x):
  return np.float32(math.lgamma(x))

def futhark_round32(x):
  return np.round(x)

def futhark_ceil32(x):
  return np.ceil(x)

def futhark_floor32(x):
  return np.floor(x)

def futhark_isnan32(x):
  return np.isnan(x)

def futhark_isinf32(x):
  return np.isinf(x)

def futhark_to_bits32(x):
  s = struct.pack('>f', x)
  return np.int32(struct.unpack('>l', s)[0])

def futhark_from_bits32(x):
  s = struct.pack('>l', x)
  return np.float32(struct.unpack('>f', s)[0])

def futhark_log16(x):
  return np.float16(np.log(x))

def futhark_log2_16(x):
  return np.float16(np.log2(x))

def futhark_log10_16(x):
  return np.float16(np.log10(x))

def futhark_sqrt16(x):
  return np.float16(np.sqrt(x))

def futhark_exp16(x):
  return np.exp(x)

def futhark_cos16(x):
  return np.cos(x)

def futhark_sin16(x):
  return np.sin(x)

def futhark_tan16(x):
  return np.tan(x)

def futhark_acos16(x):
  return np.arccos(x)

def futhark_asin16(x):
  return np.arcsin(x)

def futhark_atan16(x):
  return np.arctan(x)

def futhark_cosh16(x):
  return np.cosh(x)

def futhark_sinh16(x):
  return np.sinh(x)

def futhark_tanh16(x):
  return np.tanh(x)

def futhark_acosh16(x):
  return np.arccosh(x)

def futhark_asinh16(x):
  return np.arcsinh(x)

def futhark_atanh16(x):
  return np.arctanh(x)

def futhark_atan2_16(x, y):
  return np.arctan2(x, y)

def futhark_hypot16(x, y):
  return np.hypot(x, y)

def futhark_gamma16(x):
  return np.float16(math.gamma(x))

def futhark_lgamma16(x):
  return np.float16(math.lgamma(x))

def futhark_round16(x):
  return np.round(x)

def futhark_ceil16(x):
  return np.ceil(x)

def futhark_floor16(x):
  return np.floor(x)

def futhark_isnan16(x):
  return np.isnan(x)

def futhark_isinf16(x):
  return np.isinf(x)

def futhark_to_bits16(x):
  s = struct.pack('>e', x)
  return np.int16(struct.unpack('>H', s)[0])

def futhark_from_bits16(x):
  s = struct.pack('>H', np.uint16(x))
  return np.float16(struct.unpack('>e', s)[0])

def futhark_lerp16(v0, v1, t):
  return v0 + (v1-v0)*t

def futhark_lerp32(v0, v1, t):
  return v0 + (v1-v0)*t

def futhark_lerp64(v0, v1, t):
  return v0 + (v1-v0)*t

def futhark_mad16(a, b, c):
  return a * b + c

def futhark_mad32(a, b, c):
  return a * b + c

def futhark_mad64(a, b, c):
  return a * b + c

def futhark_fma16(a, b, c):
  return a * b + c

def futhark_fma32(a, b, c):
  return a * b + c

def futhark_fma64(a, b, c):
  return a * b + c

# End of scalar.py.
# Start of server.py

import sys
import time
import shlex # For string splitting

class Server:
    def __init__(self, ctx):
        self._ctx = ctx
        self._vars = {}

    class Failure(BaseException):
        def __init__(self, msg):
            self.msg = msg

    def _get_arg(self, args, i):
        if i < len(args):
            return args[i]
        else:
            raise self.Failure('Insufficient command args')

    def _get_entry_point(self, entry):
        if entry in self._ctx.entry_points:
            return self._ctx.entry_points[entry]
        else:
            raise self.Failure('Unknown entry point: %s' % entry)

    def _check_var(self, vname):
        if not vname in self._vars:
            raise self.Failure('Unknown variable: %s' % vname)

    def _check_new_var(self, vname):
        if vname in self._vars:
            raise self.Failure('Variable already exists: %s' % vname)

    def _get_var(self, vname):
        self._check_var(vname)
        return self._vars[vname]

    def _cmd_inputs(self, args):
        entry = self._get_arg(args, 0)
        for t in self._get_entry_point(entry)[0]:
            print(t)

    def _cmd_outputs(self, args):
        entry = self._get_arg(args, 0)
        for t in self._get_entry_point(entry)[1]:
            print(t)

    def _cmd_dummy(self, args):
        pass

    def _cmd_free(self, args):
        for vname in args:
            self._check_var(vname)
            del self._vars[vname]

    def _cmd_rename(self, args):
        oldname = self._get_arg(args, 0)
        newname = self._get_arg(args, 1)
        self._check_var(oldname)
        self._check_new_var(newname)
        self._vars[newname] = self._vars[oldname]
        del self._vars[oldname]

    def _cmd_call(self, args):
        entry = self._get_entry_point(self._get_arg(args, 0))
        num_ins = len(entry[0])
        num_outs = len(entry[1])
        exp_len = 1 + num_outs + num_ins

        if len(args) != exp_len:
            raise self.Failure('Invalid argument count, expected %d' % exp_len)

        out_vnames = args[1:num_outs+1]

        for out_vname in out_vnames:
            self._check_new_var(out_vname)

        in_vnames = args[1+num_outs:]
        ins = [ self._get_var(in_vname) for in_vname in in_vnames ]

        try:
            (runtime, vals) = getattr(self._ctx, args[0])(*ins)
        except Exception as e:
            raise self.Failure(str(e))

        print('runtime: %d' % runtime)

        if num_outs == 1:
            self._vars[out_vnames[0]] = vals
        else:
            for (out_vname, val) in zip(out_vnames, vals):
                self._vars[out_vname] = val

    def _store_val(self, f, value):
        # In case we are using the PyOpenCL backend, we first
        # need to convert OpenCL arrays to ordinary NumPy
        # arrays.  We do this in a nasty way.
        if isinstance(value, opaque):
            for component in value.data:
                self._store_val(f, component)
        elif isinstance(value, np.number) or isinstance(value, bool) or isinstance(value, np.bool_) or isinstance(value, np.ndarray):
            # Ordinary NumPy value.
            f.write(construct_binary_value(value))
        else:
            # Assuming PyOpenCL array.
            f.write(construct_binary_value(value.get()))

    def _cmd_store(self, args):
        fname = self._get_arg(args, 0)

        with open(fname, 'wb') as f:
            for i in range(1, len(args)):
                self._store_val(f, self._get_var(args[i]))

    def _restore_val(self, reader, typename):
        if typename in self._ctx.opaques:
            vs = []
            for t in self._ctx.opaques[typename]:
                vs += [read_value(t, reader)]
            return opaque(typename, *vs)
        else:
            return read_value(typename, reader)

    def _cmd_restore(self, args):
        if len(args) % 2 == 0:
            raise self.Failure('Invalid argument count')

        fname = args[0]
        args = args[1:]

        with open(fname, 'rb') as f:
            reader = ReaderInput(f)
            while args != []:
                vname = args[0]
                typename = args[1]
                args = args[2:]

                if vname in self._vars:
                    raise self.Failure('Variable already exists: %s' % vname)

                try:
                    self._vars[vname] = self._restore_val(reader, typename)
                except ValueError:
                    raise self.Failure('Failed to restore variable %s.\n'
                                       'Possibly malformed data in %s.\n'
                                       % (vname, fname))

            skip_spaces(reader)
            if reader.get_char() != b'':
                raise self.Failure('Expected EOF after reading values')

    _commands = { 'inputs': _cmd_inputs,
                  'outputs': _cmd_outputs,
                  'call': _cmd_call,
                  'restore': _cmd_restore,
                  'store': _cmd_store,
                  'free': _cmd_free,
                  'rename': _cmd_rename,
                  'clear': _cmd_dummy,
                  'pause_profiling': _cmd_dummy,
                  'unpause_profiling': _cmd_dummy,
                  'report': _cmd_dummy
                 }

    def _process_line(self, line):
        words = shlex.split(line)
        if words == []:
            raise self.Failure('Empty line')
        else:
            cmd = words[0]
            args = words[1:]
            if cmd in self._commands:
                self._commands[cmd](self, args)
            else:
                raise self.Failure('Unknown command: %s' % cmd)

    def run(self):
        while True:
            print('%%% OK', flush=True)
            line = sys.stdin.readline()
            if line == '':
                return
            try:
                self._process_line(line)
            except self.Failure as e:
                print('%%% FAILURE')
                print(e.msg)

# End of server.py
runtime_file = None
do_warmup_run = False
num_runs = 1
entry_point = "main"
binary_output = False
parser = argparse.ArgumentParser(description="A compiled Futhark program.")
parser.add_argument("--tuning", action="append", default=[], type=open)
parser.add_argument("-L", "--log", action="append_const", default=[],
                    const=None)
parser.add_argument("-t", "--write-runtime-to", action="append", default=[],
                    type=str)
parser.add_argument("-r", "--runs", action="append", default=[], type=str)
parser.add_argument("-e", "--entry-point", action="append", default=[],
                    type=str)
parser.add_argument("-b", "--binary-output", action="append_const", default=[],
                    const=None)
parser.add_argument("-p", "--platform", action="append", default=[], type=str)
parser.add_argument("-d", "--device", action="append", default=[], type=str)
parser.add_argument("--default-threshold", action="append", default=[],
                    type=int)
parser.add_argument("--default-group-size", action="append", default=[],
                    type=int)
parser.add_argument("--default-num-groups", action="append", default=[],
                    type=int)
parser.add_argument("--default-tile-size", action="append", default=[],
                    type=int)
parser.add_argument("--default-reg-tile-size", action="append", default=[],
                    type=int)
parser.add_argument("--size", action="append", default=[], type=size_assignment)
parser_result = vars(parser.parse_args(sys.argv[1:]))
for optarg in parser_result["tuning"]:
  read_tuning_file(sizes, optarg)
for optarg in parser_result["log"]:
  pass
for optarg in parser_result["write_runtime_to"]:
  if runtime_file:
    runtime_file.close()
  runtime_file = open(optarg, "w")
for optarg in parser_result["runs"]:
  num_runs = optarg
  do_warmup_run = True
for optarg in parser_result["entry_point"]:
  entry_point = optarg
for optarg in parser_result["binary_output"]:
  binary_output = True
for optarg in parser_result["platform"]:
  preferred_platform = optarg
for optarg in parser_result["device"]:
  preferred_device = optarg
for optarg in parser_result["default_threshold"]:
  default_threshold = optarg
for optarg in parser_result["default_group_size"]:
  default_group_size = optarg
for optarg in parser_result["default_num_groups"]:
  default_num_groups = optarg
for optarg in parser_result["default_tile_size"]:
  default_tile_size = optarg
for optarg in parser_result["default_reg_tile_size"]:
  default_reg_tile_size = optarg
for optarg in parser_result["size"]:
  sizes[optarg[0]] = optarg[1]
class internal:
  def __init__(self, command_queue=None, interactive=False,
               platform_pref=preferred_platform, device_pref=preferred_device,
               default_group_size=default_group_size,
               default_num_groups=default_num_groups,
               default_tile_size=default_tile_size,
               default_reg_tile_size=default_reg_tile_size,
               default_threshold=default_threshold, sizes=sizes):
    size_heuristics=[("NVIDIA CUDA", cl.device_type.GPU, "lockstep_width",
      lambda device: np.int32(32)), ("AMD Accelerated Parallel Processing",
                                     cl.device_type.GPU, "lockstep_width",
                                     lambda device: np.int32(32)), ("",
                                                                    cl.device_type.GPU,
                                                                    "lockstep_width",
                                                                    lambda device: np.int32(1)),
     ("", cl.device_type.GPU, "num_groups",
      lambda device: (np.int32(4) * device.get_info(getattr(cl.device_info,
                                                            "MAX_COMPUTE_UNITS")))),
     ("", cl.device_type.GPU, "group_size", lambda device: np.int32(256)), ("",
                                                                            cl.device_type.GPU,
                                                                            "tile_size",
                                                                            lambda device: np.int32(32)),
     ("", cl.device_type.GPU, "reg_tile_size", lambda device: np.int32(2)), ("",
                                                                             cl.device_type.GPU,
                                                                             "threshold",
                                                                             lambda device: np.int32(32768)),
     ("", cl.device_type.CPU, "lockstep_width", lambda device: np.int32(1)), ("",
                                                                              cl.device_type.CPU,
                                                                              "num_groups",
                                                                              lambda device: device.get_info(getattr(cl.device_info,
                                                                                                                     "MAX_COMPUTE_UNITS"))),
     ("", cl.device_type.CPU, "group_size", lambda device: np.int32(32)), ("",
                                                                           cl.device_type.CPU,
                                                                           "tile_size",
                                                                           lambda device: np.int32(4)),
     ("", cl.device_type.CPU, "reg_tile_size", lambda device: np.int32(1)), ("",
                                                                             cl.device_type.CPU,
                                                                             "threshold",
                                                                             lambda device: device.get_info(getattr(cl.device_info,
                                                                                                                    "MAX_COMPUTE_UNITS")))]
    self.global_failure_args_max = 2
    self.failure_msgs=["Index [{}] out of bounds for array of shape [{}].\n-> #0  logit.fut:74:28-32\n   #1  /prelude/soacs.fut:67:19-23\n   #2  /prelude/soacs.fut:67:3-37\n   #3  logit.fut:74:13-37\n   #4  logit.fut:84:12-32\n   #5  logit.fut:117:3-29\n   #6  logit.fut:112:1-117:29\n",
     "Index [{}] out of bounds for array of shape [{}].\n-> #0  logit.fut:74:28-32\n   #1  /prelude/soacs.fut:67:19-23\n   #2  /prelude/soacs.fut:67:3-37\n   #3  logit.fut:74:13-37\n   #4  logit.fut:84:12-32\n   #5  logit.fut:117:3-29\n   #6  logit.fut:112:1-117:29\n",
     "Index [{}] out of bounds for array of shape [{}].\n-> #0  logit.fut:74:28-32\n   #1  /prelude/soacs.fut:67:19-23\n   #2  /prelude/soacs.fut:67:3-37\n   #3  logit.fut:74:13-37\n   #4  logit.fut:84:12-32\n   #5  logit.fut:117:3-29\n   #6  logit.fut:112:1-117:29\n",
     "Index [{}] out of bounds for array of shape [{}].\n-> #0  logit.fut:74:28-32\n   #1  /prelude/soacs.fut:67:19-23\n   #2  /prelude/soacs.fut:67:3-37\n   #3  logit.fut:74:13-37\n   #4  logit.fut:84:12-32\n   #5  logit.fut:117:3-29\n   #6  logit.fut:112:1-117:29\n"]
    program = initialise_opencl_object(self,
                                       program_src=fut_opencl_src,
                                       command_queue=command_queue,
                                       interactive=interactive,
                                       platform_pref=platform_pref,
                                       device_pref=device_pref,
                                       default_group_size=default_group_size,
                                       default_num_groups=default_num_groups,
                                       default_tile_size=default_tile_size,
                                       default_reg_tile_size=default_reg_tile_size,
                                       default_threshold=default_threshold,
                                       size_heuristics=size_heuristics,
                                       required_types=["i32", "i64", "f64", "bool", "unit"],
                                       user_sizes=sizes,
                                       all_sizes={"builtin#replicate_f64.group_size_19931": {"class": "group_size",
                                                                                   "value": None},
                                        "builtin#replicate_i64.group_size_20491": {"class": "group_size",
                                                                                   "value": None},
                                        "criterion.Rx_18856": {"class": "reg_tile_size", "value": None},
                                        "criterion.Ry_18857": {"class": "reg_tile_size", "value": None},
                                        "criterion.Tk_18853": {"class": "tile_size", "value": None},
                                        "criterion.Tx_18854": {"class": "tile_size", "value": None},
                                        "criterion.Ty_18855": {"class": "tile_size", "value": None},
                                        "criterion.segmap_group_size_17419": {"class": "group_size", "value": None},
                                        "criterion.segmap_group_size_17557": {"class": "group_size", "value": None},
                                        "criterion.segred_group_size_17332": {"class": "group_size", "value": None},
                                        "criterion.segred_group_size_17576": {"class": "group_size", "value": None},
                                        "criterion.segred_group_size_17595": {"class": "group_size", "value": None},
                                        "criterion.segred_group_size_17640": {"class": "group_size", "value": None},
                                        "criterion.segred_group_size_17757": {"class": "group_size", "value": None},
                                        "criterion.segred_num_groups_17334": {"class": "num_groups", "value": None},
                                        "criterion.segred_num_groups_17578": {"class": "num_groups", "value": None},
                                        "criterion.segred_num_groups_17597": {"class": "num_groups", "value": None},
                                        "criterion.segred_num_groups_17642": {"class": "num_groups", "value": None},
                                        "criterion.segred_num_groups_17759": {"class": "num_groups", "value": None},
                                        "criterion.suff_intra_par_2": {"class": "threshold(32, !criterion.suff_outer_par_1 !criterion.suff_outer_redomap_0)",
                                                                       "value": 32},
                                        "criterion.suff_outer_par_1": {"class": "threshold(def, !criterion.suff_outer_redomap_0)",
                                                                       "value": None},
                                        "criterion.suff_outer_par_3": {"class": "threshold(def, !criterion.suff_outer_par_1 !criterion.suff_intra_par_2 !criterion.suff_outer_redomap_0)",
                                                                       "value": None},
                                        "criterion.suff_outer_redomap_0": {"class": "threshold(def,)", "value": None},
                                        "generate_data.Rx_18856": {"class": "reg_tile_size", "value": None},
                                        "generate_data.Ry_18857": {"class": "reg_tile_size", "value": None},
                                        "generate_data.Tk_18853": {"class": "tile_size", "value": None},
                                        "generate_data.Tx_18854": {"class": "tile_size", "value": None},
                                        "generate_data.Ty_18855": {"class": "tile_size", "value": None},
                                        "generate_data.group_size_19978": {"class": "group_size", "value": None},
                                        "generate_data.segmap_group_size_18029": {"class": "group_size",
                                                                                  "value": None},
                                        "generate_data.segmap_group_size_18427": {"class": "group_size",
                                                                                  "value": None},
                                        "generate_data.segmap_group_size_18818": {"class": "group_size",
                                                                                  "value": None},
                                        "generate_data.segmap_num_groups_18031": {"class": "num_groups",
                                                                                  "value": None},
                                        "generate_data.segred_group_size_17961": {"class": "group_size",
                                                                                  "value": None},
                                        "generate_data.segred_group_size_17973": {"class": "group_size",
                                                                                  "value": None},
                                        "generate_data.segred_group_size_17987": {"class": "group_size",
                                                                                  "value": None},
                                        "generate_data.segred_group_size_18541": {"class": "group_size",
                                                                                  "value": None},
                                        "generate_data.segred_group_size_18560": {"class": "group_size",
                                                                                  "value": None},
                                        "generate_data.segred_group_size_18605": {"class": "group_size",
                                                                                  "value": None},
                                        "generate_data.segred_num_groups_17963": {"class": "num_groups",
                                                                                  "value": None},
                                        "generate_data.segred_num_groups_17975": {"class": "num_groups",
                                                                                  "value": None},
                                        "generate_data.segred_num_groups_17989": {"class": "num_groups",
                                                                                  "value": None},
                                        "generate_data.segred_num_groups_18543": {"class": "num_groups",
                                                                                  "value": None},
                                        "generate_data.segred_num_groups_18562": {"class": "num_groups",
                                                                                  "value": None},
                                        "generate_data.segred_num_groups_18607": {"class": "num_groups",
                                                                                  "value": None},
                                        "generate_data.segscan_group_size_18522": {"class": "group_size",
                                                                                   "value": None},
                                        "generate_data.segscan_num_groups_18524": {"class": "num_groups",
                                                                                   "value": None},
                                        "generate_data.suff_intra_par_1": {"class": "threshold(32, !generate_data.suff_outer_par_0)",
                                                                           "value": 32},
                                        "generate_data.suff_outer_par_0": {"class": "threshold(def,)", "value": None},
                                        "generate_data.suff_outer_par_2": {"class": "threshold(def, !generate_data.suff_outer_par_0 !generate_data.suff_intra_par_1)",
                                                                           "value": None}})
    self.builtinzhreplicate_f64zireplicate_19928_var = program.builtinzhreplicate_f64zireplicate_19928
    self.builtinzhreplicate_i64zireplicate_20488_var = program.builtinzhreplicate_i64zireplicate_20488
    self.criterionzisegmap_17417_var = program.criterionzisegmap_17417
    self.criterionzisegmap_17555_var = program.criterionzisegmap_17555
    self.criterionzisegmap_intragroup_17413_var = program.criterionzisegmap_intragroup_17413
    self.criterionzisegmap_intragroup_18877_var = program.criterionzisegmap_intragroup_18877
    self.criterionzisegred_large_17582_var = program.criterionzisegred_large_17582
    self.criterionzisegred_large_17601_var = program.criterionzisegred_large_17601
    self.criterionzisegred_large_17646_var = program.criterionzisegred_large_17646
    self.criterionzisegred_nonseg_17340_var = program.criterionzisegred_nonseg_17340
    self.criterionzisegred_nonseg_17765_var = program.criterionzisegred_nonseg_17765
    self.criterionzisegred_small_17582_var = program.criterionzisegred_small_17582
    self.criterionzisegred_small_17601_var = program.criterionzisegred_small_17601
    self.criterionzisegred_small_17646_var = program.criterionzisegred_small_17646
    self.generate_datazicopy_19975_var = program.generate_datazicopy_19975
    self.generate_dataziscan_stage1_18528_var = program.generate_dataziscan_stage1_18528
    self.generate_dataziscan_stage2_18528_var = program.generate_dataziscan_stage2_18528
    self.generate_dataziscan_stage3_18528_var = program.generate_dataziscan_stage3_18528
    self.generate_datazisegmap_18027_var = program.generate_datazisegmap_18027
    self.generate_datazisegmap_18425_var = program.generate_datazisegmap_18425
    self.generate_datazisegmap_18816_var = program.generate_datazisegmap_18816
    self.generate_datazisegmap_intragroup_18023_var = program.generate_datazisegmap_intragroup_18023
    self.generate_datazisegmap_intragroup_18877_var = program.generate_datazisegmap_intragroup_18877
    self.generate_datazisegred_large_18547_var = program.generate_datazisegred_large_18547
    self.generate_datazisegred_large_18566_var = program.generate_datazisegred_large_18566
    self.generate_datazisegred_large_18611_var = program.generate_datazisegred_large_18611
    self.generate_datazisegred_nonseg_17971_var = program.generate_datazisegred_nonseg_17971
    self.generate_datazisegred_nonseg_17985_var = program.generate_datazisegred_nonseg_17985
    self.generate_datazisegred_nonseg_17999_var = program.generate_datazisegred_nonseg_17999
    self.generate_datazisegred_small_18547_var = program.generate_datazisegred_small_18547
    self.generate_datazisegred_small_18566_var = program.generate_datazisegred_small_18566
    self.generate_datazisegred_small_18611_var = program.generate_datazisegred_small_18611
    self.gpu_map_transpose_f64_var = program.gpu_map_transpose_f64
    self.gpu_map_transpose_f64_low_height_var = program.gpu_map_transpose_f64_low_height
    self.gpu_map_transpose_f64_low_width_var = program.gpu_map_transpose_f64_low_width
    self.gpu_map_transpose_f64_small_var = program.gpu_map_transpose_f64_small
    self.constants = {}
    criterionzicounter_mem_19925 = np.array([np.int32(0), np.int32(0),
                                             np.int32(0), np.int32(0),
                                             np.int32(0), np.int32(0),
                                             np.int32(0), np.int32(0),
                                             np.int32(0), np.int32(0)],
                                            dtype=np.int32)
    static_mem_20505 = opencl_alloc(self, 40, "static_mem_20505")
    if (40 != 0):
      cl.enqueue_copy(self.queue, static_mem_20505,
                      normaliseArray(criterionzicounter_mem_19925),
                      is_blocking=synchronous)
    self.criterionzicounter_mem_19925 = static_mem_20505
    criterionzicounter_mem_20123 = np.zeros(10240, dtype=np.int32)
    static_mem_20507 = opencl_alloc(self, 40960, "static_mem_20507")
    if (40960 != 0):
      cl.enqueue_copy(self.queue, static_mem_20507,
                      normaliseArray(criterionzicounter_mem_20123),
                      is_blocking=synchronous)
    self.criterionzicounter_mem_20123 = static_mem_20507
    criterionzicounter_mem_20191 = np.zeros(10240, dtype=np.int32)
    static_mem_20508 = opencl_alloc(self, 40960, "static_mem_20508")
    if (40960 != 0):
      cl.enqueue_copy(self.queue, static_mem_20508,
                      normaliseArray(criterionzicounter_mem_20191),
                      is_blocking=synchronous)
    self.criterionzicounter_mem_20191 = static_mem_20508
    criterionzicounter_mem_20256 = np.zeros(10240, dtype=np.int32)
    static_mem_20509 = opencl_alloc(self, 40960, "static_mem_20509")
    if (40960 != 0):
      cl.enqueue_copy(self.queue, static_mem_20509,
                      normaliseArray(criterionzicounter_mem_20256),
                      is_blocking=synchronous)
    self.criterionzicounter_mem_20256 = static_mem_20509
    criterionzicounter_mem_20300 = np.array([np.int32(0), np.int32(0),
                                             np.int32(0), np.int32(0),
                                             np.int32(0), np.int32(0),
                                             np.int32(0), np.int32(0),
                                             np.int32(0), np.int32(0)],
                                            dtype=np.int32)
    static_mem_20510 = opencl_alloc(self, 40, "static_mem_20510")
    if (40 != 0):
      cl.enqueue_copy(self.queue, static_mem_20510,
                      normaliseArray(criterionzicounter_mem_20300),
                      is_blocking=synchronous)
    self.criterionzicounter_mem_20300 = static_mem_20510
    generate_datazicounter_mem_19937 = np.array([np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0)],
                                                dtype=np.int32)
    static_mem_20512 = opencl_alloc(self, 40, "static_mem_20512")
    if (40 != 0):
      cl.enqueue_copy(self.queue, static_mem_20512,
                      normaliseArray(generate_datazicounter_mem_19937),
                      is_blocking=synchronous)
    self.generate_datazicounter_mem_19937 = static_mem_20512
    generate_datazicounter_mem_19987 = np.array([np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0)],
                                                dtype=np.int32)
    static_mem_20515 = opencl_alloc(self, 40, "static_mem_20515")
    if (40 != 0):
      cl.enqueue_copy(self.queue, static_mem_20515,
                      normaliseArray(generate_datazicounter_mem_19987),
                      is_blocking=synchronous)
    self.generate_datazicounter_mem_19987 = static_mem_20515
    generate_datazicounter_mem_20026 = np.array([np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0),
                                                 np.int32(0), np.int32(0)],
                                                dtype=np.int32)
    static_mem_20518 = opencl_alloc(self, 40, "static_mem_20518")
    if (40 != 0):
      cl.enqueue_copy(self.queue, static_mem_20518,
                      normaliseArray(generate_datazicounter_mem_20026),
                      is_blocking=synchronous)
    self.generate_datazicounter_mem_20026 = static_mem_20518
    generate_datazicounter_mem_20251 = np.zeros(10240, dtype=np.int32)
    static_mem_20521 = opencl_alloc(self, 40960, "static_mem_20521")
    if (40960 != 0):
      cl.enqueue_copy(self.queue, static_mem_20521,
                      normaliseArray(generate_datazicounter_mem_20251),
                      is_blocking=synchronous)
    self.generate_datazicounter_mem_20251 = static_mem_20521
    generate_datazicounter_mem_20319 = np.zeros(10240, dtype=np.int32)
    static_mem_20522 = opencl_alloc(self, 40960, "static_mem_20522")
    if (40960 != 0):
      cl.enqueue_copy(self.queue, static_mem_20522,
                      normaliseArray(generate_datazicounter_mem_20319),
                      is_blocking=synchronous)
    self.generate_datazicounter_mem_20319 = static_mem_20522
    generate_datazicounter_mem_20384 = np.zeros(10240, dtype=np.int32)
    static_mem_20523 = opencl_alloc(self, 40960, "static_mem_20523")
    if (40960 != 0):
      cl.enqueue_copy(self.queue, static_mem_20523,
                      normaliseArray(generate_datazicounter_mem_20384),
                      is_blocking=synchronous)
    self.generate_datazicounter_mem_20384 = static_mem_20523
  def futhark_builtinzhgpu_map_transpose_f64(self, destmem_0, destoffset_1,
                                             srcmem_2, srcoffset_3,
                                             num_arrays_4, x_elems_5,
                                             y_elems_6):
    if ((num_arrays_4 == np.int32(0)) or ((x_elems_5 == np.int32(0)) or (y_elems_6 == np.int32(0)))):
      pass
    else:
      muly_8 = squot32(np.int32(16), x_elems_5)
      mulx_7 = squot32(np.int32(16), y_elems_6)
      if ((num_arrays_4 == np.int32(1)) and ((x_elems_5 == np.int32(1)) or (y_elems_6 == np.int32(1)))):
        if (sext_i32_i64(((x_elems_5 * y_elems_6) * np.int32(8))) != 0):
          cl.enqueue_copy(self.queue, destmem_0, srcmem_2,
                          dest_offset=np.int64(sext_i32_i64(destoffset_1)),
                          src_offset=np.int64(sext_i32_i64(srcoffset_3)),
                          byte_count=np.int64(sext_i32_i64(((x_elems_5 * y_elems_6) * np.int32(8)))))
        if synchronous:
          sync(self)
      else:
        if (sle32(x_elems_5, np.int32(8)) and slt32(np.int32(16), y_elems_6)):
          if ((((1 * (np.int64(sdiv_up32(x_elems_5,
                                         np.int32(16))) * np.int64(np.int32(16)))) * (np.int64(sdiv_up32(sdiv_up32(y_elems_6,
                                                                                                                   muly_8),
                                                                                                         np.int32(16))) * np.int64(np.int32(16)))) * (np.int64(num_arrays_4) * np.int64(np.int32(1)))) != 0):
            self.gpu_map_transpose_f64_low_width_var.set_args(cl.LocalMemory(np.int64(np.int64(2176))),
                                                              np.int32(destoffset_1),
                                                              np.int32(srcoffset_3),
                                                              np.int32(num_arrays_4),
                                                              np.int32(x_elems_5),
                                                              np.int32(y_elems_6),
                                                              np.int32(mulx_7),
                                                              np.int32(muly_8),
                                                              destmem_0,
                                                              srcmem_2)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.gpu_map_transpose_f64_low_width_var,
                                       ((np.int64(sdiv_up32(x_elems_5,
                                                            np.int32(16))) * np.int64(np.int32(16))),
                                        (np.int64(sdiv_up32(sdiv_up32(y_elems_6,
                                                                      muly_8),
                                                            np.int32(16))) * np.int64(np.int32(16))),
                                        (np.int64(num_arrays_4) * np.int64(np.int32(1)))),
                                       (np.int64(np.int32(16)),
                                        np.int64(np.int32(16)),
                                        np.int64(np.int32(1))))
            if synchronous:
              sync(self)
        else:
          if (sle32(y_elems_6, np.int32(8)) and slt32(np.int32(16), x_elems_5)):
            if ((((1 * (np.int64(sdiv_up32(sdiv_up32(x_elems_5, mulx_7),
                                           np.int32(16))) * np.int64(np.int32(16)))) * (np.int64(sdiv_up32(y_elems_6,
                                                                                                           np.int32(16))) * np.int64(np.int32(16)))) * (np.int64(num_arrays_4) * np.int64(np.int32(1)))) != 0):
              self.gpu_map_transpose_f64_low_height_var.set_args(cl.LocalMemory(np.int64(np.int64(2176))),
                                                                 np.int32(destoffset_1),
                                                                 np.int32(srcoffset_3),
                                                                 np.int32(num_arrays_4),
                                                                 np.int32(x_elems_5),
                                                                 np.int32(y_elems_6),
                                                                 np.int32(mulx_7),
                                                                 np.int32(muly_8),
                                                                 destmem_0,
                                                                 srcmem_2)
              cl.enqueue_nd_range_kernel(self.queue,
                                         self.gpu_map_transpose_f64_low_height_var,
                                         ((np.int64(sdiv_up32(sdiv_up32(x_elems_5,
                                                                        mulx_7),
                                                              np.int32(16))) * np.int64(np.int32(16))),
                                          (np.int64(sdiv_up32(y_elems_6,
                                                              np.int32(16))) * np.int64(np.int32(16))),
                                          (np.int64(num_arrays_4) * np.int64(np.int32(1)))),
                                         (np.int64(np.int32(16)),
                                          np.int64(np.int32(16)),
                                          np.int64(np.int32(1))))
              if synchronous:
                sync(self)
          else:
            if (sle32(x_elems_5, np.int32(8)) and sle32(y_elems_6,
                                                        np.int32(8))):
              if ((1 * (np.int64(sdiv_up32(((num_arrays_4 * x_elems_5) * y_elems_6),
                                           np.int32(256))) * np.int64(np.int32(256)))) != 0):
                self.gpu_map_transpose_f64_small_var.set_args(cl.LocalMemory(np.int64(np.int64(1))),
                                                              np.int32(destoffset_1),
                                                              np.int32(srcoffset_3),
                                                              np.int32(num_arrays_4),
                                                              np.int32(x_elems_5),
                                                              np.int32(y_elems_6),
                                                              np.int32(mulx_7),
                                                              np.int32(muly_8),
                                                              destmem_0,
                                                              srcmem_2)
                cl.enqueue_nd_range_kernel(self.queue,
                                           self.gpu_map_transpose_f64_small_var,
                                           ((np.int64(sdiv_up32(((num_arrays_4 * x_elems_5) * y_elems_6),
                                                                np.int32(256))) * np.int64(np.int32(256))),),
                                           (np.int64(np.int32(256)),))
                if synchronous:
                  sync(self)
            else:
              if ((((1 * (np.int64(sdiv_up32(x_elems_5,
                                             np.int32(32))) * np.int64(np.int32(32)))) * (np.int64(sdiv_up32(y_elems_6,
                                                                                                             np.int32(32))) * np.int64(np.int32(8)))) * (np.int64(num_arrays_4) * np.int64(np.int32(1)))) != 0):
                self.gpu_map_transpose_f64_var.set_args(cl.LocalMemory(np.int64(np.int64(8448))),
                                                        np.int32(destoffset_1),
                                                        np.int32(srcoffset_3),
                                                        np.int32(num_arrays_4),
                                                        np.int32(x_elems_5),
                                                        np.int32(y_elems_6),
                                                        np.int32(mulx_7),
                                                        np.int32(muly_8),
                                                        destmem_0, srcmem_2)
                cl.enqueue_nd_range_kernel(self.queue,
                                           self.gpu_map_transpose_f64_var,
                                           ((np.int64(sdiv_up32(x_elems_5,
                                                                np.int32(32))) * np.int64(np.int32(32))),
                                            (np.int64(sdiv_up32(y_elems_6,
                                                                np.int32(32))) * np.int64(np.int32(8))),
                                            (np.int64(num_arrays_4) * np.int64(np.int32(1)))),
                                           (np.int64(np.int32(32)),
                                            np.int64(np.int32(8)),
                                            np.int64(np.int32(1))))
                if synchronous:
                  sync(self)
    return ()
  def futhark_builtinzhreplicate_f64(self, mem_19924, num_elems_19925,
                                     val_19926):
    group_sizze_19931 = self.sizes["builtin#replicate_f64.group_size_19931"]
    num_groups_19932 = sdiv_up64(num_elems_19925, group_sizze_19931)
    if ((1 * (np.int64(num_groups_19932) * np.int64(group_sizze_19931))) != 0):
      self.builtinzhreplicate_f64zireplicate_19928_var.set_args(np.int32(num_elems_19925),
                                                                np.float64(val_19926),
                                                                mem_19924)
      cl.enqueue_nd_range_kernel(self.queue,
                                 self.builtinzhreplicate_f64zireplicate_19928_var,
                                 ((np.int64(num_groups_19932) * np.int64(group_sizze_19931)),),
                                 (np.int64(group_sizze_19931),))
      if synchronous:
        sync(self)
    return ()
  def futhark_builtinzhreplicate_i64(self, mem_20484, num_elems_20485,
                                     val_20486):
    group_sizze_20491 = self.sizes["builtin#replicate_i64.group_size_20491"]
    num_groups_20492 = sdiv_up64(num_elems_20485, group_sizze_20491)
    if ((1 * (np.int64(num_groups_20492) * np.int64(group_sizze_20491))) != 0):
      self.builtinzhreplicate_i64zireplicate_20488_var.set_args(np.int32(num_elems_20485),
                                                                np.int64(val_20486),
                                                                mem_20484)
      cl.enqueue_nd_range_kernel(self.queue,
                                 self.builtinzhreplicate_i64zireplicate_20488_var,
                                 ((np.int64(num_groups_20492) * np.int64(group_sizze_20491)),),
                                 (np.int64(group_sizze_20491),))
      if synchronous:
        sync(self)
    return ()
  def futhark_entry_criterion(self, x_mem_19394, zz_mem_19395, beta_mem_19396,
                              _ccp_mem_19397, d_mem_19398, implz2081U_16706,
                              implz2088U_16707, implz2082U_16708,
                              implz2083U_16709, implz2084U_16710,
                              implz2085U_16711, implz2086U_16712,
                              implz2087U_16713):
    flat_dim_16719 = (implz2084U_16710 * implz2085U_16711)
    x_16720 = (implz2081U_16706 * implz2082U_16708)
    dim_ok_16721 = (x_16720 == flat_dim_16719)
    dim_ok_cert_16722 = True
    assert dim_ok_16721, ("Error: %s\n\nBacktrace:\n-> #0  /prelude/array.fut:141:3-33\n   #1  logit.fut:83:11-30\n   #2  logit.fut:117:3-29\n   #3  logit.fut:112:1-117:29\n" % ("new shape has different number of elements than old shape",))
    i64_res_16726 = sitofp_i64_f64(implz2088U_16707)
    suff_outer_redomap_17330 = (self.sizes["criterion.suff_outer_redomap_0"] <= implz2088U_16707)
    segred_group_sizze_17342 = self.sizes["criterion.segred_group_size_17332"]
    max_num_groups_19920 = self.sizes["criterion.segred_num_groups_17334"]
    num_groups_17343 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(implz2088U_16707,
                                                            segred_group_sizze_17342),
                                                  sext_i32_i64(max_num_groups_19920))))
    suff_outer_par_17767 = (self.sizes["criterion.suff_outer_par_1"] <= implz2088U_16707)
    intra_avail_par_17770 = smin64(implz2083U_16709, x_16720)
    computed_group_sizze_17771 = smax64(implz2083U_16709, x_16720)
    max_group_sizze_17773 = self.max_group_size
    fits_17774 = sle64(computed_group_sizze_17771, max_group_sizze_17773)
    suff_intra_par_17776 = (self.sizes["criterion.suff_intra_par_2"] <= intra_avail_par_17770)
    intra_suff_and_fits_17777 = (fits_17774 and suff_intra_par_17776)
    segmap_group_sizze_17780 = self.sizes["criterion.segmap_group_size_17419"]
    comparatee_17870 = (implz2088U_16707 * implz2082U_16708)
    suff_outer_par_17871 = (self.sizes["criterion.suff_outer_par_3"] <= comparatee_17870)
    nest_sizze_17885 = (implz2081U_16706 * comparatee_17870)
    segred_group_sizze_17886 = self.sizes["criterion.segred_group_size_17640"]
    max_num_groups_19921 = self.sizes["criterion.segred_num_groups_17642"]
    num_groups_17887 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(nest_sizze_17885,
                                                            segred_group_sizze_17886),
                                                  sext_i32_i64(max_num_groups_19921))))
    nest_sizze_17900 = (implz2088U_16707 * implz2083U_16709)
    segred_group_sizze_17901 = self.sizes["criterion.segred_group_size_17595"]
    max_num_groups_19922 = self.sizes["criterion.segred_num_groups_17597"]
    num_groups_17902 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(nest_sizze_17900,
                                                            segred_group_sizze_17901),
                                                  sext_i32_i64(max_num_groups_19922))))
    segred_group_sizze_17920 = self.sizes["criterion.segred_group_size_17576"]
    max_num_groups_19923 = self.sizes["criterion.segred_num_groups_17578"]
    num_groups_17921 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(nest_sizze_17900,
                                                            segred_group_sizze_17920),
                                                  sext_i32_i64(max_num_groups_19923))))
    segmap_group_sizze_17934 = self.sizes["criterion.segmap_group_size_17557"]
    segred_group_sizze_17950 = self.sizes["criterion.segred_group_size_17757"]
    max_num_groups_19924 = self.sizes["criterion.segred_num_groups_17759"]
    num_groups_17951 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(implz2088U_16707,
                                                            segred_group_sizze_17950),
                                                  sext_i32_i64(max_num_groups_19924))))
    Ty_18858 = self.sizes["criterion.Ty_18855"]
    Ry_18859 = self.sizes["criterion.Ry_18857"]
    Tx_18860 = self.sizes["criterion.Tx_18854"]
    Rx_18861 = self.sizes["criterion.Rx_18856"]
    Tk_18862 = self.sizes["criterion.Tk_18853"]
    TxRx_18865 = (Tx_18860 * Rx_18861)
    TyRy_18866 = (Ty_18858 * Ry_18859)
    a_loc_szz_18868 = (Tk_18862 * TyRy_18866)
    binop_x_18869 = (Tx_18860 * Tk_18862)
    b_loc_szz_18870 = (Rx_18861 * binop_x_18869)
    group_sizze_18874 = (Ty_18858 * Tx_18860)
    binop_x_19399 = (implz2081U_16706 * implz2088U_16707)
    bytes_19400 = (np.int64(8) * binop_x_19399)
    binop_y_19403 = (np.int64(8) * implz2082U_16708)
    bytes_19404 = smax64(np.int64(0), binop_y_19403)
    binop_y_19418 = (np.int64(8) * implz2083U_16709)
    bytes_19419 = smax64(np.int64(0), binop_y_19418)
    binop_y_19499 = (np.int64(8) * implz2088U_16707)
    bytes_19500 = smax64(np.int64(0), binop_y_19499)
    binop_y_19710 = (np.int64(8) * comparatee_17870)
    bytes_19711 = smax64(np.int64(0), binop_y_19710)
    binop_x_19528 = (Ry_18859 * group_sizze_18874)
    binop_x_19529 = (Rx_18861 * binop_x_19528)
    bytes_19530 = (np.int64(8) * binop_x_19529)
    binop_x_19520 = (Ry_18859 * Rx_18861)
    bytes_19521 = (np.int64(8) * binop_x_19520)
    binop_y_19532 = (np.int64(8) * a_loc_szz_18868)
    bytes_19533 = smax64(np.int64(0), binop_y_19532)
    binop_y_19535 = (np.int64(8) * b_loc_szz_18870)
    bytes_19536 = smax64(np.int64(0), binop_y_19535)
    bytes_19607 = (np.int64(8) * binop_x_19528)
    binop_x_19610 = (Rx_18861 * group_sizze_18874)
    bytes_19611 = (np.int64(8) * binop_x_19610)
    bytes_19597 = (np.int64(8) * Ry_18859)
    bytes_19599 = (np.int64(8) * Rx_18861)
    binop_x_19838 = (np.int64(8) * Ty_18858)
    binop_x_19839 = (Tx_18860 * binop_x_19838)
    binop_x_19840 = (Ry_18859 * binop_x_19839)
    sizze_19841 = (Rx_18861 * binop_x_19840)
    binop_y_19724 = (np.int64(8) * nest_sizze_17900)
    bytes_19725 = smax64(np.int64(0), binop_y_19724)
    binop_x_19849 = (np.int64(8) * Ty_18858)
    binop_x_19850 = (Tx_18860 * binop_x_19849)
    binop_x_19851 = (Ry_18859 * binop_x_19850)
    num_bytes_19852 = (Rx_18861 * binop_x_19851)
    binop_x_19857 = (np.int64(8) * Ty_18858)
    binop_x_19858 = (Tx_18860 * binop_x_19857)
    binop_x_19859 = (Ry_18859 * binop_x_19858)
    num_bytes_19860 = (Rx_18861 * binop_x_19859)
    maxSubHelper_19868 = umax64(bytes_19404, bytes_19419)
    maxSubHelper_19871 = umax64(bytes_19404, bytes_19419)
    maxSubHelper_19874 = umax64(bytes_19404, bytes_19419)
    maxSubHelper_19882 = umax64(num_bytes_19852, num_bytes_19860)
    maxSubHelper_19883 = umax64(bytes_19530, sizze_19841)
    num_threads_19891 = (segred_group_sizze_17342 * num_groups_17343)
    total_sizze_19892 = (maxSubHelper_19868 * num_threads_19891)
    total_sizze_19893 = (bytes_19419 * num_threads_19891)
    local_memory_capacity_20330 = self.max_local_memory
    if (sle32((np.int32(8) + ((np.int64(8) * segred_group_sizze_17342) + srem64((np.int64(8) - srem64((np.int64(8) * segred_group_sizze_17342),
                                                                                                      np.int64(8))),
                                                                                np.int64(8)))),
              sext_i32_i64(local_memory_capacity_20330)) and suff_outer_redomap_17330):
      mem_19401 = opencl_alloc(self, bytes_19400, "mem_19401")
      self.futhark_builtinzhgpu_map_transpose_f64(mem_19401, np.int64(0),
                                                  x_mem_19394, np.int64(0),
                                                  np.int64(1), implz2081U_16706,
                                                  implz2088U_16707)
      mem_19449 = opencl_alloc(self, np.int64(8), "mem_19449")
      color_19869 = opencl_alloc(self, total_sizze_19892, "color_19869")
      color_19870 = opencl_alloc(self, total_sizze_19893, "color_19870")
      criterionzicounter_mem_19925 = self.criterionzicounter_mem_19925
      segred_tmp_mem_19927 = opencl_alloc(self,
                                          (np.int64(8) * num_groups_17343),
                                          "segred_tmp_mem_19927")
      num_threads_19929 = (num_groups_17343 * segred_group_sizze_17342)
      if ((1 * (np.int64(num_groups_17343) * np.int64(segred_group_sizze_17342))) != 0):
        self.criterionzisegred_nonseg_17340_var.set_args(self.global_failure,
                                                         self.failure_is_an_option,
                                                         self.global_failure_args,
                                                         cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17342))),
                                                         cl.LocalMemory(np.int64(np.int32(1))),
                                                         np.int64(implz2081U_16706),
                                                         np.int64(implz2088U_16707),
                                                         np.int64(implz2082U_16708),
                                                         np.int64(implz2083U_16709),
                                                         np.int64(implz2085U_16711),
                                                         np.float64(i64_res_16726),
                                                         np.int64(num_groups_17343),
                                                         np.int64(num_threads_19891),
                                                         np.int64(num_threads_19929),
                                                         zz_mem_19395,
                                                         beta_mem_19396,
                                                         d_mem_19398, mem_19401,
                                                         mem_19449, color_19869,
                                                         color_19870,
                                                         criterionzicounter_mem_19925,
                                                         segred_tmp_mem_19927)
        cl.enqueue_nd_range_kernel(self.queue,
                                   self.criterionzisegred_nonseg_17340_var,
                                   ((np.int64(num_groups_17343) * np.int64(segred_group_sizze_17342)),),
                                   (np.int64(segred_group_sizze_17342),))
        if synchronous:
          sync(self)
      self.failure_is_an_option = np.int32(1)
      mem_19401 = None
      color_19869 = None
      color_19870 = None
      read_res_20506 = np.empty(1, dtype=ct.c_double)
      cl.enqueue_copy(self.queue, read_res_20506, mem_19449,
                      device_offset=(np.int64(np.int64(0)) * 8),
                      is_blocking=synchronous)
      sync(self)
      defunc_2_reduce_res_17389 = read_res_20506[0]
      mem_19449 = None
      defunc_2_reduce_res_16727 = defunc_2_reduce_res_17389
    else:
      local_memory_capacity_20299 = self.max_local_memory
      if (sle64(np.int64(0),
                sext_i32_i64(local_memory_capacity_20299)) and suff_outer_par_17767):
        segmap_usable_groups_17781 = sdiv_up64(implz2088U_16707,
                                               segmap_group_sizze_17780)
        mem_19452 = opencl_alloc(self, bytes_19400, "mem_19452")
        self.futhark_builtinzhgpu_map_transpose_f64(mem_19452, np.int64(0),
                                                    x_mem_19394, np.int64(0),
                                                    np.int64(1),
                                                    implz2081U_16706,
                                                    implz2088U_16707)
        mem_19501 = opencl_alloc(self, bytes_19500, "mem_19501")
        num_threads_19894 = (segmap_group_sizze_17780 * segmap_usable_groups_17781)
        total_sizze_19895 = (maxSubHelper_19871 * num_threads_19894)
        color_19872 = opencl_alloc(self, total_sizze_19895, "color_19872")
        total_sizze_19896 = (bytes_19419 * num_threads_19894)
        color_19873 = opencl_alloc(self, total_sizze_19896, "color_19873")
        if ((1 * (np.int64(segmap_usable_groups_17781) * np.int64(segmap_group_sizze_17780))) != 0):
          self.criterionzisegmap_17417_var.set_args(self.global_failure,
                                                    self.failure_is_an_option,
                                                    self.global_failure_args,
                                                    np.int64(implz2081U_16706),
                                                    np.int64(implz2088U_16707),
                                                    np.int64(implz2082U_16708),
                                                    np.int64(implz2083U_16709),
                                                    np.int64(implz2085U_16711),
                                                    np.float64(i64_res_16726),
                                                    np.int64(num_threads_19894),
                                                    zz_mem_19395,
                                                    beta_mem_19396, d_mem_19398,
                                                    mem_19452, mem_19501,
                                                    color_19872, color_19873)
          cl.enqueue_nd_range_kernel(self.queue,
                                     self.criterionzisegmap_17417_var,
                                     ((np.int64(segmap_usable_groups_17781) * np.int64(segmap_group_sizze_17780)),),
                                     (np.int64(segmap_group_sizze_17780),))
          if synchronous:
            sync(self)
        self.failure_is_an_option = np.int32(1)
        mem_19452 = None
        color_19872 = None
        color_19873 = None
        ext_mem_19740 = mem_19501
      else:
        local_memory_capacity_20298 = self.max_local_memory
        if (sle64((((((maxSubHelper_19874 + srem64((np.int64(8) - srem64(maxSubHelper_19874,
                                                                         np.int64(8))),
                                                   np.int64(8))) + (bytes_19419 + srem64((np.int64(8) - srem64(bytes_19419,
                                                                                                               np.int64(8))),
                                                                                         np.int64(8)))) + ((np.int64(8) * (implz2082U_16708 * implz2081U_16706)) + srem64((np.int64(8) - srem64((np.int64(8) * (implz2082U_16708 * implz2081U_16706)),
                                                                                                                                                                                                np.int64(8))),
                                                                                                                                                                          np.int64(8)))) + ((np.int64(8) * implz2083U_16709) + srem64((np.int64(8) - srem64((np.int64(8) * implz2083U_16709),
                                                                                                                                                                                                                                                            np.int64(8))),
                                                                                                                                                                                                                                      np.int64(8)))) + ((np.int64(8) * implz2083U_16709) + srem64((np.int64(8) - srem64((np.int64(8) * implz2083U_16709),
                                                                                                                                                                                                                                                                                                                        np.int64(8))),
                                                                                                                                                                                                                                                                                                  np.int64(8)))),
                  sext_i32_i64(local_memory_capacity_20298)) and intra_suff_and_fits_17777):
          mem_19517 = opencl_alloc(self, bytes_19500, "mem_19517")
          if ((1 * (np.int64(implz2088U_16707) * np.int64(computed_group_sizze_17771))) != 0):
            self.criterionzisegmap_intragroup_17413_var.set_args(self.global_failure,
                                                                 self.failure_is_an_option,
                                                                 self.global_failure_args,
                                                                 cl.LocalMemory(np.int64((np.int64(8) * implz2083U_16709))),
                                                                 cl.LocalMemory(np.int64((np.int64(8) * implz2083U_16709))),
                                                                 cl.LocalMemory(np.int64((np.int64(8) * (implz2082U_16708 * implz2081U_16706)))),
                                                                 cl.LocalMemory(np.int64(bytes_19419)),
                                                                 cl.LocalMemory(np.int64(maxSubHelper_19874)),
                                                                 np.int64(implz2081U_16706),
                                                                 np.int64(implz2088U_16707),
                                                                 np.int64(implz2082U_16708),
                                                                 np.int64(implz2083U_16709),
                                                                 np.int64(implz2085U_16711),
                                                                 np.float64(i64_res_16726),
                                                                 np.int64(computed_group_sizze_17771),
                                                                 x_mem_19394,
                                                                 zz_mem_19395,
                                                                 beta_mem_19396,
                                                                 d_mem_19398,
                                                                 mem_19517)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.criterionzisegmap_intragroup_17413_var,
                                       ((np.int64(implz2088U_16707) * np.int64(computed_group_sizze_17771)),),
                                       (np.int64(computed_group_sizze_17771),))
            if synchronous:
              sync(self)
          self.failure_is_an_option = np.int32(1)
          ext_mem_19739 = mem_19517
        else:
          local_memory_capacity_20159 = self.max_local_memory
          if (sle64(((bytes_19536 + srem64((np.int64(8) - srem64(bytes_19536,
                                                                 np.int64(8))),
                                           np.int64(8))) + (bytes_19533 + srem64((np.int64(8) - srem64(bytes_19533,
                                                                                                       np.int64(8))),
                                                                                 np.int64(8)))),
                    sext_i32_i64(local_memory_capacity_20159)) and suff_outer_par_17871):
            tk_div_tx_18863 = sdiv_up64(Tk_18862, Tx_18860)
            tk_div_ty_18864 = sdiv_up64(Tk_18862, Ty_18858)
            gridDim_x_18871 = sdiv_up64(implz2082U_16708, TxRx_18865)
            gridDim_y_18872 = sdiv_up64(implz2088U_16707, TyRy_18866)
            grid_sizze_18873 = (gridDim_x_18871 * gridDim_y_18872)
            full_tiles_18902 = squot64(implz2081U_16706, Tk_18862)
            kk_19105 = (Tk_18862 * full_tiles_18902)
            mem_19712 = opencl_alloc(self, bytes_19711, "mem_19712")
            if ((1 * (np.int64(grid_sizze_18873) * np.int64(group_sizze_18874))) != 0):
              self.criterionzisegmap_intragroup_18877_var.set_args(self.global_failure,
                                                                   cl.LocalMemory(np.int64(bytes_19533)),
                                                                   cl.LocalMemory(np.int64(bytes_19536)),
                                                                   np.int64(implz2081U_16706),
                                                                   np.int64(implz2088U_16707),
                                                                   np.int64(implz2082U_16708),
                                                                   np.int64(implz2085U_16711),
                                                                   np.int64(gridDim_x_18871),
                                                                   np.int64(gridDim_y_18872),
                                                                   np.int64(full_tiles_18902),
                                                                   np.int64(kk_19105),
                                                                   x_mem_19394,
                                                                   beta_mem_19396,
                                                                   mem_19712)
              cl.enqueue_nd_range_kernel(self.queue,
                                         self.criterionzisegmap_intragroup_18877_var,
                                         ((np.int64(grid_sizze_18873) * np.int64(group_sizze_18874)),),
                                         (np.int64(group_sizze_18874),))
              if synchronous:
                sync(self)
            ext_mem_19718 = mem_19712
          else:
            mem_19717 = opencl_alloc(self, bytes_19711, "mem_19717")
            if slt64((implz2081U_16706 * np.int64(2)),
                     segred_group_sizze_17886):
              segment_sizze_nonzzero_20091 = smax64(np.int64(1),
                                                    implz2081U_16706)
              num_threads_20092 = (num_groups_17887 * segred_group_sizze_17886)
              if ((1 * (np.int64(num_groups_17887) * np.int64(segred_group_sizze_17886))) != 0):
                self.criterionzisegred_small_17646_var.set_args(self.global_failure,
                                                                cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17886))),
                                                                np.int64(implz2081U_16706),
                                                                np.int64(implz2088U_16707),
                                                                np.int64(implz2082U_16708),
                                                                np.int64(implz2085U_16711),
                                                                np.int64(num_groups_17887),
                                                                np.int64(segment_sizze_nonzzero_20091),
                                                                x_mem_19394,
                                                                beta_mem_19396,
                                                                mem_19717)
                cl.enqueue_nd_range_kernel(self.queue,
                                           self.criterionzisegred_small_17646_var,
                                           ((np.int64(num_groups_17887) * np.int64(segred_group_sizze_17886)),),
                                           (np.int64(segred_group_sizze_17886),))
                if synchronous:
                  sync(self)
            else:
              groups_per_segment_20116 = sdiv_up64(num_groups_17887,
                                                   smax64(np.int64(1),
                                                          (implz2088U_16707 * implz2082U_16708)))
              elements_per_thread_20117 = sdiv_up64(implz2081U_16706,
                                                    (segred_group_sizze_17886 * groups_per_segment_20116))
              virt_num_groups_20118 = (groups_per_segment_20116 * (implz2088U_16707 * implz2082U_16708))
              num_threads_20119 = (num_groups_17887 * segred_group_sizze_17886)
              threads_per_segment_20120 = (groups_per_segment_20116 * segred_group_sizze_17886)
              segred_tmp_mem_20121 = opencl_alloc(self,
                                                  (np.int64(8) * virt_num_groups_20118),
                                                  "segred_tmp_mem_20121")
              criterionzicounter_mem_20123 = self.criterionzicounter_mem_20123
              if ((1 * (np.int64(num_groups_17887) * np.int64(segred_group_sizze_17886))) != 0):
                self.criterionzisegred_large_17646_var.set_args(self.global_failure,
                                                                cl.LocalMemory(np.int64(np.int32(1))),
                                                                cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17886))),
                                                                np.int64(implz2081U_16706),
                                                                np.int64(implz2088U_16707),
                                                                np.int64(implz2082U_16708),
                                                                np.int64(implz2085U_16711),
                                                                np.int64(num_groups_17887),
                                                                np.int64(groups_per_segment_20116),
                                                                np.int64(elements_per_thread_20117),
                                                                np.int64(virt_num_groups_20118),
                                                                np.int64(threads_per_segment_20120),
                                                                x_mem_19394,
                                                                beta_mem_19396,
                                                                mem_19717,
                                                                segred_tmp_mem_20121,
                                                                criterionzicounter_mem_20123)
                cl.enqueue_nd_range_kernel(self.queue,
                                           self.criterionzisegred_large_17646_var,
                                           ((np.int64(num_groups_17887) * np.int64(segred_group_sizze_17886)),),
                                           (np.int64(segred_group_sizze_17886),))
                if synchronous:
                  sync(self)
            ext_mem_19718 = mem_19717
          mem_19722 = opencl_alloc(self, bytes_19500, "mem_19722")
          mem_19726 = opencl_alloc(self, bytes_19725, "mem_19726")
          if slt64((implz2083U_16709 * np.int64(2)), segred_group_sizze_17901):
            segment_sizze_nonzzero_20160 = smax64(np.int64(1), implz2083U_16709)
            num_threads_20161 = (num_groups_17902 * segred_group_sizze_17901)
            if ((1 * (np.int64(num_groups_17902) * np.int64(segred_group_sizze_17901))) != 0):
              self.criterionzisegred_small_17601_var.set_args(self.global_failure,
                                                              cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17901))),
                                                              np.int64(implz2088U_16707),
                                                              np.int64(implz2082U_16708),
                                                              np.int64(implz2083U_16709),
                                                              np.int64(num_groups_17902),
                                                              np.int64(segment_sizze_nonzzero_20160),
                                                              zz_mem_19395,
                                                              ext_mem_19718,
                                                              mem_19722,
                                                              mem_19726)
              cl.enqueue_nd_range_kernel(self.queue,
                                         self.criterionzisegred_small_17601_var,
                                         ((np.int64(num_groups_17902) * np.int64(segred_group_sizze_17901)),),
                                         (np.int64(segred_group_sizze_17901),))
              if synchronous:
                sync(self)
          else:
            groups_per_segment_20184 = sdiv_up64(num_groups_17902,
                                                 smax64(np.int64(1),
                                                        implz2088U_16707))
            elements_per_thread_20185 = sdiv_up64(implz2083U_16709,
                                                  (segred_group_sizze_17901 * groups_per_segment_20184))
            virt_num_groups_20186 = (groups_per_segment_20184 * implz2088U_16707)
            num_threads_20187 = (num_groups_17902 * segred_group_sizze_17901)
            threads_per_segment_20188 = (groups_per_segment_20184 * segred_group_sizze_17901)
            segred_tmp_mem_20189 = opencl_alloc(self,
                                                (np.int64(8) * virt_num_groups_20186),
                                                "segred_tmp_mem_20189")
            criterionzicounter_mem_20191 = self.criterionzicounter_mem_20191
            if ((1 * (np.int64(num_groups_17902) * np.int64(segred_group_sizze_17901))) != 0):
              self.criterionzisegred_large_17601_var.set_args(self.global_failure,
                                                              cl.LocalMemory(np.int64(np.int32(1))),
                                                              cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17901))),
                                                              np.int64(implz2088U_16707),
                                                              np.int64(implz2082U_16708),
                                                              np.int64(implz2083U_16709),
                                                              np.int64(num_groups_17902),
                                                              np.int64(groups_per_segment_20184),
                                                              np.int64(elements_per_thread_20185),
                                                              np.int64(virt_num_groups_20186),
                                                              np.int64(threads_per_segment_20188),
                                                              zz_mem_19395,
                                                              ext_mem_19718,
                                                              mem_19722,
                                                              mem_19726,
                                                              segred_tmp_mem_20189,
                                                              criterionzicounter_mem_20191)
              cl.enqueue_nd_range_kernel(self.queue,
                                         self.criterionzisegred_large_17601_var,
                                         ((np.int64(num_groups_17902) * np.int64(segred_group_sizze_17901)),),
                                         (np.int64(segred_group_sizze_17901),))
              if synchronous:
                sync(self)
          ext_mem_19718 = None
          mem_19730 = opencl_alloc(self, bytes_19500, "mem_19730")
          mem_19734 = opencl_alloc(self, bytes_19725, "mem_19734")
          if slt64((implz2083U_16709 * np.int64(2)), segred_group_sizze_17920):
            segment_sizze_nonzzero_20226 = smax64(np.int64(1), implz2083U_16709)
            num_threads_20227 = (num_groups_17921 * segred_group_sizze_17920)
            if ((1 * (np.int64(num_groups_17921) * np.int64(segred_group_sizze_17920))) != 0):
              self.criterionzisegred_small_17582_var.set_args(self.global_failure,
                                                              cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17920))),
                                                              np.int64(implz2088U_16707),
                                                              np.int64(implz2083U_16709),
                                                              np.int64(num_groups_17921),
                                                              np.int64(segment_sizze_nonzzero_20226),
                                                              mem_19722,
                                                              mem_19726,
                                                              mem_19730,
                                                              mem_19734)
              cl.enqueue_nd_range_kernel(self.queue,
                                         self.criterionzisegred_small_17582_var,
                                         ((np.int64(num_groups_17921) * np.int64(segred_group_sizze_17920)),),
                                         (np.int64(segred_group_sizze_17920),))
              if synchronous:
                sync(self)
          else:
            groups_per_segment_20249 = sdiv_up64(num_groups_17921,
                                                 smax64(np.int64(1),
                                                        implz2088U_16707))
            elements_per_thread_20250 = sdiv_up64(implz2083U_16709,
                                                  (segred_group_sizze_17920 * groups_per_segment_20249))
            virt_num_groups_20251 = (groups_per_segment_20249 * implz2088U_16707)
            num_threads_20252 = (num_groups_17921 * segred_group_sizze_17920)
            threads_per_segment_20253 = (groups_per_segment_20249 * segred_group_sizze_17920)
            segred_tmp_mem_20254 = opencl_alloc(self,
                                                (np.int64(8) * virt_num_groups_20251),
                                                "segred_tmp_mem_20254")
            criterionzicounter_mem_20256 = self.criterionzicounter_mem_20256
            if ((1 * (np.int64(num_groups_17921) * np.int64(segred_group_sizze_17920))) != 0):
              self.criterionzisegred_large_17582_var.set_args(self.global_failure,
                                                              cl.LocalMemory(np.int64(np.int32(1))),
                                                              cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17920))),
                                                              np.int64(implz2088U_16707),
                                                              np.int64(implz2083U_16709),
                                                              np.int64(num_groups_17921),
                                                              np.int64(groups_per_segment_20249),
                                                              np.int64(elements_per_thread_20250),
                                                              np.int64(virt_num_groups_20251),
                                                              np.int64(threads_per_segment_20253),
                                                              mem_19722,
                                                              mem_19726,
                                                              mem_19730,
                                                              mem_19734,
                                                              segred_tmp_mem_20254,
                                                              criterionzicounter_mem_20256)
              cl.enqueue_nd_range_kernel(self.queue,
                                         self.criterionzisegred_large_17582_var,
                                         ((np.int64(num_groups_17921) * np.int64(segred_group_sizze_17920)),),
                                         (np.int64(segred_group_sizze_17920),))
              if synchronous:
                sync(self)
          mem_19722 = None
          mem_19726 = None
          segmap_usable_groups_17935 = sdiv_up64(implz2088U_16707,
                                                 segmap_group_sizze_17934)
          mem_19738 = opencl_alloc(self, bytes_19500, "mem_19738")
          if ((1 * (np.int64(segmap_usable_groups_17935) * np.int64(segmap_group_sizze_17934))) != 0):
            self.criterionzisegmap_17555_var.set_args(self.global_failure,
                                                      self.failure_is_an_option,
                                                      self.global_failure_args,
                                                      np.int64(implz2088U_16707),
                                                      np.int64(implz2083U_16709),
                                                      np.float64(i64_res_16726),
                                                      d_mem_19398, mem_19730,
                                                      mem_19734, mem_19738)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.criterionzisegmap_17555_var,
                                       ((np.int64(segmap_usable_groups_17935) * np.int64(segmap_group_sizze_17934)),),
                                       (np.int64(segmap_group_sizze_17934),))
            if synchronous:
              sync(self)
          self.failure_is_an_option = np.int32(1)
          mem_19730 = None
          mem_19734 = None
          ext_mem_19739 = mem_19738
        ext_mem_19740 = ext_mem_19739
      mem_19743 = opencl_alloc(self, np.int64(8), "mem_19743")
      criterionzicounter_mem_20300 = self.criterionzicounter_mem_20300
      segred_tmp_mem_20302 = opencl_alloc(self,
                                          (np.int64(8) * num_groups_17951),
                                          "segred_tmp_mem_20302")
      num_threads_20304 = (num_groups_17951 * segred_group_sizze_17950)
      if ((1 * (np.int64(num_groups_17951) * np.int64(segred_group_sizze_17950))) != 0):
        self.criterionzisegred_nonseg_17765_var.set_args(self.global_failure,
                                                         cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17950))),
                                                         cl.LocalMemory(np.int64(np.int32(1))),
                                                         np.int64(implz2088U_16707),
                                                         np.int64(num_groups_17951),
                                                         np.int64(num_threads_20304),
                                                         ext_mem_19740,
                                                         mem_19743,
                                                         criterionzicounter_mem_20300,
                                                         segred_tmp_mem_20302)
        cl.enqueue_nd_range_kernel(self.queue,
                                   self.criterionzisegred_nonseg_17765_var,
                                   ((np.int64(num_groups_17951) * np.int64(segred_group_sizze_17950)),),
                                   (np.int64(segred_group_sizze_17950),))
        if synchronous:
          sync(self)
      ext_mem_19740 = None
      read_res_20511 = np.empty(1, dtype=ct.c_double)
      cl.enqueue_copy(self.queue, read_res_20511, mem_19743,
                      device_offset=(np.int64(np.int64(0)) * 8),
                      is_blocking=synchronous)
      sync(self)
      defunc_2_reduce_res_17958 = read_res_20511[0]
      mem_19743 = None
      defunc_2_reduce_res_16727 = defunc_2_reduce_res_17958
    neg_ll_res_16776 = (np.float64(0.0) - defunc_2_reduce_res_16727)
    prim_out_19919 = neg_ll_res_16776
    return prim_out_19919
  def futhark_entry_generate_data(self, seed_16777, N_16778, J_16779, Kzz_16780,
                                  Kx_16781):
    x_16782 = lshr32(seed_16777, np.int32(16))
    x_16783 = (seed_16777 ^ x_16782)
    x_16784 = (np.int32(73244475) * x_16783)
    x_16785 = lshr32(x_16784, np.int32(16))
    x_16786 = (x_16784 ^ x_16785)
    x_16787 = (np.int32(73244475) * x_16786)
    x_16788 = lshr32(x_16787, np.int32(16))
    x_16789 = (x_16787 ^ x_16788)
    unsign_arg_16790 = zext_i32_i64(x_16789)
    rand_arg_16791 = (np.int64(539527247) ^ unsign_arg_16790)
    y_16792 = (rand_arg_16791 << np.int64(23))
    x_16793 = (rand_arg_16791 ^ y_16792)
    x_16794 = (np.int64(824515495) ^ x_16793)
    y_16795 = lshr64(x_16793, np.int64(17))
    x_16796 = (x_16794 ^ y_16795)
    new_y_16797 = (np.int64(12) ^ x_16796)
    x_16798 = (np.int64(6916537531571111) ^ new_y_16797)
    x_16799 = (np.int64(52768993618) ^ x_16798)
    y_16800 = lshr64(new_y_16797, np.int64(26))
    new_y_16801 = (x_16799 ^ y_16800)
    y_16802 = (new_y_16797 << np.int64(23))
    x_16803 = (new_y_16797 ^ y_16802)
    x_16804 = (new_y_16801 ^ x_16803)
    y_16805 = lshr64(x_16803, np.int64(17))
    x_16806 = (x_16804 ^ y_16805)
    y_16807 = lshr64(new_y_16801, np.int64(26))
    new_y_16808 = (x_16806 ^ y_16807)
    binop_x_19394 = (N_16778 * Kx_16781)
    binop_y_19395 = (np.int64(8) * binop_x_19394)
    bytes_19396 = smax64(np.int64(0), binop_y_19395)
    mem_19397 = opencl_alloc(self, bytes_19396, "mem_19397")
    self.futhark_builtinzhreplicate_f64(mem_19397, (N_16778 * Kx_16781),
                                        np.float64(1.0))
    rand_matrix_arg_16810 = (Kx_16781 - np.int64(1))
    split_rng_arg_16811 = (N_16778 * rand_matrix_arg_16810)
    bounds_invalid_upwards_16812 = slt64(split_rng_arg_16811, np.int64(0))
    valid_16813 = not(bounds_invalid_upwards_16812)
    range_valid_c_16814 = True
    assert valid_16813, ("Error: %s%d%s%d%s%d%s\n\nBacktrace:\n-> #0  /prelude/array.fut:90:3-10\n   #1  /prelude/array.fut:195:11-16\n   #2  lib/github.com/diku-dk/cpprandom/random.fut:418:5-419:53\n   #3  /prelude/functional.fut:9:42-44\n   #4  logit.fut:21:20-22:41\n   #5  logit.fut:88:19-42\n   #6  logit.fut:102:21-55\n   #7  logit.fut:100:1-106:25\n" % ("Range ",
                                                                                                                                                                                                                                                                                                                                                                         np.int64(0),
                                                                                                                                                                                                                                                                                                                                                                         "..",
                                                                                                                                                                                                                                                                                                                                                                         np.int64(1),
                                                                                                                                                                                                                                                                                                                                                                         "..<",
                                                                                                                                                                                                                                                                                                                                                                         split_rng_arg_16811,
                                                                                                                                                                                                                                                                                                                                                                         " is invalid."))
    segred_group_sizze_17962 = self.sizes["generate_data.segred_group_size_17961"]
    max_num_groups_19936 = self.sizes["generate_data.segred_num_groups_17963"]
    num_groups_17964 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(split_rng_arg_16811,
                                                            segred_group_sizze_17962),
                                                  sext_i32_i64(max_num_groups_19936))))
    mem_19400 = opencl_alloc(self, np.int64(8), "mem_19400")
    mem_19402 = opencl_alloc(self, np.int64(8), "mem_19402")
    binop_y_19403 = (np.int64(8) * split_rng_arg_16811)
    bytes_19404 = smax64(np.int64(0), binop_y_19403)
    mem_19405 = opencl_alloc(self, bytes_19404, "mem_19405")
    generate_datazicounter_mem_19937 = self.generate_datazicounter_mem_19937
    segred_tmp_mem_19939 = opencl_alloc(self, (np.int64(8) * num_groups_17964),
                                        "segred_tmp_mem_19939")
    segred_tmp_mem_19941 = opencl_alloc(self, (np.int64(8) * num_groups_17964),
                                        "segred_tmp_mem_19941")
    num_threads_19943 = (num_groups_17964 * segred_group_sizze_17962)
    if ((1 * (np.int64(num_groups_17964) * np.int64(segred_group_sizze_17962))) != 0):
      self.generate_datazisegred_nonseg_17971_var.set_args(self.global_failure,
                                                           cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17962))),
                                                           cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17962))),
                                                           cl.LocalMemory(np.int64(np.int32(1))),
                                                           np.int64(new_y_16801),
                                                           np.int64(new_y_16808),
                                                           np.int64(split_rng_arg_16811),
                                                           np.int64(num_groups_17964),
                                                           np.int64(num_threads_19943),
                                                           mem_19400, mem_19402,
                                                           mem_19405,
                                                           generate_datazicounter_mem_19937,
                                                           segred_tmp_mem_19939,
                                                           segred_tmp_mem_19941)
      cl.enqueue_nd_range_kernel(self.queue,
                                 self.generate_datazisegred_nonseg_17971_var,
                                 ((np.int64(num_groups_17964) * np.int64(segred_group_sizze_17962)),),
                                 (np.int64(segred_group_sizze_17962),))
      if synchronous:
        sync(self)
    read_res_20513 = np.empty(1, dtype=ct.c_int64)
    cl.enqueue_copy(self.queue, read_res_20513, mem_19400,
                    device_offset=(np.int64(np.int64(0)) * 8),
                    is_blocking=synchronous)
    sync(self)
    defunc_2_reduce_res_16816 = read_res_20513[0]
    mem_19400 = None
    read_res_20514 = np.empty(1, dtype=ct.c_int64)
    cl.enqueue_copy(self.queue, read_res_20514, mem_19402,
                    device_offset=(np.int64(np.int64(0)) * 8),
                    is_blocking=synchronous)
    sync(self)
    defunc_2_reduce_res_16817 = read_res_20514[0]
    mem_19402 = None
    empty_slice_16913 = (N_16778 == np.int64(0))
    m_16914 = (N_16778 - np.int64(1))
    zzero_leq_i_p_m_t_s_16915 = sle64(np.int64(0), m_16914)
    i_p_m_t_s_leq_w_16916 = slt64(m_16914, N_16778)
    i_lte_j_16917 = sle64(np.int64(0), N_16778)
    y_16918 = (zzero_leq_i_p_m_t_s_16915 and i_p_m_t_s_leq_w_16916)
    y_16919 = (i_lte_j_16917 and y_16918)
    ok_or_empty_16920 = (empty_slice_16913 or y_16919)
    empty_slice_16921 = (rand_matrix_arg_16810 == np.int64(0))
    zzero_leq_i_p_m_t_s_16922 = sle64(np.int64(0), rand_matrix_arg_16810)
    i_p_m_t_s_leq_w_16923 = slt64(rand_matrix_arg_16810, Kx_16781)
    i_lte_j_16924 = sle64(np.int64(1), Kx_16781)
    y_16925 = (zzero_leq_i_p_m_t_s_16922 and i_p_m_t_s_leq_w_16923)
    y_16926 = (i_lte_j_16924 and y_16925)
    ok_or_empty_16927 = (empty_slice_16921 or y_16926)
    index_ok_16928 = (ok_or_empty_16920 and ok_or_empty_16927)
    index_certs_16929 = True
    assert index_ok_16928, ("Error: %s%d%s%d%s%d%s%d%s\n\nBacktrace:\n-> #0  logit.fut:89:3-91:16\n   #1  logit.fut:102:21-55\n   #2  logit.fut:100:1-106:25\n" % ("Index [",
                                                                                                                                                                   np.int64(0),
                                                                                                                                                                   ":, ",
                                                                                                                                                                   np.int64(1),
                                                                                                                                                                   ":] out of bounds for array of shape [",
                                                                                                                                                                   N_16778,
                                                                                                                                                                   "][",
                                                                                                                                                                   Kx_16781,
                                                                                                                                                                   "]."))
    group_sizze_19978 = self.sizes["generate_data.group_size_19978"]
    num_groups_19979 = sdiv_up64((N_16778 * rand_matrix_arg_16810),
                                 group_sizze_19978)
    if ((1 * (np.int64(num_groups_19979) * np.int64(group_sizze_19978))) != 0):
      self.generate_datazicopy_19975_var.set_args(np.int64(N_16778),
                                                  np.int64(Kx_16781),
                                                  np.int64(rand_matrix_arg_16810),
                                                  mem_19397, mem_19405)
      cl.enqueue_nd_range_kernel(self.queue, self.generate_datazicopy_19975_var,
                                 ((np.int64(num_groups_19979) * np.int64(group_sizze_19978)),),
                                 (np.int64(group_sizze_19978),))
      if synchronous:
        sync(self)
    mem_19405 = None
    split_rng_arg_16931 = (J_16779 * Kzz_16780)
    bounds_invalid_upwards_16932 = slt64(split_rng_arg_16931, np.int64(0))
    valid_16933 = not(bounds_invalid_upwards_16932)
    range_valid_c_16934 = True
    assert valid_16933, ("Error: %s%d%s%d%s%d%s\n\nBacktrace:\n-> #0  /prelude/array.fut:90:3-10\n   #1  /prelude/array.fut:195:11-16\n   #2  lib/github.com/diku-dk/cpprandom/random.fut:418:5-419:53\n   #3  /prelude/functional.fut:9:42-44\n   #4  logit.fut:21:20-22:41\n   #5  logit.fut:90:18-37\n   #6  logit.fut:102:21-55\n   #7  logit.fut:100:1-106:25\n" % ("Range ",
                                                                                                                                                                                                                                                                                                                                                                         np.int64(0),
                                                                                                                                                                                                                                                                                                                                                                         "..",
                                                                                                                                                                                                                                                                                                                                                                         np.int64(1),
                                                                                                                                                                                                                                                                                                                                                                         "..<",
                                                                                                                                                                                                                                                                                                                                                                         split_rng_arg_16931,
                                                                                                                                                                                                                                                                                                                                                                         " is invalid."))
    segred_group_sizze_17974 = self.sizes["generate_data.segred_group_size_17973"]
    max_num_groups_19986 = self.sizes["generate_data.segred_num_groups_17975"]
    num_groups_17976 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(split_rng_arg_16931,
                                                            segred_group_sizze_17974),
                                                  sext_i32_i64(max_num_groups_19986))))
    mem_19408 = opencl_alloc(self, np.int64(8), "mem_19408")
    mem_19410 = opencl_alloc(self, np.int64(8), "mem_19410")
    binop_y_19411 = (np.int64(8) * split_rng_arg_16931)
    bytes_19412 = smax64(np.int64(0), binop_y_19411)
    mem_19413 = opencl_alloc(self, bytes_19412, "mem_19413")
    mem_19416 = opencl_alloc(self, bytes_19412, "mem_19416")
    mem_19419 = opencl_alloc(self, bytes_19412, "mem_19419")
    generate_datazicounter_mem_19987 = self.generate_datazicounter_mem_19987
    segred_tmp_mem_19989 = opencl_alloc(self, (np.int64(8) * num_groups_17976),
                                        "segred_tmp_mem_19989")
    segred_tmp_mem_19991 = opencl_alloc(self, (np.int64(8) * num_groups_17976),
                                        "segred_tmp_mem_19991")
    num_threads_19993 = (num_groups_17976 * segred_group_sizze_17974)
    if ((1 * (np.int64(num_groups_17976) * np.int64(segred_group_sizze_17974))) != 0):
      self.generate_datazisegred_nonseg_17985_var.set_args(self.global_failure,
                                                           cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17974))),
                                                           cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17974))),
                                                           cl.LocalMemory(np.int64(np.int32(1))),
                                                           np.int64(defunc_2_reduce_res_16816),
                                                           np.int64(defunc_2_reduce_res_16817),
                                                           np.int64(split_rng_arg_16931),
                                                           np.int64(num_groups_17976),
                                                           np.int64(num_threads_19993),
                                                           mem_19408, mem_19410,
                                                           mem_19413, mem_19416,
                                                           mem_19419,
                                                           generate_datazicounter_mem_19987,
                                                           segred_tmp_mem_19989,
                                                           segred_tmp_mem_19991)
      cl.enqueue_nd_range_kernel(self.queue,
                                 self.generate_datazisegred_nonseg_17985_var,
                                 ((np.int64(num_groups_17976) * np.int64(segred_group_sizze_17974)),),
                                 (np.int64(segred_group_sizze_17974),))
      if synchronous:
        sync(self)
    mem_19413 = None
    mem_19416 = None
    read_res_20516 = np.empty(1, dtype=ct.c_int64)
    cl.enqueue_copy(self.queue, read_res_20516, mem_19408,
                    device_offset=(np.int64(np.int64(0)) * 8),
                    is_blocking=synchronous)
    sync(self)
    defunc_2_reduce_res_16936 = read_res_20516[0]
    mem_19408 = None
    read_res_20517 = np.empty(1, dtype=ct.c_int64)
    cl.enqueue_copy(self.queue, read_res_20517, mem_19410,
                    device_offset=(np.int64(np.int64(0)) * 8),
                    is_blocking=synchronous)
    sync(self)
    defunc_2_reduce_res_16937 = read_res_20517[0]
    mem_19410 = None
    split_rng_arg_17035 = (Kzz_16780 * Kx_16781)
    bounds_invalid_upwards_17036 = slt64(split_rng_arg_17035, np.int64(0))
    valid_17037 = not(bounds_invalid_upwards_17036)
    range_valid_c_17038 = True
    assert valid_17037, ("Error: %s%d%s%d%s%d%s\n\nBacktrace:\n-> #0  /prelude/array.fut:90:3-10\n   #1  /prelude/array.fut:195:11-16\n   #2  lib/github.com/diku-dk/cpprandom/random.fut:418:5-419:53\n   #3  /prelude/functional.fut:9:42-44\n   #4  logit.fut:21:20-22:41\n   #5  logit.fut:103:21-41\n   #6  logit.fut:100:1-106:25\n" % ("Range ",
                                                                                                                                                                                                                                                                                                                                              np.int64(0),
                                                                                                                                                                                                                                                                                                                                              "..",
                                                                                                                                                                                                                                                                                                                                              np.int64(1),
                                                                                                                                                                                                                                                                                                                                              "..<",
                                                                                                                                                                                                                                                                                                                                              split_rng_arg_17035,
                                                                                                                                                                                                                                                                                                                                              " is invalid."))
    segred_group_sizze_17988 = self.sizes["generate_data.segred_group_size_17987"]
    max_num_groups_20025 = self.sizes["generate_data.segred_num_groups_17989"]
    num_groups_17990 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(split_rng_arg_17035,
                                                            segred_group_sizze_17988),
                                                  sext_i32_i64(max_num_groups_20025))))
    mem_19422 = opencl_alloc(self, np.int64(8), "mem_19422")
    mem_19424 = opencl_alloc(self, np.int64(8), "mem_19424")
    binop_y_19425 = (np.int64(8) * split_rng_arg_17035)
    bytes_19426 = smax64(np.int64(0), binop_y_19425)
    mem_19427 = opencl_alloc(self, bytes_19426, "mem_19427")
    mem_19430 = opencl_alloc(self, bytes_19426, "mem_19430")
    mem_19433 = opencl_alloc(self, bytes_19426, "mem_19433")
    generate_datazicounter_mem_20026 = self.generate_datazicounter_mem_20026
    segred_tmp_mem_20028 = opencl_alloc(self, (np.int64(8) * num_groups_17990),
                                        "segred_tmp_mem_20028")
    segred_tmp_mem_20030 = opencl_alloc(self, (np.int64(8) * num_groups_17990),
                                        "segred_tmp_mem_20030")
    num_threads_20032 = (num_groups_17990 * segred_group_sizze_17988)
    if ((1 * (np.int64(num_groups_17990) * np.int64(segred_group_sizze_17988))) != 0):
      self.generate_datazisegred_nonseg_17999_var.set_args(self.global_failure,
                                                           cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17988))),
                                                           cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_17988))),
                                                           cl.LocalMemory(np.int64(np.int32(1))),
                                                           np.int64(defunc_2_reduce_res_16936),
                                                           np.int64(defunc_2_reduce_res_16937),
                                                           np.int64(split_rng_arg_17035),
                                                           np.int64(num_groups_17990),
                                                           np.int64(num_threads_20032),
                                                           mem_19422, mem_19424,
                                                           mem_19427, mem_19430,
                                                           mem_19433,
                                                           generate_datazicounter_mem_20026,
                                                           segred_tmp_mem_20028,
                                                           segred_tmp_mem_20030)
      cl.enqueue_nd_range_kernel(self.queue,
                                 self.generate_datazisegred_nonseg_17999_var,
                                 ((np.int64(num_groups_17990) * np.int64(segred_group_sizze_17988)),),
                                 (np.int64(segred_group_sizze_17988),))
      if synchronous:
        sync(self)
    mem_19427 = None
    mem_19430 = None
    read_res_20519 = np.empty(1, dtype=ct.c_int64)
    cl.enqueue_copy(self.queue, read_res_20519, mem_19422,
                    device_offset=(np.int64(np.int64(0)) * 8),
                    is_blocking=synchronous)
    sync(self)
    defunc_2_reduce_res_17040 = read_res_20519[0]
    mem_19422 = None
    read_res_20520 = np.empty(1, dtype=ct.c_int64)
    cl.enqueue_copy(self.queue, read_res_20520, mem_19424,
                    device_offset=(np.int64(np.int64(0)) * 8),
                    is_blocking=synchronous)
    sync(self)
    defunc_2_reduce_res_17041 = read_res_20520[0]
    mem_19424 = None
    suff_outer_par_18025 = (self.sizes["generate_data.suff_outer_par_0"] <= N_16778)
    intra_avail_par_18021 = smin64(J_16779, split_rng_arg_17035)
    computed_group_sizze_18002 = smax64(J_16779, split_rng_arg_17035)
    max_group_sizze_18293 = self.max_group_size
    fits_18294 = sle64(computed_group_sizze_18002, max_group_sizze_18293)
    suff_intra_par_18292 = (self.sizes["generate_data.suff_intra_par_1"] <= intra_avail_par_18021)
    intra_suff_and_fits_18295 = (suff_intra_par_18292 and fits_18294)
    segmap_group_sizze_18160 = self.sizes["generate_data.segmap_group_size_18029"]
    max_num_groups_20064 = self.sizes["generate_data.segmap_num_groups_18031"]
    num_groups_18161 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(N_16778,
                                                            segmap_group_sizze_18160),
                                                  sext_i32_i64(max_num_groups_20064))))
    comparatee_18641 = (N_16778 * Kzz_16780)
    suff_outer_par_18642 = (self.sizes["generate_data.suff_outer_par_2"] <= comparatee_18641)
    nest_sizze_18656 = (Kx_16781 * comparatee_18641)
    segred_group_sizze_18657 = self.sizes["generate_data.segred_group_size_18605"]
    max_num_groups_20065 = self.sizes["generate_data.segred_num_groups_18607"]
    num_groups_18658 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(nest_sizze_18656,
                                                            segred_group_sizze_18657),
                                                  sext_i32_i64(max_num_groups_20065))))
    nest_sizze_18671 = (N_16778 * J_16779)
    segred_group_sizze_18672 = self.sizes["generate_data.segred_group_size_18560"]
    max_num_groups_20066 = self.sizes["generate_data.segred_num_groups_18562"]
    num_groups_18673 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(nest_sizze_18671,
                                                            segred_group_sizze_18672),
                                                  sext_i32_i64(max_num_groups_20066))))
    segred_group_sizze_18691 = self.sizes["generate_data.segred_group_size_18541"]
    max_num_groups_20067 = self.sizes["generate_data.segred_num_groups_18543"]
    num_groups_18692 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(nest_sizze_18671,
                                                            segred_group_sizze_18691),
                                                  sext_i32_i64(max_num_groups_20067))))
    segscan_group_sizze_18706 = self.sizes["generate_data.segscan_group_size_18522"]
    max_num_groups_20068 = self.sizes["generate_data.segscan_num_groups_18524"]
    num_groups_18707 = sext_i64_i32(smax64(np.int64(1),
                                           smin64(sdiv_up64(nest_sizze_18671,
                                                            segscan_group_sizze_18706),
                                                  sext_i32_i64(max_num_groups_20068))))
    segmap_group_sizze_18719 = self.sizes["generate_data.segmap_group_size_18427"]
    Ty_18858 = self.sizes["generate_data.Ty_18855"]
    Ry_18859 = self.sizes["generate_data.Ry_18857"]
    Tx_18860 = self.sizes["generate_data.Tx_18854"]
    Rx_18861 = self.sizes["generate_data.Rx_18856"]
    Tk_18862 = self.sizes["generate_data.Tk_18853"]
    TxRx_18865 = (Tx_18860 * Rx_18861)
    TyRy_18866 = (Ty_18858 * Ry_18859)
    a_loc_szz_18868 = (Tk_18862 * TyRy_18866)
    binop_x_18869 = (Tx_18860 * Tk_18862)
    b_loc_szz_18870 = (Rx_18861 * binop_x_18869)
    group_sizze_18874 = (Ty_18858 * Tx_18860)
    binop_y_19513 = (np.int64(8) * N_16778)
    bytes_19514 = smax64(np.int64(0), binop_y_19513)
    bytes_19517 = (np.int64(8) * nest_sizze_18671)
    binop_y_19438 = (np.int64(8) * Kzz_16780)
    bytes_19439 = smax64(np.int64(0), binop_y_19438)
    binop_y_19453 = (np.int64(8) * J_16779)
    bytes_19454 = smax64(np.int64(0), binop_y_19453)
    bytes_19788 = smax64(np.int64(0), bytes_19517)
    binop_y_19745 = (np.int64(8) * comparatee_18641)
    bytes_19746 = smax64(np.int64(0), binop_y_19745)
    binop_x_19563 = (Ry_18859 * group_sizze_18874)
    binop_x_19564 = (Rx_18861 * binop_x_19563)
    bytes_19565 = (np.int64(8) * binop_x_19564)
    binop_x_19555 = (Ry_18859 * Rx_18861)
    bytes_19556 = (np.int64(8) * binop_x_19555)
    binop_y_19567 = (np.int64(8) * a_loc_szz_18868)
    bytes_19568 = smax64(np.int64(0), binop_y_19567)
    binop_y_19570 = (np.int64(8) * b_loc_szz_18870)
    bytes_19571 = smax64(np.int64(0), binop_y_19570)
    bytes_19642 = (np.int64(8) * binop_x_19563)
    binop_x_19645 = (Rx_18861 * group_sizze_18874)
    bytes_19646 = (np.int64(8) * binop_x_19645)
    bytes_19632 = (np.int64(8) * Ry_18859)
    bytes_19634 = (np.int64(8) * Rx_18861)
    binop_x_19838 = (np.int64(8) * Ty_18858)
    binop_x_19839 = (Tx_18860 * binop_x_19838)
    binop_x_19840 = (Ry_18859 * binop_x_19839)
    sizze_19841 = (Rx_18861 * binop_x_19840)
    binop_x_19849 = (np.int64(8) * Ty_18858)
    binop_x_19850 = (Tx_18860 * binop_x_19849)
    binop_x_19851 = (Ry_18859 * binop_x_19850)
    num_bytes_19852 = (Rx_18861 * binop_x_19851)
    binop_x_19857 = (np.int64(8) * Ty_18858)
    binop_x_19858 = (Tx_18860 * binop_x_19857)
    binop_x_19859 = (Ry_18859 * binop_x_19858)
    num_bytes_19860 = (Rx_18861 * binop_x_19859)
    maxSubHelper_19868 = umax64(bytes_19439, bytes_19454)
    maxSubHelper_19872 = umax64(bytes_19439, bytes_19454)
    maxSubHelper_19881 = umax64(num_bytes_19852, num_bytes_19860)
    maxSubHelper_19882 = umax64(bytes_19565, sizze_19841)
    num_threads_19907 = (segmap_group_sizze_18160 * num_groups_18161)
    total_sizze_19908 = (bytes_19454 * num_threads_19907)
    total_sizze_19909 = (maxSubHelper_19868 * num_threads_19907)
    total_sizze_19910 = (bytes_19454 * num_threads_19907)
    local_memory_capacity_20483 = self.max_local_memory
    if (sle64(np.int64(0),
              sext_i32_i64(local_memory_capacity_20483)) and suff_outer_par_18025):
      mem_19436 = opencl_alloc(self, binop_y_19395, "mem_19436")
      self.futhark_builtinzhgpu_map_transpose_f64(mem_19436, np.int64(0),
                                                  mem_19397, np.int64(0),
                                                  np.int64(1), Kx_16781,
                                                  N_16778)
      mem_19515 = opencl_alloc(self, bytes_19514, "mem_19515")
      mem_19518 = opencl_alloc(self, bytes_19517, "mem_19518")
      mem_19521 = opencl_alloc(self, bytes_19517, "mem_19521")
      color_19869 = opencl_alloc(self, total_sizze_19908, "color_19869")
      color_19870 = opencl_alloc(self, total_sizze_19909, "color_19870")
      color_19871 = opencl_alloc(self, total_sizze_19910, "color_19871")
      if ((1 * (np.int64(num_groups_18161) * np.int64(segmap_group_sizze_18160))) != 0):
        self.generate_datazisegmap_18027_var.set_args(self.global_failure,
                                                      np.int64(N_16778),
                                                      np.int64(J_16779),
                                                      np.int64(Kzz_16780),
                                                      np.int64(Kx_16781),
                                                      np.int64(defunc_2_reduce_res_17040),
                                                      np.int64(defunc_2_reduce_res_17041),
                                                      np.int64(num_groups_18161),
                                                      np.int64(num_threads_19907),
                                                      mem_19419, mem_19433,
                                                      mem_19436, mem_19515,
                                                      mem_19518, mem_19521,
                                                      color_19869, color_19870,
                                                      color_19871)
        cl.enqueue_nd_range_kernel(self.queue,
                                   self.generate_datazisegmap_18027_var,
                                   ((np.int64(num_groups_18161) * np.int64(segmap_group_sizze_18160)),),
                                   (np.int64(segmap_group_sizze_18160),))
        if synchronous:
          sync(self)
      mem_19436 = None
      color_19869 = None
      color_19870 = None
      color_19871 = None
      mem_19789 = opencl_alloc(self, bytes_19788, "mem_19789")
      self.futhark_builtinzhgpu_map_transpose_f64(mem_19789, np.int64(0),
                                                  mem_19518, np.int64(0),
                                                  np.int64(1), N_16778, J_16779)
      mem_19518 = None
      mem_19794 = opencl_alloc(self, bytes_19788, "mem_19794")
      self.futhark_builtinzhgpu_map_transpose_f64(mem_19794, np.int64(0),
                                                  mem_19521, np.int64(0),
                                                  np.int64(1), N_16778, J_16779)
      mem_19521 = None
      ext_mem_19798 = mem_19515
      ext_mem_19797 = mem_19789
      ext_mem_19796 = mem_19794
    else:
      local_memory_capacity_20482 = self.max_local_memory
      if (sle64(((((((bytes_19454 + srem64((np.int64(8) - srem64(bytes_19454,
                                                                 np.int64(8))),
                                           np.int64(8))) + (maxSubHelper_19872 + srem64((np.int64(8) - srem64(maxSubHelper_19872,
                                                                                                              np.int64(8))),
                                                                                        np.int64(8)))) + (bytes_19454 + srem64((np.int64(8) - srem64(bytes_19454,
                                                                                                                                                     np.int64(8))),
                                                                                                                               np.int64(8)))) + ((np.int64(8) * (Kzz_16780 * Kx_16781)) + srem64((np.int64(8) - srem64((np.int64(8) * (Kzz_16780 * Kx_16781)),
                                                                                                                                                                                                                       np.int64(8))),
                                                                                                                                                                                                 np.int64(8)))) + ((np.int64(8) * J_16779) + srem64((np.int64(8) - srem64((np.int64(8) * J_16779),
                                                                                                                                                                                                                                                                          np.int64(8))),
                                                                                                                                                                                                                                                    np.int64(8)))) + ((np.int64(8) * J_16779) + srem64((np.int64(8) - srem64((np.int64(8) * J_16779),
                                                                                                                                                                                                                                                                                                                             np.int64(8))),
                                                                                                                                                                                                                                                                                                       np.int64(8)))),
                sext_i32_i64(local_memory_capacity_20482)) and intra_suff_and_fits_18295):
        mem_19544 = opencl_alloc(self, bytes_19514, "mem_19544")
        mem_19548 = opencl_alloc(self, bytes_19788, "mem_19548")
        mem_19552 = opencl_alloc(self, bytes_19788, "mem_19552")
        if ((1 * (np.int64(N_16778) * np.int64(computed_group_sizze_18002))) != 0):
          self.generate_datazisegmap_intragroup_18023_var.set_args(self.global_failure,
                                                                   cl.LocalMemory(np.int64((np.int64(8) * J_16779))),
                                                                   cl.LocalMemory(np.int64((np.int64(8) * J_16779))),
                                                                   cl.LocalMemory(np.int64((np.int64(8) * (Kzz_16780 * Kx_16781)))),
                                                                   cl.LocalMemory(np.int64(bytes_19454)),
                                                                   cl.LocalMemory(np.int64(maxSubHelper_19872)),
                                                                   cl.LocalMemory(np.int64(bytes_19454)),
                                                                   np.int64(N_16778),
                                                                   np.int64(J_16779),
                                                                   np.int64(Kzz_16780),
                                                                   np.int64(Kx_16781),
                                                                   np.int64(defunc_2_reduce_res_17040),
                                                                   np.int64(defunc_2_reduce_res_17041),
                                                                   np.int64(computed_group_sizze_18002),
                                                                   mem_19397,
                                                                   mem_19419,
                                                                   mem_19433,
                                                                   mem_19544,
                                                                   mem_19548,
                                                                   mem_19552)
          cl.enqueue_nd_range_kernel(self.queue,
                                     self.generate_datazisegmap_intragroup_18023_var,
                                     ((np.int64(N_16778) * np.int64(computed_group_sizze_18002)),),
                                     (np.int64(computed_group_sizze_18002),))
          if synchronous:
            sync(self)
        ext_mem_19785 = mem_19544
        ext_mem_19784 = mem_19548
        ext_mem_19783 = mem_19552
      else:
        local_memory_capacity_20287 = self.max_local_memory
        if (sle64(((bytes_19571 + srem64((np.int64(8) - srem64(bytes_19571,
                                                               np.int64(8))),
                                         np.int64(8))) + (bytes_19568 + srem64((np.int64(8) - srem64(bytes_19568,
                                                                                                     np.int64(8))),
                                                                               np.int64(8)))),
                  sext_i32_i64(local_memory_capacity_20287)) and suff_outer_par_18642):
          tk_div_tx_18863 = sdiv_up64(Tk_18862, Tx_18860)
          tk_div_ty_18864 = sdiv_up64(Tk_18862, Ty_18858)
          gridDim_x_18871 = sdiv_up64(Kzz_16780, TxRx_18865)
          gridDim_y_18872 = sdiv_up64(N_16778, TyRy_18866)
          grid_sizze_18873 = (gridDim_x_18871 * gridDim_y_18872)
          full_tiles_18902 = squot64(Kx_16781, Tk_18862)
          kk_19105 = (Tk_18862 * full_tiles_18902)
          mem_19747 = opencl_alloc(self, bytes_19746, "mem_19747")
          if ((1 * (np.int64(grid_sizze_18873) * np.int64(group_sizze_18874))) != 0):
            self.generate_datazisegmap_intragroup_18877_var.set_args(self.global_failure,
                                                                     cl.LocalMemory(np.int64(bytes_19568)),
                                                                     cl.LocalMemory(np.int64(bytes_19571)),
                                                                     np.int64(N_16778),
                                                                     np.int64(Kzz_16780),
                                                                     np.int64(Kx_16781),
                                                                     np.int64(gridDim_x_18871),
                                                                     np.int64(gridDim_y_18872),
                                                                     np.int64(full_tiles_18902),
                                                                     np.int64(kk_19105),
                                                                     mem_19397,
                                                                     mem_19433,
                                                                     mem_19747)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.generate_datazisegmap_intragroup_18877_var,
                                       ((np.int64(grid_sizze_18873) * np.int64(group_sizze_18874)),),
                                       (np.int64(group_sizze_18874),))
            if synchronous:
              sync(self)
          ext_mem_19753 = mem_19747
        else:
          mem_19752 = opencl_alloc(self, bytes_19746, "mem_19752")
          if slt64((Kx_16781 * np.int64(2)), segred_group_sizze_18657):
            segment_sizze_nonzzero_20219 = smax64(np.int64(1), Kx_16781)
            num_threads_20220 = (num_groups_18658 * segred_group_sizze_18657)
            if ((1 * (np.int64(num_groups_18658) * np.int64(segred_group_sizze_18657))) != 0):
              self.generate_datazisegred_small_18611_var.set_args(self.global_failure,
                                                                  cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_18657))),
                                                                  np.int64(N_16778),
                                                                  np.int64(Kzz_16780),
                                                                  np.int64(Kx_16781),
                                                                  np.int64(num_groups_18658),
                                                                  np.int64(segment_sizze_nonzzero_20219),
                                                                  mem_19397,
                                                                  mem_19433,
                                                                  mem_19752)
              cl.enqueue_nd_range_kernel(self.queue,
                                         self.generate_datazisegred_small_18611_var,
                                         ((np.int64(num_groups_18658) * np.int64(segred_group_sizze_18657)),),
                                         (np.int64(segred_group_sizze_18657),))
              if synchronous:
                sync(self)
          else:
            groups_per_segment_20244 = sdiv_up64(num_groups_18658,
                                                 smax64(np.int64(1),
                                                        (N_16778 * Kzz_16780)))
            elements_per_thread_20245 = sdiv_up64(Kx_16781,
                                                  (segred_group_sizze_18657 * groups_per_segment_20244))
            virt_num_groups_20246 = (groups_per_segment_20244 * (N_16778 * Kzz_16780))
            num_threads_20247 = (num_groups_18658 * segred_group_sizze_18657)
            threads_per_segment_20248 = (groups_per_segment_20244 * segred_group_sizze_18657)
            segred_tmp_mem_20249 = opencl_alloc(self,
                                                (np.int64(8) * virt_num_groups_20246),
                                                "segred_tmp_mem_20249")
            generate_datazicounter_mem_20251 = self.generate_datazicounter_mem_20251
            if ((1 * (np.int64(num_groups_18658) * np.int64(segred_group_sizze_18657))) != 0):
              self.generate_datazisegred_large_18611_var.set_args(self.global_failure,
                                                                  cl.LocalMemory(np.int64(np.int32(1))),
                                                                  cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_18657))),
                                                                  np.int64(N_16778),
                                                                  np.int64(Kzz_16780),
                                                                  np.int64(Kx_16781),
                                                                  np.int64(num_groups_18658),
                                                                  np.int64(groups_per_segment_20244),
                                                                  np.int64(elements_per_thread_20245),
                                                                  np.int64(virt_num_groups_20246),
                                                                  np.int64(threads_per_segment_20248),
                                                                  mem_19397,
                                                                  mem_19433,
                                                                  mem_19752,
                                                                  segred_tmp_mem_20249,
                                                                  generate_datazicounter_mem_20251)
              cl.enqueue_nd_range_kernel(self.queue,
                                         self.generate_datazisegred_large_18611_var,
                                         ((np.int64(num_groups_18658) * np.int64(segred_group_sizze_18657)),),
                                         (np.int64(segred_group_sizze_18657),))
              if synchronous:
                sync(self)
          ext_mem_19753 = mem_19752
        mem_19757 = opencl_alloc(self, bytes_19514, "mem_19757")
        mem_19761 = opencl_alloc(self, bytes_19788, "mem_19761")
        if slt64((J_16779 * np.int64(2)), segred_group_sizze_18672):
          segment_sizze_nonzzero_20288 = smax64(np.int64(1), J_16779)
          num_threads_20289 = (num_groups_18673 * segred_group_sizze_18672)
          if ((1 * (np.int64(num_groups_18673) * np.int64(segred_group_sizze_18672))) != 0):
            self.generate_datazisegred_small_18566_var.set_args(self.global_failure,
                                                                cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_18672))),
                                                                np.int64(N_16778),
                                                                np.int64(J_16779),
                                                                np.int64(Kzz_16780),
                                                                np.int64(num_groups_18673),
                                                                np.int64(segment_sizze_nonzzero_20288),
                                                                mem_19419,
                                                                ext_mem_19753,
                                                                mem_19757,
                                                                mem_19761)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.generate_datazisegred_small_18566_var,
                                       ((np.int64(num_groups_18673) * np.int64(segred_group_sizze_18672)),),
                                       (np.int64(segred_group_sizze_18672),))
            if synchronous:
              sync(self)
        else:
          groups_per_segment_20312 = sdiv_up64(num_groups_18673,
                                               smax64(np.int64(1), N_16778))
          elements_per_thread_20313 = sdiv_up64(J_16779,
                                                (segred_group_sizze_18672 * groups_per_segment_20312))
          virt_num_groups_20314 = (groups_per_segment_20312 * N_16778)
          num_threads_20315 = (num_groups_18673 * segred_group_sizze_18672)
          threads_per_segment_20316 = (groups_per_segment_20312 * segred_group_sizze_18672)
          segred_tmp_mem_20317 = opencl_alloc(self,
                                              (np.int64(8) * virt_num_groups_20314),
                                              "segred_tmp_mem_20317")
          generate_datazicounter_mem_20319 = self.generate_datazicounter_mem_20319
          if ((1 * (np.int64(num_groups_18673) * np.int64(segred_group_sizze_18672))) != 0):
            self.generate_datazisegred_large_18566_var.set_args(self.global_failure,
                                                                cl.LocalMemory(np.int64(np.int32(1))),
                                                                cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_18672))),
                                                                np.int64(N_16778),
                                                                np.int64(J_16779),
                                                                np.int64(Kzz_16780),
                                                                np.int64(num_groups_18673),
                                                                np.int64(groups_per_segment_20312),
                                                                np.int64(elements_per_thread_20313),
                                                                np.int64(virt_num_groups_20314),
                                                                np.int64(threads_per_segment_20316),
                                                                mem_19419,
                                                                ext_mem_19753,
                                                                mem_19757,
                                                                mem_19761,
                                                                segred_tmp_mem_20317,
                                                                generate_datazicounter_mem_20319)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.generate_datazisegred_large_18566_var,
                                       ((np.int64(num_groups_18673) * np.int64(segred_group_sizze_18672)),),
                                       (np.int64(segred_group_sizze_18672),))
            if synchronous:
              sync(self)
        ext_mem_19753 = None
        mem_19765 = opencl_alloc(self, bytes_19514, "mem_19765")
        mem_19769 = opencl_alloc(self, bytes_19788, "mem_19769")
        if slt64((J_16779 * np.int64(2)), segred_group_sizze_18691):
          segment_sizze_nonzzero_20354 = smax64(np.int64(1), J_16779)
          num_threads_20355 = (num_groups_18692 * segred_group_sizze_18691)
          if ((1 * (np.int64(num_groups_18692) * np.int64(segred_group_sizze_18691))) != 0):
            self.generate_datazisegred_small_18547_var.set_args(self.global_failure,
                                                                cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_18691))),
                                                                np.int64(N_16778),
                                                                np.int64(J_16779),
                                                                np.int64(num_groups_18692),
                                                                np.int64(segment_sizze_nonzzero_20354),
                                                                mem_19757,
                                                                mem_19761,
                                                                mem_19765,
                                                                mem_19769)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.generate_datazisegred_small_18547_var,
                                       ((np.int64(num_groups_18692) * np.int64(segred_group_sizze_18691)),),
                                       (np.int64(segred_group_sizze_18691),))
            if synchronous:
              sync(self)
        else:
          groups_per_segment_20377 = sdiv_up64(num_groups_18692,
                                               smax64(np.int64(1), N_16778))
          elements_per_thread_20378 = sdiv_up64(J_16779,
                                                (segred_group_sizze_18691 * groups_per_segment_20377))
          virt_num_groups_20379 = (groups_per_segment_20377 * N_16778)
          num_threads_20380 = (num_groups_18692 * segred_group_sizze_18691)
          threads_per_segment_20381 = (groups_per_segment_20377 * segred_group_sizze_18691)
          segred_tmp_mem_20382 = opencl_alloc(self,
                                              (np.int64(8) * virt_num_groups_20379),
                                              "segred_tmp_mem_20382")
          generate_datazicounter_mem_20384 = self.generate_datazicounter_mem_20384
          if ((1 * (np.int64(num_groups_18692) * np.int64(segred_group_sizze_18691))) != 0):
            self.generate_datazisegred_large_18547_var.set_args(self.global_failure,
                                                                cl.LocalMemory(np.int64(np.int32(1))),
                                                                cl.LocalMemory(np.int64((np.int64(8) * segred_group_sizze_18691))),
                                                                np.int64(N_16778),
                                                                np.int64(J_16779),
                                                                np.int64(num_groups_18692),
                                                                np.int64(groups_per_segment_20377),
                                                                np.int64(elements_per_thread_20378),
                                                                np.int64(virt_num_groups_20379),
                                                                np.int64(threads_per_segment_20381),
                                                                mem_19757,
                                                                mem_19761,
                                                                mem_19765,
                                                                mem_19769,
                                                                segred_tmp_mem_20382,
                                                                generate_datazicounter_mem_20384)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.generate_datazisegred_large_18547_var,
                                       ((np.int64(num_groups_18692) * np.int64(segred_group_sizze_18691)),),
                                       (np.int64(segred_group_sizze_18691),))
            if synchronous:
              sync(self)
        mem_19757 = None
        mem_19761 = None
        mem_19774 = opencl_alloc(self, bytes_19788, "mem_19774")
        mem_19778 = opencl_alloc(self, bytes_19788, "mem_19778")
        if slt64(np.int64(0), (N_16778 * J_16779)):
          stage1_max_num_groups_20418 = self.max_group_size
          stage1_num_groups_20419 = smin64(stage1_max_num_groups_20418,
                                           num_groups_18707)
          num_threads_20420 = sext_i64_i32((stage1_num_groups_20419 * segscan_group_sizze_18706))
          if ((1 * (np.int64(stage1_num_groups_20419) * np.int64(segscan_group_sizze_18706))) != 0):
            self.generate_dataziscan_stage1_18528_var.set_args(self.global_failure,
                                                               cl.LocalMemory(np.int64(smax64(np.int64(1),
                                                                                              (np.int64(8) * segscan_group_sizze_18706)))),
                                                               np.int64(N_16778),
                                                               np.int64(J_16779),
                                                               np.int32(num_threads_20420),
                                                               mem_19765,
                                                               mem_19769,
                                                               mem_19774,
                                                               mem_19778)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.generate_dataziscan_stage1_18528_var,
                                       ((np.int64(stage1_num_groups_20419) * np.int64(segscan_group_sizze_18706)),),
                                       (np.int64(segscan_group_sizze_18706),))
            if synchronous:
              sync(self)
          if ((1 * (np.int64(np.int64(1)) * np.int64(stage1_num_groups_20419))) != 0):
            self.generate_dataziscan_stage2_18528_var.set_args(self.global_failure,
                                                               cl.LocalMemory(np.int64(smax64(np.int64(1),
                                                                                              (np.int64(8) * stage1_num_groups_20419)))),
                                                               np.int64(N_16778),
                                                               np.int64(J_16779),
                                                               np.int64(stage1_num_groups_20419),
                                                               np.int32(num_threads_20420),
                                                               mem_19774)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.generate_dataziscan_stage2_18528_var,
                                       ((np.int64(np.int64(1)) * np.int64(stage1_num_groups_20419)),),
                                       (np.int64(stage1_num_groups_20419),))
            if synchronous:
              sync(self)
          required_groups_20462 = sext_i64_i32(sdiv_up64((N_16778 * J_16779),
                                                         segscan_group_sizze_18706))
          if ((1 * (np.int64(num_groups_18707) * np.int64(segscan_group_sizze_18706))) != 0):
            self.generate_dataziscan_stage3_18528_var.set_args(self.global_failure,
                                                               np.int64(N_16778),
                                                               np.int64(J_16779),
                                                               np.int64(num_groups_18707),
                                                               np.int32(num_threads_20420),
                                                               np.int32(required_groups_20462),
                                                               mem_19774)
            cl.enqueue_nd_range_kernel(self.queue,
                                       self.generate_dataziscan_stage3_18528_var,
                                       ((np.int64(num_groups_18707) * np.int64(segscan_group_sizze_18706)),),
                                       (np.int64(segscan_group_sizze_18706),))
            if synchronous:
              sync(self)
        mem_19765 = None
        mem_19769 = None
        segmap_usable_groups_18720 = sdiv_up64(N_16778,
                                               segmap_group_sizze_18719)
        mem_19782 = opencl_alloc(self, bytes_19514, "mem_19782")
        if ((1 * (np.int64(segmap_usable_groups_18720) * np.int64(segmap_group_sizze_18719))) != 0):
          self.generate_datazisegmap_18425_var.set_args(self.global_failure,
                                                        np.int64(N_16778),
                                                        np.int64(defunc_2_reduce_res_17040),
                                                        np.int64(defunc_2_reduce_res_17041),
                                                        mem_19782)
          cl.enqueue_nd_range_kernel(self.queue,
                                     self.generate_datazisegmap_18425_var,
                                     ((np.int64(segmap_usable_groups_18720) * np.int64(segmap_group_sizze_18719)),),
                                     (np.int64(segmap_group_sizze_18719),))
          if synchronous:
            sync(self)
        ext_mem_19785 = mem_19782
        ext_mem_19784 = mem_19774
        ext_mem_19783 = mem_19778
      ext_mem_19798 = ext_mem_19785
      ext_mem_19797 = ext_mem_19784
      ext_mem_19796 = ext_mem_19783
    mem_19801 = opencl_alloc(self, bytes_19514, "mem_19801")
    self.futhark_builtinzhreplicate_i64(mem_19801, N_16778, np.int64(0))
    upper_bound_17314 = (J_16779 - np.int64(1))
    segmap_group_sizze_18819 = self.sizes["generate_data.segmap_group_size_18818"]
    segmap_usable_groups_18820 = sdiv_up_safe64(N_16778,
                                                segmap_group_sizze_18819)
    j_17316 = np.int64(0)
    one_20525 = np.int64(1)
    for counter_20524 in range(upper_bound_17314):
      y_17318 = slt64(j_17316, J_16779)
      index_ok_17319 = (ok_or_empty_16920 and y_17318)
      index_certs_17320 = True
      assert index_ok_17319, ("Error: %s%d%s%d%s%d%s%d%s\n\nBacktrace:\n-> #0  logit.fut:63:30-41\n   #1  logit.fut:105:11-34\n   #2  logit.fut:100:1-106:25\n" % ("Index [",
                                                                                                                                                                   np.int64(0),
                                                                                                                                                                   ":, ",
                                                                                                                                                                   j_17316,
                                                                                                                                                                   "] out of bounds for array of shape [",
                                                                                                                                                                   N_16778,
                                                                                                                                                                   "][",
                                                                                                                                                                   J_16779,
                                                                                                                                                                   "]."))
      replicate_arg_17322 = (np.int64(1) + j_17316)
      if ((1 * (np.int64(segmap_usable_groups_18820) * np.int64(segmap_group_sizze_18819))) != 0):
        self.generate_datazisegmap_18816_var.set_args(self.global_failure,
                                                      np.int64(N_16778),
                                                      np.int64(J_16779),
                                                      np.int64(j_17316),
                                                      np.int64(replicate_arg_17322),
                                                      ext_mem_19797,
                                                      ext_mem_19798, mem_19801)
        cl.enqueue_nd_range_kernel(self.queue,
                                   self.generate_datazisegmap_18816_var,
                                   ((np.int64(segmap_usable_groups_18820) * np.int64(segmap_group_sizze_18819)),),
                                   (np.int64(segmap_group_sizze_18819),))
        if synchronous:
          sync(self)
      j_17316 += one_20525
    ext_mem_19797 = None
    ext_mem_19798 = None
    mem_19818 = opencl_alloc(self, bytes_19412, "mem_19818")
    if (((Kzz_16780 * J_16779) * np.int64(8)) != 0):
      cl.enqueue_copy(self.queue, mem_19818, mem_19419,
                      dest_offset=np.int64(np.int64(0)),
                      src_offset=np.int64(np.int64(0)),
                      byte_count=np.int64(((Kzz_16780 * J_16779) * np.int64(8))))
    if synchronous:
      sync(self)
    mem_19419 = None
    mem_19823 = opencl_alloc(self, bytes_19426, "mem_19823")
    if (((Kx_16781 * Kzz_16780) * np.int64(8)) != 0):
      cl.enqueue_copy(self.queue, mem_19823, mem_19433,
                      dest_offset=np.int64(np.int64(0)),
                      src_offset=np.int64(np.int64(0)),
                      byte_count=np.int64(((Kx_16781 * Kzz_16780) * np.int64(8))))
    if synchronous:
      sync(self)
    mem_19433 = None
    mem_19827 = opencl_alloc(self, bytes_19514, "mem_19827")
    if ((N_16778 * np.int64(8)) != 0):
      cl.enqueue_copy(self.queue, mem_19827, mem_19801,
                      dest_offset=np.int64(np.int64(0)),
                      src_offset=np.int64(np.int64(0)),
                      byte_count=np.int64((N_16778 * np.int64(8))))
    if synchronous:
      sync(self)
    mem_19801 = None
    mem_out_19919 = mem_19397
    mem_out_19920 = mem_19818
    mem_out_19921 = mem_19823
    mem_out_19922 = ext_mem_19796
    mem_out_19923 = mem_19827
    return (mem_out_19919, mem_out_19920, mem_out_19921, mem_out_19922,
            mem_out_19923)
self = internal()
def entry_entry_criterion():
  x_mem_19394_ext = read_value("[][]f64")
  zz_mem_19395_ext = read_value("[][]f64")
  beta_mem_19396_ext = read_value("[][]f64")
  _ccp_mem_19397_ext = read_value("[][]f64")
  d_mem_19398_ext = read_value("[]i64")
  end_of_input("entry_criterion")
  implz2088U_16707 = None
  implz2081U_16706 = None
  implz2082U_16708 = None
  implz2083U_16709 = None
  implz2084U_16710 = None
  implz2085U_16711 = None
  implz2086U_16712 = None
  implz2087U_16713 = None
  implz2088U_16707 = None
  try:
    assert ((type(x_mem_19394_ext) in [np.ndarray,
                                       cl.array.Array]) and (x_mem_19394_ext.dtype == np.float64)), "Parameter has unexpected type"
    if (implz2088U_16707 == None):
      implz2088U_16707 = np.int64(x_mem_19394_ext.shape[0])
    else:
      assert (implz2088U_16707 == x_mem_19394_ext.shape[0]), "Error: entry point arguments have invalid sizes."
    if (implz2081U_16706 == None):
      implz2081U_16706 = np.int64(x_mem_19394_ext.shape[1])
    else:
      assert (implz2081U_16706 == x_mem_19394_ext.shape[1]), "Error: entry point arguments have invalid sizes."
    if (type(x_mem_19394_ext) == cl.array.Array):
      x_mem_19394 = x_mem_19394_ext.data
    else:
      x_mem_19394 = opencl_alloc(self, np.int64(x_mem_19394_ext.nbytes),
                                 "x_mem_19394")
      if (np.int64(x_mem_19394_ext.nbytes) != 0):
        cl.enqueue_copy(self.queue, x_mem_19394,
                        normaliseArray(x_mem_19394_ext),
                        is_blocking=synchronous)
  except (TypeError, AssertionError) as e:
    raise TypeError("Argument #0 has invalid value\nFuthark type: {}\nArgument has Python type {} and value: {}\n".format("[][]f64",
                                                                                                                          type(x_mem_19394_ext),
                                                                                                                          x_mem_19394_ext))
  try:
    assert ((type(zz_mem_19395_ext) in [np.ndarray,
                                        cl.array.Array]) and (zz_mem_19395_ext.dtype == np.float64)), "Parameter has unexpected type"
    if (implz2082U_16708 == None):
      implz2082U_16708 = np.int64(zz_mem_19395_ext.shape[0])
    else:
      assert (implz2082U_16708 == zz_mem_19395_ext.shape[0]), "Error: entry point arguments have invalid sizes."
    if (implz2083U_16709 == None):
      implz2083U_16709 = np.int64(zz_mem_19395_ext.shape[1])
    else:
      assert (implz2083U_16709 == zz_mem_19395_ext.shape[1]), "Error: entry point arguments have invalid sizes."
    if (type(zz_mem_19395_ext) == cl.array.Array):
      zz_mem_19395 = zz_mem_19395_ext.data
    else:
      zz_mem_19395 = opencl_alloc(self, np.int64(zz_mem_19395_ext.nbytes),
                                  "zz_mem_19395")
      if (np.int64(zz_mem_19395_ext.nbytes) != 0):
        cl.enqueue_copy(self.queue, zz_mem_19395,
                        normaliseArray(zz_mem_19395_ext),
                        is_blocking=synchronous)
  except (TypeError, AssertionError) as e:
    raise TypeError("Argument #1 has invalid value\nFuthark type: {}\nArgument has Python type {} and value: {}\n".format("[][]f64",
                                                                                                                          type(zz_mem_19395_ext),
                                                                                                                          zz_mem_19395_ext))
  try:
    assert ((type(beta_mem_19396_ext) in [np.ndarray,
                                          cl.array.Array]) and (beta_mem_19396_ext.dtype == np.float64)), "Parameter has unexpected type"
    if (implz2084U_16710 == None):
      implz2084U_16710 = np.int64(beta_mem_19396_ext.shape[0])
    else:
      assert (implz2084U_16710 == beta_mem_19396_ext.shape[0]), "Error: entry point arguments have invalid sizes."
    if (implz2085U_16711 == None):
      implz2085U_16711 = np.int64(beta_mem_19396_ext.shape[1])
    else:
      assert (implz2085U_16711 == beta_mem_19396_ext.shape[1]), "Error: entry point arguments have invalid sizes."
    if (type(beta_mem_19396_ext) == cl.array.Array):
      beta_mem_19396 = beta_mem_19396_ext.data
    else:
      beta_mem_19396 = opencl_alloc(self, np.int64(beta_mem_19396_ext.nbytes),
                                    "beta_mem_19396")
      if (np.int64(beta_mem_19396_ext.nbytes) != 0):
        cl.enqueue_copy(self.queue, beta_mem_19396,
                        normaliseArray(beta_mem_19396_ext),
                        is_blocking=synchronous)
  except (TypeError, AssertionError) as e:
    raise TypeError("Argument #2 has invalid value\nFuthark type: {}\nArgument has Python type {} and value: {}\n".format("[][]f64",
                                                                                                                          type(beta_mem_19396_ext),
                                                                                                                          beta_mem_19396_ext))
  try:
    assert ((type(_ccp_mem_19397_ext) in [np.ndarray,
                                          cl.array.Array]) and (_ccp_mem_19397_ext.dtype == np.float64)), "Parameter has unexpected type"
    if (implz2086U_16712 == None):
      implz2086U_16712 = np.int64(_ccp_mem_19397_ext.shape[0])
    else:
      assert (implz2086U_16712 == _ccp_mem_19397_ext.shape[0]), "Error: entry point arguments have invalid sizes."
    if (implz2087U_16713 == None):
      implz2087U_16713 = np.int64(_ccp_mem_19397_ext.shape[1])
    else:
      assert (implz2087U_16713 == _ccp_mem_19397_ext.shape[1]), "Error: entry point arguments have invalid sizes."
    if (type(_ccp_mem_19397_ext) == cl.array.Array):
      _ccp_mem_19397 = _ccp_mem_19397_ext.data
    else:
      _ccp_mem_19397 = opencl_alloc(self, np.int64(_ccp_mem_19397_ext.nbytes),
                                    "_ccp_mem_19397")
      if (np.int64(_ccp_mem_19397_ext.nbytes) != 0):
        cl.enqueue_copy(self.queue, _ccp_mem_19397,
                        normaliseArray(_ccp_mem_19397_ext),
                        is_blocking=synchronous)
  except (TypeError, AssertionError) as e:
    raise TypeError("Argument #3 has invalid value\nFuthark type: {}\nArgument has Python type {} and value: {}\n".format("[][]f64",
                                                                                                                          type(_ccp_mem_19397_ext),
                                                                                                                          _ccp_mem_19397_ext))
  try:
    assert ((type(d_mem_19398_ext) in [np.ndarray,
                                       cl.array.Array]) and (d_mem_19398_ext.dtype == np.int64)), "Parameter has unexpected type"
    if (implz2088U_16707 == None):
      implz2088U_16707 = np.int64(d_mem_19398_ext.shape[0])
    else:
      assert (implz2088U_16707 == d_mem_19398_ext.shape[0]), "Error: entry point arguments have invalid sizes."
    if (type(d_mem_19398_ext) == cl.array.Array):
      d_mem_19398 = d_mem_19398_ext.data
    else:
      d_mem_19398 = opencl_alloc(self, np.int64(d_mem_19398_ext.nbytes),
                                 "d_mem_19398")
      if (np.int64(d_mem_19398_ext.nbytes) != 0):
        cl.enqueue_copy(self.queue, d_mem_19398,
                        normaliseArray(d_mem_19398_ext),
                        is_blocking=synchronous)
  except (TypeError, AssertionError) as e:
    raise TypeError("Argument #4 has invalid value\nFuthark type: {}\nArgument has Python type {} and value: {}\n".format("[]i64",
                                                                                                                          type(d_mem_19398_ext),
                                                                                                                          d_mem_19398_ext))
  try:
    if do_warmup_run:
      x_mem_copy_20526 = opencl_alloc(self, x_mem_19394_ext.nbytes,
                                      "x_mem_copy_20526")
      if (x_mem_19394_ext.nbytes != 0):
        cl.enqueue_copy(self.queue, x_mem_copy_20526, x_mem_19394,
                        dest_offset=np.int64(0), src_offset=np.int64(0),
                        byte_count=np.int64(x_mem_19394_ext.nbytes))
      if synchronous:
        sync(self)
      zz_mem_copy_20527 = opencl_alloc(self, zz_mem_19395_ext.nbytes,
                                       "zz_mem_copy_20527")
      if (zz_mem_19395_ext.nbytes != 0):
        cl.enqueue_copy(self.queue, zz_mem_copy_20527, zz_mem_19395,
                        dest_offset=np.int64(0), src_offset=np.int64(0),
                        byte_count=np.int64(zz_mem_19395_ext.nbytes))
      if synchronous:
        sync(self)
      beta_mem_copy_20528 = opencl_alloc(self, beta_mem_19396_ext.nbytes,
                                         "beta_mem_copy_20528")
      if (beta_mem_19396_ext.nbytes != 0):
        cl.enqueue_copy(self.queue, beta_mem_copy_20528, beta_mem_19396,
                        dest_offset=np.int64(0), src_offset=np.int64(0),
                        byte_count=np.int64(beta_mem_19396_ext.nbytes))
      if synchronous:
        sync(self)
      _ccp_mem_copy_20529 = opencl_alloc(self, _ccp_mem_19397_ext.nbytes,
                                         "_ccp_mem_copy_20529")
      if (_ccp_mem_19397_ext.nbytes != 0):
        cl.enqueue_copy(self.queue, _ccp_mem_copy_20529, _ccp_mem_19397,
                        dest_offset=np.int64(0), src_offset=np.int64(0),
                        byte_count=np.int64(_ccp_mem_19397_ext.nbytes))
      if synchronous:
        sync(self)
      d_mem_copy_20530 = opencl_alloc(self, d_mem_19398_ext.nbytes,
                                      "d_mem_copy_20530")
      if (d_mem_19398_ext.nbytes != 0):
        cl.enqueue_copy(self.queue, d_mem_copy_20530, d_mem_19398,
                        dest_offset=np.int64(0), src_offset=np.int64(0),
                        byte_count=np.int64(d_mem_19398_ext.nbytes))
      if synchronous:
        sync(self)
      with np.errstate(divide="ignore", over="ignore", under="ignore",
                       invalid="ignore"):
        prim_out_19919 = self.futhark_entry_criterion(x_mem_copy_20526,
                                                      zz_mem_copy_20527,
                                                      beta_mem_copy_20528,
                                                      _ccp_mem_copy_20529,
                                                      d_mem_copy_20530,
                                                      implz2081U_16706,
                                                      implz2088U_16707,
                                                      implz2082U_16708,
                                                      implz2083U_16709,
                                                      implz2084U_16710,
                                                      implz2085U_16711,
                                                      implz2086U_16712,
                                                      implz2087U_16713)
      sync(self)
    for i in range(int(num_runs)):
      x_mem_copy_20526 = opencl_alloc(self, x_mem_19394_ext.nbytes,
                                      "x_mem_copy_20526")
      if (x_mem_19394_ext.nbytes != 0):
        cl.enqueue_copy(self.queue, x_mem_copy_20526, x_mem_19394,
                        dest_offset=np.int64(0), src_offset=np.int64(0),
                        byte_count=np.int64(x_mem_19394_ext.nbytes))
      if synchronous:
        sync(self)
      zz_mem_copy_20527 = opencl_alloc(self, zz_mem_19395_ext.nbytes,
                                       "zz_mem_copy_20527")
      if (zz_mem_19395_ext.nbytes != 0):
        cl.enqueue_copy(self.queue, zz_mem_copy_20527, zz_mem_19395,
                        dest_offset=np.int64(0), src_offset=np.int64(0),
                        byte_count=np.int64(zz_mem_19395_ext.nbytes))
      if synchronous:
        sync(self)
      beta_mem_copy_20528 = opencl_alloc(self, beta_mem_19396_ext.nbytes,
                                         "beta_mem_copy_20528")
      if (beta_mem_19396_ext.nbytes != 0):
        cl.enqueue_copy(self.queue, beta_mem_copy_20528, beta_mem_19396,
                        dest_offset=np.int64(0), src_offset=np.int64(0),
                        byte_count=np.int64(beta_mem_19396_ext.nbytes))
      if synchronous:
        sync(self)
      _ccp_mem_copy_20529 = opencl_alloc(self, _ccp_mem_19397_ext.nbytes,
                                         "_ccp_mem_copy_20529")
      if (_ccp_mem_19397_ext.nbytes != 0):
        cl.enqueue_copy(self.queue, _ccp_mem_copy_20529, _ccp_mem_19397,
                        dest_offset=np.int64(0), src_offset=np.int64(0),
                        byte_count=np.int64(_ccp_mem_19397_ext.nbytes))
      if synchronous:
        sync(self)
      d_mem_copy_20530 = opencl_alloc(self, d_mem_19398_ext.nbytes,
                                      "d_mem_copy_20530")
      if (d_mem_19398_ext.nbytes != 0):
        cl.enqueue_copy(self.queue, d_mem_copy_20530, d_mem_19398,
                        dest_offset=np.int64(0), src_offset=np.int64(0),
                        byte_count=np.int64(d_mem_19398_ext.nbytes))
      if synchronous:
        sync(self)
      time_start = time.time()
      with np.errstate(divide="ignore", over="ignore", under="ignore",
                       invalid="ignore"):
        prim_out_19919 = self.futhark_entry_criterion(x_mem_copy_20526,
                                                      zz_mem_copy_20527,
                                                      beta_mem_copy_20528,
                                                      _ccp_mem_copy_20529,
                                                      d_mem_copy_20530,
                                                      implz2081U_16706,
                                                      implz2088U_16707,
                                                      implz2082U_16708,
                                                      implz2083U_16709,
                                                      implz2084U_16710,
                                                      implz2085U_16711,
                                                      implz2086U_16712,
                                                      implz2087U_16713)
      sync(self)
      time_end = time.time()
      if runtime_file:
        runtime_file.write(str((int((time_end * 1000000)) - int((time_start * 1000000)))))
        runtime_file.write("\n")
        runtime_file.flush()
  except AssertionError as e:
    sys.exit("Assertion.{} failed".format(e))
  if runtime_file:
    runtime_file.close()
  write_value(np.float64(prim_out_19919), binary=binary_output)
  sys.stdout.write("\n")
def entry_entry_generate_data():
  seed_16777_ext = read_value("i32")
  N_16778_ext = read_value("i64")
  J_16779_ext = read_value("i64")
  Kzz_16780_ext = read_value("i64")
  Kx_16781_ext = read_value("i64")
  end_of_input("entry_generate_data")
  try:
    seed_16777 = np.int32(seed_16777_ext)
  except (TypeError, AssertionError) as e:
    raise TypeError("Argument #0 has invalid value\nFuthark type: {}\nArgument has Python type {} and value: {}\n".format("i32",
                                                                                                                          type(seed_16777_ext),
                                                                                                                          seed_16777_ext))
  try:
    N_16778 = np.int64(ct.c_int64(N_16778_ext))
  except (TypeError, AssertionError) as e:
    raise TypeError("Argument #1 has invalid value\nFuthark type: {}\nArgument has Python type {} and value: {}\n".format("i64",
                                                                                                                          type(N_16778_ext),
                                                                                                                          N_16778_ext))
  try:
    J_16779 = np.int64(ct.c_int64(J_16779_ext))
  except (TypeError, AssertionError) as e:
    raise TypeError("Argument #2 has invalid value\nFuthark type: {}\nArgument has Python type {} and value: {}\n".format("i64",
                                                                                                                          type(J_16779_ext),
                                                                                                                          J_16779_ext))
  try:
    Kzz_16780 = np.int64(ct.c_int64(Kzz_16780_ext))
  except (TypeError, AssertionError) as e:
    raise TypeError("Argument #3 has invalid value\nFuthark type: {}\nArgument has Python type {} and value: {}\n".format("i64",
                                                                                                                          type(Kzz_16780_ext),
                                                                                                                          Kzz_16780_ext))
  try:
    Kx_16781 = np.int64(ct.c_int64(Kx_16781_ext))
  except (TypeError, AssertionError) as e:
    raise TypeError("Argument #4 has invalid value\nFuthark type: {}\nArgument has Python type {} and value: {}\n".format("i64",
                                                                                                                          type(Kx_16781_ext),
                                                                                                                          Kx_16781_ext))
  try:
    if do_warmup_run:
      with np.errstate(divide="ignore", over="ignore", under="ignore",
                       invalid="ignore"):
        (mem_out_19919, mem_out_19920, mem_out_19921, mem_out_19922,
         mem_out_19923) = self.futhark_entry_generate_data(seed_16777, N_16778,
                                                           J_16779, Kzz_16780,
                                                           Kx_16781)
      sync(self)
    for i in range(int(num_runs)):
      time_start = time.time()
      with np.errstate(divide="ignore", over="ignore", under="ignore",
                       invalid="ignore"):
        (mem_out_19919, mem_out_19920, mem_out_19921, mem_out_19922,
         mem_out_19923) = self.futhark_entry_generate_data(seed_16777, N_16778,
                                                           J_16779, Kzz_16780,
                                                           Kx_16781)
      sync(self)
      time_end = time.time()
      if runtime_file:
        runtime_file.write(str((int((time_end * 1000000)) - int((time_start * 1000000)))))
        runtime_file.write("\n")
        runtime_file.flush()
  except AssertionError as e:
    sys.exit("Assertion.{} failed".format(e))
  if runtime_file:
    runtime_file.close()
  write_value(cl.array.Array(self.queue, (N_16778, Kx_16781), np.float64, data=mem_out_19919).get(),
              binary=binary_output)
  sys.stdout.write("\n")
  write_value(cl.array.Array(self.queue, (Kzz_16780, J_16779), np.float64, data=mem_out_19920).get(),
              binary=binary_output)
  sys.stdout.write("\n")
  write_value(cl.array.Array(self.queue, (Kx_16781, Kzz_16780), np.float64,
               data=mem_out_19921).get(),
              binary=binary_output)
  sys.stdout.write("\n")
  write_value(cl.array.Array(self.queue, (N_16778, J_16779), np.float64, data=mem_out_19922).get(),
              binary=binary_output)
  sys.stdout.write("\n")
  write_value(cl.array.Array(self.queue, (N_16778,), np.int64, data=mem_out_19923).get(),
              binary=binary_output)
  sys.stdout.write("\n")
entry_points = {"criterion": entry_entry_criterion,
                "generate_data": entry_entry_generate_data}
entry_point_fun = entry_points.get(entry_point)
if (entry_point_fun == None):
  sys.exit("No entry point '{}'.  Select another with --entry point.  Options are:\n{}".format(entry_point,
                                                                                               "\n".join(entry_points.keys())))
else:
  entry_point_fun()